{"version":3,"file":"token-action-hud-core.min.mjs","sources":["../module/core/constants.mjs","../module/core/utils.mjs","../module/handlers/data-handler.mjs","../module/managers/migration-manager.mjs","../module/handlers/character-handler.mjs","../module/handlers/layout-handler.mjs","../module/handlers/tooltip-handler.mjs","../module/handlers/group-handler.mjs","../module/managers/hud-manager.mjs","../node_modules/@yaireo/dragsort/dist/dragsort.js","../node_modules/@yaireo/tagify/dist/tagify.esm.js","../module/applications/tagify-app.mjs","../module/applications/tagify-app-helper.mjs","../module/handlers/group-resizer.mjs","../module/applications/token-action-hud.mjs","../module/core/sockets.mjs","../module/handlers/action-handlers/generic-action-handler.mjs","../module/handlers/action-handlers/compendium-action-handler.mjs","../module/handlers/action-handlers/macro-action-handler.mjs","../module/handlers/action-handlers/action-handler.mjs","../module/handlers/action-handlers/action-handler-extender.mjs","../module/handlers/roll-handlers/roll-handler.mjs","../module/handlers/roll-handlers/pre-roll-handler.mjs","../module/handlers/roll-handlers/roll-handler-extender.mjs","../module/applications/custom-style-form.mjs","../module/dialogs/reset-layout.mjs","../module/dialogs/reset-all-layouts.mjs","../module/applications/settings-form.mjs","../module/core/settings.mjs","../module/handlers/action-handlers/item-macro-extender.mjs","../module/managers/system-manager.mjs","../module/core/api.mjs","../module/main.mjs"],"sourcesContent":["/**\n * Module-based constants\n */\nexport const MODULE = {\n  ID: \"token-action-hud-core\",\n  NAME: \"Token Action HUD\"\n};\n\n\n/* -------------------------------------------- */\n\n/**\n * Template directory\n */\nconst TEMPLATE_DIR = `modules/${MODULE.ID}/templates`;\n\n/* -------------------------------------------- */\n\n/**\n * Templates\n */\nexport const TEMPLATE = {\n  action: `${TEMPLATE_DIR}/action.hbs`,\n  customStyleForm: `${TEMPLATE_DIR}/custom-style-form.hbs`,\n  group: `${TEMPLATE_DIR}/group.hbs`,\n  hud: `${TEMPLATE_DIR}/hud.hbs`,\n  listSubgroup: `${TEMPLATE_DIR}/list-subgroup.hbs`,\n  settings: `${TEMPLATE_DIR}/settings.hbs`,\n  tabSubgroup: `${TEMPLATE_DIR}/tab-subgroup.hbs`,\n  tagifyAppHud: `${TEMPLATE_DIR}/tag-dialog-hud.hbs`,\n  tagifyAppGroup: `${TEMPLATE_DIR}/tag-dialog-group.hbs`,\n  tagifyAppSubgroup: `${TEMPLATE_DIR}/tag-dialog-subgroup.hbs`\n};\n\n/* -------------------------------------------- */\n\n/**\n * Delimiter character\n */\nexport const DELIMITER = \"|\";\n\n/* -------------------------------------------- */\n\n/**\n * Action types\n */\nexport const ACTION_TYPE = {\n  compendiumEntry: \"tokenActionHud.compendiumEntry\",\n  compendiumMacro: \"tokenActionHud.compendiumMacro\",\n  compendiumPlaylist: \"tokenActionHud.compendiumPlaylist\",\n  macro: \"tokenActionHud.macro\"\n};\n\n/* -------------------------------------------- */\n\n/**\n * Compendium action types\n */\nexport const COMPENDIUM_ACTION_TYPES = [\"compendiumEntry\", \"compendiumMacro\", \"compendiumPlaylist\", \"macro\"];\n\n/* -------------------------------------------- */\n\n/**\n * Compendium pack types\n */\nexport const COMPENDIUM_PACK_TYPES = [\"JournalEntry\", \"Macro\", \"RollTable\"];\n\n/* -------------------------------------------- */\n\n/**\n * CSS styles\n */\nexport const CSS_STYLE = {\n  foundryVTT: {\n    class: \"tah-style-foundry-vtt-dark\",\n    file: \"tah-foundry-vtt-dark\",\n    moduleId: MODULE.ID,\n    name: \"Foundry VTT Dark\",\n    primaryColor: \"#dddddd\",\n    secondaryColor: \"#dddddd80\",\n    tertiaryColor: \"#ff6400\"\n  },\n  compact: {\n    class: \"tah-style-foundry-vtt\",\n    file: \"tah-foundry-vtt-dark-compact\",\n    moduleId: MODULE.ID,\n    name: \"Foundry VTT Dark Compact\",\n    primaryColor: \"#dddddd\",\n    secondaryColor: \"#dddddd80\",\n    tertiaryColor: \"#ff6400\"\n  },\n  dockedLeft: {\n    class: \"tah-style-docked-left\",\n    file: \"tah-docked-left\",\n    moduleId: MODULE.ID,\n    name: \"Foundry VTT Dark Docked Left\",\n    primaryColor: \"#dddddd\",\n    secondaryColor: \"#dddddd80\",\n    tertiaryColor: \"#ff6400\",\n    isDocked: true,\n    dockPosition: \"left\"\n  },\n  dockedCenterRight: {\n    class: \"tah-style-docked-right\",\n    file: \"tah-docked-right\",\n    moduleId: MODULE.ID,\n    name: \"Foundry VTT Dark Docked Center-Right\",\n    primaryColor: \"#dddddd\",\n    secondaryColor: \"#dddddd80\",\n    tertiaryColor: \"#ff6400\",\n    collapseIcon: \"fa-caret-right\",\n    expandIcon: \"fa-caret-left\",\n    isDocked: true,\n    dockPosition: \"center-right\"\n  },\n  dockedRight: {\n    class: \"tah-style-docked-right\",\n    file: \"tah-docked-right\",\n    moduleId: MODULE.ID,\n    name: \"Foundry VTT Dark Docked Right\",\n    primaryColor: \"#dddddd\",\n    secondaryColor: \"#dddddd80\",\n    tertiaryColor: \"#ff6400\",\n    collapseIcon: \"fa-caret-right\",\n    expandIcon: \"fa-caret-left\",\n    isDocked: true,\n    dockPosition: \"right\"\n  },\n  foundryVttLight: {\n    class: \"tah-style-foundry-vtt-light\",\n    file: \"tah-foundry-vtt-light\",\n    moduleId: MODULE.ID,\n    name: \"Foundry VTT Light\",\n    primaryColor: \"#dddddd\",\n    secondaryColor: \"#dddddd80\",\n    tertiaryColor: \"#ff6400\"\n  },\n  pathfinder: {\n    class: \"tah-style-pathfinder\",\n    file: \"tah-pathfinder\",\n    moduleId: MODULE.ID,\n    name: \"Pathfinder\"\n  },\n  highContrast: {\n    class: \"tah-style-high-contrast\",\n    file: \"tah-high-contrast\",\n    moduleId: MODULE.ID,\n    name: \"High Contrast\",\n    primaryColor: \"#ffff00\",\n    secondaryColor: \"#ffff00\",\n    tertiaryColor: \"#0C7BDC\"\n  },\n  custom: {\n    class: \"tah-style-custom\",\n    file: \"tah-custom\",\n    moduleId: MODULE.ID,\n    name: \"Custom\"\n  }\n};\n\n/* -------------------------------------------- */\n\n/**\n * Custom styles\n */\nexport const CUSTOM_STYLE = {\n  backgroundColor: { cssProperty: \"--tah-background-color\", type: String, default: \"#00000000\" },\n  buttonHeight: { cssProperty: \"--tah-button-height-editable\", type: Number, default: 32 },\n  buttonBackgroundColor: { cssProperty: \"--tah-button-background-color-editable\", type: String, default: \"#000000b3\" },\n  buttonBorderPrimaryColor: { cssProperty: \"--tah-button-border-primary-color-editable\", type: String, default: \"#0C0C0CFF\" },\n  buttonBorderSecondaryColor: { cssProperty: \"--tah-button-border-secondary-color-editable\", type: String, default: \"#060606FF\" },\n  buttonTextColor: { cssProperty: \"--tah-button-text-color-editable\", type: String, default: \"#DDDDDDFF\" },\n  buttonHoverBorderPrimaryColor: { cssProperty: \"--tah-button-hover-border-primary-color-editable\", type: String, default: \"#FF6400FF\" },\n  buttonHoverBorderSecondaryColor: { cssProperty: \"--tah-button-hover-border-secondary-color-editable\", type: String, default: \"#FF0000FF\" },\n  buttonHoverBackgroundColor: { cssProperty: \"--tah-button-hover-background-color-editable\", type: String, default: \"#000000B3\" },\n  buttonHoverTextColor: { cssProperty: \"--tah-button-hover-text-color-editable\", type: String, default: \"#FFFFFFFF\" },\n  buttonToggleActiveBackgroundColor: { cssProperty: \"--tah-button-toggle-active-background-color-editable\", type: String, default: \"#3C0078BF\" },\n  buttonToggleActiveBorderPrimaryColor: { cssProperty: \"--tah-button-toggle-active-border-primary-color-editable\", type: String, default: \"#9B8DFFFF\" },\n  buttonToggleActiveBorderSecondaryColor: { cssProperty: \"--tah-button-toggle-active-border-secondary-color-editable\", type: String, default: \"#9B8DFFFF\" },\n  buttonToggleActiveTextColor: { cssProperty: \"--tah-button-toggle-active-text-color-editable\", type: String, default: \"#FFFFFFFF\" },\n  buttonToggleHoverBackgroundColor: { cssProperty: \"--tah-button-toggle-hover-background-color-editable\", type: String, default: \"#3C0078BF\" },\n  buttonToggleHoverBorderPrimaryColor: { cssProperty: \"--tah-button-toggle-hover-border-primary-color-editable\", type: String, default: \"#9B8DFFFF\" },\n  buttonToggleHoverBorderSecondaryColor: { cssProperty: \"--tah-button-toggle-hover-secondary-color-editable\", type: String, default: \"#9B8DFFFF\" },\n  buttonToggleHoverTextColor: { cssProperty: \"--tah-button-toggle-hover-text-color-editable\", type: String, default: \"#FFFFFFFF\" },\n  textPrimaryColor: { cssProperty: \"--tah-text-primary-color-editable\", type: String, default: \"#DDDDDDFF\" },\n  textSecondaryColor: { cssProperty: \"--tah-text-secondary-color-editable\", type: String, default: \"#DDDDDD80\" },\n  textTertiaryColor: { cssProperty: \"--tah-text-tertiary-color-editable\", type: String, default: \"#FF6400FF\" },\n  textHoverPrimaryColor: { cssProperty: \"--tah-text-hover-primary-color-editable\", type: String, default: \"#DDDDDDFF\" },\n  textHoverSecondaryColor: { cssProperty: \"--tah-text-hover-secondary-color-editable\", type: String, default: \"#DDDDDD80\" },\n  textHoverTertiaryColor: { cssProperty: \"--tah-text-tertiary-color-editable\", type: String, default: \"#FF6400FF\" }\n};\n\n/* -------------------------------------------- */\n\n/**\n * Group types\n */\nexport const GROUP_TYPE = {\n  COMPENDIUM: \"compendium\",\n  CUSTOM: \"custom\",\n  SYSTEM: \"system\",\n  SYSTEM_DERIVED: \"system-derived\"\n};\n\n/* -------------------------------------------- */\n\n/**\n * HUD\n */\nexport const HUD = {\n  DEFAULT_HEIGHT: 200,\n  DEFAULT_WIDTH: 20,\n  DEFAULT_LEFT_POS: 150,\n  DEFAULT_TOP_POS: 80,\n  DEFAULT_SCALE: 1,\n  DEFAULT_ZINDEX: 100\n};\n\n/* -------------------------------------------- */\n\n/**\n * Item Macro icon\n */\nexport const ITEM_MACRO_ICON = {\n  ICON: \"fas fa-sd-card\",\n  TOOLTIP: \"Item Macro\"\n};\n\n/* -------------------------------------------- */\n\n/**\n * Layout settings\n */\nexport const LAYOUT_SETTING = {\n  customLayout: {\n    hint: \"tokenActionHud.settings.customLayout.hint\",\n    name: \"tokenActionHud.settings.customLayout.name\",\n    inputType: \"filePicker\",\n    filePickerType: \"json\",\n    dtype: \"String\",\n    scope: \"world\"\n  },\n  userCustomLayout: {\n    hint: \"tokenActionHud.settings.userCustomLayout.hint\",\n    name: \"tokenActionHud.settings.userCustomLayout.name\",\n    inputType: \"filePicker\",\n    filePickerType: \"json\",\n    dtype: \"String\",\n    scope: \"user\"\n  },\n  exportLayout: {\n    hint: \"tokenActionHud.settings.exportLayout.hint\",\n    label: \"tokenActionHud.settings.exportLayout.label\",\n    name: \"tokenActionHud.settings.exportLayout.name\",\n    inputType: \"button\",\n    icon: \"fa-solid fa-file-export\",\n    action: \"exportLayout\"\n  },\n  resetLayout: {\n    hint: \"tokenActionHud.settings.resetLayout.hint\",\n    label: \"tokenActionHud.settings.resetLayout.label\",\n    name: \"tokenActionHud.settings.resetLayout.name\",\n    inputType: \"button\",\n    icon: \"fa-solid fa-arrow-rotate-left\",\n    action: \"resetLayout\",\n    scope: \"client\"\n  },\n  resetAllLayouts: {\n    hint: \"tokenActionHud.settings.resetAllLayouts.hint\",\n    label: \"tokenActionHud.settings.resetAllLayouts.label\",\n    name: \"tokenActionHud.settings.resetAllLayouts.name\",\n    inputType: \"button\",\n    icon: \"fa-solid fa-bomb\",\n    action: \"resetAllLayouts\",\n    scope: \"world\"\n  }\n};\n\n/* -------------------------------------------- */\n\n/**\n * Settings\n */\nexport const SETTING = {\n  activeCssAsText: { classes: [\"TokenActionHud\"], variable: \"activeCssAsTextSetting\" },\n  allow: { classes: [\"TokenActionHud\"], variable: \"allowSetting\" },\n  alwaysShowHud: { classes: [\"TokenActionHud\"], variable: \"alwaysShowHudSetting\" },\n  backgroundColor: {},\n  buttonBackgroundColor: {},\n  buttonBorderPrimaryColor: {},\n  buttonBorderSecondaryColor: {},\n  buttonHeight: {},\n  buttonHoverBorderPrimaryColor: {},\n  buttonHoverBorderSecondaryColor: {},\n  buttonHoverBackgroundColor: {},\n  buttonHoverTextColor: {},\n  buttonTextColor: {},\n  buttonToggleActiveBackgroundColor: {},\n  buttonToggleActiveBorderPrimaryColor: {},\n  buttonToggleActiveBorderSecondaryColor: {},\n  buttonToggleActiveTextColor: {},\n  buttonToggleHoverBackgroundColor: {},\n  buttonToggleHoverBorderPrimaryColor: {},\n  buttonToggleHoverBorderSecondaryColor: {},\n  buttonToggleHoverTextColor: {},\n  clickOpenCategory: { classes: [\"TokenActionHud\"], variable: \"clickOpenCategorySetting\" },\n  customLayout: { classes: [\"ActionHandler\"], variable: \"customLayoutSetting\" },\n  customStyle: {},\n  debug: { classes: [\"TokenActionHud\"], variable: \"debugSetting\" },\n  direction: { classes: [\"TokenActionHud\"], variable: \"directionSetting\" },\n  displayCharacterName: { classes: [\"TokenActionHud\"], variable: \"displayCharacterName\" },\n  displayIcons: { classes: [\"TokenActionHud\"], variable: \"displayIconsSetting\" },\n  drag: { classes: [\"TokenActionHud\"], variable: \"dragSetting\" },\n  enable: { classes: [\"TokenActionHud\"], variable: \"enableSetting\" },\n  enableCustomization: { classes: [\"ActionHandler\", \"TokenActionHud\"], variable: \"enableCustomizationSetting\" },\n  grid: { classes: [\"TokenActionHud\"], variable: \"gridSetting\" },\n  itemMacro: {},\n  migrationVersion: {},\n  reset: {},\n  renderItemOnRightClick: {},\n  rollHandler: { default: \"core\" },\n  scale: { classes: [\"TokenActionHud\"], variable: \"scaleSetting\" },\n  sortActions: { classes: [\"ActionHandler\"], variable: \"sortActionsSetting\" },\n  startup: {},\n  style: { classes: [\"TokenActionHud\"], variable: \"styleSetting\"},\n  tooltips: { classes: [\"ActionHandler\"], variable: \"tooltipsSetting\" },\n  textPrimaryColor: {},\n  textSecondaryColor: {},\n  textTertiaryColor: {},\n  textHoverPrimaryColor: {},\n  textHoverSecondaryColor: {},\n  textHoverTertiaryColor: {},\n  userCustomLayout: { classes: [\"ActionHandler\"], variable: \"userCustomLayoutFlag\" }\n};\n","import { CSS_STYLE, CUSTOM_STYLE, MODULE } from \"./constants.mjs\";\n\n/**\n * A class responsible for logging messages to the console.\n */\nexport class Logger {\n  /**\n   * Log an info message to the console. If 'notify' is true, also send a notification\n   * @param {string} message The message\n   * @param {boolean} notify Whether to send a notification\n   */\n  static info(message, notify = false) {\n    if (notify) ui.notifications.info(`Token Action HUD | ${message}`);\n    else console.log(`Token Action HUD Info | ${message}`);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Log an error message to the console. If 'notify' is true, also send a notification\n   * @param {string} message The message\n   * @param {boolean} notify Whether to send a notification\n   */\n  static error(message, notify = false) {\n    if (notify) ui.notifications.error(`Token Action HUD | ${message}`, { permanent: true });\n    else console.error(`Token Action HUD Error | ${message}`);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Log a debug message and, optionally, data to the console\n   * @param {string} message   The message\n   * @param {object|null} data The data\n   */\n  static debug(message, data = null) {\n    const isDebug = (game.tokenActionHud) ? game.tokenActionHud.debugSetting : Utils.getSetting(\"debug\");\n    if (isDebug) {\n      if (!data) {\n        console.log(`Token Action HUD Debug | ${message}`);\n        return;\n      }\n      const dataClone = Utils.deepClone(data);\n      console.log(`Token Action HUD Debug | ${message}`, dataClone);\n    }\n  }\n}\n\n/* -------------------------------------------- */\n\n/**\n * A class responsible for setting and aborting timers.\n */\nexport class Timer {\n  constructor(milliseconds) {\n    this.milliseconds = milliseconds;\n    this.timer = null;\n  }\n\n  async start() {\n    if (this.timer) this.abort();\n    return new Promise(resolve => {\n      this.timer = setTimeout(() => { resolve(); }, this.milliseconds ?? 100);\n    });\n  }\n\n  async abort() {\n    clearTimeout(this.timer);\n    this.timer = null;\n  }\n}\n\n/* -------------------------------------------- */\n\n/**\n * A class of helper functions.\n */\nexport class Utils {\n  /**\n   * Whether the user is allowed to use the HUD\n   * @public\n   * @param {number} userRole     The user's role\n   * @param {number} allowSetting The 'allow' setting value\n   * @returns {boolean} Whether the user is allowed to use the HUD\n   */\n  static checkAllow(userRole, allowSetting) {\n    return userRole >= allowSetting;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Capitalize the first letter of every word\n   * @param {string} value The string\n   * @returns {string}     The capitalized string\n   */\n  static capitalize(value) {\n    return value.replace(\n      /\\w\\S*/g,\n      text => text.charAt(0).toUpperCase() + text.substring(1).toLowerCase()\n    );\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Foundry VTT's deepClone function wrapped here to avoid code error highlighting due to missing definition\n   * @public\n   * @param {object} original The original object\n   * @param {object} options  The options\n   * @returns {object}        The cloned object\n   */\n  static deepClone(original, options) {\n    // eslint-disable-next-line no-undef\n    return foundry.utils.deepClone(original, options);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actor from the token or actor\n   * @public\n   * @param {string} actorId The actor id\n   * @param {string} tokenId The token id\n   * @returns {object}       The actor\n   */\n  static getActor(actorId, tokenId) {\n    let token = null;\n    if (tokenId) token = canvas.tokens.placeables.find(token => token.id === tokenId);\n    if (token) return token.actor;\n    return game.actors.get(actorId);\n  }\n\n  /**\n   * Get closest group to the event target\n   * @param {object} event The event\n   * @returns {object}     The closest group element\n   */\n  static getClosestGroupElement(event) {\n    if (!event) return null;\n    return event.target.closest(\"[data-part=\\\"subgroup\\\"]\") || event.target.closest(\"[data-part=\\\"group\\\"]\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actors of controlled tokens\n   * @public\n   * @returns {Array} The actors\n   */\n  static getControlledActors() {\n    const tokens = game.canvas.tokens?.controlled ?? [];\n    return tokens.map(token => token.actor);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get status effect from actor based on the status ID\n   * @param {object} actor    The actor\n   * @param {string} statusId The status ID\n   * @returns {object}        The status effect\n   */\n  static getStatusEffect(actor, statusId) {\n    return actor.effects.find(effect => effect.statuses.every(status => status === statusId));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get image from the entity\n   * @public\n   * @param {object} entity       The entity, e.g., actor, item\n   * @param {Array} defaultImages Any default images to exclude\n   * @returns {string}            The image URL\n   */\n  static getImage(entity, defaultImages = []) {\n    defaultImages.push(\"icons/svg/mystery-man.svg\");\n    let result = \"\";\n    if (game.tokenActionHud.displayIconsSetting) {\n      result = (typeof entity === \"string\")\n        ? entity\n        : entity?.img ?? entity?.icon ?? \"\";\n    }\n    return !defaultImages.includes(result) ? result : \"\";\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get item from the actor\n   * @public\n   * @param {object} actor  The actor\n   * @param {string} itemId The item id\n   * @returns {object}      The item\n   */\n  static getItem(actor, itemId) {\n    return actor.items.get(itemId);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get token\n   * @public\n   * @param {string} tokenId The token id\n   * @returns {object}       The token\n   */\n  static getToken(tokenId) {\n    return canvas.tokens.placeables.find(token => token.id === tokenId);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get controlled tokens\n   * @public\n   * @returns {Array} The controlled tokens\n   */\n  static getControlledTokens() {\n    return game.canvas.tokens?.controlled ?? [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get first controlled tokens\n   * @public\n   * @returns {object|null} The first controlled token\n   */\n  static getFirstControlledToken() {\n    const controlledToken = game.canvas.tokens.controlled[0];\n    if (controlledToken) {\n      return controlledToken;\n    }\n\n    const character = game.user?.character;\n    if (character) {\n      return canvas.tokens.placeables.find(token => token.actor?.id === character.id);\n    }\n\n    return null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get setting value\n   * @public\n   * @param {string} key               The setting key\n   * @param {string=null} defaultValue The setting default value\n   * @returns {*}                      The setting value\n   */\n  static getSetting(key, defaultValue = null) {\n    let value = defaultValue ?? null;\n    try {\n      value = game.settings.get(MODULE.ID, key);\n    } catch{\n      Logger.debug(`Setting '${key}' not found`);\n    }\n    return value;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set setting value\n   * @public\n   * @param {string} key   The setting key\n   * @param {string} value The setting value\n   */\n  static async setSetting(key, value) {\n    if (game.settings.settings.get(`${MODULE.ID}.${key}`)) {\n      await game.settings.set(MODULE.ID, key, value);\n      Logger.debug(`Setting '${key}' set to '${value}'`);\n    } else if (key !== \"debug\") {\n      Logger.debug(`Setting '${key}' not found`);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get module actor flag\n   * @public\n   * @param {string} key The flag key\n   * @returns {*}        The flag value\n   */\n  static getActorFlag(key) {\n    return game.tokenActionHud.actor.getFlag(MODULE.ID, key);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set module actor flag\n   * @public\n   * @param {string} key The flag key\n   * @param {*} value    The flag value\n   */\n  static async setActorFlag(key, value) {\n    await game.tokenActionHud.actor.setFlag(MODULE.ID, key, value);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Unset module actor flag\n   * @public\n   * @param {string} key The flag key\n   */\n  static async unsetActorFlag(key) {\n    await game.tokenActionHud.actor.unsetFlag(MODULE.ID, key);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get module user flag\n   * @public\n   * @param {string} key The flag key\n   * @returns {*}        The flag value\n   */\n  static getUserFlag(key) {\n    return game.user.getFlag(MODULE.ID, key);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set module user flag\n   * @public\n   * @param {string} key The flag key\n   * @param {*} value    The flag value\n   */\n  static async setUserFlag(key, value) {\n    await game.user.setFlag(MODULE.ID, key, value);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Unset module user flag\n   * @public\n   * @param {string} key The flag key\n   */\n  static async unsetUserFlag(key) {\n    await game.user.unsetFlag(MODULE.ID, key);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Language translation\n   * @public\n   * @param {string} toTranslate The value to translate\n   * @returns {string}           The translated value\n   */\n  static i18n(toTranslate) {\n    return game.i18n.localize(toTranslate);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether a GM is active\n   * @public\n   * @returns {boolean} Whether a GM is active\n   */\n  static isGmActive() {\n    return game.users.some(user => user.isGM && user.active);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the given module is active\n   * @public\n   * @param {string} moduleId The module id\n   * @returns {boolean}       Whether the given module is active\n   */\n  static isModuleActive(moduleId) {\n    const module = game.modules.get(moduleId);\n    return module && module.active;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the given module's title\n   * @public\n   * @param {string} moduleId The module id\n   * @returns {string}        The module title\n   */\n  static getModuleTitle(moduleId) {\n    return game.modules.get(moduleId)?.title ?? \"\";\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the given module's version\n   * @public\n   * @param {string} moduleId The module id\n   * @returns {string}        The module version\n   */\n  static getModuleVersion(moduleId) {\n    return game.modules.get(moduleId)?.version ?? \"\";\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Humanize keybinding\n   * @param {object} key The keybinding key\n   * @returns {string}   The humanized keybinding\n   */\n  static humanizeBinding(key) {\n    const binding = game.keybindings.get(MODULE.ID, key);\n    if (!binding) return \"\";\n    const stringParts = binding[0].modifiers.reduce((parts, part) => {\n      if (KeyboardManager.MODIFIER_CODES[part]?.includes(binding[0].key)) return parts;\n      parts.unshift(KeyboardManager.getKeycodeDisplayString(part));\n      return parts;\n    }, [KeyboardManager.getKeycodeDisplayString(binding[0].key)]);\n    return stringParts.join(\" + \");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the median\n   * @public\n   * @param {Array} numbers The array of numbers\n   * @returns {number}      The median\n   */\n  static median(numbers) {\n    const mid = Math.floor(numbers.length / 2);\n    const nums = [...numbers].sort((a, b) => a - b);\n    return numbers.length % 2 !== 0 ? nums[mid] : (nums[mid - 1] + nums[mid]) / 2;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get upper quartile average\n   * @param {Array} numbers The numbers\n   * @returns {number}      The upper quartile average\n   */\n  static getUpperQuartileAverage(numbers) {\n    const sortedNumbers = numbers.slice().sort((a, b) => a - b);\n    const length = sortedNumbers.length;\n    const startIndex = Math.ceil(length * 0.75);\n    const endIndex = length - 1;\n\n    let sum = 0;\n    let count = 0;\n\n    for (let i = startIndex; i <= endIndex; i++) {\n      sum += sortedNumbers[i];\n      count++;\n    }\n\n    const upperQuartileAverage = sum / count;\n\n    return upperQuartileAverage;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get modifier (e.g., +5) from number\n   * @param {number} num The number\n   * @returns {string}   The modifier\n   */\n  static getModifier(num) {\n    if (!num && num !== 0) return \"\";\n    const sign = (num >= 0) ? \"+\" : \"\";\n    return `${sign}${num}`;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Sort items\n   * @public\n   * @param {object} items The items\n   * @returns {object}     The sorted items\n   */\n  static sortItems(items) {\n    return new Map([...items.entries()].sort((a, b) => a[1].sort.localeCompare(b[1].sort)));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Sort items by name\n   * @public\n   * @param {object} items The items\n   * @returns {object}     The sorted items\n   */\n  static sortItemsByName(items) {\n    return new Map([...items.entries()].sort((a, b) => a[1].name.localeCompare(b[1].name)));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Enable stylesheet based on setting and disable all other stylesheets\n   * @public\n   * @param {string} style The 'style' setting value\n   */\n  static switchCSS(style) {\n    const { file, moduleId } = CSS_STYLE[style];\n\n    for (const [key, value] of Object.entries(CSS_STYLE)) {\n      const href = [`modules/${value.moduleId}/`, `${value.file}`];\n      const stylesheet = Object.values(document.styleSheets).find(\n        ss => ss.href?.includes(href[0]) && ss.href?.includes(href[1])\n      );\n\n      if (key === style) {\n        stylesheet.disabled = false;\n      } else if (moduleId !== value.moduleId || file !== value.file) {\n        stylesheet.disabled = true;\n      }\n    }\n\n    if (style === \"custom\") {\n      for (const [key, value] of Object.entries(CUSTOM_STYLE)) {\n        const setting = Utils.getSetting(key);\n        if (setting) {\n          document.querySelector(\":root\").style.setProperty(value.cssProperty, setting);\n        }\n      }\n    }\n\n    const tahElement = document.querySelector(\"#token-action-hud\");\n    if (tahElement) {\n      tahElement.classList.remove(...tahElement.classList);\n      tahElement.classList.add(CSS_STYLE[style].class);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Register Handlebar helpers\n   * @public\n   */\n  static registerHandlebars() {\n    // Capitalise first character\n    Handlebars.registerHelper(\"tokenActionHudCoreCap\", function(string) {\n      if (!string || string.length < 1) return \"\";\n      return string[0].toUpperCase() + string.slice(1);\n    });\n    const reduceOp = function(args, reducer) {\n      args = Array.from(args);\n      args.pop(); // => options\n      const first = args.shift();\n      return args.reduce(reducer, first);\n    };\n\n    // Support operators\n    Handlebars.registerHelper({\n      tokenActionHudCoreTrue: function() { return reduceOp(arguments, a => a); }\n    });\n\n    // Add asterisk to toggleable actions\n    Handlebars.registerHelper(\"tokenActionHudCoreActiveText\", function(block) {\n      if (game.tokenActionHud.activeCssAsTextSetting) {\n        return block.fn(this);\n      }\n      return block.inverse(this);\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the major, minor and patch parts of the module version\n   * @public\n   * @param {string} moduleVersion The module version\n   * @returns {object|null}        The module version parts\n   */\n  static getModuleVersionParts(moduleVersion) {\n    if (!moduleVersion) {\n      Logger.debug(\"Module version not retrieved\", { trigger: \"getModuleVersionParts\" });\n      return null;\n    }\n    const moduleVersionParts = moduleVersion.split(\".\");\n    return {\n      major: moduleVersionParts[0],\n      minor: moduleVersionParts[1],\n      patch: moduleVersionParts[2]\n    };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the system module is compatible with the core module version\n   * @public\n   * @param {string} requiredCoreModuleVersion The required core module version\n   * @returns {boolean}                        Whether the system module is compatible with the core module version\n   */\n  static isSystemModuleCompatible(requiredCoreModuleVersion) {\n    if (!requiredCoreModuleVersion) return true;\n\n    // Get core module version in parts\n    const requiredCoreModuleVersionParts = this.getModuleVersionParts(requiredCoreModuleVersion);\n    const coreModuleVersionParts = this.getModuleVersionParts(game.modules.get(MODULE.ID).version);\n\n    if (coreModuleVersionParts.major !== requiredCoreModuleVersionParts.major\n      || coreModuleVersionParts.minor !== requiredCoreModuleVersionParts.minor\n      || (requiredCoreModuleVersionParts.patch && coreModuleVersionParts.patch !== requiredCoreModuleVersionParts.patch)\n    ) {\n      const requiredVersion = `${requiredCoreModuleVersionParts.major}.${requiredCoreModuleVersionParts.minor}.${requiredCoreModuleVersionParts.patch ?? \"X\"}`;\n      const installedVersion = game.modules.get(MODULE.ID).version;\n      ui.notifications.error(\n        `The installed Token Action HUD system module requires Token Action HUD Core module version ${requiredVersion}, but version ${installedVersion} is installed. Install Token Action HUD Core module version ${requiredVersion} to continue using Token Action HUD. Earlier versions of Token Action HUD Core are available on the module's package page on the Foundry VTT site.`,\n        { permanent: true }\n      );\n      return false;\n    }\n    return true;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get nested groups by criteria\n   * @public\n   * @param {object} groups The groups\n   * @param {object} data   The search data\n   * @returns {object|null} The nested groups\n   */\n  static getNestedGroups(groups, data = {}) {\n    let order = 0;\n    if (!groups) return null;\n    const groupId = data?.id;\n    const groupType = data?.type;\n    groups = (Array.isArray(groups)) ? groups : Object.values(groups);\n    const foundGroups = {};\n    for (const group of groups) {\n      if ((!groupId || group.id === groupId) && (!groupType || group.type === groupType)) {\n        order++;\n        const level = group.nestId.split(\"_\").length;\n        foundGroups[group.nestId] = { ...group, order, level };\n      }\n      if (group.groups?.length > 0) {\n        const groups = this.getNestedGroups(group.groups, data);\n        if (groups) Object.assign(foundGroups, groups);\n      }\n    }\n    return (Object.keys(foundGroups).length > 0) ? foundGroups : null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get group by nest ID\n   * @public\n   * @param {object} groups The groups\n   * @param {string} data   The search data\n   * @returns {object|null} The group\n   */\n  static async getGroupByNestId(groups, data = {}) {\n    const nestId = (typeof data === \"string\" ? data : data?.nestId);\n    const groupType = data?.type;\n    if (!nestId) return null;\n\n    const parts = nestId.split(\"_\");\n    return await findGroup(groups, parts);\n\n    /* -------------------------------------------- */\n\n    /**\n     * Find group\n     * @param {object} groups The groups\n     * @param {Array} parts   The nestId parts\n     * @returns {object}      The group\n     */\n    async function findGroup(groups, parts) {\n      if (!groups) return null;\n      groups = (Array.isArray(groups)) ? groups : Object.values(groups);\n      for (const group of groups) {\n        if (group.id === parts[0]) {\n          if (parts.length === 1) {\n            if (!group.type || !groupType || group.type === groupType) return group;\n            return;\n          }\n          parts.shift();\n          if (!group.groups) continue;\n          for (const groupStyle of Object.values(group.groups)) {\n            if (groupStyle.length === 0) continue;\n            const foundGroup = await findGroup(groupStyle, parts);\n            if (foundGroup) return foundGroup;\n          }\n        }\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Delete group by nest id\n   * @public\n   * @param {object} groups The groups\n   * @param {string} data   The search data\n   */\n  static async deleteGroupByNestId(groups, data = {}) {\n    const nestId = (typeof data === \"string\" ? data : data?.nestId);\n    if (!nestId) return;\n\n    const parts = nestId.split(\"_\");\n    await findAndDeleteGroup(groups, parts);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Find and delete a group\n   * @param {object} groups The groups\n   * @param {Array} parts   The nestId parts\n   */\n  static async findAndDeleteGroup(groups, parts) {\n    groups = (Array.isArray(groups)) ? groups : Object.values(groups);\n    for (const [index, group] of groups.entries()) {\n      if (group.id === parts[0]) {\n        if (parts.length === 1) {\n          groups.splice(index, 1);\n          return;\n        }\n        if (group.groups.length === 0) return;\n        parts.shift();\n        const foundGroup = await findAndDeleteGroup(group.groups, parts);\n        if (foundGroup) return;\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Delete groups by id\n   * @public\n   * @param {object} groups The groups\n   * @param {string} data   The search data\n   */\n  static async deleteGroupsById(groups, data = {}) {\n    const id = (typeof data === \"string\" ? data : data?.id);\n    if (!id) return;\n\n    for (let i = groups.length - 1; i >= 0; i--) {\n      if (groups[i].id === id) {\n        groups.splice(i, 1);\n      } else if (groups[i].groups?.length > 0) {\n        deleteGroupsById(groups[i].groups, data);\n      }\n    }\n  }\n}\n","import { MODULE } from \"../core/constants.mjs\";\nimport { Logger, Utils } from \"../core/utils.mjs\";\n\n/* -------------------------------------------- */\n\n/**\n * A class responsible for handling data-related activities.\n */\nexport class DataHandler {\n  constructor(socket) {\n    this.socket = socket;\n  }\n\n  /**\n   * Initialise the data handler\n   */\n  async init() {\n    await this.#createDirectories();\n    await Promise.all([\n      this.private = await this.isPrivate(),\n      this.fileMap = await this.getFilePathsAsGm()\n    ]);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether persistent storage can be used\n   * @returns {boolean} Whether persistent storage can be used\n   */\n  get isPersistentStorage() {\n    return (foundry.utils.isNewerVersion(game.version, \"11.305\") && typeof ForgeVTT === \"undefined\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Create directories for storage of files\n   * @private\n   */\n  async #createDirectories() {\n    if (!game.user.isGM || !Utils.getSetting(\"enableCustomization\")) return;\n\n    const DATA_FOLDER = \"data\";\n    const moduleDirectory = (this.isPersistentStorage)\n      ? `modules/${MODULE.ID}/storage`\n      : MODULE.ID;\n\n    const directoriesToCreate = [\n      moduleDirectory,\n      `${moduleDirectory}/${game.world.id}`,\n      `${moduleDirectory}/${game.world.id}/actor`,\n      `${moduleDirectory}/${game.world.id}/user`\n    ];\n\n    for (const directory of directoriesToCreate) {\n      await FilePicker.browse(DATA_FOLDER, directory).catch(async _ => {\n        if (!(await FilePicker.createDirectory(DATA_FOLDER, directory, {}))) {\n          Logger.debug(`Failed to create directory: ${directory}`);\n        }\n      });\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get base path to the layout files\n   * @returns {string} The path\n   */\n  get path() {\n    return (this.isPersistentStorage)\n      ? `modules/${MODULE.ID}/storage/${game.world.id}/`\n      : `${MODULE.ID}/${game.world.id}/`;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get file parts\n   * @param {string} file The file\n   * @returns {object}    The file parts\n   */\n  getFileParts(file) {\n    const parts = file.split(\"/\");\n    const filename = parts.pop();\n    const folder = parts.join(\"/\");\n    const id = filename.split(\".\")[0];\n    return { folder, filename, id };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the module directory is set to private\n   * @returns {boolean} Whether the module directory is set to private\n   */\n  async isPrivate() {\n    if (game.user.isGM) return false;\n\n    if (game.user.hasPermission(\"FILES_BROWSE\")) {\n      try {\n        await FilePicker.browse(\"data\", this.path);\n        return false;\n      } catch{\n        return true;\n      }\n    }\n    return true;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get file paths as GM\n   * @returns {object} The file paths\n   */\n  async getFilePathsAsGm() {\n    if ((!game.user.hasPermission(\"FILES_BROWSE\") || this.private) && !Utils.isGmActive()) {\n      Logger.info(\"Cannot get file paths without a GM present\", true);\n      return new Map(); // Return an empty map if no permissions and no GM\n    }\n\n    const files = game.user.hasPermission(\"FILES_BROWSE\") && !this.private\n      ? await this.getFilePaths()\n      : await this.socket.executeAsGM(\"getFilePaths\");\n\n    return new Map(files.map(file => {\n      const { id } = this.getFileParts(file);\n      return [id, file];\n    }));\n  }\n\n  /**\n   * Get file paths using socket\n   * @returns {Array} The file paths\n   */\n  static async getFilePathsWithSocket() {\n    return await game.tokenActionHud?.dataHandler?.getFilePaths() ?? [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get file paths\n   * @returns {Array} The file paths\n   */\n  async getFilePaths() {\n    const [actorFiles, userFiles] = await Promise.all([\n      FilePicker.browse(\"data\", `${this.path}actor/`),\n      FilePicker.browse(\"data\", `${this.path}user/`)\n    ]);\n\n    return [...(actorFiles?.files ?? []), ...(userFiles?.files ?? [])];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the user can save data\n   * @returns {boolean} Whether the user can save data\n   */\n  get canSaveData() {\n    return ((game.user.hasPermission(\"FILES_UPLOAD\") && !this.private) || Utils.isGmActive());\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Save data the GM\n   * @public\n   * @param {string} type The type: actor or user\n   * @param {string} id   The actor or user id\n   * @param {object} data The data\n   */\n  async saveDataAsGm(type, id, data) {\n    if (game.user.hasPermission(\"FILES_UPLOAD\") && !this.private) {\n      await this.saveData(type, id, data);\n    }\n\n    if (!Utils.isGmActive()) {\n      Logger.info(\"Cannot save data without a GM present\", true);\n      return;\n    }\n\n    await this.socket.executeAsGM(\"saveData\", type, id, data);\n  }\n\n  /* -------------------------------------------- */\n\n  static async saveDataWithSocket(type, id, data) {\n    return await game.tokenActionHud.dataHandler.saveData(type, id, data);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Save data\n   * @param {string} type The type: actor or user\n   * @param {string} id   The actor or user id\n   * @param {object} data The data\n   */\n  async saveData(type, id, data) {\n    try {\n      // Get the folder path\n      const folder = `${this.path}${type}`;\n\n      // Generate the system-safe filename\n      const fileName = encodeURI(`${id}.json`);\n\n      // Create the file and contents\n      const file = new File([JSON.stringify(data, null, \"\")], fileName, { type: \"application/json\" });\n\n      // Upload the file\n      const response = await FilePicker.upload(\"data\", folder, file, {}, { notify: false });\n\n      if (response.path) {\n        if (!this.fileMap.has(id)) {\n          this.fileMap.set(id, response.path);\n        }\n      } else {\n        Logger.debug(`Failed to save data to: ${fileName}\\nReason: ${response.error || \"Unknown error\"}`);\n      }\n    } catch(error) {\n      Logger.error(`An error occurred while saving data for ${id}.json: ${error.message}`);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the user can get data\n   * @returns {boolean} Whether the user can get data\n   */\n  get canGetData() {\n    return ((game.user.hasPermission(\"FILES_BROWSE\") && !this.private) || Utils.isGmActive());\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get data as GM\n   * @public\n   * @param {object} options The options: file, type, id\n   * @returns {object}       The data\n   */\n  async getDataAsGm(options) {\n    try {\n      if ((!game.user.hasPermission(\"FILES_BROWSE\") || this.private) && !Utils.isGmActive()) {\n        Logger.info(\"Cannot get data without a GM present\", true);\n        return;\n      }\n\n      const data = (game.user.hasPermission(\"FILES_BROWSE\"))\n        ? await this.getData(options)\n        : await this.socket.executeAsGM(\"getData\", options);\n\n      return data;\n    } catch(error) {\n      Logger.error(`An error occurred while getting data: ${error.message}`);\n      return null;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  static async getDataWithSocket(options) {\n    return await game.tokenActionHud.dataHandler.getData(options);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get data\n   * @param {string} options The options: file, type, id\n   * @returns {object}       The data\n   */\n  async getData(options) {\n    const { id, file } = options;\n\n    // Check if the file is available in the fileMap\n    let foundFile = this.fileMap.get(id) ?? null;\n\n    // If not found, try to browse, otherwise return null\n    if (!foundFile) {\n      if (!file) return null;\n      const { folder, filename } = this.getFileParts(file);\n      const foundFolder = await FilePicker.browse(\"data\", folder);\n      foundFile = foundFolder.files.find(file => file.endsWith(filename));\n      if (!foundFile) return null;\n    }\n\n    try {\n      const ms = Date.now();\n      const response = await fetch(`${foundFile}?ms=${ms}`);\n\n      // Check if the fetch was successful\n      if (response.ok) {\n        const data = await response.json();\n        return data;\n      } else {\n        return null;\n      }\n    } catch(error) {\n      console.error(error);\n      return null;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get data\n   * @param {string} type The type: actor or user\n   * @param {string} id   The actor or user id\n   * @returns {object}    The data\n   */\n  async getDataMigrate(type, id) {\n    const folderPath = `${MODULE.ID}/${game.world.id}/${type}`;\n    const fileName = encodeURI(`${id}.json`);\n    try {\n      const foundFolderPath = await FilePicker.browse(\"data\", folderPath);\n      const foundFilePath = foundFolderPath.files.find(file => file.endsWith(fileName));\n      if (foundFilePath) {\n        const ms = Date.now();\n        return await fetch(`${foundFilePath}?ms=${ms}`)\n          .then(response => {\n            if (response.ok) {\n              return response.json();\n            } else {\n              return null;\n            }\n          })\n          .catch(error => {\n            console.error(error);\n          });\n      } else {\n        return null;\n      }\n    } catch{\n      return null;\n    }\n  }\n}\n","import { MODULE } from \"../core/constants.mjs\";\nimport { Logger, Utils } from \"../core/utils.mjs\";\n\n/**\n * Manages migrations between module versions\n */\nexport class MigrationManager {\n  constructor(dataHandler, socket) {\n    this.dataHandler = dataHandler;\n    this.socket = socket;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Initialise migrations\n   * @public\n   */\n  async init() {\n    if (!game.user.isGM) return;\n\n    const moduleVersion = game.modules.get(MODULE.ID).version;\n    const migrationVersion = Utils.getSetting(\"migrationVersion\");\n    if (moduleVersion === migrationVersion) return;\n\n    let isSuccess = true;\n    isSuccess = (!migrationVersion || foundry.utils.isNewerVersion(\"1.4.10\", migrationVersion))\n      ? await this.#unsetOldFlags()\n      : true;\n    isSuccess = (this.dataHandler.isPersistentStorage && (!migrationVersion || foundry.utils.isNewerVersion(\"1.4.11\", migrationVersion)))\n      ? await this.#migrateFiles()\n      : true;\n\n    if (isSuccess) {\n      Utils.setSetting(\"migrationVersion\", moduleVersion);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Unset old flags\n   * @private\n   * @returns {boolean} Whether the old flags were unset\n   */\n  async #unsetOldFlags() {\n    try {\n      const users = game.users.filter(user => user.getFlag(MODULE.ID, \"categories\"));\n      for (const user of users) {\n        user.unsetFlag(MODULE.ID, \"categories\");\n        user.unsetFlag(MODULE.ID, \"defaults\");\n      }\n\n      const actors = game.actors.filter(actor => actor.getFlag(MODULE.ID, \"categories\"));\n      for (const actor of actors) {\n        actor.unsetFlag(MODULE.ID, \"categories\");\n      }\n\n      const tokens = game.canvas.tokens.objects.children.filter(token => token.actor?.getFlag(MODULE.ID, \"categories\"));\n      for (const token of tokens) {\n        token.actor?.unsetFlag(MODULE.ID, \"categories\");\n      }\n\n      for (const scene of game.scenes) {\n        const tokens = scene.tokens.filter(token => token.actor?.getFlag(MODULE.ID, \"categories\"));\n        for (const token of tokens) {\n          token.actor?.unsetFlag(MODULE.ID, \"categories\");\n        }\n      }\n\n      return true;\n    } catch(err) {\n      Logger.debug(err.message, err);\n\n      return false;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Migrate files to storage\n   * @returns {boolean} Whether the files were migrated to storage\n   */\n  async #migrateFiles() {\n    try {\n      Logger.info(\"Migrating files to persistent storage...\", true);\n      for (const user of game.users) {\n        const data = await this.dataHandler.getDataMigrate(\"user\", user.id);\n        if (data) {\n          await this.dataHandler.saveData(\"user\", user.id, data);\n        }\n      }\n\n      for (const actor of game.actors) {\n        const data = await this.dataHandler.getDataMigrate(\"actor\", actor.id);\n        if (data) {\n          await this.dataHandler.saveData(\"actor\", actor.id, data);\n        }\n      }\n      Logger.info(\"Successfully migrated files to persistent storage\", true);\n      return true;\n    } catch{\n      Logger.info(\"Failed to migrate files to persistent storage\", true);\n      return false;\n    }\n  }\n}\n","import { Utils } from \"../core/utils.mjs\";\n\nexport class CharacterHandler {\n  constructor(hudManager) {\n    this.hudManager = hudManager;\n    this.groupHandler = hudManager.groupHandler;\n    this.actionHandler = hudManager.actionHandler;\n    this.rollHandler = hudManager.rollHandler;\n  }\n\n  /**\n   * Initialise Character Handler\n   */\n  init() {\n    this.previousActorId = this.actor?.id;\n    this.setCharacter();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether there is a character\n   * @returns {boolean} Whether there is a character\n   */\n  get isCharacter() {\n    return this.actor || this.isMultipleTokens;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether there is multiple tokens\n   * @returns {boolean} Whether there is multiple tokens\n   */\n  get isMultipleTokens() {\n    const controlledTokens = Utils.getControlledTokens();\n    return controlledTokens.length > 1 && !this.actor;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the current actor is the same actor\n   * @returns {boolean} Whether the current actor is the same actor\n   */\n  get isSameActor() {\n    return this.previousActorId !== this.actor?.id;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set character based on controlled tokens\n   * @private\n   */\n  setCharacter() {\n    this.resetCharacter();\n    const controlledTokens = Utils.getControlledTokens();\n    if (controlledTokens.length > 1) {\n      this.#handleMultipleTokens(controlledTokens);\n    } else {\n      this.#handleSingleToken(controlledTokens);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset actor and token properties\n   */\n  resetCharacter() {\n    this.token = null;\n    this.actor = null;\n    this.tokens = [];\n    this.actors = [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle multiple controlled tokens\n   * @param {*} controlledTokens\n   */\n  #handleMultipleTokens(controlledTokens) {\n    this.characterName = game.i18n.localize(\"tokenActionHud.multiple\");\n\n    // Empty singulars\n    this.token = null;\n    this.actor = null;\n\n    // Set multiples\n    this.tokens = controlledTokens;\n    this.actors = Utils.getControlledActors();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle a single controlled token\n   * @private\n   * @param {Array} controlledTokens The controlled tokens\n   */\n  #handleSingleToken(controlledTokens) {\n    const character = { token: null, actor: null };\n\n    if (controlledTokens.length === 1 && this.#isValidCharacter(controlledTokens[0])) {\n      character.token = controlledTokens[0];\n      character.actor = character.token?.actor;\n    } else if (controlledTokens.length === 0 && game.user.character && Utils.getSetting(\"alwaysShowHud\")) {\n      character.actor = game.user.character;\n      character.token = canvas.tokens?.placeables.find(t => t.actor?.id === character.actor.id) ?? null;\n    }\n\n    if (!character.actor) return;\n\n    this.characterName = character.token?.name ?? character.actor.name;\n\n    // Set in this class\n    this.token = character.token;\n    this.actor = character.actor;\n    this.tokens = [character.token];\n    this.actors = [character.actor];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the character is a valid selection for the current user\n   * @private\n   * @param {object} [token = {}] The token\n   * @returns {boolean}           Whether the character is a valid selection for the current user\n   */\n  #isValidCharacter(token = {}) {\n    return game.user.isGM || token.actor?.testUserPermission(game.user, \"OWNER\");\n  }\n\n}\n","import { Utils } from \"../core/utils.mjs\";\n\n/**\n * Handler for the HUD layout.\n */\nexport class LayoutHandler {\n  constructor(systemManager, dataHandler) {\n    this.systemManager = systemManager;\n    this.dataHandler = dataHandler;\n    this.defaultLayout = null;\n    this.customLayout = null;\n  }\n\n  /**\n   * Initialise the HUD layout\n   */\n  async init() {\n    await Promise.all([\n      this.#setDefaultLayout(),\n      this.#setCustomLayout()\n    ]);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Soft reset variables\n   */\n  softReset() {\n    this.defaultLayout = null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Hard reset variables\n   */\n  hardReset() {\n    this.softReset();\n    this.customLayout = null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the default layout\n   * @private\n   */\n  async #setDefaultLayout() {\n    if (this.defaultLayout) return;\n    const defaultLayout = this.systemManager.defaults?.layout;\n    if (!defaultLayout) { this.defaultLayout = null; return; }\n    this.defaultLayout = await Utils.getNestedGroups(defaultLayout);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set custom layout\n   * @private\n   */\n  async #setCustomLayout() {\n    if (this.customLayout) return;\n    const file = Utils.getUserFlag(\"userCustomLayout\") || Utils.getSetting(\"customLayout\") || null;\n    this.customLayout = (file) ? await this.dataHandler.getDataAsGm({ file }) : null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Export layout to file\n   * @public\n   */\n  async exportLayout() {\n    const data = await this.dataHandler.getDataAsGm({ type: \"user\", id: game.userId }) ?? this.customLayout ?? this.defaultLayout;\n    if (data) {\n      saveDataToFile(JSON.stringify(data, null, 2), \"text/json\", \"token-action-hud-layout.json\");\n    }\n  }\n\n  /**\n   * Get the layout\n   * @returns {object} The layout\n   */\n  get layout() {\n    return this.customLayout ?? this.defaultLayout;\n  }\n}\n","import { Utils } from \"../core/utils.mjs\";\n\n\n/**\n * Get tooltip based on module setting\n * @param {object|string} tooltip The tooltip\n * @param {string} name           The name\n * @returns {object}              The tooltip\n */\nexport function getTooltip(tooltip, name) {\n  const setting = Utils.getSetting(\"tooltips\");\n\n  if (setting === \"none\") return null;\n  if (setting === \"nameOnly\" || !tooltip) return name;\n\n  if (typeof tooltip !== \"object\") {\n    tooltip = { content: tooltip };\n  }\n\n  if (!tooltip.content.includes(\"tah-tooltip-wrapper\")) {\n    tooltip.content = `<div class=\"tah-tooltip-wrapper\">${tooltip.content}</div>`;\n  }\n\n  let direction = \"RIGHT\";\n  if (tooltip.direction) {\n    direction = tooltip.direction;\n  } else {\n    const style = game.tokenActionHud.systemManager.styles[game.tokenActionHud.styleSetting];\n\n    if ([\"center-right\", \"right\"].includes(style.dockPosition)) {\n      direction = \"LEFT\";\n    }\n  }\n\n  tooltip.direction = direction;\n\n  return tooltip;\n}\n","import { COMPENDIUM_PACK_TYPES, GROUP_TYPE } from \"../core/constants.mjs\";\nimport { Logger, Utils } from \"../core/utils.mjs\";\nimport { getTooltip } from \"../handlers/tooltip-handler.mjs\";\n\n/**\n * Handler for the HUD groups.\n */\nexport class GroupHandler {\n  constructor(hudManager, systemManager, dataHandler, layoutHandler) {\n    this.hudManager = hudManager;\n    this.systemManager = systemManager;\n    this.dataHandler = dataHandler;\n    this.layoutHandler = layoutHandler;\n    this.defaultGroups = {};\n    this.groups = {};\n    this.actorGroups = {};\n    this.userGroups = {};\n  }\n\n  get actor() {\n    return this.hudManager?.actor;\n  }\n\n  get actors() {\n    return this.hudManager?.actors;\n  }\n\n  get token() {\n    return this.hudManager?.token;\n  }\n\n  get tokens() {\n    return this.hudManager?.tokens;\n  }\n\n  /**\n   * Initialise the groups\n   */\n  async init() {\n    this.#setDefaultGroups();\n    await Promise.all([\n      this.#setSavedActorGroups(),\n      this.#setSavedUserGroups()\n    ]);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Soft reset variables\n   */\n  softReset() {\n    this.defaultGroups = {};\n    this.groups = null;\n    this.groups = {};\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Hard reset variables\n   */\n  hardReset() {\n    this.softReset();\n    this.actorGroups = {};\n    this.userGroups = {};\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the default groups\n   * @private\n   */\n  #setDefaultGroups() {\n    const defaultGroups = this.systemManager.defaults?.groups;\n    if (!defaultGroups) return;\n    for (const defaultGroup of defaultGroups) {\n      this.defaultGroups[defaultGroup.id] = defaultGroup;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the saved groups from the actor flag\n   * @private\n   */\n  async #setSavedActorGroups() {\n    if (!this.actor) return;\n\n    if (!Utils.getSetting(\"enableCustomization\")) {\n      this.actorGroups = {};\n      return;\n    }\n\n    if (this.isSameActor && Object.entries(this.actorGroups).length) return;\n\n    if (!this.dataHandler.canGetData) {\n      this.actorGroups = {};\n      return;\n    }\n\n    Logger.debug(\"Retrieving groups from actor...\", { actor: this.actor });\n    this.actorGroups = {};\n    const actorGroups = await this.dataHandler.getDataAsGm({ type: \"actor\", id: this.actor.id }) ?? null;\n    if (!actorGroups) return;\n    for (const group of Object.entries(actorGroups)) {\n      group[1].nestId = group[0];\n    }\n    this.actorGroups = actorGroups;\n    Logger.debug(\"Groups from actor retrieved\", { actorGroups: this.actorGroups, actor: this.actor });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the saved groups from the user flag\n   * @private\n   */\n  async #setSavedUserGroups() {\n    const user = game.user;\n    const layout = this.layoutHandler.layout;\n\n    const getUserGroups = data => {\n      const userGroups = Object.keys(data).length ? data : layout;\n      for (const group of Object.entries(userGroups)) {\n        group[1].nestId = group[0];\n      }\n      return userGroups;\n    };\n\n    if (!Utils.getSetting(\"enableCustomization\")) {\n      this.userGroups = getUserGroups(layout);\n      return;\n    }\n\n    if (Object.entries(this.userGroups).length) return;\n\n    if (!this.dataHandler.canGetData) {\n      this.userGroups = getUserGroups(layout);\n      return;\n    }\n\n    Logger.debug(\"Retrieving groups from user...\", { user });\n    this.userGroups = {};\n    const savedUserData = await this.dataHandler.getDataAsGm({ type: \"user\", id: user.id }) ?? {};\n    this.userGroups = getUserGroups(savedUserData);\n    Logger.debug(\"Groups retrieved from user\", { userGroups: this.userGroups, user });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare groups in the HUD.\n   * @param {object} hud The HUD\n   * @returns {object}   The prepared groups\n   */\n  async prepareGroups(hud) {\n    if (Object.keys(this.userGroups).length) {\n      const userGroups = this.getUserGroups();\n      for (const userGroup of userGroups) {\n        if (userGroup.level === 1) {\n          const group = this.createGroup(userGroup);\n          hud.groups.push(group);\n          this.groups[group.nestId] = group;\n        } else {\n          const parentNestId = userGroup.nestId.split(\"_\", userGroup.level - 1).join(\"_\");\n          const parentGroup = await Utils.getGroupByNestId(hud.groups, { nestId: parentNestId });\n          if (parentGroup) {\n            const group = this.createGroup(userGroup);\n            if (group.settings.style === \"tab\") {\n              parentGroup.groups.tabs.push(group);\n            } else {\n              parentGroup.groups.lists.push(group);\n            }\n            this.groups[group.nestId] = group;\n          }\n        }\n      }\n    }\n\n    if (Object.keys(this.actorGroups).length) {\n      const actorGroups = this.getActorGroups();\n\n      for (const actorGroup of actorGroups) {\n        const parentNestId = actorGroup.nestId.split(\"_\", actorGroup.level - 1).join(\"_\");\n        const existingGroup = await Utils.getGroupByNestId(hud.groups, { nestId: actorGroup.nestId });\n        if (existingGroup) {\n          if (actorGroup.actions?.length) {\n            existingGroup.actions = actorGroup.actions;\n          }\n        } else {\n          const parentGroup = await Utils.getGroupByNestId(hud.groups, { nestId: parentNestId });\n\n          if (parentGroup && actorGroup.type === \"system-derived\") {\n            if (!parentGroup.groups) parentGroup.groups = { lists: [], tabs: [] };\n\n            const group = this.createGroup(actorGroup, true);\n\n            if (actorGroup.actions?.length) {\n              group.actions = actorGroup.actions;\n            }\n\n            if (group.settings.style === \"tab\") {\n              parentGroup.groups.tabs.push(group);\n            } else {\n              parentGroup.groups.lists.push(group);\n            }\n\n            this.groups[group.nestId] = group;\n          }\n        }\n      }\n    }\n\n    return this.groups;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get first matching group\n   * @public\n   * @param {object} [data = {}]   The group data\n   * @param {string} [data.nestId] The nested group ID\n   * @param {string} [data.id]     The group ID\n   * @param {number} [data.level]  The group level\n   * @param {string} [data.type]   The group type\n   * @returns {Array}              The group\n   */\n  getGroup({ nestId, id, level, type } = {}) {\n    if (nestId) return this.groups[nestId];\n\n    return Object.values(this.groups).find(group =>\n      (!id || group.id === id)\n      && (!level || group.level === level)\n      && (!type || group.type === type)\n    );\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get matching groups\n   * @public\n   * @param {object}  [data = {}]     The group data\n   * @param {string}  [data.nestId]   The nested group ID\n   * @param {string}  [data.id]       The group ID\n   * @param {number}  [data.level]    The group level\n   * @param {string}  [data.type]     The group type\n   * @param {boolean} [data.selected] Whether the group is selected\n   * @returns {Array}                 The matching groups\n   */\n  getGroups({ nestId, id, level, type, selected } = {}) {\n    return Object.values(this.groups).filter(group =>\n      (!nestId || group.nestId.startsWith(nestId))\n      && (!id || group.id === id)\n      && (!level || group.level === level)\n      && (!type || group.type === type)\n      && (!selected || group.selected === selected)\n    );\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get matching actor-related groups\n   * @public\n   * @param {object}  [data = {}]   The group data\n   * @param {string}  [data.nestId] The nested group ID\n   * @param {string}  [data.id]     The group ID\n   * @param {number}  [data.level]  The group level\n   * @param {string}  [data.type]   The group type\n   * @returns {Array}               The groups\n   */\n  getActorGroups({ nestId, id, level, type } = {}) {\n    return Object.values(this.actorGroups).filter(group =>\n      (!nestId || group.nestId.startsWith(nestId))\n      && (!id || group.id === id)\n      && (!level || group.level === level)\n      && (!type || group.type === type)\n    ).sort((a, b) => (a.level - b.level || a.order - b.order));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get matching user-related groups\n   * @public\n   * @param {object}  [data = {}]   The group data\n   * @param {string}  [data.nestId] The nested group ID\n   * @param {string}  [data.id]     The group ID\n   * @param {number}  [data.level]  The group level\n   * @param {string}  [data.type]   The group type\n   * @returns {Array}               The groups\n   */\n  getUserGroups({ nestId, id, level, type } = {}) {\n    return Object.values(this.userGroups).filter(group =>\n      (!nestId || group.nestId.startsWith(nestId))\n      && (!id || group.id === id)\n      && (!level || group.level === level)\n      && (!type || group.type === type)\n    ).sort((a, b) => (a.level - b.level || a.order - b.order));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get group IDs\n   * @returns {Array} The group IDs\n   */\n  getGroupIds() {\n    return Object.values(this.groups).map(group => group.id);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get group settings\n   * @public\n   * @param {object} [groupData={}] The group data\n   * @returns {object|null}         The group settings\n   */\n  getGroupSettings(groupData = {}) {\n    return this.getGroup(groupData)?.settings ?? null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Create group\n   * @public\n   * @param {object} groupData The group data\n   * @param {boolean} keepData Whether to keep the data\n   * @returns {object}         The group\n   */\n  createGroup(groupData, keepData = false) {\n    const groupDataClone = Utils.deepClone(groupData);\n    const nestIdParts = groupData.nestId.split(\"_\");\n    const level = nestIdParts.length ?? 1;\n\n    const tooltip = getTooltip(groupData?.tooltip, groupDataClone?.name);\n\n    if (!keepData) {\n      groupDataClone.actions = [];\n      groupDataClone.groups = { lists: [], tabs: [] };\n    }\n\n    const defaultSettings = {\n      showTitle: true,\n      style: (level === 1) ? \"tab\" : \"list\"\n    };\n\n    const groupSettings = groupDataClone.settings || {};\n    groupSettings.showTitle ??= defaultSettings.showTitle;\n    groupSettings.style ??= defaultSettings.style;\n\n    groupDataClone.subtitleClass = (groupSettings.showTitle) ? \"\" : \"tah-hidden\";\n\n    const groupSystem = groupDataClone.system || {};\n\n    const commonProps = {\n      actions: groupDataClone.actions,\n      class: groupDataClone.class || groupDataClone.cssClass || \"\",\n      groups: groupDataClone.groups,\n      id: groupDataClone.id,\n      info1: groupDataClone.info1 || \"\",\n      info2: groupDataClone.info2 || \"\",\n      info3: groupDataClone.info3 || \"\",\n      level: groupDataClone.level || level || 1,\n      listName: groupDataClone.listName || groupDataClone.name,\n      name: groupDataClone.name,\n      nestId: groupDataClone.nestId || groupDataClone.id,\n      order: groupDataClone.order,\n      selected: groupDataClone.selected ?? groupDataClone.isSelected ?? groupDataClone.defaultSelected ?? true,\n      settings: groupSettings,\n      system: groupSystem,\n      tooltip,\n      type: groupDataClone.type || GROUP_TYPE.CUSTOM\n    };\n\n    if (level > 1) {\n      commonProps.subtitleClass = groupDataClone.subtitleClass || \"\";\n    }\n\n    return commonProps;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update groups\n   * @public\n   * @param {Array | object} groupsData         The groups data\n   * @param {object} [parentGroupData = null] The parent group data\n   */\n  updateGroups(groupsData, parentGroupData) {\n    if (!Array.isArray(groupsData)) groupsData = [groupsData];\n\n    const level = (parentGroupData?.level ?? 0) + 1;\n    const childGroupData = { level };\n    if (parentGroupData?.nestId) childGroupData.nestId = parentGroupData.nestId;\n\n    const existingGroups = this.getGroups(childGroupData);\n\n    // Remove any groups that are no longer present\n    for (const existingGroup of existingGroups) {\n      if (existingGroup.type === \"system-derived\") {\n        existingGroup.selected = false;\n        existingGroup.order = 999;\n      } else if (!groupsData.find(groupData => groupData.id === existingGroup.id)) {\n        delete this.groups[existingGroup.nestId];\n      }\n    }\n\n    // Add or update groups\n    let order = 0;\n    for (const groupData of groupsData) {\n      groupData.nestId = (parentGroupData?.nestId)\n        ? `${parentGroupData.nestId}_${groupData.id}`\n        : groupData.id;\n      groupData.selected = groupData.selected ?? true;\n      groupData.order = order;\n\n      const existingGroup = this.getGroup(groupData);\n\n      if (existingGroup) {\n        Object.assign(existingGroup, groupData);\n      } else {\n        const group = this.createGroup(groupData);\n        this.groups[groupData.nestId] = group;\n      }\n      order++;\n    }\n\n    // Update parent group settings\n    if (parentGroupData?.settings) {\n      const existingParentGroup = this.getGroup(parentGroupData);\n      if (existingParentGroup) {\n        existingParentGroup.settings = parentGroupData.settings;\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Save group settings\n   * @public\n   * @param {object} groupData The group data\n   */\n  saveGroupSettings(groupData) {\n    const group = this.getGroup(groupData);\n    group.settings = { ...group.settings, ...groupData.settings };\n    this.saveGroups({ saveActor: true, saveUser: true });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Save groups\n   * @public\n   * @param {object} options The options\n   */\n  async saveGroups(options = { saveActor: false, saveUser: false }) {\n    if (!Utils.getSetting(\"enableCustomization\")) return;\n\n    Logger.debug(\"Saving groups...\");\n\n    if (options?.saveActor) await this.saveActorGroups();\n    if (options?.saveUser) await this.saveUserGroups();\n\n    Logger.debug(\"Groups saved\", { groups: this.groups });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Save actor groups to file\n   * @public\n   */\n  async saveActorGroups() {\n    if (!this.actor || !Object.keys(this.groups).length) return;\n\n    Logger.debug(\"Saving actor groups...\");\n\n    const actorGroups = {};\n    this.actorGroups = {};\n\n    for (const group of Object.values(this.groups)) {\n      this.actorGroups[group.nestId] = group;\n      actorGroups[group.nestId] = this.#getReducedGroupData(group, true);\n    }\n\n    if (this.dataHandler.canSaveData) {\n      await this.dataHandler.saveDataAsGm(\"actor\", this.actor.id, actorGroups);\n\n      Logger.debug(\"Actor groups saved\", { actorGroups });\n    } else {\n      Logger.debug(\"Actor groups not saved as no GM present\");\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Save user groups to file\n   * @public\n   */\n  async saveUserGroups() {\n    if (!Object.keys(this.groups).length) return;\n\n    Logger.debug(\"Saving user groups...\");\n\n    const userGroups = {};\n    this.userGroups = {};\n\n    for (const group of Object.values(this.groups)) {\n      if (group.type !== \"system-derived\") {\n        this.userGroups[group.nestId] = group;\n        userGroups[group.nestId] = this.#getReducedGroupData(group, false);\n      }\n    }\n\n    if (this.dataHandler.canSaveData) {\n      await this.dataHandler.saveDataAsGm(\"user\", game.userId, userGroups);\n      Logger.debug(\"User groups saved\", { userGroups });\n    } else {\n      Logger.debug(\"User groups not saved as no GM present\");\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get reduced groups data for saving to flags\n   * @private\n   * @param {object}  data          The group data\n   * @param {string}  data.id       The group ID\n   * @param {string}  data.name     The group name\n   * @param {string}  data.listName The list name for the group\n   * @param {number}  data.level    The group level\n   * @param {number}  data.order    The order of the group\n   * @param {boolean} data.selected Whether the group is selected\n   * @param {object}  data.settings The group settings\n   * @param {string}  data.type     The group type\n   * @param {Array}   data.actions  The list of actions for the group (if `keepActions` is true)\n   * @param {boolean} keepActions   Whether to keep action data\n   * @returns {object}              The reduced group data\n   */\n  #getReducedGroupData({ id, name, listName, level, order, selected, settings, type, actions }, keepActions = false) {\n    const data = { id, name, listName, level, order, selected, settings, type };\n\n    if (keepActions) {\n      data.actions = actions.map(({ id, isPreset, userSelected }) => { return { id, isPreset, userSelected }; });\n    }\n\n    return data;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get selected groups as Tagify entries\n   * @public\n   * @param {object} groupData The group data\n   * @returns {object}         The selected groups\n   */\n  getSelectedGroupsAsTags(groupData = {}) {\n    groupData.selected = true;\n    groupData.level = (groupData.level || 0) + 1;\n    const groups = this.getGroups(groupData);\n    return groups?.map(group => this.#toTagify(group)) ?? [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get available groups as Tagify entries\n   * @public\n   * @param {object} groupData The group data\n   * @returns {object}         The groups\n   */\n  async getAvailableGroupAsTags(groupData) {\n    const derivedGroups = await this.#getDerivedGroupsAsTags(groupData);\n    const systemGroups = await this.#getSystemGroupsAsTags();\n    const compendiumGroups = await this.#getCompendiumGroupsAsTags();\n    const macroGroups = await this.#getMacroGroupsAsTags();\n    return [...derivedGroups, ...systemGroups, ...compendiumGroups, ...macroGroups];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get derived groups as Tagify entries\n   * @private\n   * @param {object} data        The group data\n   * @param {object} data.nestId The group nest ID\n   * @returns {object}           The derived groups\n   */\n  #getDerivedGroupsAsTags({ nestId }) {\n    const derivedGroups = this.getGroups({ nestId, type: GROUP_TYPE.SYSTEM_DERIVED });\n    return derivedGroups?.map(group => this.#toTagify(group)) ?? [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get system groups as Tagify entries\n   * @private\n   * @returns {object} The system groups\n   */\n  #getSystemGroupsAsTags() {\n    return Object.values(this.defaultGroups).map(group => this.#toTagify(group));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get compendium groups as Tagify entries\n   * @private\n   * @returns {object} The compendium groups\n   */\n  #getCompendiumGroupsAsTags() {\n    const packs = game.packs.filter(pack =>\n      COMPENDIUM_PACK_TYPES.includes(pack.documentName)\n            && (foundry.utils.isNewerVersion(game.version, \"10\") ? pack.visible : (!pack.private || game.user.isGM))\n    );\n    const groups = packs.map(pack => {\n      return {\n        id: pack.metadata.id.replace(\".\", \"-\"),\n        listName: `${game.i18n.localize(\"tokenActionHud.group\")}: ${pack.metadata.label}`,\n        name: pack.metadata.label,\n        type: \"core\"\n      };\n    });\n    return groups.map(group => this.#toTagify(group));\n  }\n\n  /**\n   * Get macro groups as Tagify entries\n   * @private\n   * @returns {object} The macro groups\n   */\n  #getMacroGroupsAsTags() {\n    return [this.#toTagify({\n      id: \"macros\",\n      listName: `${game.i18n.localize(\"tokenActionHud.group\")}: ${game.i18n.localize(\"tokenActionHud.macros\")}`,\n      name: game.i18n.localize(\"tokenActionHud.macros\"),\n      type: \"core\"\n    })];\n  }\n\n  /**\n   * Add group to the HUD\n   * @public\n   * @param {object} groupData         The group data\n   * @param {object} parentGroupData   The parent group data\n   * @param {boolean} [update = false] Whether to update an existing group\n   */\n  addGroup(groupData, parentGroupData, update = false) {\n    groupData.type = groupData?.type ?? \"system-derived\";\n    groupData.style = groupData?.style ?? \"list\";\n\n    if (!parentGroupData?.id && !parentGroupData?.nestId) return;\n\n    const parentGroups = this.getGroups(parentGroupData);\n    if (!parentGroups?.length) return;\n\n    for (const parentGroup of parentGroups) {\n      const nestId = `${parentGroup.nestId}_${groupData.id}`;\n      const existingGroups = this.getGroups({ ...groupData, nestId });\n\n      if (existingGroups.length) {\n        if (update) {\n          for (const existingGroup of existingGroups) {\n            // Temporary fix until info1-3 properties are grouped into info object\n            if (groupData.info) {\n              Object.assign(groupData, { ...groupData.info });\n              delete groupData.info;\n            }\n\n            Object.assign(existingGroup, this.createGroup({ ...existingGroup, ...groupData }, true));\n          }\n        } else {\n          for (const existingGroup of existingGroups) {\n            const tooltip = getTooltip(groupData.tooltip, existingGroup.name);\n            Object.assign(existingGroup, { tooltip });\n          }\n        }\n      } else {\n        const group = this.createGroup({ ...groupData, nestId });\n\n        if (!parentGroup.groups) parentGroup.groups = { lists: [], tabs: [] };\n\n        if (group.settings.style === \"tab\") {\n          parentGroup.groups.tabs.push(group);\n        } else {\n          parentGroup.groups.lists.push(group);\n        }\n        this.groups[group.nestId] = group;\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update group in the HUD\n   * @public\n   * @param {object} groupData                The group data\n   * @param {object} [parentGroupData = null] The parent group data\n   */\n  updateGroup(groupData, parentGroupData = null) {\n    groupData.type = groupData?.type ?? \"system-derived\";\n\n    const updateExistingGroups = existingGroups => {\n      for (const existingGroup of existingGroups) {\n        // Temporary fix until info1-3 properties are grouped into info object\n        if (groupData.info) {\n          Object.assign(groupData, { ...groupData.info });\n          delete groupData.info;\n        }\n\n        Object.assign(existingGroup, this.createGroup({ ...existingGroup, ...groupData }, true));\n      }\n    };\n\n    if (parentGroupData) {\n      const parentGroups = this.getGroups(parentGroupData);\n      for (const parentGroup of parentGroups) {\n        const nestId = `${parentGroup.nestId}_${groupData.id}`;\n        const existingGroups = this.getGroups({ ...groupData, nestId });\n\n        updateExistingGroups(existingGroups);\n      }\n    } else {\n      const existingGroups = this.getGroups(groupData);\n\n      updateExistingGroups(existingGroups);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Remove group from HUD\n   * @public\n   * @param {object} groupData The group data\n   */\n  removeGroup(groupData) {\n    if (!groupData?.nestId && groupData?.id) {\n      Utils.deleteGroupsById(this.hud.groups, groupData.id);\n    }\n\n    const groups = this.getGroups(groupData);\n    if (!groups?.length) return;\n\n    for (const group of groups) {\n      delete this.groups[group.nestId];\n      if (groupData?.nestId) {\n        Utils.deleteGroupByNestId(this.hud.groups, group.nestId);\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add info to group in the HUD\n   * @public\n   * @param {string} groupData The group data\n   */\n  addGroupInfo(groupData) {\n    const groupId = groupData?.id;\n    const groupInfo = groupData?.info;\n\n    if (!groupId || !groupInfo) return;\n\n    const groups = this.getGroups(groupData);\n\n    groups.forEach(group => {\n      group.info1 = groupInfo.info1;\n      group.info2 = groupInfo.info2;\n      group.info3 = groupInfo.info3;\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set property to indicate whether a group has actions within it\n   * @public\n   */\n  setHasActions() {\n    Object.values(this.groups).forEach(group => {\n      if (group.actions.some(action => action.selected)) {\n        group.hasActions = true;\n      } else {\n        group.hasActions = false;\n      }\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Convert a group into a Tagify entry\n   * @private\n   * @param {object} groupData The group data\n   * @returns {object}         The Tagify entry\n   */\n  #toTagify(groupData) {\n    const { id, name, type, listName } = groupData;\n    return { id, name, type, value: listName ?? name };\n  }\n}\n","\nimport { CharacterHandler } from \"../handlers/character-handler.mjs\";\nimport { LayoutHandler } from \"../handlers/layout-handler.mjs\";\nimport { GroupHandler } from \"../handlers/group-handler.mjs\";\nimport { Logger, Utils } from \"../core/utils.mjs\";\n\nexport class HudManager {\n  constructor(tokenActionHud, systemManager, dataHandler, socket) {\n    this.tokenActionHud = tokenActionHud;\n    this.dataHandler = dataHandler;\n    this.socket = socket;\n    this.layoutHandler = new LayoutHandler(systemManager, dataHandler);\n    this.groupHandler = new GroupHandler(this, systemManager, dataHandler, this.layoutHandler);\n    this.actionHandler = systemManager.getActionHandlerCore(this, this.dataHandler, this.groupHandler);\n    this.rollHandler = systemManager.getRollHandlerCore(this);\n    this.characterHandler = new CharacterHandler(this);\n  }\n\n  /**\n   * Initialise the HUD\n   * @param {string} trigger The update trigger\n   * @returns {boolean} Whether the HUD was initialised\n   */\n  async init(trigger) {\n    this.characterHandler.init();\n\n    if ( !this.characterHandler.isCharacter || !this.isHudEnabled) return false;\n\n    const options = (trigger === \"controlToken\" && this.characterHandler.isSameActor) ? { saveActor: true } : {};\n\n    await this.#buildHud(options);\n\n    return true;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Soft reset variables\n   * @public\n   */\n  softResetHud() {\n    this.hud = null;\n    this.hud = [];\n    this.groupHandler.softReset();\n    this.layoutHandler.softReset();\n    this.actionHandler.softReset();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Hard reset variables\n   * @public\n   */\n  hardResetHud() {\n    this.softResetHud();\n    this.groupHandler.hardReset();\n    this.layoutHandler.hardReset();\n  }\n\n  /**\n   * Build the HUD\n   * @private\n   * @param {object} options The options\n   * @returns {object}       The HUD\n   */\n  async #buildHud(options) {\n    Logger.debug(\"Building HUD...\", { actor: this.actor, token: this.token });\n\n    if (this.previousActor?.id === this.actor?.id) {\n      this.isSameActor = true;\n    } else {\n      this.previousActor = this.actor;\n      this.isSameActor = false;\n    }\n\n    this.softResetHud();\n\n    await this.layoutHandler.init();\n    await this.groupHandler.init();\n\n    if (!this.dataHandler.canGetData && !this.isGmInactiveUserNotified) {\n      Logger.info(\"Cannot retrieve HUD layout without GM present\", true);\n      this.isGmInactiveUserNotified = true;\n    }\n\n    this.hud = await this.#prepareHud();\n\n    await this.actionHandler.buildActionsCore();\n    this.groupHandler.setHasActions();\n    await this.groupHandler.saveGroups(options);\n\n    Logger.debug(\"HUD built\", { hud: this.hud, actor: this.actor, token: this.token });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare the HUD\n   * @private\n   * @returns {object} The HUD\n   */\n  async #prepareHud() {\n    Logger.debug(\"Preparing HUD...\", { actor: this.actor, token: this.token });\n\n    const name = (Utils.getSetting(\"displayCharacterName\"))\n      ? this.characterHandler.characterName ?? game.i18n.localize(\"tokenActionHud.multiple\")\n      : \"\";\n    const actorId = this.actor?.id ?? \"multi\";\n    const tokenId = this.token?.id ?? \"multi\";\n    const hud = { name, tokenId, actorId, groups: [] };\n\n    const groups = await this.groupHandler.prepareGroups(hud);\n    this.actionHandler.prepareActions(groups);\n\n    Logger.debug(\"HUD prepared\", { hud, actor: this.actor, token: this.token });\n    return hud;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle HUD event\n   * @param {string} eventType The event type\n   * @param {object} event     The event\n   */\n  handleHudEvent(eventType, event) {\n    const group = ([\"groupClick\"].includes(eventType)) ? this.getGroup(event) : null;\n    const action = ([\"clickAction\", \"hoverAction\"].includes(eventType)) ? this.getAction(event) : null;\n\n    this.#registerKeyPresses(event);\n    this.#setIsHover(event);\n\n    try {\n      switch (eventType) {\n        case \"groupClick\":\n          this.rollHandler.handleGroupClickCore(event, group);\n          break;\n        case \"clickAction\":\n          this.rollHandler.handleActionClickCore(event, action, this.actionHandler);\n          break;\n        case \"hoverAction\":\n          this.rollHandler.handleActionHoverCore(event, action);\n      }\n    } catch(error) {\n      Logger.error(event);\n    }\n  }\n\n  /**\n   * Registers key presses\n   * @private\n   * @param {object} event The events\n   */\n  #registerKeyPresses(event) {\n    this.#setIsRightClick(event);\n    this.#setIsAlt(event);\n    this.#setIsCtrl(event);\n    this.#setIsShift(event);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the button was right-clicked\n   * @public\n   * @param {object} event The event\n   */\n  #setIsRightClick(event) {\n    const button = event?.originalEvent?.button || event.button;\n    this.isRightClick = button === 2;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set isAlt based on event\n   * @private\n   * @param {object} event The event\n   */\n  #setIsAlt(event) {\n    const isModiferActive = game.keyboard.isModifierActive(KeyboardManager.MODIFIER_KEYS.ALT);\n    if (event.altKey && !isModiferActive) {\n      Logger.debug(\"Emulating LEFT ALT key press\");\n      KeyboardManager.emulateKeypress(false, \"AltLeft\", { altKey: true, force: true });\n      game.keyboard.downKeys.add(\"AltLeft\");\n      this.isAlt = true;\n    } else {\n      this.isAlt = isModiferActive;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set isCtrl based on event\n   * @private\n   * @param {object} event The event\n   */\n  #setIsCtrl(event) {\n    const isModiferActive = game.keyboard.isModifierActive(KeyboardManager.MODIFIER_KEYS.CONTROL);\n    if (event.ctrlKey && !isModiferActive) {\n      Logger.debug(\"Emulating LEFT CTRL key press\");\n      KeyboardManager.emulateKeypress(false, \"ControlLeft\", { ctrlKey: true, force: true });\n      game.keyboard.downKeys.add(\"ControlLeft\");\n      this.isCtrl = true;\n    } else {\n      this.isCtrl = isModiferActive;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set isShift based on event\n   * @private\n   * @param {object} event The event\n   */\n  #setIsShift(event) {\n    const isModiferActive = game.keyboard.isModifierActive(KeyboardManager.MODIFIER_KEYS.SHIFT);\n    if (event.shiftKey && !isModiferActive) {\n      Logger.debug(\"Emulating LEFT SHIFT key press\");\n      KeyboardManager.emulateKeypress(false, \"ShiftLeft\", { shiftKey: true, force: true });\n      game.keyboard.downKeys.add(\"ShiftLeft\");\n      this.isShift = true;\n    } else {\n      this.isShift = isModiferActive;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set isHover based on event\n   * @private\n   * @param {object} event The event\n   */\n  #setIsHover(event) {\n    this.isHover = [\"mouseenter\", \"mouseover\", \"pointerenter\"].includes(event.type);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the group from the nest ID\n   * @param {object} event The event\n   * @returns {object}     The group\n   */\n  getGroup(event) {\n    const groupElement = Utils.getClosestGroupElement(event);\n    const nestId = groupElement?.dataset?.nestId;\n    return this.groupHandler.getGroup({ nestId }) ?? null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the action from the action ID on the button\n   * @param {object} event  The event\n   * @returns {object}      The action\n   */\n  getAction(event) {\n    if (!event) return {};\n    const actionButtonElement = event.target.closest('[data-part=\"actionButton\"]')\n      ?? event.target.querySelector('[data-part=\"actionButton\"]');\n    const actionId = actionButtonElement?.dataset?.actionId;\n    if (!actionId) return {};\n    return this.actionHandler.availableActions.get(actionId) || {};\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the hud is enabled for the current user\n   * @private\n   * @returns {boolean} Whether the hud is enabled for the current user\n   */\n  get isHudEnabled() {\n    if (!Utils.getSetting(\"enable\")) return false;\n    if (game.user.isGM) return true;\n    return Utils.checkAllow(game.user.role, Utils.getSetting(\"allow\"));\n  }\n\n  /* -------------------------------------------- */\n  /* Shortcuts to CharacterHandler properties     */\n  /* -------------------------------------------- */\n\n  get characterName() {\n    return this.characterHandler?.characterName;\n  }\n\n  get actor() {\n    return this.characterHandler?.actor;\n  }\n\n  set actor(actor) {\n    this.characterHandler.actor = actor;\n  }\n\n  get actors() {\n    return this.characterHandler?.actors;\n  }\n\n  set actors(actors) {\n    this.characterHandler.actors = actors;\n  }\n\n  get token() {\n    return this.characterHandler?.token;\n  }\n\n  set token(token) {\n    this.characterHandler.token = token;\n  }\n\n  get tokens() {\n    return this.characterHandler?.tokens;\n  }\n\n  set tokens(tokens) {\n    this.characterHandler.tokens = tokens;\n  }\n}\n","!function(t,e){var i=i||{};\"function\"==typeof i&&i.amd?i([],e):\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"object\"==typeof exports?exports.DragSort=e():t.DragSort=e()}(this,(function(){var t,e=0,i={},s={},r=(t=window.MutationObserver||window.WebKitMutationObserver,function(e,i){e&&1===e.nodeType&&(t?new t((function(t,e){i(t)})).observe(e,{childList:!0,subtree:!1}):window.addEventListener&&e.addEventListener(\"DOMNodeInserted\",i,!1))});function a(t,e){if(!t)return this;e=e||{},this.parentElm=t,this.uid=e.uid,this.settings={selector:\"*\",callbacks:{}},Object.assign(this.settings,e),this.setup(),r(this.parentElm,this.setup.bind(this)),this.bindEvents()}return a.prototype={namespace:\"dragsort\",setup(){[...this.parentElm.childNodes].forEach((t=>{if(1!=t.nodeType)return t.parentNode.removeChild(t);t.matches(this.settings.selector)&&(t.draggable=!0)})),this.gap=this.getItemsGap(this.parentElm.firstElementChild)},throttle(t,e){var i=!1,s=this;return function(r){i||(t.call(s,r),i=!0,setTimeout((()=>i=!1),e))}},getDraggableElm(t){if(!t.closest)return null;var e=t.closest('[draggable=\"true\"]');return this.uid==i.uid?e:null},dragstart(t,e){i=this;var s,r=this.getDraggableElm(e);r?(this.saveInitialStyles(),this.source=this.getInitialState(),this.target=this.getInitialState(),s=r.getBoundingClientRect(),this.source.elm=r,this.source.idx=this.getNodeIndex(r),this.source.size.width=s.width,this.source.size.height=s.height,t.dataTransfer.effectAllowed=\"move\",this.settings.callbacks.dragStart&&this.settings.callbacks.dragStart(this.source.elm,t),setTimeout(this.afterDragStart.bind(this))):i={}},afterDragStart(){var t=\"vertical\"==this.settings.mode?\"height\":\"width\";this.parentElm.classList.add(`${this.namespace}--dragStart`),this.source.elm.style[t]=this.source.size[t]+\"px\",this.source.elm.classList.add(`${this.namespace}--dragElem`)},dragover(t){t.preventDefault(),t.stopPropagation();var e=t.target;if((e=this.getDraggableElm(e))&&this.target){var i=this.target.elm,s=this.target.hoverDirection;t.dataTransfer.dropEffect=\"move\",this.target.hoverDirection=this.getTargetDirection(t),i==e&&s==this.target.hoverDirection||this.directionAwareDragEnter(t,e)}},dragenter(t,e){(e=this.getDraggableElm(e))&&this.target&&this.isValidElm(e)&&this.source.elm!=e&&this.source.elm&&(this.target.bounding=e.getBoundingClientRect())},directionAwareDragEnter(t,e){var i;t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect=\"none\",this.isValidElm(e)&&this.source.elm!=e&&this.source.elm&&(t.dataTransfer.dropEffect=\"move\",this.cleanupLastTarget(),this.target.elm=e,this.target.idx=this.getNodeIndex(e),e.classList.add(\"over\"),i=Math.abs(this.target.idx-this.source.idx),this.source.elm.classList.toggle(`${this.namespace}--hide`,i>0),\"vertical\"==this.settings.mode?this.target.elm.style[this.target.hoverDirection?\"marginBottom\":\"marginTop\"]=this.source.size.height+this.gap+\"px\":this.target.elm.style[this.target.hoverDirection?\"marginRight\":\"marginLeft\"]=this.source.size.width+this.gap+\"px\")},dragend(t){if(clearTimeout(this.dragoverTimeout),this.dragoverTimeout=null,this.parentElm.classList.remove(`${this.namespace}--dragStart`),!this.isValidElm(this.target.elm))return this.cleanup();var e=this.target.hoverDirection?this.target.elm.nextElementSibling:this.target.elm;return this.source.elm!=this.target.elm&&this.target.elm&&(this.target.elm.classList.add(`${this.namespace}--noAnim`),this.cleanup(),this.parentElm.insertBefore(this.source.elm,e)),this.source.elm&&this.source.elm.classList.remove(`${this.namespace}--dragElem`,`${this.namespace}--hide`),this.settings.callbacks.dragEnd&&this.settings.callbacks.dragEnd(this.source.elm),this},isTargetLastChild(){return this.parentElm.lastElementChild==this.target.elm},getTargetDirection(t){if(this.target.bounding)return\"vertical\"==this.settings.mode?t.pageY>this.target.bounding.top+this.target.bounding.height/2?1:0:t.pageX>this.target.bounding.left+this.target.bounding.width/2?1:0},getNodeIndex(t){for(var e=0;t=t.previousSibling;)3==t.nodeType&&/^\\s*$/.test(t.data)||e++;return e},isValidElm(t){return t&&t.nodeType&&t.parentNode==this.parentElm},saveInitialStyles(){[...this.parentElm.children].forEach((t=>{t.setAttribute(\"dragsort-initial-style\",t.getAttribute(\"style\"))}))},cleanup(){i={},[...this.parentElm.children].forEach((t=>{t.style=t.getAttribute(\"dragsort-initial-style\"),t.removeAttribute(\"dragsort-initial-style\"),setTimeout((()=>{t.classList.remove(`${this.namespace}--over`,`${this.namespace}--noAnim`,`${this.namespace}--dragElem`)}),50)}))},cleanupLastTarget(){const{elm:t}=this.target;t&&(t.classList.remove(`${this.namespace}--hide`,`${this.namespace}--over`),t.style=t.getAttribute(\"dragsort-initial-style\"))},getInitialState:()=>({elm:null,size:{}}),getItemsGap(t){var e=getComputedStyle(t),i=getComputedStyle(t.parentNode),s=\"vertical\"==this.settings.mode,r=parseInt(i.gap)||0;return parseInt(e[\"margin\"+(s?\"Top\":\"Left\")])+parseInt(e[\"margin\"+(s?\"Bottom\":\"Right\")])+r},bindEvents(t){for(var e in this.listeners=this.listeners||{dragstart:t=>this.dragstart(t,t.target),dragenter:t=>this.dragenter(t,t.target),dragend:t=>this.dragend(t,t.target),dragover:this.throttle(this.dragover,350)},this.listeners)this.parentElm[t?\"removeEventListener\":\"addEventListener\"](e,this.listeners[e])},destroy(){this.cleanup(),this.bindEvents(!0),delete s[this.uid]}},function(t,i){return s[++e]=t.DragSort?s[t.DragSort]:new a(t,{...i,uid:e}),t.DragSort=e,s[e]}}));","/*\nTagify v4.31.3 - tags input component\nBy: Yair Even-Or <vsync.design@gmail.com>\nhttps://github.com/yairEO/tagify\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in\r\nall copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\nTHE SOFTWARE.\r\n\r\nThis Software may not be rebranded and sold as a library under any other name\r\nother than \"Tagify\" (by owner) or as part of another library.\n*/\n\nvar t=\"&#8203;\";function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function i(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if(\"undefined\"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t[\"@@iterator\"])return Array.from(t)}(t)||function(t,i){if(!t)return;if(\"string\"==typeof t)return e(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);\"Object\"===n&&t.constructor&&(n=t.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(n);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,i)}(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}var n={isEnabled:function(){var t;return null===(t=window.TAGIFY_DEBUG)||void 0===t||t},log:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var s;this.isEnabled()&&(s=console).log.apply(s,[\"[Tagify]:\"].concat(i(e)))},warn:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var s;this.isEnabled()&&(s=console).warn.apply(s,[\"[Tagify]:\"].concat(i(e)))}},s=function(t,e,i,n){return t=\"\"+t,e=\"\"+e,n&&(t=t.trim(),e=e.trim()),i?t==e:t.toLowerCase()==e.toLowerCase()},a=function(t,e){return t&&Array.isArray(t)&&t.map((function(t){return o(t,e)}))};function o(t,e){var i,n={};for(i in t)e.indexOf(i)<0&&(n[i]=t[i]);return n}function r(t){return(new DOMParser).parseFromString(t.trim(),\"text/html\").body.firstElementChild}function l(t,e){for(e=e||\"previous\";t=t[e+\"Sibling\"];)if(3==t.nodeType)return t}function d(t){return\"string\"==typeof t?t.replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\").replace(/\"/g,\"&quot;\").replace(/`|'/g,\"&#039;\"):t}function c(t){var e=Object.prototype.toString.call(t).split(\" \")[1].slice(0,-1);return t===Object(t)&&\"Array\"!=e&&\"Function\"!=e&&\"RegExp\"!=e&&\"HTMLUnknownElement\"!=e}function u(t,e,i){var n,s;function a(t,e){for(var i in e)if(e.hasOwnProperty(i)){if(c(e[i])){c(t[i])?a(t[i],e[i]):t[i]=Object.assign({},e[i]);continue}if(Array.isArray(e[i])){t[i]=Object.assign([],e[i]);continue}t[i]=e[i]}}return n=t,(null!=(s=Object)&&\"undefined\"!=typeof Symbol&&s[Symbol.hasInstance]?s[Symbol.hasInstance](n):n instanceof s)||(t={}),a(t,e),i&&a(t,i),t}function g(){var t=[],e={},i=!0,n=!1,s=void 0;try{for(var a,o=arguments[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var r=a.value,l=!0,d=!1,u=void 0;try{for(var g,h=r[Symbol.iterator]();!(l=(g=h.next()).done);l=!0){var p=g.value;c(p)?e[p.value]||(t.push(p),e[p.value]=1):t.includes(p)||t.push(p)}}catch(t){d=!0,u=t}finally{try{l||null==h.return||h.return()}finally{if(d)throw u}}}}catch(t){n=!0,s=t}finally{try{i||null==o.return||o.return()}finally{if(n)throw s}}return t}function h(t){return String.prototype.normalize?\"string\"==typeof t?t.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g,\"\"):void 0:t}var p=function(){return/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent)};function f(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}))}function m(t){return t&&t.classList&&t.classList.contains(this.settings.classNames.tag)}function v(t){return t&&t.closest(this.settings.classNames.tagSelector)}function b(t,e){var i=window.getSelection();return e=e||i.getRangeAt(0),\"string\"==typeof t&&(t=document.createTextNode(t)),e&&(e.deleteContents(),e.insertNode(t)),t}function w(t,e,i){return t?(e&&(t.__tagifyTagData=i?e:u({},t.__tagifyTagData||{},e)),t.__tagifyTagData):(n.warn(\"tag element doesn't exist\",{tagElm:t,data:e}),e)}function y(t){if(t&&t.parentNode){var e=t,i=window.getSelection(),n=i.getRangeAt(0);i.rangeCount&&(n.setStartAfter(e),n.collapse(!0),i.removeAllRanges(),i.addRange(n))}}function T(t,e){t.forEach((function(t){if(w(t.previousSibling)||!t.previousSibling){var i=document.createTextNode(\"​\");t.before(i),e&&y(i)}}))}var O={delimiters:\",\",pattern:null,tagTextProp:\"value\",maxTags:1/0,callbacks:{},addTagOnBlur:!0,addTagOn:[\"blur\",\"tab\",\"enter\"],onChangeAfterBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,focusable:!0,keepInvalidTags:!1,createInvalidTags:!0,mixTagsAllowedAfter:/,|\\.|\\:|\\s/,mixTagsInterpolator:[\"[[\",\"]]\"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:function(){},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:\" \"},autoComplete:{enabled:!0,rightKey:!1,tabKey:!1},classNames:{namespace:\"tagify\",mixMode:\"tagify--mix\",selectMode:\"tagify--select\",input:\"tagify__input\",focus:\"tagify--focus\",tagNoAnimation:\"tagify--noAnim\",tagInvalid:\"tagify--invalid\",tagNotAllowed:\"tagify--notAllowed\",scopeLoading:\"tagify--loading\",hasMaxTags:\"tagify--hasMaxTags\",hasNoTags:\"tagify--noTags\",empty:\"tagify--empty\",inputInvalid:\"tagify__input--invalid\",dropdown:\"tagify__dropdown\",dropdownWrapper:\"tagify__dropdown__wrapper\",dropdownHeader:\"tagify__dropdown__header\",dropdownFooter:\"tagify__dropdown__footer\",dropdownItem:\"tagify__dropdown__item\",dropdownItemActive:\"tagify__dropdown__item--active\",dropdownItemHidden:\"tagify__dropdown__item--hidden\",dropdownItemSelected:\"tagify__dropdown__item--selected\",dropdownInital:\"tagify__dropdown--initial\",tag:\"tagify__tag\",tagText:\"tagify__tag-text\",tagX:\"tagify__tag__removeBtn\",tagLoading:\"tagify__tag--loading\",tagEditing:\"tagify__tag--editable\",tagFlash:\"tagify__tag--flash\",tagHide:\"tagify__tag--hide\"},dropdown:{classname:\"\",enabled:2,maxItems:10,searchKeys:[\"value\",\"searchBy\"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,includeSelectedTags:!1,escapeHTML:!0,highlightFirst:!0,closeOnSelect:!0,clearOnSelect:!0,position:\"all\",appendTarget:null},hooks:{beforeRemoveTag:function(){return Promise.resolve()},beforePaste:function(){return Promise.resolve()},suggestionClick:function(){return Promise.resolve()},beforeKeyDown:function(){return Promise.resolve()}}};function x(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function D(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);\"function\"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),n.forEach((function(e){x(t,e,i[e])}))}return t}function I(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})),t}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function E(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function M(t){return function(t){if(Array.isArray(t))return S(t)}(t)||function(t){if(\"undefined\"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t[\"@@iterator\"])return Array.from(t)}(t)||function(t,e){if(!t)return;if(\"string\"==typeof t)return S(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);\"Object\"===i&&t.constructor&&(i=t.constructor.name);if(\"Map\"===i||\"Set\"===i)return Array.from(i);if(\"Arguments\"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return S(t,e)}(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function N(){for(var t in this.dropdown={},this._dropdown)this.dropdown[t]=\"function\"==typeof this._dropdown[t]?this._dropdown[t].bind(this):this._dropdown[t];this.dropdown.refs(),this.DOM.dropdown.__tagify=this}var _,A,C=(_=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);\"function\"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),n.forEach((function(e){E(t,e,i[e])}))}return t}({},{events:{binding:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.dropdown.events.callbacks,i=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this,null),onKeyDown:e.onKeyDown.bind(this),onMouseOver:e.onMouseOver.bind(this),onMouseLeave:e.onMouseLeave.bind(this),onClick:e.onClick.bind(this),onScroll:e.onScroll.bind(this)},n=t?\"addEventListener\":\"removeEventListener\";\"manual\"!=this.settings.dropdown.position&&(document[n](\"scroll\",i.position,!0),window[n](\"resize\",i.position),window[n](\"keydown\",i.onKeyDown)),this.DOM.dropdown[n](\"mouseover\",i.onMouseOver),this.DOM.dropdown[n](\"mouseleave\",i.onMouseLeave),this.DOM.dropdown[n](\"mousedown\",i.onClick),this.DOM.dropdown.content[n](\"scroll\",i.onScroll)},callbacks:{onKeyDown:function(t){var e=this;if(this.state.hasFocus&&!this.state.composing){var i=this.settings,s=this.DOM.dropdown.querySelector(i.classNames.dropdownItemActiveSelector),a=this.dropdown.getSuggestionDataByNode(s),o=\"mix\"==i.mode,r=\"select\"==i.mode;i.hooks.beforeKeyDown(t,{tagify:this}).then((function(l){switch(t.key){case\"ArrowDown\":case\"ArrowUp\":case\"Down\":case\"Up\":t.preventDefault();var d=e.dropdown.getAllSuggestionsRefs(),c=\"ArrowUp\"==t.key||\"Up\"==t.key;s&&(s=e.dropdown.getNextOrPrevOption(s,!c)),s&&s.matches(i.classNames.dropdownItemSelector)||(s=d[c?d.length-1:0]),e.dropdown.highlightOption(s,!0);break;case\"Escape\":case\"Esc\":e.dropdown.hide();break;case\"ArrowRight\":if(e.state.actions.ArrowLeft||i.autoComplete.rightKey)return;case\"Tab\":var u=!i.autoComplete.rightKey||!i.autoComplete.tabKey;if(!o&&!r&&s&&u&&!e.state.editing&&a){t.preventDefault();var g=e.dropdown.getMappedValue(a);return e.input.autocomplete.set.call(e,g),!1}return!0;case\"Enter\":t.preventDefault(),i.hooks.suggestionClick(t,{tagify:e,tagData:a,suggestionElm:s}).then((function(){if(s)return e.dropdown.selectOption(s),s=e.dropdown.getNextOrPrevOption(s,!c),void e.dropdown.highlightOption(s);e.dropdown.hide(),o||e.addTags(e.state.inputText.trim(),!0)})).catch((function(t){return n.warn(t)}));break;case\"Backspace\":if(o||e.state.editing.scope)return;var h=e.input.raw.call(e);\"\"!=h&&8203!=h.charCodeAt(0)||(!0===i.backspace?e.removeTags():\"edit\"==i.backspace&&setTimeout(e.editTag.bind(e),0))}}))}},onMouseOver:function(t){var e=t.target.closest(this.settings.classNames.dropdownItemSelector);this.dropdown.highlightOption(e)},onMouseLeave:function(t){this.dropdown.highlightOption()},onClick:function(t){var e=this;if(0==t.button&&t.target!=this.DOM.dropdown&&t.target!=this.DOM.dropdown.content){var i=t.target.closest(this.settings.classNames.dropdownItemSelector),s=this.dropdown.getSuggestionDataByNode(i);this.state.actions.selectOption=!0,setTimeout((function(){return e.state.actions.selectOption=!1}),50),this.settings.hooks.suggestionClick(t,{tagify:this,tagData:s,suggestionElm:i}).then((function(){i?e.dropdown.selectOption(i,t):e.dropdown.hide()})).catch((function(t){return n.warn(t)}))}},onScroll:function(t){var e=t.target,i=e.scrollTop/(e.scrollHeight-e.parentNode.clientHeight)*100;this.trigger(\"dropdown:scroll\",{percentage:Math.round(i)})}}},refilter:function(t){t=t||this.state.dropdown.query||\"\",this.suggestedListItems=this.dropdown.filterListItems(t),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger(\"dropdown:updated\",this.DOM.dropdown)},getSuggestionDataByNode:function(t){for(var e,i=t&&t.getAttribute(\"value\"),n=this.suggestedListItems.length;n--;){if(c(e=this.suggestedListItems[n])&&e.value==i)return e;if(e==i)return{value:e}}},getNextOrPrevOption:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.dropdown.getAllSuggestionsRefs(),n=i.findIndex((function(e){return e===t}));return e?i[n+1]:i[n-1]},highlightOption:function(t,e){var i,n=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(n),this.state.ddItemElm.removeAttribute(\"aria-selected\")),!t)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);i=this.dropdown.getSuggestionDataByNode(t),this.state.ddItemData=i,this.state.ddItemElm=t,t.classList.add(n),t.setAttribute(\"aria-selected\",!0),e&&(t.parentNode.scrollTop=t.clientHeight+t.offsetTop-t.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,i),this.dropdown.position())},selectOption:function(t,e){var i=this,n=this.settings,s=n.dropdown,a=s.clearOnSelect,o=s.closeOnSelect;if(!t)return this.addTags(this.state.inputText,!0),void(o&&this.dropdown.hide());e=e||{};var r=t.getAttribute(\"value\"),l=\"noMatch\"==r,d=\"mix\"==n.mode,c=this.suggestedListItems.find((function(t){var e;return(null!==(e=t.value)&&void 0!==e?e:t)==r}));if(this.trigger(\"dropdown:select\",{data:c,elm:t,event:e}),c||l){if(this.state.editing){var g=this.normalizeTags([c])[0];c=n.transformTag.call(this,g)||g,this.onEditTagDone(null,u({__isValid:!0},c))}else this[d?\"addMixTags\":\"addTags\"]([c||this.input.raw.call(this)],a);(d||this.DOM.input.parentNode)&&(setTimeout((function(){i.DOM.input.focus(),i.toggleFocusClass(!0)})),o&&setTimeout(this.dropdown.hide.bind(this)),t.addEventListener(\"transitionend\",(function(){i.dropdown.fillHeaderFooter(),setTimeout((function(){t.remove(),i.dropdown.refilter()}),100)}),{once:!0}),t.classList.add(this.settings.classNames.dropdownItemHidden))}else o&&setTimeout(this.dropdown.hide.bind(this))},selectAll:function(t){this.suggestedListItems.length=0,this.dropdown.hide(),this.dropdown.filterListItems(\"\");var e=this.dropdown.filterListItems(\"\");return t||(e=this.state.dropdown.suggestions),this.addTags(e,!0),this},filterListItems:function(t,e){var i,n,s,a,o,r,l=function(){var t,l,d=void 0,u=void 0;t=m[y],n=(null!=(l=Object)&&\"undefined\"!=typeof Symbol&&l[Symbol.hasInstance]?l[Symbol.hasInstance](t):t instanceof l)?m[y]:{value:m[y]};var v,b=!Object.keys(n).some((function(t){return w.includes(t)}))?[\"value\"]:w;g.fuzzySearch&&!e.exact?(a=b.reduce((function(t,e){return t+\" \"+(n[e]||\"\")}),\"\").toLowerCase().trim(),g.accentedSearch&&(a=h(a),r=h(r)),d=0==a.indexOf(r),u=a===r,v=a,s=r.toLowerCase().split(\" \").every((function(t){return v.includes(t.toLowerCase())}))):(d=!0,s=b.some((function(t){var i=\"\"+(n[t]||\"\");return g.accentedSearch&&(i=h(i),r=h(r)),g.caseSensitive||(i=i.toLowerCase()),u=i===r,e.exact?i===r:0==i.indexOf(r)}))),o=!g.includeSelectedTags&&i.isTagDuplicate(c(n)?n.value:n),s&&!o&&(u&&d?f.push(n):\"startsWith\"==g.sortby&&d?p.unshift(n):p.push(n))},d=this,u=this.settings,g=u.dropdown,p=(e=e||{},[]),f=[],m=u.whitelist,v=g.maxItems>=0?g.maxItems:1/0,b=g.includeSelectedTags||\"select\"==u.mode,w=g.searchKeys,y=0;if(!(t=\"select\"==u.mode&&this.value.length&&this.value[0][u.tagTextProp]==t?\"\":t)||!w.length)return p=b?m:m.filter((function(t){return!d.isTagDuplicate(c(t)?t.value:t)})),this.state.dropdown.suggestions=p,p.slice(0,v);for(r=g.caseSensitive?\"\"+t:(\"\"+t).toLowerCase();y<m.length;y++)i=this,l();return this.state.dropdown.suggestions=f.concat(p),\"function\"==typeof g.sortby?g.sortby(f.concat(p),r):f.concat(p).slice(0,v)},getMappedValue:function(t){var e=this.settings.dropdown.mapValueTo;return e?\"function\"==typeof e?e(t):t[e]||t.value:t.value},createListHTML:function(t){var e=this;return u([],t).map((function(t,i){\"string\"!=typeof t&&\"number\"!=typeof t||(t={value:t});var n=e.dropdown.getMappedValue(t);return n=\"string\"==typeof n&&e.settings.dropdown.escapeHTML?d(n):n,e.settings.templates.dropdownItem.apply(e,[I(D({},t),{mappedValue:n}),e])})).join(\"\")}}),A=null!=(A={refs:function(){this.DOM.dropdown=this.parseTemplate(\"dropdown\",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector(\"[data-selector='tagify-suggestions-wrapper']\")},getHeaderRef:function(){return this.DOM.dropdown.querySelector(\"[data-selector='tagify-suggestions-header']\")},getFooterRef:function(){return this.DOM.dropdown.querySelector(\"[data-selector='tagify-suggestions-footer']\")},getAllSuggestionsRefs:function(){return M(this.DOM.dropdown.content.querySelectorAll(this.settings.classNames.dropdownItemSelector))},show:function(t){var e,i,n,a=this,o=this.settings,r=\"mix\"==o.mode&&!o.enforceWhitelist,l=!o.whitelist||!o.whitelist.length,d=\"manual\"==o.dropdown.position;if(t=void 0===t?this.state.inputText:t,!(l&&!r&&!o.templates.dropdownItemNoMatch||!1===o.dropdown.enable||this.state.isLoading||this.settings.readonly)){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(t),t&&!this.suggestedListItems.length&&(this.trigger(\"dropdown:noMatch\",t),o.templates.dropdownItemNoMatch&&(n=o.templates.dropdownItemNoMatch.call(this,{value:t}))),!n){if(this.suggestedListItems.length)t&&r&&!this.state.editing.scope&&!s(this.suggestedListItems[0].value,t)&&this.suggestedListItems.unshift({value:t});else{if(!t||!r||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:t}]}i=\"\"+(c(e=this.suggestedListItems[0])?e.value:e),o.autoComplete&&i&&0==i.indexOf(t)&&this.input.autocomplete.suggest.call(this,e)}this.dropdown.fill(n),o.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.querySelector(o.classNames.dropdownItemSelector)),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=t||!0,this.state.dropdown.query=t,this.setStateSelection(),d||setTimeout((function(){a.dropdown.position(),a.dropdown.render()})),setTimeout((function(){a.trigger(\"dropdown:show\",a.DOM.dropdown)}))}},hide:function(t){var e=this,i=this.DOM,n=i.scope,s=i.dropdown,a=\"manual\"==this.settings.dropdown.position&&!t;if(s&&document.body.contains(s)&&!a)return window.removeEventListener(\"resize\",this.dropdown.position),this.dropdown.events.binding.call(this,!1),n.setAttribute(\"aria-expanded\",!1),s.parentNode.removeChild(s),setTimeout((function(){e.state.dropdown.visible=!1}),100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger(\"dropdown:hide\",s),this},toggle:function(t){this.dropdown[this.state.dropdown.visible&&!t?\"hide\":\"show\"]()},getAppendTarget:function(){var t=this.settings.dropdown;return\"function\"==typeof t.appendTarget?t.appendTarget():t.appendTarget},render:function(){var t,e,i,n=this,s=(t=this.DOM.dropdown,(i=t.cloneNode(!0)).style.cssText=\"position:fixed; top:-9999px; opacity:0\",document.body.appendChild(i),e=i.clientHeight,i.parentNode.removeChild(i),e),a=this.settings,o=this.dropdown.getAppendTarget();return!1===a.dropdown.enabled||(this.DOM.scope.setAttribute(\"aria-expanded\",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(a.classNames.dropdownInital),this.dropdown.position(s),o.appendChild(this.DOM.dropdown),setTimeout((function(){return n.DOM.dropdown.classList.remove(a.classNames.dropdownInital)})))),this},fill:function(t){t=\"string\"==typeof t?t:this.dropdown.createListHTML(t||this.suggestedListItems);var e,i=this.settings.templates.dropdownContent.call(this,t);this.DOM.dropdown.content.innerHTML=(e=i)?e.replace(/\\>[\\r\\n ]+\\</g,\"><\").split(/>\\s+</).join(\"><\").trim():\"\"},fillHeaderFooter:function(){var t=this.dropdown.filterListItems(this.state.dropdown.query),e=this.parseTemplate(\"dropdownHeader\",[t]),i=this.parseTemplate(\"dropdownFooter\",[t]),n=this.dropdown.getHeaderRef(),s=this.dropdown.getFooterRef();e&&(null==n||n.parentNode.replaceChild(e,n)),i&&(null==s||s.parentNode.replaceChild(i,s))},position:function(t){var e=this.settings.dropdown,i=this.dropdown.getAppendTarget();if(\"manual\"!=e.position&&i){var n,s,a,o,r,l,d,c,u,g=this.DOM.dropdown,h=e.RTL,p=i===document.body,f=i===this.DOM.scope,m=p?window.pageYOffset:i.scrollTop,v=document.fullscreenElement||document.webkitFullscreenElement||document.documentElement,b=v.clientHeight,w=Math.max(v.clientWidth||0,window.innerWidth||0)>480?e.position:\"all\",y=this.DOM[\"input\"==w?\"input\":\"scope\"];if(t=t||g.clientHeight,this.state.dropdown.visible){if(\"text\"==w?(a=(n=function(){var t=document.getSelection();if(t.rangeCount){var e,i,n=t.getRangeAt(0),s=n.startContainer,a=n.startOffset;if(a>0)return(i=document.createRange()).setStart(s,a-1),i.setEnd(s,a),{left:(e=i.getBoundingClientRect()).right,top:e.top,bottom:e.bottom};if(s.getBoundingClientRect)return s.getBoundingClientRect()}return{left:-9999,top:-9999}}()).bottom,s=n.top,o=n.left,r=\"auto\"):(l=function(t){var e=0,i=0;for(t=t.parentNode;t&&t!=v;)e+=t.offsetTop||0,i+=t.offsetLeft||0,t=t.parentNode;return{top:e,left:i}}(i),n=y.getBoundingClientRect(),s=f?-1:n.top-l.top,a=(f?n.height:n.bottom-l.top)-1,o=f?-1:n.left-l.left,r=n.width+\"px\"),!p){var T=function(){for(var t=0,i=e.appendTarget.parentNode;i;)t+=i.scrollTop||0,i=i.parentNode;return t}();s+=T,a+=T}var O;s=Math.floor(s),a=Math.ceil(a),c=((d=null!==(O=e.placeAbove)&&void 0!==O?O:b-n.bottom<t)?s:a)+m,u=\"left: \".concat(o+(h&&n.width||0)+window.pageXOffset,\"px;\"),g.style.cssText=\"\".concat(u,\"; top: \").concat(c,\"px; min-width: \").concat(r,\"; max-width: \").concat(r),g.setAttribute(\"placement\",d?\"top\":\"bottom\"),g.setAttribute(\"position\",w)}}}})?A:{},Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(A)):function(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}(Object(A)).forEach((function(t){Object.defineProperty(_,t,Object.getOwnPropertyDescriptor(A,t))})),_),k=\"@yaireo/tagify/\",L={empty:\"empty\",exceed:\"number of tags exceeded\",pattern:\"pattern mismatch\",duplicate:\"already exists\",notAllowed:\"not allowed\"},j={wrapper:function(e,i){return'<tags class=\"'.concat(i.classNames.namespace,\" \").concat(i.mode?\"\".concat(i.classNames[i.mode+\"Mode\"]):\"\",\" \").concat(e.className,'\"\\n                    ').concat(i.readonly?\"readonly\":\"\",\"\\n                    \").concat(i.disabled?\"disabled\":\"\",\"\\n                    \").concat(i.required?\"required\":\"\",\"\\n                    \").concat(\"select\"===i.mode?\"spellcheck='false'\":\"\",'\\n                    tabIndex=\"-1\">\\n                    ').concat(this.settings.templates.input.call(this),\"\\n                \").concat(t,\"\\n        </tags>\")},input:function(){var e=this.settings,i=e.placeholder||t;return\"<span \".concat(!e.readonly&&e.userInput?\"contenteditable\":\"\",' tabIndex=\"0\" data-placeholder=\"').concat(i,'\" aria-placeholder=\"').concat(e.placeholder||\"\",'\"\\n                    class=\"').concat(e.classNames.input,'\"\\n                    role=\"textbox\"\\n                    autocapitalize=\"false\"\\n                    autocorrect=\"off\"\\n                    spellcheck=\"false\"\\n                    aria-autocomplete=\"both\"\\n                    aria-multiline=\"').concat(\"mix\"==e.mode,'\"></span>')},tag:function(t,e){var i=e.settings;return'<tag title=\"'.concat(t.title||t.value,\"\\\"\\n                    contenteditable='false'\\n                    tabIndex=\\\"\").concat(i.a11y.focusableTags?0:-1,'\"\\n                    class=\"').concat(i.classNames.tag,\" \").concat(t.class||\"\",'\"\\n                    ').concat(this.getAttributes(t),\">\\n            <x title='' tabIndex=\\\"\").concat(i.a11y.focusableTags?0:-1,'\" class=\"').concat(i.classNames.tagX,\"\\\" role='button' aria-label='remove tag'></x>\\n            <div>\\n                <span \").concat(\"select\"===i.mode&&i.userInput?\"contenteditable='true'\":\"\",' autocapitalize=\"false\" autocorrect=\"off\" spellcheck=\\'false\\' class=\"').concat(i.classNames.tagText,'\">').concat(t[i.tagTextProp]||t.value,\"</span>\\n            </div>\\n        </tag>\")},dropdown:function(t){var e=t.dropdown,i=\"manual\"==e.position;return'<div class=\"'.concat(i?\"\":t.classNames.dropdown,\" \").concat(e.classname,'\" role=\"listbox\" aria-labelledby=\"dropdown\" dir=\"').concat(e.RTL?\"rtl\":\"\",\"\\\">\\n                    <div data-selector='tagify-suggestions-wrapper' class=\\\"\").concat(t.classNames.dropdownWrapper,'\"></div>\\n                </div>')},dropdownContent:function(t){var e=this.settings.templates,i=this.state.dropdown.suggestions;return\"\\n            \".concat(e.dropdownHeader.call(this,i),\"\\n            \").concat(t,\"\\n            \").concat(e.dropdownFooter.call(this,i),\"\\n        \")},dropdownItem:function(t){return\"<div \".concat(this.getAttributes(t),\"\\n                    class='\").concat(this.settings.classNames.dropdownItem,\" \").concat(this.isTagDuplicate(t.value)?this.settings.classNames.dropdownItemSelected:\"\",\" \").concat(t.class||\"\",'\\'\\n                    tabindex=\"0\"\\n                    role=\"option\">').concat(t.mappedValue||t.value,\"</div>\")},dropdownHeader:function(t){return\"<header data-selector='tagify-suggestions-header' class=\\\"\".concat(this.settings.classNames.dropdownHeader,'\"></header>')},dropdownFooter:function(t){var e=t.length-this.settings.dropdown.maxItems;return e>0?\"<footer data-selector='tagify-suggestions-footer' class=\\\"\".concat(this.settings.classNames.dropdownFooter,'\">\\n                ').concat(e,\" more items. Refine your search.\\n            </footer>\"):\"\"},dropdownItemNoMatch:null};function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function V(t,e){return null!=e&&\"undefined\"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function F(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:\"undefined\"!=typeof Symbol&&t[Symbol.iterator]||t[\"@@iterator\"];if(null!=i){var n,s,a=[],o=!0,r=!1;try{for(i=i.call(t);!(o=(n=i.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){r=!0,s=t}finally{try{o||null==i.return||i.return()}finally{if(r)throw s}}return a}}(t,e)||function(t,e){if(!t)return;if(\"string\"==typeof t)return P(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);\"Object\"===i&&t.constructor&&(i=t.constructor.name);if(\"Map\"===i||\"Set\"===i)return Array.from(i);if(\"Arguments\"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return P(t,e)}(t,e)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function H(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function B(t,e){return null!=e&&\"undefined\"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function W(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})),t}function K(t){return function(t){if(Array.isArray(t))return R(t)}(t)||function(t){if(\"undefined\"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t[\"@@iterator\"])return Array.from(t)}(t)||function(t,e){if(!t)return;if(\"string\"==typeof t)return R(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);\"Object\"===i&&t.constructor&&(i=t.constructor.name);if(\"Map\"===i||\"Set\"===i)return Array.from(i);if(\"Arguments\"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return R(t,e)}(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}var U={customBinding:function(){var t=this;this.customEventsList.forEach((function(e){t.on(e,t.settings.callbacks[e])}))},binding:function(){var t,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=this.settings,n=this.events.callbacks,s=e?\"addEventListener\":\"removeEventListener\";if(!this.state.mainEvents||!e){for(var a in this.state.mainEvents=e,e&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on(\"tagify.removeAllTags\",this.removeAllTags.bind(this))),t=this.listeners.main=this.listeners.main||{keydown:[\"input\",n.onKeydown.bind(this)],click:[\"scope\",n.onClickScope.bind(this)],dblclick:\"select\"!=i.mode&&[\"scope\",n.onDoubleClickScope.bind(this)],paste:[\"input\",n.onPaste.bind(this)],drop:[\"input\",n.onDrop.bind(this)],compositionstart:[\"input\",n.onCompositionStart.bind(this)],compositionend:[\"input\",n.onCompositionEnd.bind(this)]})t[a]&&this.DOM[t[a][0]][s](a,t[a][1]);var o=this.listeners.main.inputMutationObserver||new MutationObserver(n.onInputDOMChange.bind(this));o.disconnect(),\"mix\"==i.mode&&o.observe(this.DOM.input,{childList:!0}),this.events.bindOriginaInputListener.call(this)}},bindOriginaInputListener:function(t){var e=(t||0)+500;this.listeners.main&&(clearInterval(this.listeners.main.originalInputValueObserverInterval),this.listeners.main.originalInputValueObserverInterval=setInterval(this.events.callbacks.observeOriginalInputValue.bind(this),e))},bindGlobal:function(t){var e,i=this.events.callbacks,n=t?\"removeEventListener\":\"addEventListener\";if(this.listeners&&(t||!this.listeners.global)){this.listeners.global=this.listeners.global||[{type:this.isIE?\"keydown\":\"input\",target:this.DOM.input,cb:i[this.isIE?\"onInputIE\":\"onInput\"].bind(this)},{type:\"keydown\",target:window,cb:i.onWindowKeyDown.bind(this)},{type:\"focusin\",target:this.DOM.scope,cb:i.onFocusBlur.bind(this)},{type:\"focusout\",target:this.DOM.scope,cb:i.onFocusBlur.bind(this)},{type:\"click\",target:document,cb:i.onClickAnywhere.bind(this),useCapture:!0}];var s=!0,a=!1,o=void 0;try{for(var r,l=this.listeners.global[Symbol.iterator]();!(s=(r=l.next()).done);s=!0)(e=r.value).target[n](e.type,e.cb,!!e.useCapture)}catch(t){a=!0,o=t}finally{try{s||null==l.return||l.return()}finally{if(a)throw o}}}},unbindGlobal:function(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur:function(t){var e,i,n=this.settings,s=v.call(this,t.target),a=m.call(this,t.target),o=t.target.classList.contains(n.classNames.tagX),r=\"focusin\"==t.type,l=\"focusout\"==t.type;s&&r&&!a&&!o&&this.toggleFocusClass(this.state.hasFocus=+new Date);var d=t.target?this.trim(this.DOM.input.textContent):\"\",c=null===(i=this.value)||void 0===i||null===(e=i[0])||void 0===e?void 0:e[n.tagTextProp],u=n.dropdown.enabled>=0,g={relatedTarget:t.relatedTarget},h=this.state.actions.selectOption&&(u||!n.dropdown.closeOnSelect),p=this.state.actions.addNew&&u;if(l){if(t.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),n.onChangeAfterBlur&&this.triggerChangeEvent()}if(!(h||p||o))if(r||s?(this.state.hasFocus=+new Date,this.toggleFocusClass(this.state.hasFocus)):this.state.hasFocus=!1,\"mix\"!=n.mode){if(r){if(!n.focusable)return;var f=0===n.dropdown.enabled&&!this.state.dropdown.visible,b=!a||\"select\"===n.mode;return this.toggleFocusClass(!0),this.trigger(\"focus\",g),void(f&&b&&this.dropdown.show(this.value.length?\"\":void 0))}if(l){if(this.trigger(\"blur\",g),this.loading(!1),\"select\"==n.mode){if(this.value.length){var w=this.getTagElms()[0];d=this.trim(w.textContent)}c===d&&(d=\"\")}d&&!this.state.actions.selectOption&&n.addTagOnBlur&&n.addTagOn.includes(\"blur\")&&this.addTags(d,!0)}s||(this.DOM.input.removeAttribute(\"style\"),this.dropdown.hide())}else r?this.trigger(\"focus\",g):l&&(this.trigger(\"blur\",g),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onCompositionStart:function(t){this.state.composing=!0},onCompositionEnd:function(t){this.state.composing=!1},onWindowKeyDown:function(t){var e,i=this.settings,n=document.activeElement,s=v.call(this,n)&&this.DOM.scope.contains(document.activeElement),a=s&&n.hasAttribute(\"readonly\");if(this.state.hasFocus||s&&!a){e=n.nextElementSibling;var o=t.target.classList.contains(i.classNames.tagX);switch(t.key){case\"Backspace\":i.readonly||this.state.editing||(this.removeTags(n),(e||this.DOM.input).focus());break;case\"Enter\":if(o)return void this.removeTags(t.target.parentNode);i.a11y.focusableTags&&m.call(this,n)&&setTimeout(this.editTag.bind(this),0,n);break;case\"ArrowDown\":this.state.dropdown.visible||\"mix\"==i.mode||this.dropdown.show()}}},onKeydown:function(t){var e=this,i=this.settings;if(!this.state.composing&&i.userInput){\"select\"==i.mode&&i.enforceWhitelist&&this.value.length&&\"Tab\"!=t.key&&t.preventDefault();var n=this.trim(t.target.textContent);this.trigger(\"keydown\",{event:t}),i.hooks.beforeKeyDown(t,{tagify:this}).then((function(s){if(\"mix\"==i.mode){switch(t.key){case\"Left\":case\"ArrowLeft\":e.state.actions.ArrowLeft=!0;break;case\"Delete\":case\"Backspace\":if(e.state.editing)return;var a=document.getSelection(),o=\"Delete\"==t.key&&a.anchorOffset==(a.anchorNode.length||0),r=a.anchorNode.previousSibling,d=1==a.anchorNode.nodeType||!a.anchorOffset&&r&&1==r.nodeType&&a.anchorNode.previousSibling;!function(t){var e=document.createElement(\"div\");t.replace(/\\&#?[0-9a-z]+;/gi,(function(t){return e.innerHTML=t,e.innerText}))}(e.DOM.input.innerHTML);var c,u,g,h=e.getTagElms(),f=1===a.anchorNode.length&&a.anchorNode.nodeValue==String.fromCharCode(8203);if(\"edit\"==i.backspace&&d)return c=1==a.anchorNode.nodeType?null:a.anchorNode.previousElementSibling,setTimeout(e.editTag.bind(e),0,c),void t.preventDefault();if(p()&&B(d,Element))return g=l(d),d.hasAttribute(\"readonly\")||d.remove(),e.DOM.input.focus(),void setTimeout((function(){y(g),e.DOM.input.click()}));if(\"BR\"==a.anchorNode.nodeName)return;if((o||d)&&1==a.anchorNode.nodeType?u=0==a.anchorOffset?o?h[0]:null:h[Math.min(h.length,a.anchorOffset)-1]:o?u=a.anchorNode.nextElementSibling:B(d,Element)&&(u=d),3==a.anchorNode.nodeType&&!a.anchorNode.nodeValue&&a.anchorNode.previousElementSibling&&t.preventDefault(),(d||o)&&!i.backspace)return void t.preventDefault();if(\"Range\"!=a.type&&!a.anchorOffset&&a.anchorNode==e.DOM.input&&\"Delete\"!=t.key)return void t.preventDefault();if(\"Range\"!=a.type&&u&&u.hasAttribute(\"readonly\"))return void y(l(u));\"Delete\"==t.key&&f&&w(a.anchorNode.nextSibling)&&e.removeTags(a.anchorNode.nextSibling)}return!0}var m=\"manual\"==i.dropdown.position;switch(t.key){case\"Backspace\":\"select\"==i.mode&&i.enforceWhitelist&&e.value.length?e.removeTags():e.state.dropdown.visible&&\"manual\"!=i.dropdown.position||\"\"!=t.target.textContent&&8203!=n.charCodeAt(0)||(!0===i.backspace?e.removeTags():\"edit\"==i.backspace&&setTimeout(e.editTag.bind(e),0));break;case\"Esc\":case\"Escape\":if(e.state.dropdown.visible)return;t.target.blur();break;case\"Down\":case\"ArrowDown\":e.state.dropdown.visible||e.dropdown.show();break;case\"ArrowRight\":var v=e.state.inputSuggestion||e.state.ddItemData;if(v&&i.autoComplete.rightKey)return void e.addTags([v],!0);break;case\"Tab\":var b=\"select\"==i.mode;if(!n||b)return!0;t.preventDefault();case\"Enter\":if(e.state.dropdown.visible&&!m)return;t.preventDefault(),setTimeout((function(){e.state.dropdown.visible&&!m||e.state.actions.selectOption||!i.addTagOn.includes(t.key.toLowerCase())||e.addTags(n,!0)}))}})).catch((function(t){return t}))}},onInput:function(t){this.postUpdate();var e=this.settings;if(\"mix\"==e.mode)return this.events.callbacks.onMixTagsInput.call(this,t);var i=this.input.normalize.call(this,void 0,{trim:!1}),n=i.length>=e.dropdown.enabled,s={value:i,inputElm:this.DOM.input},a=this.validateTag({value:i});\"select\"==e.mode&&this.toggleScopeValidation(a),s.isValid=a,this.state.inputText!=i&&(this.input.set.call(this,i,!1),-1!=i.search(e.delimiters)?this.addTags(i)&&this.input.set.call(this):e.dropdown.enabled>=0&&this.dropdown[n?\"show\":\"hide\"](i),this.trigger(\"input\",s))},onMixTagsInput:function(t){var e,i,n,s,a,o,r,l,d=this,c=this.settings,g=this.value.length,h=this.getTagElms(),f=document.createDocumentFragment(),m=window.getSelection().getRangeAt(0),v=[].map.call(h,(function(t){return w(t).value}));if(\"deleteContentBackward\"==t.inputType&&p()&&this.events.callbacks.onKeydown.call(this,{target:t.target,key:\"Backspace\"}),T(this.getTagElms()),this.value.slice().forEach((function(t){t.readonly&&!v.includes(t.value)&&f.appendChild(d.createTagElem(t))})),f.childNodes.length&&(m.insertNode(f),this.setRangeAtStartEnd(!1,f.lastChild)),h.length!=g)return this.value=[].map.call(this.getTagElms(),(function(t){return w(t)})),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(o=window.getSelection()).rangeCount>0&&3==o.anchorNode.nodeType){if((m=o.getRangeAt(0).cloneRange()).collapse(!0),m.setStart(o.focusNode,0),n=(e=m.toString().slice(0,m.endOffset)).split(c.pattern).length-1,(i=e.match(c.pattern))&&(s=e.slice(e.lastIndexOf(i[i.length-1]))),s){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:s.match(c.pattern)[0],value:s.replace(c.pattern,\"\")},this.state.tag.baseOffset=o.baseOffset-this.state.tag.value.length,l=this.state.tag.value.match(c.delimiters))return this.state.tag.value=this.state.tag.value.replace(c.delimiters,\"\"),this.state.tag.delimiters=l[0],this.addTags(this.state.tag.value,c.dropdown.clearOnSelect),void this.dropdown.hide();a=this.state.tag.value.length>=c.dropdown.enabled;try{r=(r=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&r.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(t){}(r||n<this.state.mixMode.matchedPatternCount)&&(a=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=n}setTimeout((function(){d.update({withoutChangeEvent:!0}),d.trigger(\"input\",u({},d.state.tag,{textContent:d.DOM.input.textContent})),d.state.tag&&d.dropdown[a?\"show\":\"hide\"](d.state.tag.value)}),10)},onInputIE:function(t){var e=this;setTimeout((function(){e.events.callbacks.onInput.call(e,t)}))},observeOriginalInputValue:function(){this.DOM.originalInput.parentNode||this.destroy(),this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickAnywhere:function(t){t.target==this.DOM.scope||this.DOM.scope.contains(t.target)||(this.toggleFocusClass(!1),this.state.hasFocus=!1,t.target.closest(\".tagify__dropdown\")&&t.target.closest(\".tagify__dropdown\").__tagify!=this&&this.dropdown.hide())},onClickScope:function(t){var e=this.settings,i=t.target.closest(\".\"+e.classNames.tag),n=t.target===this.DOM.scope,s=+new Date-this.state.hasFocus;if(n&&\"select\"!=e.mode)this.DOM.input.focus();else{if(!t.target.classList.contains(e.classNames.tagX))return i&&!this.state.editing?(this.trigger(\"click\",{tag:i,index:this.getNodeIndex(i),data:w(i),event:t}),void(1!==e.editTags&&1!==e.editTags.clicks&&\"select\"!=e.mode||this.events.callbacks.onDoubleClickScope.call(this,t))):void(t.target==this.DOM.input&&(\"mix\"==e.mode&&this.fixFirefoxLastTagNoCaret(),s>500||!e.focusable)?this.state.dropdown.visible?this.dropdown.hide():0===e.dropdown.enabled&&\"mix\"!=e.mode&&this.dropdown.show(this.value.length?\"\":void 0):\"select\"!=e.mode||0!==e.dropdown.enabled||this.state.dropdown.visible||(this.events.callbacks.onDoubleClickScope.call(this,W(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);\"function\"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),n.forEach((function(e){H(t,e,i[e])}))}return t}({},t),{target:this.getTagElms()[0]})),!e.userInput&&this.dropdown.show()));this.removeTags(t.target.parentNode)}},onPaste:function(t){var e=this;t.preventDefault();var i,n,s,a=this.settings;if(\"select\"==a.mode&&a.enforceWhitelist||!a.userInput)return!1;a.readonly||(n=t.clipboardData||window.clipboardData,s=n.getData(\"Text\"),a.hooks.beforePaste(t,{tagify:this,pastedText:s,clipboardData:n}).then((function(a){void 0===a&&(a=s),a&&(e.injectAtCaret(a,window.getSelection().getRangeAt(0)),\"mix\"==e.settings.mode?e.events.callbacks.onMixTagsInput.call(e,t):e.settings.pasteAsTags?i=e.addTags(e.state.inputText+a,!0):(e.state.inputText=a,e.dropdown.show(a))),e.trigger(\"paste\",{event:t,pastedText:s,clipboardData:n,tagsElems:i})})).catch((function(t){return t})))},onDrop:function(t){t.preventDefault()},onEditTagInput:function(t,e){var i,n=t.closest(\".\"+this.settings.classNames.tag),s=this.getNodeIndex(n),a=w(n),o=this.input.normalize.call(this,t),r=(H(i={},this.settings.tagTextProp,o),H(i,\"__tagId\",a.__tagId),i),l=this.validateTag(r);this.editTagChangeDetected(u(a,r))||!0!==t.originalIsValid||(l=!0),n.classList.toggle(this.settings.classNames.tagInvalid,!0!==l),a.__isValid=l,n.title=!0===l?a.title||a.value:l,o.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=o),this.dropdown.show(o)),this.trigger(\"edit:input\",{tag:n,index:s,data:u({},this.value[s],{newValue:o}),event:e})},onEditTagPaste:function(t,e){var i=(e.clipboardData||window.clipboardData).getData(\"Text\");e.preventDefault();var n=b(i);this.setRangeAtStartEnd(!1,n)},onEditTagClick:function(t,e){this.events.callbacks.onClickScope.call(this,e)},onEditTagFocus:function(t){this.state.editing={scope:t,input:t.querySelector(\"[contenteditable]\")}},onEditTagBlur:function(t,e){var i=m.call(this,e.relatedTarget);if(\"select\"==this.settings.mode&&i&&e.relatedTarget.contains(e.target))this.dropdown.hide();else if(this.state.editing&&(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(t))){var n,s,a,o=this.settings,r=t.closest(\".\"+o.classNames.tag),l=w(r),d=this.input.normalize.call(this,t),c=(H(n={},o.tagTextProp,d),H(n,\"__tagId\",l.__tagId),n),g=l.__originalData,h=this.editTagChangeDetected(u(l,c)),p=this.validateTag(c);if(d)if(h){var f;if(s=this.hasMaxTags(),a=u({},g,(H(f={},o.tagTextProp,this.trim(d)),H(f,\"__isValid\",p),f)),o.transformTag.call(this,a,g),!0!==(p=(!s||!0===g.__isValid)&&this.validateTag(a))){if(this.trigger(\"invalid\",{data:a,tag:r,message:p}),o.editTags.keepInvalid)return;o.keepInvalidTags?a.__isValid=p:a=g}else o.keepInvalidTags&&(delete a.title,delete a[\"aria-invalid\"],delete a.class);this.onEditTagDone(r,a)}else this.onEditTagDone(r,g);else this.onEditTagDone(r)}},onEditTagkeydown:function(t,e){if(!this.state.composing)switch(this.trigger(\"edit:keydown\",{event:t}),t.key){case\"Esc\":case\"Escape\":this.state.editing=!1,!!e.__tagifyTagData.__originalData.value?e.parentNode.replaceChild(e.__tagifyTagData.__originalHTML,e):e.remove();break;case\"Enter\":case\"Tab\":t.preventDefault();setTimeout((function(){return t.target.blur()}),0)}},onDoubleClickScope:function(t){var e,i,n=t.target.closest(\".\"+this.settings.classNames.tag),s=w(n),a=this.settings;n&&!1!==s.editable&&(e=n.classList.contains(this.settings.classNames.tagEditing),i=n.hasAttribute(\"readonly\"),a.readonly||e||i||!this.settings.editTags||!a.userInput||(this.events.callbacks.onEditTagFocus.call(this,n),this.editTag(n)),this.toggleFocusClass(!0),\"select\"!=a.mode&&this.trigger(\"dblclick\",{tag:n,index:this.getNodeIndex(n),data:w(n)}))},onInputDOMChange:function(t){var e=this;t.forEach((function(t){t.addedNodes.forEach((function(t){if(\"<div><br></div>\"==t.outerHTML)t.replaceWith(document.createElement(\"br\"));else if(1==t.nodeType&&t.querySelector(e.settings.classNames.tagSelector)){var i,n=document.createTextNode(\"\");3==t.childNodes[0].nodeType&&\"BR\"!=t.previousSibling.nodeName&&(n=document.createTextNode(\"\\n\")),(i=t).replaceWith.apply(i,K([n].concat(K(K(t.childNodes).slice(0,-1))))),y(n)}else if(m.call(e,t)){var s;if(3!=(null===(s=t.previousSibling)||void 0===s?void 0:s.nodeType)||t.previousSibling.textContent||t.previousSibling.remove(),t.previousSibling&&\"BR\"==t.previousSibling.nodeName){t.previousSibling.replaceWith(\"\\n​\");for(var a=t.nextSibling,o=\"\";a;)o+=a.textContent,a=a.nextSibling;o.trim()&&y(t.previousSibling)}else t.previousSibling&&!w(t.previousSibling)||t.before(\"​\")}})),t.removedNodes.forEach((function(t){t&&\"BR\"==t.nodeName&&m.call(e,i)&&(e.removeTags(i),e.fixFirefoxLastTagNoCaret())}))}));var i=this.DOM.input.lastChild;i&&\"\"==i.nodeValue&&i.remove(),i&&\"BR\"==i.nodeName||this.DOM.input.appendChild(document.createElement(\"br\"))}}};function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function z(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function X(t,e){return null!=e&&\"undefined\"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function J(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);\"function\"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),n.forEach((function(e){z(t,e,i[e])}))}return t}function G(t){return function(t){if(Array.isArray(t))return q(t)}(t)||function(t){if(\"undefined\"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t[\"@@iterator\"])return Array.from(t)}(t)||function(t,e){if(!t)return;if(\"string\"==typeof t)return q(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);\"Object\"===i&&t.constructor&&(i=t.constructor.name);if(\"Map\"===i||\"Set\"===i)return Array.from(i);if(\"Arguments\"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return q(t,e)}(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function $(t,e){if(!t){n.warn(\"input element not found\",t);var i=new Proxy(this,{get:function(){return function(){return i}}});return i}if(t.__tagify)return n.warn(\"input element is already Tagified - Same instance is returned.\",t),t.__tagify;var s;u(this,function(t){var e=document.createTextNode(\"\"),i={};function s(t,i,n){n&&i.split(/\\s+/g).forEach((function(i){return e[t+\"EventListener\"].call(e,i,n)}))}return{removeAllCustomListeners:function(){Object.entries(i).forEach((function(t){var e=F(t,2),i=e[0];e[1].forEach((function(t){return s(\"remove\",i,t)}))})),i={}},off:function(t,e){return t&&(e?s(\"remove\",t,e):t.split(/\\s+/g).forEach((function(t){var e;null===(e=i[t])||void 0===e||e.forEach((function(e){return s(\"remove\",t,e)})),delete i[t]}))),this},on:function(t,e){return e&&\"function\"==typeof e&&(t.split(/\\s+/g).forEach((function(t){Array.isArray(i[t])?i[t].push(e):i[t]=[e]})),s(\"add\",t,e)),this},trigger:function(i,s,a){var o;if(a=a||{cloneData:!0},i)if(t.settings.isJQueryPlugin)\"remove\"==i&&(i=\"removeTag\"),jQuery(t.DOM.originalInput).triggerHandler(i,[s]);else{try{var r=\"object\"==typeof s?s:{value:s};if((r=a.cloneData?u({},r):r).tagify=this,s.event&&(r.event=this.cloneEvent(s.event)),V(s,Object))for(var l in s)V(s[l],HTMLElement)&&(r[l]=s[l]);o=new CustomEvent(i,{detail:r})}catch(t){n.warn(t)}e.dispatchEvent(o)}}}}(this)),this.isFirefox=/firefox|fxios/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent),this.isIE=window.document.documentMode,e=e||{},this.getPersistedData=(s=e.id,function(t){var e,i=\"/\"+t;if(1==localStorage.getItem(k+s+\"/v\",1))try{e=JSON.parse(localStorage[k+s+i])}catch(t){}return e}),this.setPersistedData=function(t){return t?(localStorage.setItem(k+t+\"/v\",1),function(e,i){var n=\"/\"+i,s=JSON.stringify(e);e&&i&&(localStorage.setItem(k+t+n,s),dispatchEvent(new Event(\"storage\")))}):function(){}}(e.id),this.clearPersistedData=function(t){return function(e){var i=k+\"/\"+t+\"/\";if(e)localStorage.removeItem(i+e);else for(var n in localStorage)n.includes(i)&&localStorage.removeItem(n)}}(e.id),this.applySettings(t,e),this.state={inputText:\"\",editing:!1,composing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(t),N.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),t.autofocus&&this.DOM.input.focus(),t.__tagify=this}$.prototype={_dropdown:C,placeCaretAfterNode:y,getSetTagData:w,helpers:{sameStr:s,removeCollectionProp:a,omit:o,isObject:c,parseHTML:r,escapeHTML:d,extend:u,concatWithoutDups:g,getUID:f,isNodeTag:m},customEventsList:[\"change\",\"add\",\"remove\",\"invalid\",\"input\",\"paste\",\"click\",\"keydown\",\"focus\",\"blur\",\"edit:input\",\"edit:beforeUpdate\",\"edit:updated\",\"edit:start\",\"edit:keydown\",\"dropdown:show\",\"dropdown:hide\",\"dropdown:select\",\"dropdown:updated\",\"dropdown:noMatch\",\"dropdown:scroll\"],dataProps:[\"__isValid\",\"__removed\",\"__originalData\",\"__originalHTML\",\"__tagId\"],trim:function(t){return this.settings.trim&&t&&\"string\"==typeof t?t.trim():t},parseHTML:r,templates:j,parseTemplate:function(t,e){return r((t=this.settings.templates[t]||t).apply(this,e))},set whitelist(t){var e=t&&Array.isArray(t);this.settings.whitelist=e?t:[],this.setPersistedData(e?t:[],\"whitelist\")},get whitelist(){return this.settings.whitelist},set userInput(t){this.settings.userInput=!!t,this.setContentEditable(!!t)},get userInput(){return this.settings.userInput},generateClassSelectors:function(t){var e=function(e){var i=e;Object.defineProperty(t,i+\"Selector\",{get:function(){return\".\"+this[i].split(\" \")[0]}})};for(var i in t)e(i)},applySettings:function(t,e){var i,n;O.templates=this.templates;var s=u({},O,\"mix\"==e.mode?{dropdown:{position:\"text\"}}:{}),a=this.settings=u({},s,e);if(a.disabled=t.hasAttribute(\"disabled\"),a.readonly=a.readonly||t.hasAttribute(\"readonly\"),a.placeholder=d(t.getAttribute(\"placeholder\")||a.placeholder||\"\"),a.required=t.hasAttribute(\"required\"),this.generateClassSelectors(a.classNames),void 0===a.dropdown.includeSelectedTags&&(a.dropdown.includeSelectedTags=a.duplicates),this.isIE&&(a.autoComplete=!1),[\"whitelist\",\"blacklist\"].forEach((function(e){var i=t.getAttribute(\"data-\"+e);i&&X(i=i.split(a.delimiters),Array)&&(a[e]=i)})),\"autoComplete\"in e&&!c(e.autoComplete)&&(a.autoComplete=O.autoComplete,a.autoComplete.enabled=e.autoComplete),\"mix\"==a.mode&&(a.pattern=a.pattern||/@/,a.autoComplete.rightKey=!0,a.delimiters=e.delimiters||null,a.tagTextProp&&!a.dropdown.searchKeys.includes(a.tagTextProp)&&a.dropdown.searchKeys.push(a.tagTextProp)),t.pattern)try{a.pattern=new RegExp(t.pattern)}catch(t){}if(a.delimiters){a._delimiters=a.delimiters;try{a.delimiters=new RegExp(this.settings.delimiters,\"g\")}catch(t){}}a.disabled&&(a.userInput=!1),this.TEXTS=J({},L,a.texts||{}),(\"select\"!=a.mode||(null===(i=e.dropdown)||void 0===i?void 0:i.enabled))&&a.userInput||(a.dropdown.enabled=0),a.dropdown.appendTarget=(null===(n=e.dropdown)||void 0===n?void 0:n.appendTarget)||document.body;var o=this.getPersistedData(\"whitelist\");Array.isArray(o)&&(this.whitelist=Array.isArray(a.whitelist)?g(a.whitelist,o):o)},getAttributes:function(t){var e,i=this.getCustomAttributes(t),n=\"\";for(e in i)n+=\" \"+e+(void 0!==t[e]?'=\"'.concat(i[e],'\"'):\"\");return n},getCustomAttributes:function(t){if(!c(t))return\"\";var e,i={};for(e in t)\"__\"!=e.slice(0,2)&&\"class\"!=e&&t.hasOwnProperty(e)&&void 0!==t[e]&&(i[e]=d(t[e]));return i},setStateSelection:function(){var t=window.getSelection(),e={anchorOffset:t.anchorOffset,anchorNode:t.anchorNode,range:t.getRangeAt&&t.rangeCount&&t.getRangeAt(0)};return this.state.selection=e,e},getCSSVars:function(){var t,e,i,n=getComputedStyle(this.DOM.scope,null);this.CSSVars={tagHideTransition:(t=function(t){if(!t)return{};var e=(t=t.trim().split(\" \")[0]).split(/\\d+/g).filter((function(t){return t})).pop().trim();return{value:+t.split(e).filter((function(t){return t}))[0].trim(),unit:e}}((i=\"tag-hide-transition\",n.getPropertyValue(\"--\"+i))),e=t.value,\"s\"==t.unit?1e3*e:e)}},build:function(t){var e=this.DOM,i=t.closest(\"label\");this.settings.mixMode.integrated?(e.originalInput=null,e.scope=t,e.input=t):(e.originalInput=t,e.originalInput_tabIndex=t.tabIndex,e.scope=this.parseTemplate(\"wrapper\",[t,this.settings]),e.input=e.scope.querySelector(this.settings.classNames.inputSelector),t.parentNode.insertBefore(e.scope,t),t.tabIndex=-1),i&&i.setAttribute(\"for\",\"\")},destroy:function(){this.events.unbindGlobal.call(this),this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.DOM.originalInput.tabIndex=this.DOM.originalInput_tabIndex,delete this.DOM.originalInput.__tagify,this.dropdown.hide(!0),this.removeAllCustomListeners(),clearTimeout(this.dropdownHide__bindEventsTimeout),clearInterval(this.listeners.main.originalInputValueObserverInterval)},loadOriginalValues:function(t){var e,i=this.settings;if(this.state.blockChangeEvent=!0,void 0===t){var n=this.getPersistedData(\"value\");t=n&&!this.DOM.originalInput.value?n:i.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags(),t)if(\"mix\"==i.mode)this.parseMixTags(t),(e=this.DOM.input.lastChild)&&\"BR\"==e.tagName||this.DOM.input.insertAdjacentHTML(\"beforeend\",\"<br>\");else{try{X(JSON.parse(t),Array)&&(t=JSON.parse(t))}catch(t){}this.addTags(t,!0).forEach((function(t){return t&&t.classList.add(i.classNames.tagNoAnimation)}))}else this.postUpdate();this.state.lastOriginalValueReported=i.mixMode.integrated?\"\":this.DOM.originalInput.value},cloneEvent:function(t){var e={};for(var i in t)\"path\"!=i&&(e[i]=t[i]);return e},loading:function(t){return this.state.isLoading=t,this.DOM.scope.classList[t?\"add\":\"remove\"](this.settings.classNames.scopeLoading),this},tagLoading:function(t,e){return t&&t.classList[e?\"add\":\"remove\"](this.settings.classNames.tagLoading),this},toggleClass:function(t,e){\"string\"==typeof t&&this.DOM.scope.classList.toggle(t,e)},toggleScopeValidation:function(t){var e=!0===t||void 0===t;!this.settings.required&&t&&t===this.TEXTS.empty&&(e=!0),this.toggleClass(this.settings.classNames.tagInvalid,!e),this.DOM.scope.title=e?\"\":t},toggleFocusClass:function(t){this.toggleClass(this.settings.classNames.focus,!!t)},setPlaceholder:function(t){var e=this;[\"data\",\"aria\"].forEach((function(i){return e.DOM.input.setAttribute(\"\".concat(i,\"-placeholder\"),t)}))},triggerChangeEvent:function(){if(!this.settings.mixMode.integrated){var t=this.DOM.originalInput,e=this.state.lastOriginalValueReported!==t.value,i=new CustomEvent(\"change\",{bubbles:!0});e&&(this.state.lastOriginalValueReported=t.value,i.simulated=!0,t._valueTracker&&t._valueTracker.setValue(Math.random()),t.dispatchEvent(i),this.trigger(\"change\",this.state.lastOriginalValueReported),t.value=this.state.lastOriginalValueReported)}},events:U,fixFirefoxLastTagNoCaret:function(){},setRangeAtStartEnd:function(t,e){if(e){t=\"number\"==typeof t?t:!!t,e=e.lastChild||e;var i=document.getSelection();if(X(i.focusNode,Element)&&!this.DOM.input.contains(i.focusNode))return!0;try{i.rangeCount>=1&&[\"Start\",\"End\"].forEach((function(n){return i.getRangeAt(0)[\"set\"+n](e,t||e.length)}))}catch(t){console.warn(t)}}},insertAfterTag:function(t,e){if(e=e||this.settings.mixMode.insertAfterTag,t&&t.parentNode&&e)return e=\"string\"==typeof e?document.createTextNode(e):e,t.parentNode.insertBefore(e,t.nextSibling),e},editTagChangeDetected:function(t){var e=t.__originalData;for(var i in e)if(!this.dataProps.includes(i)&&t[i]!=e[i])return!0;return!1},getTagTextNode:function(t){return t.querySelector(this.settings.classNames.tagTextSelector)},setTagTextNode:function(t,e){this.getTagTextNode(t).innerHTML=d(e)},editTag:function(t,e){var i=this;t=t||this.getLastTag(),e=e||{};var s=this.settings,a=this.getTagTextNode(t),o=this.getNodeIndex(t),r=w(t),l=this.events.callbacks,d=!0,c=\"select\"==s.mode;if(!c&&this.dropdown.hide(),a){if(!X(r,Object)||!(\"editable\"in r)||r.editable)return r=w(t,{__originalData:u({},r),__originalHTML:t.cloneNode(!0)}),w(r.__originalHTML,r.__originalData),a.setAttribute(\"contenteditable\",!0),t.classList.add(s.classNames.tagEditing),this.events.callbacks.onEditTagFocus.call(this,t),a.addEventListener(\"click\",l.onEditTagClick.bind(this,t)),a.addEventListener(\"blur\",l.onEditTagBlur.bind(this,this.getTagTextNode(t))),a.addEventListener(\"input\",l.onEditTagInput.bind(this,a)),a.addEventListener(\"paste\",l.onEditTagPaste.bind(this,a)),a.addEventListener(\"keydown\",(function(e){return l.onEditTagkeydown.call(i,e,t)})),a.addEventListener(\"compositionstart\",l.onCompositionStart.bind(this)),a.addEventListener(\"compositionend\",l.onCompositionEnd.bind(this)),e.skipValidation||(d=this.editTagToggleValidity(t)),a.originalIsValid=d,this.trigger(\"edit:start\",{tag:t,index:o,data:r,isValid:d}),a.focus(),!c&&this.setRangeAtStartEnd(!1,a),0===s.dropdown.enabled&&!c&&this.dropdown.show(),this.state.hasFocus=!0,this}else n.warn(\"Cannot find element in Tag template: .\",s.classNames.tagTextSelector)},editTagToggleValidity:function(t,e){var i;if(e=e||w(t))return(i=!(\"__isValid\"in e)||!0===e.__isValid)||this.removeTagsFromValue(t),this.update(),t.classList.toggle(this.settings.classNames.tagNotAllowed,!i),e.__isValid=i,e.__isValid;n.warn(\"tag has no data: \",t,e)},onEditTagDone:function(t,e){t=t||this.state.editing.scope,e=e||{};var i,n,s={tag:t,index:this.getNodeIndex(t),previousData:w(t),data:e},a=this.settings;this.trigger(\"edit:beforeUpdate\",s,{cloneData:!1}),this.state.editing=!1,delete e.__originalData,delete e.__originalHTML,t&&(void 0!==(n=e[a.tagTextProp])?null===(i=(n+=\"\").trim)||void 0===i?void 0:i.call(n):a.tagTextProp in e?void 0:e.value)?(t=this.replaceTag(t,e),this.editTagToggleValidity(t,e),a.a11y.focusableTags?t.focus():\"select\"!=a.mode&&y(t)):t&&this.removeTags(t),this.trigger(\"edit:updated\",s),this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag:function(t,e){e&&\"\"!==e.value&&void 0!==e.value||(e=t.__tagifyTagData),e.__isValid&&1!=e.__isValid&&u(e,this.getInvalidTagAttrs(e,e.__isValid));var i=this.createTagElem(e);return t.parentNode.replaceChild(i,t),this.updateValueByDOMTags(),i},updateValueByDOMTags:function(){var t=this;this.value.length=0;var e=this.settings.classNames,i=[e.tagNotAllowed.split(\" \")[0],e.tagHide];[].forEach.call(this.getTagElms(),(function(e){G(e.classList).some((function(t){return i.includes(t)}))||t.value.push(w(e))})),this.update()},injectAtCaret:function(t,e){var i;if(e=e||(null===(i=this.state.selection)||void 0===i?void 0:i.range),\"string\"==typeof t&&(t=document.createTextNode(t)),!e&&t)return this.appendMixTags(t),this;var n=b(t,e);return this.setRangeAtStartEnd(!1,n),this.updateValueByDOMTags(),this.update(),this},input:{set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.settings,n=i.dropdown.closeOnSelect;this.state.inputText=t,e&&(this.DOM.input.innerHTML=d(\"\"+t),t&&this.toggleClass(i.classNames.empty,!this.DOM.input.innerHTML)),!t&&n&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},raw:function(){return this.DOM.input.textContent},validate:function(){var t=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!t),t},normalize:function(t,e){var i=t||this.DOM.input,n=[];i.childNodes.forEach((function(t){return 3==t.nodeType&&n.push(t.nodeValue)})),n=n.join(\"\\n\");try{n=n.replace(/(?:\\r\\n|\\r|\\n)/g,this.settings.delimiters.source.charAt(0))}catch(t){}return n=n.replace(/\\s/g,\" \"),(null==e?void 0:e.trim)?this.trim(n):n},autocomplete:{suggest:function(t){if(this.settings.autoComplete.enabled){\"object\"!=typeof(t=t||{value:\"\"})&&(t={value:t});var e=this.dropdown.getMappedValue(t);if(\"number\"!=typeof e){var i=this.state.inputText.toLowerCase(),n=e.substr(0,this.state.inputText.length).toLowerCase(),s=e.substring(this.state.inputText.length);e&&this.state.inputText&&n==i?(this.DOM.input.setAttribute(\"data-suggest\",s),this.state.inputSuggestion=t):(this.DOM.input.removeAttribute(\"data-suggest\"),delete this.state.inputSuggestion)}}},set:function(t){var e=this.DOM.input.getAttribute(\"data-suggest\"),i=t||(e?this.state.inputText+e:null);return!!i&&(\"mix\"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+i)):(this.input.set.call(this,i),this.setRangeAtStartEnd(!1,this.DOM.input)),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx:function(t){return this.value.findIndex((function(e){return e.__tagId==(t||{}).__tagId}))},getNodeIndex:function(t){var e=0;if(t)for(;t=t.previousElementSibling;)e++;return e},getTagElms:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=\".\"+G(this.settings.classNames.tag.split(\" \")).concat(G(e)).join(\".\");return[].slice.call(this.DOM.scope.querySelectorAll(n))},getLastTag:function(){var t=this.settings.classNames,e=this.DOM.scope.querySelectorAll(\"\".concat(t.tagSelector,\":not(.\").concat(t.tagHide,\"):not([readonly])\"));return e[e.length-1]},isTagDuplicate:function(t,e,i){var n=0,a=!0,o=!1,r=void 0;try{for(var l,d=this.value[Symbol.iterator]();!(a=(l=d.next()).done);a=!0){var c=l.value;s(this.trim(\"\"+t),c.value,e)&&i!=c.__tagId&&n++}}catch(t){o=!0,r=t}finally{try{a||null==d.return||d.return()}finally{if(o)throw r}}return n},getTagIndexByValue:function(t){var e=this,i=[],n=this.settings.dropdown.caseSensitive;return this.getTagElms().forEach((function(a,o){a.__tagifyTagData&&s(e.trim(a.__tagifyTagData.value),t,n)&&i.push(o)})),i},getTagElmByValue:function(t){var e=this.getTagIndexByValue(t)[0];return this.getTagElms()[e]},flashTag:function(t){var e=this;t&&(t.classList.add(this.settings.classNames.tagFlash),setTimeout((function(){t.classList.remove(e.settings.classNames.tagFlash)}),100))},isTagBlacklisted:function(t){return t=this.trim(t.toLowerCase()),this.settings.blacklist.filter((function(e){return(\"\"+e).toLowerCase()==t})).length},isTagWhitelisted:function(t){return!!this.getWhitelistItem(t)},getWhitelistItem:function(t,e,i){e=e||\"value\";var n,a=this.settings;return(i=i||a.whitelist).some((function(i){var o=\"object\"==typeof i?i[e]||i.value:i;if(s(o,t,a.dropdown.caseSensitive,a.trim))return n=\"object\"==typeof i?i:{value:i},!0})),n||\"value\"!=e||\"value\"==a.tagTextProp||(n=this.getWhitelistItem(t,a.tagTextProp,i)),n},validateTag:function(t){var e=this.settings,i=\"value\"in t?\"value\":e.tagTextProp,n=this.trim(t[i]+\"\");return(t[i]+\"\").trim()?\"mix\"!=e.mode&&e.pattern&&X(e.pattern,RegExp)&&!e.pattern.test(n)?this.TEXTS.pattern:!e.duplicates&&this.isTagDuplicate(n,e.dropdown.caseSensitive,t.__tagId)?this.TEXTS.duplicate:this.isTagBlacklisted(n)||e.enforceWhitelist&&!this.isTagWhitelisted(n)?this.TEXTS.notAllowed:!e.validate||e.validate(t):this.TEXTS.empty},getInvalidTagAttrs:function(t,e){return{\"aria-invalid\":!0,class:\"\".concat(t.class||\"\",\" \").concat(this.settings.classNames.tagNotAllowed).trim(),title:e}},hasMaxTags:function(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly:function(t,e){var i=this.settings;this.DOM.scope.contains(document.activeElement)&&document.activeElement.blur(),i[e||\"readonly\"]=t,this.DOM.scope[(t?\"set\":\"remove\")+\"Attribute\"](e||\"readonly\",!0),this.settings.userInput=!0,this.setContentEditable(!t)},setContentEditable:function(t){this.DOM.input.contentEditable=t,this.DOM.input.tabIndex=t?0:-1},setDisabled:function(t){this.setReadonly(t,\"disabled\")},normalizeTags:function(t){var e=this,i=this.settings,n=i.whitelist,s=i.delimiters,a=i.mode,o=i.tagTextProp,r=[],l=!!n&&X(n[0],Object),d=Array.isArray(t),g=d&&t[0].value,h=function(t){return(t+\"\").split(s).reduce((function(t,i){var n,s=e.trim(i);return s&&t.push((z(n={},o,s),z(n,\"value\",s),n)),t}),[])};if(\"number\"==typeof t&&(t=t.toString()),\"string\"==typeof t){if(!t.trim())return[];t=h(t)}else d&&(t=t.reduce((function(t,i){if(c(i)){var n=u({},i);o in n||(o=\"value\"),n[o]=e.trim(n[o]),(n[o]||0===n[o])&&t.push(n)}else if(i){var s;(s=t).push.apply(s,G(h(i)))}return t}),[]));return l&&!g&&(t.forEach((function(t){var i=r.map((function(t){return t.value})),n=e.dropdown.filterListItems.call(e,t[o],{exact:!0});e.settings.duplicates||(n=n.filter((function(t){return!i.includes(t.value)})));var s=n.length>1?e.getWhitelistItem(t[o],o,n):n[0];s&&X(s,Object)?r.push(s):\"mix\"!=a&&(null==t.value&&(t.value=t[o]),r.push(t))})),r.length&&(t=r)),t},parseMixTags:function(t){var e=this,i=this.settings,n=i.mixTagsInterpolator,s=i.duplicates,a=i.transformTag,o=i.enforceWhitelist,r=i.maxTags,l=i.tagTextProp,d=[];t=t.split(n[0]).map((function(t,i){var c,u,g,h=t.split(n[1]),p=h[0],f=d.length==r;try{if(p==+p)throw Error;u=JSON.parse(p)}catch(t){u=e.normalizeTags(p)[0]||{value:p}}if(a.call(e,u),f||!(h.length>1)||o&&!e.isTagWhitelisted(u.value)||!s&&e.isTagDuplicate(u.value)){if(t)return i?n[0]+t:t}else u[c=u[l]?l:\"value\"]=e.trim(u[c]),g=e.createTagElem(u),d.push(u),g.classList.add(e.settings.classNames.tagNoAnimation),h[0]=g.outerHTML,e.value.push(u);return h.join(\"\")})).join(\"\"),this.DOM.input.innerHTML=t,this.DOM.input.appendChild(document.createTextNode(\"\")),this.DOM.input.normalize();var c=this.getTagElms();return c.forEach((function(t,e){return w(t,d[e])})),this.update({withoutChangeEvent:!0}),T(c,this.state.hasFocus),t},replaceTextWithNode:function(t,e){if(this.state.tag||e){e=e||this.state.tag.prefix+this.state.tag.value;var i,n,s=this.state.selection||window.getSelection(),a=s.anchorNode,o=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return a.splitText(s.anchorOffset-o),-1==(i=a.nodeValue.lastIndexOf(e))?!0:(n=a.splitText(i),t&&a.parentNode.replaceChild(t,n),!0)}},prepareNewTagNode:function(t,e){e=e||{};var i=this.settings,n=[],s={},a=Object.assign({},t,{value:t.value+\"\"});if(t=Object.assign({},a),i.transformTag.call(this,t),t.__isValid=this.hasMaxTags()||this.validateTag(t),!0!==t.__isValid){if(e.skipInvalid)return;if(u(s,this.getInvalidTagAttrs(t,t.__isValid),{__preInvalidData:a}),t.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(t.value)),!i.createInvalidTags)return void n.push(t.value)}return\"readonly\"in t&&(t.readonly?s[\"aria-readonly\"]=!0:delete t.readonly),{tagElm:this.createTagElem(t,s),tagData:t,aggregatedInvalidInput:n}},postProcessNewTagNode:function(t,e){var i=this,n=this.settings,s=e.__isValid;s&&!0===s?this.value.push(e):(this.trigger(\"invalid\",{data:e,index:this.value.length,tag:t,message:s}),n.keepInvalidTags||setTimeout((function(){return i.removeTags(t,!0)}),1e3)),this.dropdown.position()},selectTag:function(t,e){var i=this;if(!this.settings.enforceWhitelist||this.isTagWhitelisted(e.value)){this.state.actions.selectOption&&setTimeout((function(){return i.setRangeAtStartEnd(!1,i.DOM.input)}));var n=this.getLastTag();return n?this.replaceTag(n,e):this.appendTag(t),this.value[0]=e,this.update(),this.trigger(\"add\",{tag:t,data:e}),[t]}},addEmptyTag:function(t){var e=u({value:\"\"},t||{}),i=this.createTagElem(e);w(i,e),this.appendTag(i),this.editTag(i,{skipValidation:!0}),this.toggleFocusClass(!0)},addTags:function(t,e,i){var n=this,s=[],a=this.settings,o=[],r=document.createDocumentFragment(),l=[];if(!t||0==t.length)return s;switch(t=this.normalizeTags(t),a.mode){case\"mix\":return this.addMixTags(t);case\"select\":e=!1,this.removeAllTags()}return this.DOM.input.removeAttribute(\"style\"),t.forEach((function(t){var e=n.prepareNewTagNode(t,{skipInvalid:i||a.skipInvalid});if(e){var d=e.tagElm;if(t=e.tagData,o=e.aggregatedInvalidInput,s.push(d),\"select\"==a.mode)return n.selectTag(d,t);r.appendChild(d),n.postProcessNewTagNode(d,t),l.push({tagElm:d,tagData:t})}})),this.appendTag(r),l.forEach((function(t){var e=t.tagElm,i=t.tagData;return n.trigger(\"add\",{tag:e,index:n.getTagIdx(i),data:i})})),this.update(),t.length&&e&&(this.input.set.call(this,a.createInvalidTags?\"\":o.join(a._delimiters)),this.setRangeAtStartEnd(!1,this.DOM.input)),this.dropdown.refilter(),s},addMixTags:function(t){var e=this;if((t=this.normalizeTags(t))[0].prefix||this.state.tag)return this.prefixedTextToTag(t[0]);var i=document.createDocumentFragment();return t.forEach((function(t){var n=e.prepareNewTagNode(t);i.appendChild(n.tagElm),e.insertAfterTag(n.tagElm),e.postProcessNewTagNode(n.tagElm,n.tagData)})),this.appendMixTags(i),i.children},appendMixTags:function(t){var e=!!this.state.selection;e?this.injectAtCaret(t):(this.DOM.input.focus(),(e=this.setStateSelection()).range.setStart(this.DOM.input,e.range.endOffset),e.range.setEnd(this.DOM.input,e.range.endOffset),this.DOM.input.appendChild(t),this.updateValueByDOMTags(),this.update())},prefixedTextToTag:function(t){var e,i,n,s=this,a=this.settings,o=null===(e=this.state.tag)||void 0===e?void 0:e.delimiters;if(t.prefix=t.prefix||this.state.tag?this.state.tag.prefix:(a.pattern.source||a.pattern)[0],n=this.prepareNewTagNode(t),i=n.tagElm,this.replaceTextWithNode(i)||this.DOM.input.appendChild(i),setTimeout((function(){return i.classList.add(s.settings.classNames.tagNoAnimation)}),300),this.update(),!o){var r=this.insertAfterTag(i)||i;setTimeout(y,0,r)}return this.state.tag=null,this.postProcessNewTagNode(i,n.tagData),i},appendTag:function(t){var e=this.DOM,i=e.input;e.scope.insertBefore(t,i)},createTagElem:function(t,e){t.__tagId=f();var i,n=u({},t,J({value:d(t.value+\"\")},e));return function(t){for(var e,i=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,null,!1);e=i.nextNode();)e.textContent.trim()||e.parentNode.removeChild(e)}(i=this.parseTemplate(\"tag\",[n,this])),w(i,t),i},reCheckInvalidTags:function(){var t=this,e=this.settings;this.getTagElms(e.classNames.tagNotAllowed).forEach((function(i,n){var s=w(i),a=t.hasMaxTags(),o=t.validateTag(s),r=!0===o&&!a;if(\"select\"==e.mode&&t.toggleScopeValidation(o),r)return s=s.__preInvalidData?s.__preInvalidData:{value:s.value},t.replaceTag(i,s);i.title=a||o}))},removeTags:function(t,e,i){var n,s=this,a=this.settings;if(t=t&&X(t,HTMLElement)?[t]:X(t,Array)?t:t?[t]:[this.getLastTag()].filter((function(t){return t})),n=t.reduce((function(t,e){e&&\"string\"==typeof e&&(e=s.getTagElmByValue(e));var i=w(e);return e&&i&&!i.readonly&&t.push({node:e,idx:s.getTagIdx(i),data:w(e,{__removed:!0})}),t}),[]),i=\"number\"==typeof i?i:this.CSSVars.tagHideTransition,\"select\"==a.mode&&(i=0,this.input.set.call(this)),1==n.length&&\"select\"!=a.mode&&n[0].node.classList.contains(a.classNames.tagNotAllowed)&&(e=!0),n.length)return a.hooks.beforeRemoveTag(n,{tagify:this}).then((function(){var t=function(t){t.node.parentNode&&(t.node.parentNode.removeChild(t.node),e?a.keepInvalidTags&&this.trigger(\"remove\",{tag:t.node,index:t.idx}):(this.trigger(\"remove\",{tag:t.node,index:t.idx,data:t.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),a.keepInvalidTags&&this.reCheckInvalidTags()))};i&&i>10&&1==n.length?function(e){e.node.style.width=parseFloat(window.getComputedStyle(e.node).width)+\"px\",document.body.clientTop,e.node.classList.add(a.classNames.tagHide),setTimeout(t.bind(this),i,e)}.call(s,n[0]):n.forEach(t.bind(s)),e||(s.removeTagsFromValue(n.map((function(t){return t.node}))),s.update(),\"select\"==a.mode&&a.userInput&&s.setContentEditable(!0))})).catch((function(t){}))},removeTagsFromDOM:function(){this.getTagElms().forEach((function(t){return t.remove()}))},removeTagsFromValue:function(t){var e=this;(t=Array.isArray(t)?t:[t]).forEach((function(t){var i=w(t),n=e.getTagIdx(i);n>-1&&e.value.splice(n,1)}))},removeAllTags:function(t){var e=this;t=t||{},this.value=[],\"mix\"==this.settings.mode?this.DOM.input.innerHTML=\"\":this.removeTagsFromDOM(),this.dropdown.refilter(),this.dropdown.position(),this.state.dropdown.visible&&setTimeout((function(){e.DOM.input.focus()})),\"select\"==this.settings.mode&&(this.input.set.call(this),this.settings.userInput&&this.setContentEditable(!0)),this.update(t)},postUpdate:function(){this.state.blockChangeEvent=!1;var t,e,i=this.settings,n=i.classNames,s=\"mix\"==i.mode?i.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;(this.toggleClass(n.hasMaxTags,this.value.length>=i.maxTags),this.toggleClass(n.hasNoTags,!this.value.length),this.toggleClass(n.empty,!s),\"select\"==i.mode)&&this.toggleScopeValidation(null===(e=this.value)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.__isValid)},setOriginalInputValue:function(t){var e=this.DOM.originalInput;this.settings.mixMode.integrated||(e.value=t,e.tagifyValue=e.value,this.setPersistedData(t,\"value\"))},update:function(t){clearTimeout(this.debouncedUpdateTimeout),this.debouncedUpdateTimeout=setTimeout(function(){var e=this.getInputValue();this.setOriginalInputValue(e),this.settings.onChangeAfterBlur&&(t||{}).withoutChangeEvent||this.state.blockChangeEvent||this.triggerChangeEvent();this.postUpdate()}.bind(this),100),this.events.bindOriginaInputListener.call(this,100)},getInputValue:function(){var t=this.getCleanValue();return\"mix\"==this.settings.mode?this.getMixedTagsAsString(t):t.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(t):JSON.stringify(t):\"\"},getCleanValue:function(t){return a(t||this.value,this.dataProps)},getMixedTagsAsString:function(){var t=\"\",e=this,i=this.settings,n=i.originalInputValueFormat||JSON.stringify,s=i.mixTagsInterpolator;return function i(a){a.childNodes.forEach((function(a){if(1==a.nodeType){var r=w(a);if(\"BR\"==a.tagName&&(t+=\"\\r\\n\"),r&&m.call(e,a)){if(r.__removed)return;t+=s[0]+n(o(r,e.dataProps))+s[1]}else a.getAttribute(\"style\")||[\"B\",\"I\",\"U\"].includes(a.tagName)?t+=a.textContent:\"DIV\"!=a.tagName&&\"P\"!=a.tagName||(t+=\"\\r\\n\",i(a))}else t+=a.textContent}))}(this.DOM.input),t}},$.prototype.removeTag=$.prototype.removeTags;export{$ as default};\n//# sourceMappingURL=tagify.esm.js.map\r\n","import { MODULE, TEMPLATE } from \"../core/constants.mjs\";\nimport { Logger } from \"../core/utils.mjs\";\nimport DragSort from \"@yaireo/dragsort\";\nimport Tagify from \"@yaireo/tagify\";\n\nconst { ApplicationV2, HandlebarsApplicationMixin } = foundry.applications.api;\n\n/**\n * Tagify-based application\n */\nexport class TagifyApp extends HandlebarsApplicationMixin(ApplicationV2) {\n  constructor(data) {\n    super(data);\n    this.tagify = null;\n    this.dragSort = null;\n    this.content = data.content;\n    this.submit = data.submit;\n    this.categoryId = null;\n    this.subcategoryId = null;\n    this.options.window.title = data.title;\n  }\n\n  /* -------------------------------------------- */\n\n  static DEFAULT_OPTIONS = {\n    actions: {\n      resetActions: TagifyApp.resetActions,\n      unselectAllTags: TagifyApp.unselectAllTags\n    },\n    classes: [`${MODULE.ID}-app`, \"tah-dialog\", \"sheet\"],\n    id: \"token-action-hud-dialog\",\n    form: {\n      closeOnSubmit: true,\n      handler: TagifyApp.submit\n    },\n    position: {\n      width: 600,\n      height: 800\n    },\n    tag: \"form\",\n    window: {\n      minimizable: true,\n      resizable: true\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  async _prepareContext() {\n    return this.content;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Show dialog\n   * @public\n   * @param {string} dialogType      The dialog type\n   * @param {string} nestId          The nest id\n   * @param {object} tags            The available and selected tags\n   * @param {object} dialogData      The dialog data\n   * @param {function*} dialogSubmit The dialog submit function\n   */\n  static open(dialogType, nestId, tags, dialogData, dialogSubmit) {\n    this.nestId = nestId;\n    TagifyApp.#prepareHook(tags);\n\n    const data = {\n      title: dialogData.title,\n      content: dialogData.content,\n      submit: dialogSubmit\n    };\n\n    let dialog;\n    switch (dialogType) {\n      case \"hud\":\n        dialog = new TagifyAppHud(data);\n        break;\n      case \"topLevelGroup\":\n        dialog = new TagifyAppGroup(data);\n        break;\n      case \"group\":\n        dialog = new TagifyAppSubgroup(data);\n        break;\n    }\n\n    dialog.render(true);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare dialog hook\n   * @private\n   * @param {object} tags The tags\n   */\n  static #prepareHook(tags) {\n    Hooks.once(\"renderTagifyApp\", (app, html, options) => {\n      const tagInput = html.querySelector('input[class=\"tah-dialog-tagify\"]');\n\n      if (tagInput) {\n        const options = {\n          delimiters: \";\",\n          maxTags: \"Infinity\",\n          dropdown: {\n            position: \"manual\",\n            maxItems: Infinity, // <- maximum allowed rendered suggestions\n            classname: \"tah-dialog-tags-dropdown\", // <- custom classname for this dropdown, so it could be targeted\n            enabled: 0 // <- show suggestions on focus\n          },\n          templates: {\n            dropdownItemNoMatch() {\n              return \"<div class='empty'>Nothing Found</div>\";\n            }\n          }\n        };\n\n        if (tags.available) options.whitelist = tags.available;\n\n        TagifyApp.tagify = new Tagify(tagInput, options);\n\n        if (tags.selected) TagifyApp.tagify.addTags(tags.selected);\n\n        TagifyApp.dragSort = new DragSort(TagifyApp.tagify.DOM.scope, {\n          selector: `.${TagifyApp.tagify.settings.classNames.tag}`,\n          callbacks: { dragEnd: onDragEnd }\n        });\n\n        /**\n         * On drag end\n         */\n        function onDragEnd() {\n          TagifyApp.tagify.updateValueByDOMTags();\n        }\n\n        const tagifyInput = html.querySelector(\".tagify__input\");\n        if (tagifyInput) {\n          tagifyInput.addEventListener(\"keydown\", event => {\n            if (event.key === \"Enter\") {\n              event.preventDefault();\n              TagifyApp.tagify.addTags(TagifyApp.tagify.state.inputText, !0);\n            }\n          });\n        }\n\n        if (app.constructor.name === \"TagifyAppHud\") return;\n\n        TagifyApp.tagify.dropdown.show();\n        const dropdownLabelElement = document.createElement(\"div\");\n        dropdownLabelElement.classList.add(\"tah-dialog-label\");\n        dropdownLabelElement.innerHTML = game.i18n.localize(\"tokenActionHud.form.hud.availableItems\");\n        TagifyApp.tagify.DOM.scope.parentNode.appendChild(dropdownLabelElement);\n        TagifyApp.tagify.DOM.scope.parentNode.appendChild(TagifyApp.tagify.DOM.dropdown);\n      }\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Reset Actions within Groups' button is clicked, reset the actor's HUD data.\n   * Only used in the HUD dialog.\n   * @private\n   */\n  static async resetActions() {\n    await foundry.applications.api.DialogV2.confirm({\n      window: {\n        title: game.i18n.localize(\"tokenActionHud.dialog.resetActions.title\")\n      },\n      content: `<p>${game.i18n.localize(\"tokenActionHud.dialog.resetActions.content\")}</p>`,\n      modal: true,\n      yes: {\n        label: game.i18n.localize(\"tokenActionHud.dialog.button.yes\"),\n        callback: async () => {\n          await game.tokenActionHud.resetActorData();\n          Logger.info(\"Actions reset\", true);\n        }\n      },\n      no: {\n        label: game.i18n.localize(\"tokenActionHud.dialog.button.no\")\n      }\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Unselect All' button is clicked, unselect all tags\n   */\n  static unselectAllTags() {\n    TagifyApp.tagify.removeAllTags();\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  _onKeyDown(event) {\n    // Close dialog\n    if (event.key === \"Escape\" && !event.target.className.includes(\"tagify\")) {\n      event.preventDefault();\n      event.stopPropagation();\n      return this.close();\n    }\n\n    // Confirm default choice\n    if (\n      event.key === \"Enter\"\n            && this.data.default\n            && !event.target.className.includes(\"tagify\")\n    ) {\n      event.preventDefault();\n      event.stopPropagation();\n      const defaultChoice = this.data.buttons[this.data.default];\n      return this.submit(defaultChoice);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle form submission\n   * @param {object} event    The event\n   * @param {object} form     The form\n   * @param {object} formData The form data\n   */\n  static async submit(event, form, formData) {\n    const selection = TagifyApp.tagify.value.map(c => {\n      c.id = c.id ?? c.value.slugify({ replacement: \"-\", strict: true });\n      return {\n        id: c.id,\n        listName: c.value,\n        name: c.name ?? c.value,\n        type: c.type\n      };\n    });\n    await this.submit(selection, formData.object);\n  }\n}\n\n/* -------------------------------------------- */\n\nexport class TagifyAppHud extends TagifyApp {\n  static PARTS = {\n    form: {\n      template: TEMPLATE.tagifyAppHud\n    }\n  };\n}\n\n/* -------------------------------------------- */\n\nexport class TagifyAppGroup extends TagifyApp {\n  static PARTS = {\n    form: {\n      template: TEMPLATE.tagifyAppGroup\n    }\n  };\n}\n\n/* -------------------------------------------- */\n\nexport class TagifyAppSubgroup extends TagifyApp {\n  static PARTS = {\n    form: {\n      template: TEMPLATE.tagifyAppSubgroup\n    }\n  };\n}\n","import { TagifyApp } from \"./tagify-app.mjs\";\nimport { Utils } from \"../core/utils.mjs\";\n\n/**\n * Generates data for the Tagify application.\n */\nexport class TagifyAppHelper {\n  /**\n   * Show the HUD dialog\n   * @public\n   * @param {class} groupHandler The GroupHandler instance\n   */\n  static async openEditHudApp(groupHandler) {\n    // Set available and selected tags\n    const tags = {};\n    tags.available = [];\n    tags.selected = await groupHandler.getSelectedGroupsAsTags();\n    const grid = await Utils.getSetting(\"grid\");\n\n    // Set dialog data\n    const dialogData = {\n      title: game.i18n.localize(\"tokenActionHud.form.hud.hudTitle\"),\n      content: {\n        topLabel: game.i18n.localize(\"tokenActionHud.form.hud.hudDetail\"),\n        placeholder: game.i18n.localize(\"tokenActionHud.form.hud.tagPlaceholder\"),\n        settings: { grid }\n      }\n    };\n\n    // Set function on submit\n    const dialogSubmit = async (choices, formData) => {\n      const grid = formData?.grid;\n      await groupHandler.updateGroups(choices, { level: 0 });\n      await groupHandler.saveGroups({ saveActor: true, saveUser: true });\n      await Utils.setSetting(\"grid\", grid);\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    };\n\n    // Show dialog\n    TagifyApp.open(\"hud\", null, tags, dialogData, dialogSubmit);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Show group dialog\n   * @public\n   * @param {class} groupHandler The GroupHandler instance\n   * @param {object} groupData   The group data\n   */\n  static async openEditGroupApp(groupHandler, groupData) {\n    const { nestId, name, level } = groupData;\n\n    // Set available and selected tags\n    const tags = {};\n\n    // Get available subcategories\n    tags.available = await groupHandler.getAvailableGroupAsTags({ nestId, level });\n\n    // Get selected subcategories\n    tags.selected = await groupHandler.getSelectedGroupsAsTags({ nestId, level });\n\n    // Set dialog data\n    const dialogData = {\n      title: `${game.i18n.localize(\"tokenActionHud.form.hud.groupTitle\")}: ${name}`,\n      content: {\n        topLabel: game.i18n.localize(\"tokenActionHud.form.hud.groupDetail\"),\n        placeholder: game.i18n.localize(\"tokenActionHud.form.hud.tagPlaceholder\"),\n        settings: await groupHandler.getGroupSettings(groupData)\n      }\n    };\n\n    // Set function on submit\n    const dialogSubmit = async (choices, formData) => {\n      choices = choices.map(choice => {\n        choice.id =\n                choice.id\n                ?? choice.name.slugify({\n                  replacement: \"-\",\n                  strict: true\n                });\n        choice.type = choice.type ?? \"custom\";\n        return {\n          id: choice.id,\n          listName: choice.listName,\n          name: choice.name,\n          type: choice.type\n        };\n      });\n\n      const characterCount = formData?.characterCount;\n      const customWidth = formData?.customWidth;\n      const grid = formData?.grid;\n      const image = formData?.image;\n      const showTitle = formData?.showTitle;\n      const sort = formData?.sort;\n      groupData.settings = { characterCount, customWidth, grid, image, showTitle, sort };\n\n      // Save selected subcategories to user action list\n      await groupHandler.updateGroups(choices, groupData);\n      await groupHandler.saveGroups({ saveActor: true, saveUser: true });\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    };\n\n    TagifyApp.open(\n      \"topLevelGroup\",\n      nestId,\n      tags,\n      dialogData,\n      dialogSubmit\n    );\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Show action dialog\n   * @public\n   * @param {class} groupHandler  The GroupHandler instance\n   * @param {class} actionHandler The ActionHandler instance\n   * @param {object} groupData    The group data\n   */\n  static async openEditSubgroupApp(groupHandler, actionHandler, groupData) {\n    const { nestId, name, level } = groupData;\n\n    // Set available and selected tags\n    const tags = {};\n\n    // Get available groups and actions\n    const availableActions = await actionHandler.getAvailableActionsAsTags(groupData);\n    const availableGroups = await groupHandler.getAvailableGroupAsTags({ nestId, level });\n    tags.available = [...availableActions, ...availableGroups];\n\n    // Get selected actions and subcategories\n    const selectedActions = await actionHandler.getSelectedActionsAsTags(groupData);\n    const selectedGroups = await groupHandler.getSelectedGroupsAsTags({ nestId, level });\n    tags.selected = [...selectedActions, ...selectedGroups];\n\n    // Set dialog data\n    const dialogData = {\n      title: `${game.i18n.localize(\"tokenActionHud.form.hud.groupTitle\")}: ${name} `,\n      content: {\n        topLabel: game.i18n.localize(\"tokenActionHud.form.hud.groupDetail\"),\n        placeholder: game.i18n.localize(\"tokenActionHud.form.hud.tagPlaceholder\"),\n        settings: await groupHandler.getGroupSettings(groupData)\n      }\n    };\n\n    // Set function on submit\n    const dialogSubmit = async (choices, formData) => {\n      const selectedGroups = [];\n      const selectedActions = [];\n      for (const choice of choices) {\n        if (choice.type === \"action\") {\n          selectedActions.push(choice);\n        } else {\n          selectedGroups.push(choice);\n        }\n      }\n\n      // Get advanced category options\n      const characterCount = formData?.characterCount;\n      const collapse = formData?.collapse;\n      const customWidth = formData?.customWidth;\n      const grid = formData?.grid;\n      const image = formData?.image;\n      const showTitle = formData?.showTitle;\n      const sort = formData?.sort;\n      const style = formData?._style;\n      groupData.settings = { characterCount, collapse, customWidth, grid, image, showTitle, sort, style };\n\n      // Save subcategories to user action list\n      await groupHandler.updateGroups(selectedGroups, groupData);\n      await actionHandler.updateActions(selectedActions, groupData);\n      await groupHandler.saveGroups({ saveActor: true, saveUser: true });\n\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    };\n\n    TagifyApp.open(\n      \"group\",\n      nestId,\n      tags,\n      dialogData,\n      dialogSubmit\n    );\n  }\n}\n","import { Utils } from \"../core/utils.mjs\";\n\nexport class GroupResizer {\n  constructor(tokenActionHud, hudManager) {\n    this.tokenActionHud = tokenActionHud;\n    this.hudManager = hudManager;\n    this.groupHandler = hudManager.groupHandler;\n    this.minCols = 3;\n    this.isCustomWidth = false;\n    this.settings = null;\n    this.spacing = 10;\n  }\n\n  /**\n   * Resize the groups element\n   * @param {object} groupElement The group element\n   */\n  async resizeGroup(groupElement) {\n    if (!groupElement) return;\n\n    this.#setVariables(groupElement);\n\n    if (!this.subgroupsElement) return;\n\n    if (!this.tokenActionHud.isDocked) {\n      await this.#setWidth();\n    }\n\n    await this.#setHeight();\n\n    this.#resetVariables();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set variables\n   * @private\n   * @param {object} groupElement The group element\n   */\n  async #setVariables(groupElement) {\n    this.#resetVariables();\n\n    this.groupElement = groupElement;\n\n    // Get groups element\n    await this.#setSubgroupsElement();\n    if (!this.subgroupsElement) return;\n\n    // Reset groups elements\n    this.#resetGroupsElements();\n\n    // Get groups\n    this.#setSubgroupElementArr();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset variables\n   * @private\n   */\n  #resetVariables() {\n    this.actionsElements = null;\n    this.availableHeight = null;\n    this.availableWidth = null;\n    this.gridWidth = null;\n    this.groupElement = null;\n    this.subgroupElementArr = null;\n    this.subgroupsElement = null;\n    this.subgroupsElementPadding = null;\n    this.subgroupsElementRect = null;\n    this.isCustomWidth = false;\n    this.minCols = 3;\n    this.settings = null;\n    this.spacing = 10;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset groups elements\n   */\n  #resetGroupsElements() {\n    const level1GroupElement = this.groupElement.closest('[data-part=\"group\"]');\n    const groupsElements = level1GroupElement.querySelectorAll(\".tah-subgroups\");\n    const style = { maxHeight: \"\", overflowY: \"\" };\n    this.#resetCSS(groupsElements, style);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the grid width\n   * @private\n   */\n  async #getGridWidth() {\n    // Reset action elements\n    const emptyStyle = { display: \"\", gridTemplateColumns: \"\", width: \"\" };\n    await this.#resetCSS(this.actionsElements, emptyStyle);\n\n    const actionWidths = [];\n    const actionWidthsForMedian = [];\n    for (const actionsElement of this.actionsElements) {\n      const actionElements = actionsElement.querySelectorAll(\".tah-action:not(.shrink)\");\n      for (const actionElement of actionElements) {\n        const actionRect = actionElement.getBoundingClientRect();\n        const actionWidth = Math.round(parseFloat(actionRect.width) + 1 || 0);\n        const actionButtonText = actionElement.querySelector(\".tah-action-button-text\");\n        const actionButtonTextRect = actionButtonText?.getBoundingClientRect();\n        const actionButtonTextWidth = Math.round(parseFloat(actionButtonTextRect?.width) || 0);\n        actionWidthsForMedian.push(actionWidth);\n        actionWidths.push({ actionWidth, actionButtonTextWidth });\n      }\n    }\n\n    let upperQuartileAverage = Math.ceil(Utils.getUpperQuartileAverage(actionWidthsForMedian));\n    const minActionButtonTextWidth = 30;\n\n    for (const actionWidth of actionWidths) {\n      const availableactionButtonTextWidth = upperQuartileAverage\n        - (actionWidth.actionWidth - actionWidth.actionButtonTextWidth);\n      if (availableactionButtonTextWidth < minActionButtonTextWidth) {\n        upperQuartileAverage = (upperQuartileAverage - availableactionButtonTextWidth) + minActionButtonTextWidth;\n      }\n    }\n\n    this.gridWidth = upperQuartileAverage;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Resize the actions element into the grid format\n   * @private\n   * @param {object} actionsElement   The actions element\n   * @param {number} groupCustomWidth The group custom width\n   */\n  async #resizeGrid(actionsElement, groupCustomWidth) {\n    if (!actionsElement) return;\n    const emptyStyle = { display: \"\", gridTemplateColumns: \"\", width: \"\" };\n    await this.#assignCSS(actionsElement, emptyStyle);\n\n    const actions = actionsElement.querySelectorAll(\".tah-action\");\n    const squaredCols = Math.ceil(Math.sqrt(actions.length));\n    const availableGroupWidth = groupCustomWidth ?? this.availableWidth;\n    const availableCols = Math.floor(availableGroupWidth / this.gridWidth);\n    const cols = (squaredCols > availableCols || groupCustomWidth)\n      ? availableCols\n      : (actions.length <= this.minCols) ? actions.length : squaredCols;\n    // Apply maxHeight and width styles to content\n    const style = { display: \"grid\", gridTemplateColumns: `repeat(${cols}, ${this.gridWidth}px)` };\n    await this.#assignCSS(actionsElement, style);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Resize the actions element\n   * @private\n   * @param {object} actionsElement   The actions element\n   * @param {number} groupCustomWidth The group custom width\n   */\n  async #resize(actionsElement, groupCustomWidth) {\n    if (!actionsElement) return;\n\n    let width = 500;\n\n    if (this.isCustomWidth) {\n      width = this.availableWidth;\n    } else if (groupCustomWidth) {\n      width = groupCustomWidth;\n    } else {\n      const actions = actionsElement.querySelectorAll(\".tah-action\");\n      if (!actions.length) return;\n      const sqrtActions = Math.ceil(Math.sqrt(actions.length)); // 4\n\n      // Initialize variables\n      let currentRow = 1;\n      let maxRowWidth = 0;\n      let rowWidth = 0;\n      // Iterate through action groups, calculating dimensions and counts\n      if (actions.length > 0) {\n        actions.forEach((action, index) => {\n          if ((index + 1) / sqrtActions > currentRow) {\n            rowWidth = rowWidth - 5;\n            maxRowWidth = (rowWidth > maxRowWidth) ? rowWidth : maxRowWidth;\n            rowWidth = 0;\n            currentRow++;\n          }\n          const actionRect = action.getBoundingClientRect();\n          const actionWidth = Math.ceil(parseFloat(actionRect.width) + 1 || 0);\n          rowWidth += actionWidth;\n          if (index + 1 === actions.length) {\n            rowWidth = rowWidth - 5;\n            maxRowWidth = (rowWidth > maxRowWidth) ? rowWidth : maxRowWidth;\n          }\n        });\n      }\n\n      // Add padding to maxAvgGroupWidth and maxGroupWidth\n      maxRowWidth += this.subgroupsElementPadding;\n\n      // Determine width of content\n      width = (maxRowWidth < this.availableWidth && actions.length > 3) ? maxRowWidth : this.availableWidth;\n      if (width < 200) width = 200;\n    }\n\n    const style = { maxWidth: `${width}px` };\n    await this.#assignCSS(actionsElement, style);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get available content width\n   * @private\n   * @returns {number} The available content width\n   */\n  #getAvailableWidth() {\n    const customWidth = this.settings?.customWidth;\n\n    if (customWidth) {\n      this.isCustomWidth = true;\n      return customWidth;\n    }\n\n    const windowWidth = canvas.screenDimensions[0] || window.innerWidth;\n    const contentLeft = this.subgroupsElementRect.left;\n    const uiRight = document.querySelector(\"#ui-right\");\n    const uiRightClientWidth = uiRight.clientWidth;\n    return Math.floor((\n      uiRightClientWidth > 0\n        ? windowWidth - uiRightClientWidth\n        : windowWidth\n    ) - this.spacing - contentLeft);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get subgroups element\n   * @private\n   */\n  async #setSubgroupsElement() {\n    this.subgroupsElement = this.groupElement.querySelector('[data-part=\"subgroups\"]');\n    if (!this.subgroupsElement) return;\n    this.subgroupsElementRect = this.subgroupsElement.getBoundingClientRect();\n    this.subgroupsElementComputed = getComputedStyle(this.subgroupsElement);\n    this.subgroupsElementPadding =\n      Math.ceil(parseFloat(this.subgroupsElementComputed.paddingLeft) || 0)\n      + Math.ceil(parseFloat(this.subgroupsElementComputed.paddingRight) || 0);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get subgroup elements\n   * @private\n   */\n  #setSubgroupElementArr() {\n    this.subgroupElementArr = this.groupElement.querySelectorAll('[data-part=\"subgroup\"]');\n    if (this.subgroupElementArr.length === 0) this.subgroupElementArr = [this.groupElement];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the width\n   */\n  async #setWidth() {\n    this.actionsElements = this.groupElement.querySelectorAll('[data-part=\"actions\"]');\n\n    // Exit early if no action elements exist\n    if (this.actionsElements.length === 0) return;\n\n    // Get group settings\n    const nestId = this.groupElement.dataset.nestId;\n    this.settings = await this.groupHandler.getGroupSettings({ nestId, level: 1 });\n\n    // Get available width\n    this.availableWidth = this.#getAvailableWidth();\n\n    // Loop groups\n    let hasGrid = false;\n    for (const subgroupElement of this.subgroupElementArr) {\n      const actionsElement = subgroupElement.querySelector('[data-part=\"actions\"]');\n      if (!actionsElement) continue;\n      const nestId = subgroupElement.dataset.nestId;\n      const groupSettings = await this.groupHandler.getGroupSettings({ nestId });\n      const groupCustomWidth = groupSettings.customWidth;\n      const grid = Utils.getSetting(\"grid\") || this.settings?.grid || groupSettings?.grid || actionsElement.style.display;\n      if (grid) {\n        if (!hasGrid) {\n          await this.#getGridWidth();\n          hasGrid = true;\n        }\n        await this.#resizeGrid(actionsElement, groupCustomWidth);\n      } else {\n        await this.#resize(actionsElement, groupCustomWidth);\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the height\n   * @private\n   */\n  async #setHeight() {\n    await new Promise(resolve => {\n      requestAnimationFrame(() => {\n        this.availableHeight = this.#getAvailableHeight();\n        const style = { maxHeight: `${this.availableHeight}px`, overflowY: \"auto\" };\n        Object.assign(this.subgroupsElement.style, style);\n        resolve();\n      });\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get available height\n   * @private\n   * @returns {number} The available height\n   */\n  #getAvailableHeight() {\n    const windowHeight = canvas.screenDimensions[1] || window.innerHeight;\n    const contentBottom = this.subgroupsElementRect.bottom;\n    const contentTop = this.subgroupsElementRect.top;\n\n    if (this.tokenActionHud.isDocked) {\n      let siblingsHeight = 0;\n      let sibling = this.groupElement.nextElementSibling;\n\n      if (sibling) {\n        const siblings = [sibling];\n        while (sibling) {\n          sibling = sibling.nextElementSibling;\n          if (sibling) siblings.push(sibling);\n        }\n        for (const sibling of siblings) {\n          const siblingHeight = sibling.getBoundingClientRect().height;\n          siblingsHeight += siblingHeight ?? 0;\n        }\n      }\n\n      return Math.max(windowHeight - contentTop - siblingsHeight - this.spacing, 100);\n    } else {\n      const uiTopBottom = (this.tokenActionHud.direction === \"down\")\n        ? document.querySelector(\"#ui-bottom\")\n        : document.querySelector(\"#ui-top\");\n      const uiTopBottomOffsetHeight = uiTopBottom.offsetHeight;\n      const availableHeight = (this.tokenActionHud.direction === \"down\")\n        ? windowHeight - contentTop - uiTopBottomOffsetHeight - this.spacing\n        : contentBottom - uiTopBottomOffsetHeight - this.spacing;\n      return Math.max(availableHeight, 100);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Assign CSS\n   * @private\n   * @param {object} element The DOM element\n   * @param {object} style   The style\n   */\n  async #assignCSS(element, style) {\n    if (!element) return;\n    requestAnimationFrame(() => {\n      Object.assign(element.style, style);\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset CSS\n   * @private\n   * @param {Array} elements The DOM elements\n   * @param {object} style   The style\n   */\n  async #resetCSS(elements, style) {\n    for (const element of elements) {\n      Object.assign(element.style, style);\n    }\n  }\n}\n","import { HudManager } from \"../managers/hud-manager.mjs\";\nimport { TagifyAppHelper } from \"./tagify-app-helper.mjs\";\nimport { GroupResizer } from \"../handlers/group-resizer.mjs\";\nimport { HUD, MODULE, SETTING, TEMPLATE } from \"../core/constants.mjs\";\nimport { Logger, Timer, Utils } from \"../core/utils.mjs\";\n\nconst { ApplicationV2, HandlebarsApplicationMixin } = foundry.applications.api;\n\n/**\n * Token Action HUD application\n */\nexport class TokenActionHud extends HandlebarsApplicationMixin(ApplicationV2) {\n  constructor(systemManager, dataHandler, socket) {\n    super();\n    this.systemManager = systemManager;\n    this.dataHandler = dataHandler;\n    this.hudManager = new HudManager(this, systemManager, dataHandler, socket);\n    this.groupResizer = new GroupResizer(this, this.hudManager);\n    this.socket = socket;\n    this.openGroups = new Set();\n    this.updatePendingTimer = new Timer(10);\n    this.updateTimer = new Timer(10);\n    this.closeTimer = null;\n    this.renderTimer = null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Merge Token Action Hud's default options with ApplicationV2\n   * @override\n   */\n  static DEFAULT_OPTIONS = {\n    actions: {\n      clickGroup: {\n        buttons: [0, 2],\n        handler: TokenActionHud.clickGroup\n      },\n      clickSubgroup: {\n        buttons: [0, 2],\n        handler: TokenActionHud.clickSubgroup\n      },\n      clickAction: {\n        buttons: [0, 2],\n        handler: TokenActionHud.clickAction\n      },\n      collapseHud: TokenActionHud.collapseHud,\n      expandHud: TokenActionHud.expandHud,\n      lockHud: TokenActionHud.lockHud,\n      unlockHud: TokenActionHud.unlockHud,\n      editHud: TokenActionHud.editHud\n    },\n    background: \"none\",\n    id: \"token-action-hud-app\",\n    position: {\n      width: HUD.DEFAULT_WIDTH,\n      height: HUD.DEFAULT_HEIGHT,\n      left: HUD.DEFAULT_LEFT_POS,\n      top: HUD.DEFAULT_TOP_POS,\n      scale: HUD.DEFAULT_SCALE,\n      zIndex: HUD.DEFAULT_ZINDEX\n    },\n    window: {\n      frame: false,\n      title: \"token-action-hud\"\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  /**\n   * Define template parts\n   */\n  static PARTS = {\n    form: {\n      template: TEMPLATE.hud\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare context\n   * @override\n   */\n  async _prepareContext() {\n    const styleData = this.systemManager.styles[Utils.getSetting(\"style\")];\n    const context = {\n      hud: this.hudManager.hud,\n      id: \"token-action-hud\",\n      style: styleData.class ?? \"\",\n      scale: this.scale,\n      background: \"#00000000\",\n      collapseIcon: styleData.collapseIcon ?? \"fa-caret-left\",\n      expandIcon: styleData.expandIcon ?? \"fa-caret-right\",\n      collapsibleSubgroups: Utils.getSetting(\"collapsibleSubgroups\")\n    };\n\n    Logger.debug(\"Application context\", { context });\n    return context;\n  }\n\n  /* -------------------------------------------- */\n  /* SETTINGS                                     */\n  /* -------------------------------------------- */\n\n  /**\n   * Initialise the HUD\n   * @public\n   */\n  async init() {\n    this.#cacheSettings();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Cache settings for slightly faster retrieval\n   */\n  #cacheSettings() {\n    const settings = [\n      \"activeCssAsText\", \"allow\", \"alwaysShowHud\", \"clickOpenCategory\", \"direction\",\n      \"debug\", \"displayIcons\", \"drag\", \"enable\", \"grid\",\n      \"scale\", \"style\"\n    ];\n\n    settings.forEach(setting => {\n      this[`${setting}Setting`] = Utils.getSetting(setting);\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update cached settings following changes\n   * @param {string} key The setting key\n   * @param {*|null} value      The setting value\n   * @public\n   */\n  async updateCachedSettings(key, value = null) {\n    if (!this.updateSettingsPending) {\n      this.updateSettingsPending = true;\n      Logger.debug(\"Updating settings...\");\n    }\n\n    if (!SETTING[key]) return;\n\n    const { classes, variable } = SETTING[key];\n    if (variable) {\n      if (classes.includes(\"TokenActionHud\")) this[variable] = value;\n    }\n\n    switch (key) {\n      case \"customLayout\":\n      case \"userCustomLayout\":\n        this.hudManager.layoutHandler.customLayout = null;\n        break;\n      case \"rollHandler\":\n        this.hudManager.rollHandler = this.systemManager.getRollHandlerCore(this.hudManager.actionHandler);\n        break;\n      case \"style\":\n        this.setPosition();\n    }\n  }\n\n  /* -------------------------------------------- */\n  /* RENDER                                       */\n  /* -------------------------------------------- */\n\n  /**\n   * On render\n   * @param {options} context The context\n   * @param {options} options The options\n   */\n  _onRender(context, options) {\n    super._onRender(context, options);\n    this.element.classList.remove(\"tah-closed\");\n    clearTimeout(this.closeTimer);\n    clearTimeout(this.renderTimer);\n    this.#cacheElements();\n    this.#setInitialHudState();\n    this.#addHoverEvents(this.elements);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Cache HUD elements\n   */\n  #cacheElements() {\n    this.elements = {\n      characterName: this.element.querySelector(\"[data-part=\\\"characterName\\\"]\"),\n      actionArr: this.element.querySelectorAll(\"[data-part=\\\"action\\\"]\"),\n      buttons: this.element.querySelector(\"[data-part=\\\"buttons\\\"]\"),\n      tabSubgroupArr: this.element.querySelectorAll(\"[data-group-type=\\\"tab\\\"]\"),\n      groups: this.element.querySelector(\"[data-part=\\\"groups\\\"]\"),\n      editHudButton: this.element.querySelector(\"[data-part=\\\"editHudButton\\\"]\"),\n      listSubgroupsArr: this.element.querySelectorAll(\"[data-part=\\\"listSubgroups\\\"]\"),\n      subgroupsContainerArr: this.element.querySelectorAll(\"[data-part=\\\"subgroupsContainer\\\"]\"),\n      subgroupArr: this.element.querySelectorAll(\"[data-part=\\\"subgroup\\\"]\"),\n      listSubgroupTitleArr: this.element.querySelectorAll(\"[data-part=\\\"listSubgroupTitle\\\"]\"),\n      groupButtonArr: this.element.querySelectorAll(\"[data-part=\\\"groupButton\\\"]\"),\n      collapseExpandContainer: this.element.querySelector(\"[data-part=\\\"collapseExpandContainer\\\"]\"),\n      collapseHudButton: this.element.querySelector(\"[data-part=\\\"collapseHudButton\\\"]\"),\n      expandHudButton: this.element.querySelector(\"[data-part=\\\"expandHudButton\\\"]\"),\n      unlockButton: this.element.querySelector(\"[data-part=\\\"unlockHudButton\\\"]\"),\n      lockButton: this.element.querySelector(\"[data-part=\\\"lockHudButton\\\"]\")\n    };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the initial state of the HUD (collapsed or expanded, locked or unlocked)\n   * @private\n   */\n  #setInitialHudState() {\n    if (this.isCollapsed) { TokenActionHud.collapseHud.call(this); }\n\n    if (Utils.getSetting(\"enableCustomization\")) {\n      if (this.isUnlocked) {\n        TokenActionHud.unlockHud.call(this);\n      } else {\n        TokenActionHud.lockHud.call(this);\n      }\n    } else {\n      TokenActionHud.lockHud.call(this);\n      this.elements.unlockButton.classList.add(\"tah-hidden\");\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add hover events\n   * @param {object} elements The elements\n   */\n  #addHoverEvents(elements) {\n    if (!Utils.getSetting(\"clickOpenCategory\")) {\n      // When a category button is hovered over...\n      elements.tabSubgroupArr.forEach(element => {\n        element.addEventListener(\"touchstart\", this.toggleGroup.bind(this), { passive: true });\n        element.addEventListener(\"pointerenter\", this.toggleGroup.bind(this));\n        element.addEventListener(\"pointerleave\", this.toggleGroup.bind(this));\n      });\n    }\n\n    // When a category button is clicked and held...\n    if (!this.isDocked) {\n      elements.groupButtonArr.forEach(element => {\n        element.addEventListener(\"mousedown\", this.#dragEvent.bind(this));\n        element.addEventListener(\"touchstart\", this.#dragEvent.bind(this), { passive: true });\n      });\n    }\n\n    // When an action is hovered...\n    elements.actionArr.forEach(element => {\n      element.addEventListener(\"pointerenter\", this.handleActionHover.bind(this));\n      element.addEventListener(\"pointerleave\", this.handleActionHover.bind(this));\n    });\n  }\n\n  /* -------------------------------------------- */\n  /* POST-RENDER                                  */\n  /* -------------------------------------------- */\n\n  /**\n   * Functions to execute after the application is rendered\n   */\n  postRender() {\n    this.rendering = false;\n    this.#applyDirection();\n    this.#reopenGroups();\n    if (!this.isCollapsed) {\n      this.renderTimer = setTimeout(() => {\n        requestAnimationFrame(() => {\n          this.element?.classList?.add(\"tah-expanded\");\n        });\n      }, 25);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Apply classes for HUD direction\n   * @private\n   */\n  #applyDirection() {\n    if (this.isDocked) return;\n\n    const { characterName, subgroupsContainerArr } = this.elements;\n\n    if (this.direction === \"up\") {\n      characterName.classList.add(\"tah-hidden\");\n\n      subgroupsContainerArr.forEach(element => {\n        element.classList.remove(\"expand-down\");\n        element.classList.add(\"expand-up\");\n      });\n    } else {\n      if (!this.isCollapsed) {\n        characterName.classList.remove(\"tah-hidden\");\n      }\n\n      subgroupsContainerArr.forEach(element => {\n        element.classList.add(\"expand-down\");\n        element.classList.remove(\"expand-up\");\n      });\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reopen groups following a re-render of the HUD\n   * @private\n   */\n  #reopenGroups() {\n    if (!this.openGroups.size) return;\n\n    this.openGroups.forEach(groupId => {\n      const group = this.element.querySelector(`#${groupId}`);\n      if (group) {\n        this.toggleGroup(null, group);\n      }\n    });\n  }\n\n  /* -------------------------------------------- */\n  /* INTERACTIVITY                                */\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Edit HUD' button is clicked, open the Edit HUD app\n   */\n  static editHud() {\n    TagifyAppHelper.openEditHudApp(this.hudManager.groupHandler);\n  }\n\n  /* -------------------------------------------- */\n  /* ENABLE/DISABLE HUD                           */\n  /* -------------------------------------------- */\n\n  /**\n   * Toggle the HUD enabled state\n   */\n  async toggleHudEnable() {\n    const binding = Utils.humanizeBinding(\"enableDisableHud\");\n    const state = (this.isEnabled) ? \"disabled\" : \"enabled\";\n    if (this.isEnabled) {\n      this.#close();\n    } else {\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    }\n    await Utils.setSetting(\"enable\", !this.isEnabled);\n    Logger.info(game.i18n.format(`tokenActionHud.keybinding.toggleHud.${state}`, { binding }), true);\n  }\n\n  /* -------------------------------------------- */\n  /* COLLAPSE/EXPAND HUD                          */\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Collapse HUD' button is clicked, collapse the HUD\n   */\n  static collapseHud() {\n    this.toggleHudCollapse(\"collapse\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Expand HUD' button is clicked, expand the HUD\n   */\n  static expandHud() {\n    this.toggleHudCollapse(\"expand\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Toggle the HUD between collapse and expand states\n   * @param {string} state The state (\"collapse\" or \"expand\")\n   */\n  toggleHudCollapse(state) {\n    state = state ?? ((this.isCollapsed) ? \"expand\" : \"collapse\");\n    const isCollapsing = state === \"collapse\";\n    const { characterName, collapseHudButton, expandHudButton, groups, buttons } = this.elements;\n\n    collapseHudButton.classList.toggle(\"tah-hidden\", isCollapsing);\n    expandHudButton.classList.toggle(\"tah-hidden\", !isCollapsing);\n\n    if (this.isDocked) {\n      this.element.classList.toggle(\"tah-expanded\", !isCollapsing);\n    } else {\n      if (this.direction === \"down\") { characterName.classList.toggle(\"tah-hidden\", isCollapsing); }\n      groups.classList.toggle(\"tah-hidden\", isCollapsing);\n      buttons.classList.toggle(\"tah-hidden\", isCollapsing);\n    }\n\n    this.isCollapsed = isCollapsing;\n  }\n\n  /* -------------------------------------------- */\n  /* LOCK/UNLOCK HUD                              */\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Unlock HUD' button is clicked, unlock the HUD\n   * @param {object|null} event The event\n   */\n  static async unlockHud(event = null) {\n    this.toggleHudLock(\"unlock\", event);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * When the 'Lock HUD' button is clicked, lock the HUD\n   * @param {object|null} event The event\n   */\n  static async lockHud(event = null) {\n    this.toggleHudLock(\"lock\", event);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Toggle HUD lock state\n   * @param {string} state      The state (\"lock\" or \"unlock\")\n   * @param {object|null} event The event\n   */\n  toggleHudLock(state, event = null) {\n    if (event) event.preventDefault();\n\n    const isUnlocking = state === \"unlock\";\n    const { unlockButton, lockButton, editHudButton, subgroupArr, groupButtonArr,\n      groups, listSubgroupsArr, tabSubgroupArr, listSubgroupTitleArr } = this.elements;\n\n    // Toggle button visibiltiy\n    unlockButton.classList.toggle(\"tah-hidden\", isUnlocking);\n    lockButton.classList.toggle(\"tah-hidden\", !isUnlocking);\n    editHudButton.classList.toggle(\"tah-hidden\", !isUnlocking);\n\n    // Toggle class for styling when unlocked/locked\n    groups.classList.toggle(\"tah-unlocked\", isUnlocking);\n\n    // Helper function to toggle classes\n    const toggleElements = (elements, className, toggle) => {\n      elements.forEach(element => element.classList.toggle(className, toggle));\n    };\n\n    toggleElements(groupButtonArr, \"disable-edit\", !isUnlocking);\n    toggleElements(listSubgroupTitleArr, \"disable-edit\", !isUnlocking);\n\n    if (isUnlocking) {\n      // When the HUD is unlocked, unhide elements\n      toggleElements(subgroupArr, \"tah-hidden\", !isUnlocking);\n      toggleElements(listSubgroupsArr, \"tah-hidden\", !isUnlocking);\n      toggleElements(tabSubgroupArr, \"tah-hidden\", !isUnlocking);\n      toggleElements(listSubgroupTitleArr, \"tah-hidden\", !isUnlocking);\n    } else {\n      // When the HUD is locked, hide elements that have no underlying actions\n      const hideIfEmpty = elements => {\n        elements.forEach(element => {\n          const hasActions = element.querySelectorAll(\".tah-action\").length > 0;\n          if (!hasActions) element.classList.add(\"tah-hidden\");\n        });\n      };\n\n      hideIfEmpty(tabSubgroupArr);\n      hideIfEmpty(subgroupArr);\n      hideIfEmpty(listSubgroupsArr);\n\n      listSubgroupTitleArr.forEach(element => {\n        const groupElement = element.closest(\".tah-subgroup\");\n        if (groupElement.dataset?.showTitle === \"false\") {\n          element.classList.add(\"tah-hidden\");\n        }\n      });\n    }\n\n    this.isUnlocked = isUnlocking;\n  }\n\n  /* -------------------------------------------- */\n  /* GROUP EVENTS                                 */\n  /* -------------------------------------------- */\n\n  /**\n   * When a group is clicked\n   * @param {object} event The event\n   */\n  static clickGroup(event) {\n    this.bringToFront();\n\n    // Remove focus to allow core ESC interactions\n    event.currentTarget.blur();\n\n    if (event.type === \"contextmenu\") {\n      if (this.isUnlocked) {\n        this.openEditGroupApp(event);\n      } else {\n        this.handleGroupClick(event);\n      }\n    } else if (Utils.getSetting(\"clickOpenCategory\")) {\n      this.toggleGroup(event);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * When a subgroup is clicked\n   * @param {object} event The event\n   */\n  static clickSubgroup(event) {\n    if (event.type === \"contextmenu\") {\n      if (this.isUnlocked) {\n        this.openEditGroupApp(event);\n      } else {\n        this.handleGroupClick(event);\n      }\n    } else {\n      const group = Utils.getClosestGroupElement(event);\n      if (group.dataset?.groupType === \"tab\") {\n        this.toggleGroup(event, group);\n      } else {\n        this.collapseExpandSubgroup(event);\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Toggle the visibility of the group\n   * @param {object} event The event\n   * @param {object} group The group element\n   */\n  toggleGroup(event = null, group = null) {\n    group = group || Utils.getClosestGroupElement(event);\n    const isOpen = group.classList.contains(\"hover\");\n    const shouldOpen = !isOpen;\n    if ((isOpen && event?.type === \"pointerenter\") || (!isOpen && event?.type === \"pointerleave\")) return;\n    group.classList.toggle(\"hover\", shouldOpen);\n    if (shouldOpen) {\n      this.#toggleOtherGroups(group);\n      this.groupResizer.resizeGroup(group);\n\n      this.openGroups.add(group.id);\n    } else {\n      this.openGroups.delete(group.id);\n    }\n    // Remove focus to allow core ESC interactions\n    if (event) event.currentTarget.blur();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Toggle visibility of other groups\n   * @private\n   * @param {string} groupToIgnore The group to ignore\n   */\n  #toggleOtherGroups(groupToIgnore) {\n    if (!this.openGroups.size) return;\n\n    this.openGroups.forEach(groupId => {\n      if (groupId === groupToIgnore.id) return;\n      const group = this.element.querySelector(`#${groupId}`);\n      // If group no longer exists on the HUD, delete it\n      if (!group) {\n        this.openGroups.delete(groupId);\n      }\n      const isParentToIgnore = group.querySelector(`#${groupToIgnore.id}`);\n      if (group && !isParentToIgnore) {\n        this.toggleGroup(null, group);\n      }\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Collapse/expand a subgroup\n   * @param {object} event                       The event\n   */\n  collapseExpandSubgroup(event) {\n    if (!Utils.getSetting(\"collapsibleSubgroups\")) return;\n\n    const target = event.target.closest('[data-part=\"listSubgroupTitle\"]');\n\n    const groupElement = Utils.getClosestGroupElement(event);\n    const nestId = groupElement?.dataset?.nestId;\n    const tabSubgroup = target.closest(\".tah-tab-subgroup.hover\");\n    const groupsElement = groupElement?.querySelector(\"[data-part=\\\"subgroups\\\"]\");\n    const collapseIcon = target.querySelector(\".tah-collapse-icon\");\n    const expandIcon = target.querySelector(\".tah-expand-icon\");\n    const imageElement = groupElement.querySelector(\".tah-list-image\");\n\n    const toggleGroupVisibility = () => {\n      groupsElement?.classList.toggle(\"tah-hidden\");\n      collapseIcon?.classList.toggle(\"tah-hidden\");\n      expandIcon?.classList.toggle(\"tah-hidden\");\n      imageElement?.classList.toggle(\"tah-hidden\");\n    };\n\n    const saveGroupSettings = collapse => {\n      if (Utils.getSetting(\"enableCustomization\")) {\n        this.hudManager.groupHandler.saveGroupSettings({ nestId, settings: { collapse } });\n      }\n    };\n\n    if (groupsElement?.classList.contains(\"tah-hidden\")) {\n      toggleGroupVisibility();\n      saveGroupSettings(false);\n      this.groupResizer.resizeGroup(tabSubgroup);\n    } else {\n      toggleGroupVisibility();\n      saveGroupSettings(true);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle when a group is clicked\n   * @param {object} event The event\n   */\n  handleGroupClick(event) {\n    this.hudManager.handleHudEvent(\"groupClick\", event);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Open the 'Edit Group' or 'Edit Subgroup' app\n   * @param {object} event\n   */\n  openEditGroupApp(event) {\n    const group = Utils.getClosestGroupElement(event);\n    const { nestId, level, type } = group.dataset;\n    if (!nestId) return;\n    const name = this.hudManager.groupHandler.groups[nestId].name;\n    const parsedLevel = parseInt(level, 10) || null;\n\n    if (parsedLevel === 1) {\n      TagifyAppHelper.openEditGroupApp(\n        this.hudManager.groupHandler,\n        { nestId, name, level: parsedLevel, type }\n      );\n    } else {\n      TagifyAppHelper.openEditSubgroupApp(\n        this.hudManager.groupHandler,\n        this.hudManager.actionHandler,\n        { nestId, name, level: parsedLevel, type }\n      );\n    }\n\n  }\n\n  /* -------------------------------------------- */\n  /* ACTION EVENTS                                */\n  /* -------------------------------------------- */\n\n  /**\n   * When an action is clicked\n   * @param {object} event The event\n   */\n  static clickAction(event) {\n    event.preventDefault();\n    this.hudManager.handleHudEvent(\"clickAction\", event);\n    event.currentTarget.blur();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle when an action is hovered\n   * @param {object} event The event\n   */\n  handleActionHover(event) {\n    this.hudManager.handleHudEvent(\"hoverAction\", event);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Drag event handler\n   * @private\n   * @param {object} event The event\n   */\n  #dragEvent(event) {\n    if (!this.isDraggable) return;\n\n    // Get the main element\n    const element = this.element;\n\n    const clientX = event.clientX ?? event.changedTouches[0].clientX;\n    const clientY = event.clientY ?? event.changedTouches[0].clientY;\n\n    // Initialise positions and starting positions\n    let pos1 = 0;\n    let pos2 = 0;\n    let pos3 = clientX;\n    let pos4 = clientY;\n    const originalElementTop = element.offsetTop;\n    const originalElementLeft = element.offsetLeft;\n    let newElementTop = originalElementTop;\n    let newElementLeft = originalElementLeft;\n\n    /**\n     * Mouse movement event handler\n     * @param {object} event The event\n     */\n    const mouseMoveEvent = event => {\n      const clientX = event.clientX ?? event.changedTouches[0].clientX;\n      const clientY = event.clientY ?? event.changedTouches[0].clientY;\n      pos1 = pos3 - clientX;\n      pos2 = pos4 - clientY;\n      pos3 = clientX;\n      pos4 = clientY;\n\n      // If the mouse has not moved, do not update\n      if (pos1 === pos3 && pos2 === pos4) return;\n\n      newElementTop = newElementTop - pos2;\n      newElementLeft = newElementLeft - pos1;\n\n      this.topPos = newElementTop;\n\n      // Apply styles\n      requestAnimationFrame(() => {\n        Object.assign(element.style, { left: `${newElementLeft}px`, top: `${newElementTop}px` });\n      });\n    };\n\n    /* -------------------------------------------- */\n\n    /**\n     * Mouse up event handler\n     */\n    const mouseUpEvent = () => {\n      // Remove the mouse move and touch move events\n      document.onmousemove = null;\n      element.ontouchmove = null;\n\n      // Remove the mouse up and touch end events\n      document.onmouseup = null;\n      element.ontouchend = null;\n\n      // If position has not changed, do not update\n      if (newElementTop === originalElementTop && newElementLeft === originalElementLeft) return;\n\n      this.topPos = newElementTop;\n\n      this.#applyDirection();\n\n      // Save the new position to the user's flags\n      this.hudPosition = { top: newElementTop, left: newElementLeft };\n    };\n\n    // Bind mouse move and touch move events\n    document.onmousemove = mouseMoveEvent;\n    element.ontouchmove = mouseMoveEvent;\n\n    // Bind mouse up and touch end events\n    document.onmouseup = mouseUpEvent;\n    element.ontouchend = mouseUpEvent;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set position of the HUD\n   * @public\n   */\n  setPosition() {\n    if (!this.hudManager.hud) return;\n    if (this.isDocked) {\n      this.#setDockedPosition();\n    } else {\n      this.#setUndockedPosition();\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set docked position\n   */\n  #setDockedPosition() {\n    this.element.style.top = 0;\n    this.element.style.left = 0;\n\n    const interfaceElement = document.querySelector(\"#interface\");\n    const dockPosition = this.systemManager.styles[this.styleSetting]?.dockPosition;\n\n    switch (dockPosition) {\n      case \"right\":\n        interfaceElement.appendChild(this.element);\n        break;\n      case \"center-right\":\n        const rightUiElement = interfaceElement.querySelector(\"#ui-right\");\n        interfaceElement.insertBefore(this.element, rightUiElement);\n        break;\n      case \"left\":\n        const leftUiElement = interfaceElement.querySelector(\"#ui-left\");\n        interfaceElement.insertBefore(this.element, leftUiElement);\n        break;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set undocked position\n   */\n  #setUndockedPosition() {\n    document.body.appendChild(this.element);\n    this.#setPositionFromFlag();\n    this.#applyDirection();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set the position of the HUD based on user flag\n   * @private\n   */\n  #setPositionFromFlag() {\n    if (!this.hudPosition) {\n      this.element.style.top = `${HUD.DEFAULT_TOP_POS}px`;\n      this.element.style.left = `${HUD.DEFAULT_LEFT_POS}px`;\n      return;\n    }\n\n    return new Promise(resolve => {\n      const check = () => {\n        if (this.element) {\n          this.element.style.bottom = null;\n          this.topPos = this.hudPosition.top < 5 || this.hudPosition.top > window.innerHeight + 5\n            ? HUD.DEFAULT_TOP_POS\n            : this.hudPosition.top ?? HUD.DEFAULT_TOP_POS;\n          this.leftPos = this.hudPosition.left < 5 || this.hudPosition.left > window.innerWidth + 5\n            ? HUD.DEFAULT_LEFT_POS\n            : this.hudPosition.left ?? HUD.DEFAULT_LEFT_POS;\n          this.element.style.top = `${this.topPos}px`;\n          this.element.style.left = `${this.leftPos}px`;\n          resolve();\n        } else {\n          setTimeout(check, 10);\n        }\n      };\n\n      check();\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * The direction the HUD will expand\n   * @private\n   * @returns {string} The direction\n   */\n  get direction() {\n    const direction = Utils.getSetting(\"direction\");\n    if (direction === \"up\" || (direction === \"auto\" && this.topPos > window.innerHeight / 2)) return \"up\";\n    return \"down\";\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * The HUD position\n   * @returns {object} The HUD position\n   */\n  get hudPosition() {\n    return Utils.getUserFlag(\"position\");\n  }\n\n  set hudPosition(obj) {\n    Utils.setUserFlag(\"position\", obj);\n    Logger.debug(`Position set to x: ${obj.top}px, y: ${obj.left}px`);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the HUD is enabled\n   * @returns {boolean} Whether the HUD is enabled\n   */\n  get isEnabled() {\n    return Utils.getSetting(\"enable\");\n  }\n\n  set isEnabled(bool) {\n    Utils.setSetting(\"enable\", bool);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the HUD is collapsed\n   * @returns {boolean} Whether the HUD is collapsed\n   */\n  get isCollapsed() {\n    return Utils.getUserFlag(\"isCollapsed\");\n  }\n\n  set isCollapsed(bool) {\n    Utils.setUserFlag(\"isCollapsed\", bool);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the HUD is docked\n   * @returns {boolean} Whether the HUD is docked\n   */\n  get isDocked() {\n    const style = this.systemManager.styles[this.styleSetting];\n    return style.isDocked || style.dockPosition;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the HUD is unlocked\n   * @returns {boolean} Whether the HUD is unlocked\n   */\n  get isUnlocked() {\n    return Utils.getUserFlag(\"isUnlocked\");\n  }\n\n  set isUnlocked(bool) {\n    Utils.setUserFlag(\"isUnlocked\", bool);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the HUD is draggable\n   * @returns {boolean} Whether the HUD is draggable\n   */\n  get isDraggable() {\n    const drag = Utils.getSetting(\"drag\");\n    return ((drag === \"always\") || (drag === \"whenUnlocked\" && this.isUnlocked));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * The HUD scale\n   * @private\n   * @returns {number} The scale\n   */\n  get scale() {\n    if (this.isDocked) return 1;\n    const scale = parseFloat(Utils.getSetting(\"scale\")) || 1;\n    return Math.min(Math.max(scale, 0.5), 2);\n  }\n\n  /**\n   * Reset the position of the HUD\n   * @public\n   */\n  async resetPosition() {\n    Logger.debug(\"Resetting position...\");\n    this.hudPosition = { top: HUD.DEFAULT_TOP_POS, left: HUD.DEFAULT_LEFT_POS };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Copy user's data to others users\n   * @public\n   * @param {string} fromUserId        The user id to copy from\n   * @param {string | Array} toUserIds The user ids to copy to\n   */\n  async copy(fromUserId, toUserIds) {\n    await this.#copyUserData(fromUserId, toUserIds);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Copy user's data to others users\n   * @private\n   * @param {string} fromUserId        The user id to copy from\n   * @param {string | Array} toUserIds The user ids to copy to\n   */\n  async #copyUserData(fromUserId, toUserIds) {\n    if (!game.user.isGM) {\n      Logger.info(\"Copy failed: User is not a GM\", true);\n      return;\n    }\n    // Exit if parameters are missing\n    if (!fromUserId || !toUserIds.length) {\n      Logger.info(\"Copy failed: Parameters missing\", true);\n      return;\n    }\n\n    Logger.debug(\"Copying user data to users...\");\n\n    const fromGroup = await this.dataHandler.getDataAsGm({ type: \"user\", id: fromUserId });\n\n    if (typeof toUserIds === \"string\") {\n      await this.dataHandler.saveDataAsGm(\"user\", toUserIds, fromGroup);\n    } else if (Array.isArray(toUserIds)) {\n      for (const userId of toUserIds) {\n        await this.dataHandler.saveDataAsGm(\"user\", userId, fromGroup);\n      }\n    }\n\n    Logger.debug(\"User data copied to users\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset the HUD layout with the socket\n   */\n  static async resetLayoutWithSocket() {\n    game?.tokenActionHud?.resetLayout();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset the HUD layout\n   */\n  async resetLayout() {\n    Logger.debug(\"Resetting layout...\");\n    await this.resetUserAndActorData();\n    this.resetPosition();\n    Logger.debug(\"Layout reset\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset current actor's HUD data\n   */\n  async resetActorData() {\n    Logger.debug(\"Resetting actor data...\");\n\n    await this.dataHandler.saveDataAsGm(\"actor\", this.hudManager.actor.id, {});\n\n    Logger.debug(\"Actor data reset\");\n\n    this.hudManager.hardResetHud();\n    const trigger = { trigger: { type: \"method\", name: \"TokenActionHud#resetActorData\" } };\n    this.update(trigger);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset every actor's HUD data\n   * @public\n   */\n  async resetAllActorData() {\n    Logger.debug(\"Resetting all actor data...\");\n\n    for (const actor of game.actors) {\n      Logger.debug(`Resetting flags for actor [${actor.id}]`, { actor });\n      await this.dataHandler.saveDataAsGm(\"actor\", actor.id, {});\n    }\n\n    Logger.debug(\"All actor data reset\");\n    this.hudManager.hardResetHud();\n    const trigger = { trigger: { type: \"method\", name: \"TokenActionHud#resetAllActorData\" } };\n    this.update(trigger);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset user's HUD data\n   * @public\n   */\n  async resetUserData() {\n    Logger.debug(\"Resetting user data...\");\n    await this.dataHandler.saveDataAsGm(\"user\", game.userId, {});\n    Logger.debug(\"User data reset\");\n    this.hudManager.hardResetHud();\n    const trigger = { trigger: { type: \"method\", name: \"TokenActionHud#resetUserData\" } };\n    this.update(trigger);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset every user's HUD data\n   * @public\n   */\n  async resetAllUserData() {\n    Logger.debug(\"Resetting all user data...\");\n    for (const user of game.users) {\n      await this.dataHandler.saveDataAsGm(\"user\", user.id, {});\n    }\n    Logger.debug(\"All user data reset\");\n    this.hudManager.hardResetHud();\n    const trigger = { trigger: { type: \"method\", name: \"TokenActionHud#resetAllUserData\" } };\n    this.update(trigger);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Reset user and actor's HUD data\n   */\n  async resetUserAndActorData() {\n    Logger.debug(\"Resetting user data...\");\n    await this.dataHandler.saveDataAsGm(\"user\", game.userId, {});\n    Logger.debug(\"User data reset\");\n\n    Logger.debug(\"Resetting actor data...\");\n    await this.dataHandler.saveDataAsGm(\"actor\", this.hudManager.actor.id, {});\n    Logger.debug(\"Actor data reset\");\n\n    this.hudManager.hardResetHud();\n    const trigger = { trigger: { type: \"method\", name: \"TokenActionHud#resetUserAndActorData\" } };\n    this.update(trigger);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update the HUD\n   * @public\n   * @param {object} trigger The trigger for the update\n   */\n  async update(trigger = null) {\n    // Stops settings updates from triggering the HUD update multiple times\n    // Instead an update is triggered when settings are updated and the settings config window is closed\n    if (trigger?.name === \"closeSettingsConfig\") {\n      if (!this.updateSettingsPending) return;\n      this.updateSettingsPending = false;\n      Logger.debug(\"Settings updated\");\n    }\n\n    await this.#handleUpdate();\n    await this.#performUpdate(trigger);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handles HUD updates to avoid overlapping updates\n   */\n  async #handleUpdate() {\n    // Start a timer and reset it each time an update call is received before the timer has elapsed\n    if (this.isUpdatePending) this.updatePendingTimer.abort();\n\n    this.isUpdatePending = true;\n    await this.updatePendingTimer.start();\n    this.isUpdatePending = false;\n\n    // Wait for the current update to complete before progressing a pending update\n    // Stop waiting if the current update takes longer than 5 seconds\n    const waitForUpdateCompletion = async () => {\n      const maxWaitTime = 5000;\n      const interval = 10;\n      const iterations = maxWaitTime / interval;\n\n      let i = 0;\n      while (i < iterations && this.isUpdating) {\n        await this.updateTimer.start();\n        i++;\n      }\n\n      return !this.isUpdating;\n    };\n\n    if (this.isUpdating) {\n      const hasCompleted = await waitForUpdateCompletion();\n      if (!hasCompleted) {\n        Logger.debug(\"Update took too long. Aborting...\");\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Perform the HUD update following handling\n   * @param {object} trigger The trigger for the update\n   */\n  async #performUpdate(trigger) {\n    this.isUpdating = true;\n    Logger.debug(\"Updating HUD...\", trigger);\n\n    // Await does have an effect\n    const initialised = await this.hudManager.init(trigger);\n    if (!initialised) {\n      this.#abortUpdate();\n      return;\n    }\n\n    this.rendering = true;\n    this.render({ force: true, position: {} });\n\n    if (!ui.windows[MODULE.ID]) {\n      ui.windows[MODULE.ID] = this;\n    }\n\n    this.isUpdating = false;\n\n    Hooks.callAll(\"tokenActionHudCoreHudUpdated\", MODULE);\n    Logger.debug(\"HUD updated\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Abort the HUD update with a debug message\n   * @private\n   */\n  #abortUpdate() {\n    this.#close();\n    Logger.debug(\"HUD update aborted as no character(s) found or HUD is disabled\");\n    this.isUpdating = false;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Close the HUD\n   * @public\n   */\n  closeHud() {\n    this.#close();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Close the HUD\n   * @private\n   */\n  #close() {\n    requestAnimationFrame(() => {\n      this.element?.classList?.remove(\"tah-expanded\");\n      this.element?.classList?.add(\"tah-closed\");\n    });\n\n    this.openGroups = new Set();\n    this.closeTimer = setTimeout(() => {\n      this.close({ animate: false });\n    }, 500);\n\n    delete ui.windows[MODULE.ID];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the token change is valid for a HUD update\n   * @public\n   * @param {object} token The token\n   * @param {object} data  The data\n   * @returns {boolean}    Whether the token change is valid for a HUD update\n   */\n  isValidTokenChange(token, data = null) {\n    if (data.flags) return false;\n    return this.#isRelevantToken(token) || (Utils.getSetting(\"alwaysShowHud\") && token.actorId === game.user.character?.id);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the token is controlled or on the canvas\n   * @private\n   * @param {object} token The token\n   * @returns {boolean} Whether the token is controlled or on the canvas\n   */\n  #isRelevantToken(token) {\n    const controlledTokens = Utils.getControlledTokens();\n    return (\n      controlledTokens?.some(controlledToken => controlledToken.id === token.id)\n        || (!controlledTokens?.length\n          && canvas?.tokens?.placeables?.some(token => token.id === this.hudManager.token?.id))\n    );\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the given actor is the selected actor\n   * @param {object} actor The actor\n   * @returns {boolean}    Whether the given actor is the selected actor\n   */\n  isControlledActor(actor) {\n    return actor?.id === this.hudManager.actor?.id;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the actor or item update is valid for a HUD update\n   * @param {object} actor The actor\n   * @param {object} data  The data\n   * @returns {boolean}    Whether the actor or item update is valid for a HUD update\n   */\n  isValidActorOrItemUpdate(actor, data) {\n    if (!actor) {\n      Logger.debug(\"No actor; updating HUD\", { data });\n      return true;\n    }\n\n    if (this.isControlledActor(actor)) {\n      Logger.debug(\"Same actor; updating HUD\", { actor, data });\n      return true;\n    } else {\n      Logger.debug(\"Different actor; skipping HUD update\", { actor, data });\n      return false;\n    }\n  }\n}\n","import { MODULE } from \"./constants.mjs\";\nimport { DataHandler } from \"../handlers/data-handler.mjs\";\nimport { TokenActionHud } from \"../applications/token-action-hud.mjs\";\n\nlet socket;\n\n/**\n * Register socket with socketlib module\n */\nexport function registerSocket() {\n  socket = socketlib.registerModule(MODULE.ID);\n  socket.register(\"getFilePaths\", DataHandler.getFilePathsWithSocket);\n  socket.register(\"getData\", DataHandler.getDataWithSocket);\n  socket.register(\"saveData\", DataHandler.saveDataWithSocket);\n  socket.register(\"reset\", TokenActionHud.resetLayoutWithSocket);\n}\n\n/**\n * Whether the socketlib module is active\n * @returns {boolean} Whether the socketlib module is active\n */\nexport function isSocketlibActive() {\n  if (game.modules.get(\"socketlib\")?.active) return true;\n\n  Logger.error(\"This module requires the 'socketlib' module to be installed and enabled.\", true);\n  return false;\n}\n\n\n/**\n * Get the socket\n * @returns {object} The socket\n */\nexport function getSocket() {\n  return socket;\n}\n","import { GROUP_TYPE } from \"../../core/constants.mjs\";\nimport { Utils } from \"../../core/utils.mjs\";\n\n/**\n * Handler for building the HUD's generic actions.\n */\nexport class GenericActionHandler {\n  constructor(actionHandler) {\n    this.actionHandler = actionHandler;\n    this.actor = actionHandler.actor;\n    this.token = actionHandler.token;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build generic actions\n   * @public\n   */\n  buildActions() {\n    this.#buildUtilities();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build utilities\n   * @private\n   */\n  #buildUtilities() {\n    if (this.actor) {\n      this.#buildSingleTokenUtilities();\n    } else {\n      this.#buildMultipleTokenUtilities();\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build utilities for a single token\n   * @private\n   */\n  #buildSingleTokenUtilities() {\n    if (!this.token) return;\n    const actionsData = [];\n\n    // Build Toggle Combat action\n    const toggleCombatId = \"toggleCombat\";\n    const toggleCombatName = this.token?.inCombat\n      ? game.i18n.localize(\"tokenActionHud.removeFromCombat\")\n      : game.i18n.localize(\"tokenActionHud.addToCombat\");\n    const toggleCombatAction = {\n      id: toggleCombatId,\n      name: toggleCombatName,\n      onClick: async () => {\n        const token = Utils.getFirstControlledToken();\n        token.document.toggleCombatant();\n\n      }\n    };\n    actionsData.push(toggleCombatAction);\n\n    // Build Toggle Visibility action\n    if (game.user.isGM) {\n      const toggleVisibilityId = \"toggleVisibility\";\n      const toggleVisibilityName = this.token?.document?.hidden\n        ? game.i18n.localize(\"tokenActionHud.makeVisible\")\n        : game.i18n.localize(\"tokenActionHud.makeInvisible\");\n      const toggleVisibilityAction = {\n        id: toggleVisibilityId,\n        name: toggleVisibilityName,\n        onClick: async () => {\n          const token = Utils.getFirstControlledToken();\n          const isHidden = token.document.hidden;\n          await token.document.update({ hidden: !isHidden });\n        }\n      };\n      actionsData.push(toggleVisibilityAction);\n    }\n\n    const groupData = { id: \"token\", type: GROUP_TYPE.SYSTEM };\n\n    // Add actions to HUD\n    this.actionHandler.addActions(actionsData, groupData);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build utilities for multiple tokens\n   * @private\n   */\n  #buildMultipleTokenUtilities() {\n    const tokens = Utils.getControlledTokens();\n    const actionsData = [];\n\n    // Toggle Combat\n    const toggleCombatId = \"toggleCombat\";\n    const toggleCombatName = tokens.every(token => token.inCombat)\n      ? game.i18n.localize(\"tokenActionHud.removeFromCombat\")\n      : game.i18n.localize(\"tokenActionHud.addToCombat\");\n    const toggleCombatAction = {\n      id: toggleCombatId,\n      name: toggleCombatName,\n      onClick: async () => {\n        const controlledTokens = Utils.getControlledTokens();\n        for (const token of controlledTokens) {\n          await token.document.toggleCombatant();\n        }\n      }\n    };\n    actionsData.push(toggleCombatAction);\n\n    // Toggle Visibility\n    if (game.user.isGM) {\n      const toggleVisibilityId = \"toggleVisibility\";\n      const toggleVisibilityname = tokens.every(token => token.document?.hidden)\n        ? game.i18n.localize(\"tokenActionHud.makeVisible\")\n        : game.i18n.localize(\"tokenActionHud.makeInvisible\");\n      const toggleVisibilityAction = {\n        id: toggleVisibilityId,\n        name: toggleVisibilityname,\n        onClick: async () => {\n          const controlledTokens = Utils.getControlledTokens();\n          for (const token of controlledTokens) {\n            const isHidden = token.document.hidden;\n            await token.document.update({ hidden: !isHidden });\n          }\n        }\n      };\n      actionsData.push(toggleVisibilityAction);\n    }\n\n    const groupData = { id: \"token\", type: GROUP_TYPE.SYSTEM };\n\n    // Add actions to HUD\n    this.actionHandler.addActions(actionsData, groupData);\n  }\n}\n","import { ACTION_TYPE, COMPENDIUM_PACK_TYPES } from \"../../core/constants.mjs\";\nimport { Utils } from \"../../core/utils.mjs\";\n\n/**\n * Handler for building the HUD's compendium actions.\n */\nexport class CompendiumActionHandler {\n  actionHandler;\n\n  compendiumActions;\n\n  packIds;\n\n  constructor(actionHandler) {\n    this.actionHandler = actionHandler;\n    this.compendiumActions = new Map();\n    this.packIds = [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build compendium actions\n   */\n  async buildActions() {\n    if (this.compendiumActions.size === 0) {\n      this.packIds = game.packs\n        .filter(\n          pack =>\n            COMPENDIUM_PACK_TYPES.includes(pack.documentName)\n              && (foundry.utils.isNewerVersion(game.version, \"10\") ? pack.visible : !pack.private || game.user.isGM)\n        )\n        .map(pack => pack.metadata.id);\n\n      if (this.packIds.length === 0) return;\n\n      await Promise.all(this.packIds.map(packId => this.#setActions(packId)));\n    }\n\n    for (const pack of this.compendiumActions.values()) {\n      this.actionHandler.addActions(pack.actionsData, pack.groupData);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set compendium actions into the compendiumActions map\n   * @param {string} packId The pack id\n   */\n  async #setActions(packId) {\n    const pack = game.packs.get(packId);\n    const entries = pack ? pack.index.size > 0 ? pack.index : await pack.getIndex() : null;\n    if (!entries) return;\n    const actionType = this.#getCompendiumActionType(pack?.documentName);\n    if (!actionType) return;\n    const actionsData = entries.map(entry => ({\n      id: entry._id,\n      name: entry.name,\n      listName: `${game.i18n.localize(ACTION_TYPE[actionType])}: ${entry.name}`,\n      img: Utils.getImage(entry),\n      function: this.#getOnClick(actionType, pack, entry._id)\n    }));\n    const groupData = { id: this.#getGroupId(packId), type: \"core\" };\n    this.compendiumActions.set(packId, { actionsData, groupData });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get compendium action type based on document name\n   * @param {string} documentName The pack document name\n   * @returns {string}            The compendium action type\n   */\n  #getCompendiumActionType(documentName) {\n    switch (documentName) {\n      case \"Macro\":\n        return \"compendiumMacro\";\n      default:\n        return \"compendiumEntry\";\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get on click function\n   * @param {string} actionType The action type\n   * @param {object} pack       The compendium pack\n   * @param {string} documentId The document ID\n   * @returns {Function}        The function\n   */\n  #getOnClick(actionType, pack, documentId) {\n    switch (actionType) {\n      case \"compendiumMacro\":\n        return this.#getOnClickFunction(pack, documentId);\n      default:\n        return this.#getOnClickEntry(pack, documentId);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get on click function for compendium journal entry\n   * @param {object} pack       The pack\n   * @param {string} documentId The document ID\n   * @returns {Function}        The function\n   */\n  #getOnClickEntry(pack, documentId) {\n    return async () => {\n      const journalEntry = await pack.getDocument(documentId);\n      journalEntry.sheet.render(true); };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get on click function for compendium macro\n   * @param {object} pack       The pack\n   * @param {string} documentId The document ID\n   * @returns {Function}        The function\n   */\n  #getOnClickFunction(pack, documentId) {\n    return async () => {\n      await pack.getDocument(documentId).then(macro => macro.execute());\n    };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the group ID from the pack ID\n   * @param {string} packId The pack id\n   * @returns {string}      The group id\n   */\n  #getGroupId(packId) {\n    return packId.replace(\".\", \"-\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the compendium is linked\n   * @public\n   * @param {string} packId The pack id\n   * @returns {boolean}     Whether the compendium is linked\n   */\n  isLinkedCompendium(packId) {\n    return (this.packIds.length)\n      ? this.packIds?.includes(packId)\n      : false;\n  }\n}\n","import { ACTION_TYPE } from \"../../core/constants.mjs\";\nimport { Utils } from \"../../core/utils.mjs\";\n\n/**\n * Handler for building the HUD's macro actions.\n */\nexport class MacroActionHandler {\n  constructor(actionHandler) {\n    this.actionHandler = actionHandler;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build macro actions\n   * @override\n   */\n  async buildActions() {\n    if (!this.macroActions) {\n      this.macroActions = {\n        actionsData: await this.#getActions(),\n        groupData: { id: \"macros\", type: \"core\" }\n      };\n    }\n\n    this.actionHandler.addActions(this.macroActions.actionsData, this.macroActions.groupData);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actions\n   * @private\n   * @returns {object} The actions\n   */\n  async #getActions() {\n    const actionType = \"macro\";\n    const macros = game.macros.filter(macro => this.#hasPermission(macro));\n\n    return macros.map(macro => {\n      return {\n        id: macro.id,\n        name: macro.name,\n        listName: this.#getListName(actionType, macro.name),\n        img: Utils.getImage(macro),\n        onClick: () => {\n          game.macros.get(macro.id).execute();\n        }\n      };\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Check if the user has permission for the macro\n   * @private\n   * @param {object} macro The macro\n   * @returns {boolean}    Whether the user has permission\n   */\n  #hasPermission(macro) {\n    const { ownership } = macro;\n    return ownership[game.userId] ? ownership[game.userId] > 0 : ownership.default > 0;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get list name\n   * @param {string} actionType The action type\n   * @param {string} name       The action name\n   * @returns {string}          The list name\n   */\n  #getListName(actionType, name) {\n    const actionTypeName = `${game.i18n.localize(ACTION_TYPE[actionType])}: ` ?? \"\";\n    return `${actionTypeName}${name}`;\n  }\n}\n","import { DELIMITER } from \"../../core/constants.mjs\";\nimport { GenericActionHandler } from \"./generic-action-handler.mjs\";\nimport { CompendiumActionHandler } from \"./compendium-action-handler.mjs\";\nimport { MacroActionHandler } from \"./macro-action-handler.mjs\";\nimport { getTooltip } from \"../tooltip-handler.mjs\";\nimport { Logger, Utils } from \"../../core/utils.mjs\";\n\n/**\n * Handler for the HUD actions.\n */\nexport class ActionHandler {\n  constructor() {\n    this.hudManager = {};\n    this.groupHandler = {};\n    this.genericActionHandler = new GenericActionHandler(this);\n    this.compendiumActionHandler = new CompendiumActionHandler(this);\n    this.macroActionHandler = new MacroActionHandler(this);\n    this.actions = [];\n    this.availableActions = new Map();\n    this.delimiter = DELIMITER;\n    this.actionHandlerExtenders = [];\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Soft reset variables\n   */\n  softReset() {\n    this.genericActionHandler = new GenericActionHandler(this);\n    this.actions = [];\n    this.availableActions = new Map();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Prepare actions\n   * @param {object} groups The HUD groups\n   */\n  prepareActions(groups) {\n    for (const group of Object.values(groups)) {\n      if (group.actions?.length) {\n        this.actions.push(...group.actions);\n        for (const action of group.actions) {\n          action.selected = false;\n        }\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build actions\n   */\n  async buildActionsCore() {\n    await Promise.all([\n      this.#buildSystemActionsCore(),\n      this.#buildGenericActionsCore(),\n      this.#buildCompendiumActionsCore(),\n      this.#buildMacroActionsCore()\n    ]);\n    await this.#buildExtendedActionsCore();\n    this.#updateNonPresetActions();\n    this.#setCharacterLimit();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build system-specific actions\n   * @private\n   */\n  async #buildSystemActionsCore() {\n    Logger.debug(\"Building system actions...\", { actor: this.actor, token: this.token });\n    const groupIds = this.groupHandler.getGroupIds();\n    await this.buildSystemActions(groupIds);\n    Logger.debug(\"System actions built\", { hud: this.hud, actor: this.actor, token: this.token });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Placeholder function for the system module\n   * @override\n   * @param {Array} groupIds The group IDs\n   */\n  async buildSystemActions(groupIds) {}\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build compendium-specific actions\n   * @private\n   */\n  async #buildCompendiumActionsCore() {\n    Logger.debug(\"Building compendium actions...\");\n    await this.compendiumActionHandler.buildActions();\n    Logger.debug(\"Compendium actions built\", { hud: this.hud });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build generic actions\n   * @private\n   */\n  #buildGenericActionsCore() {\n    Logger.debug(\"Building generic actions...\", { actor: this.actor, token: this.token });\n    this.genericActionHandler.buildActions();\n    Logger.debug(\"Generic actions built\", { hud: this.hud, actor: this.actor, token: this.token });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build macro-specific actions\n   * @private\n   */\n  async #buildMacroActionsCore() {\n    Logger.debug(\"Building macro actions...\");\n    await this.macroActionHandler.buildActions();\n    Logger.debug(\"Macro actions built\", { hud: this.hud });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Build extended actions\n   * @private\n   */\n  async #buildExtendedActionsCore() {\n    await Promise.all(this.actionHandlerExtenders.map(\n      async extender => await extender.extendActionHandler()\n    ));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update non-preset actions\n   * @private\n   */\n  #updateNonPresetActions() {\n    const nonPresetActions = this.actions.filter(action => !action?.isPreset);\n\n    for (const nonPresetAction of nonPresetActions) {\n      const availableAction = this.availableActions.get(nonPresetAction.id);\n\n      if (availableAction) {\n        const systemSelected = availableAction.systemSelected ?? nonPresetAction.systemSelected;\n        const userSelected = nonPresetAction.userSelected ?? availableAction.userSelected;\n        Object.assign(nonPresetAction, this.#createAction({ ...availableAction, systemSelected, userSelected }));\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set character limit for action names based on the 'Character per Word' setting\n   * @private\n   */\n  #setCharacterLimit() {\n    const groups = this.groupHandler.getGroups({ level: 1 });\n\n    for (const group of groups) {\n      const groupCharacterCount = group?.settings?.characterCount;\n\n      const subgroups = this.groupHandler.getGroups({ nestId: group.nestId });\n\n      for (const subgroup of subgroups) {\n        const actions = subgroup.actions;\n        if (!actions?.length) continue;\n\n        const subgroupCharacterCount = subgroup?.settings?.characterCount;\n        const characterCount = (subgroupCharacterCount >= 0)\n          ? groupCharacterCount\n          : subgroupCharacterCount;\n\n        // Exit if character limit is not defined\n        if ((!characterCount && characterCount !== 0) || characterCount < 0) continue;\n\n        for (const action of actions) {\n          if (action.name.length <= characterCount) continue;\n          if (characterCount === 0) {\n            action.name = \"\";\n            continue;\n          }\n          // Set each word to the character limit\n          action.name = action.name\n            .split(\" \")\n            .map(word => word.slice(0, characterCount))\n            .join(\" \");\n        }\n      }\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actions by ID\n   * @public\n   * @param {object} actionData The action data\n   * @returns {Array}           The actions\n   */\n  getActions(actionData) {\n    return this.actions.filter(action => action.id === actionData.id);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Create action\n   * @private\n   * @param {object} actionData The action data\n   * @returns {object}          The action\n   */\n  #createAction(actionData) {\n    const fullName = actionData.fullName ?? actionData.name;\n    const tooltip = getTooltip(actionData.tooltip, fullName);\n\n    const infoProps = info => {\n      if (!info) return {};\n      return {\n        ...(info.class && { class: info.class }),\n        ...(info.icon && { icon: info.icon }),\n        ...(info.text && { text: info.text }),\n        ...(info.title && { title: info.title })\n      };\n    };\n\n    return {\n      id: actionData.id,\n      name: actionData.name,\n      fullName,\n      listName: actionData.listName || actionData.name,\n      ...(actionData.onClick && { onClick: actionData.onClick }),\n      ...(actionData.onHover && { onClick: actionData.onHover }),\n      ...(actionData.encodedValue && { encodedValue: actionData.encodedValue }),\n      ...(actionData.cssClass && { cssClass: actionData.cssClass }),\n      icons: actionData.icons || {},\n      ...(actionData.icon1 && { icon1: actionData.icon1 }),\n      ...(actionData.icon2 && { icon2: actionData.icon2 }),\n      ...(actionData.icon3 && { icon3: actionData.icon3 }),\n      ...(actionData.img && { img: actionData.img }),\n      info1: infoProps(actionData.info1),\n      info2: infoProps(actionData.info2),\n      info3: infoProps(actionData.info3),\n      system: actionData.system || {},\n      isAction: true,\n      ...(actionData.isItem && { isItem: actionData.isItem }),\n      ...(actionData.isPreset && { isPreset: actionData.isPreset }),\n      userSelected: actionData.userSelected ?? true,\n      systemSelected: actionData.systemSelected ?? true,\n      selected: actionData.systemSelected\n        ? actionData.userSelected ?? actionData.systemSelected ?? true\n        : false,\n      tooltip,\n      ...(actionData.useRawHtmlName && { useRawHtmlName: actionData.useRawHtmlName })\n    };\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add actions to the HUD\n   * @public\n   * @param {object} actionsData The actions data\n   * @param {object} groupData   The group data\n   */\n  addActions(actionsData, groupData) {\n    if (!actionsData.length) return;\n\n    // Create actions\n    const actions = new Map(actionsData.map(actionData => [actionData.id, this.#createAction(actionData)]));\n    this.#addToAvailableActions(actions);\n\n    if (!groupData?.id) return;\n\n    if (!groupData?.type) { groupData.type = \"system\"; }\n\n    const groups = this.groupHandler.getGroups(groupData);\n\n    if (!groups) return;\n\n    for (const group of groups) {\n      // Get existing actions\n      const existingActions = new Map(group.actions.map(action => [action.id, action]));\n\n      const reorderedActions = [];\n\n      // Loop the previously saved actions in the group\n      existingActions.forEach((existingAction, existingActionId) => {\n        const action = actions.get(existingActionId);\n        if (action) {\n          const systemSelected = action.systemSelected ?? existingAction.systemSelected;\n          const userSelected = existingAction.userSelected ?? action.userSelected;\n          const selected = (!systemSelected)\n            ? false\n            : userSelected ?? systemSelected ?? true;\n          Object.assign(existingAction, { ...action, isPreset: true, selected, systemSelected, userSelected });\n        } else if (!existingAction.selected && existingAction.isPreset) {\n          const systemSelected = false;\n          Object.assign(existingAction, this.#createAction({ ...existingAction, systemSelected }));\n        }\n      });\n\n      // Loop the generated actions and add any not previously saved\n      actions.forEach((action, actionId) => {\n        const existingAction = existingActions.get(actionId);\n        if (!existingAction) reorderedActions.push(this.#createAction({ ...action, isPreset: true }));\n      });\n\n      // Sort actions alphabetically\n      if (\n        groupData?.settings?.sort\n        || (typeof groupData?.settings?.sort === \"undefined\" && Utils.getSetting(\"sortActions\"))\n      ) {\n        reorderedActions.sort((a, b) => a.name.localeCompare(b.name));\n      }\n\n      // Add actions to group\n      group.actions.push(...reorderedActions);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Update actions\n   * @public\n   * @param {Array} actionsData The actions data\n   * @param {object} groupData  The group data\n   */\n  updateActions(actionsData, groupData) {\n    const group = this.groupHandler.getGroup(groupData);\n    const actions = group.actions;\n\n    const reorderedActions = [];\n\n    // Set 'selected' to true for selected actions\n    // Reorder actions based on order in dialog\n    for (const actionData of actionsData) {\n      if (actionData.id.includes(\"itemMacro\")) continue;\n      const existingAction = group.actions.find(action => action.id === actionData.id);\n      if (existingAction) {\n        const actionClone = { ...existingAction, userSelected: true };\n        reorderedActions.push(actionClone);\n      } else {\n        const availableAction = this.availableActions.get(actionData.id);\n        if (availableAction) {\n          const actionClone = { ...availableAction, userSelected: true };\n          reorderedActions.push(actionClone);\n        }\n      }\n    }\n    // Set 'selected' to false for unselected actions\n    for (const action of actions) {\n      if (!action.id || action?.id.includes(\"itemMacro\")) continue;\n\n      const actionData = actionsData.find(actionData => actionData.id === action.id);\n      if (!actionData && action.isPreset) {\n        const actionClone = { ...action, userSelected: false };\n        reorderedActions.push(actionClone);\n      }\n    }\n\n    // Sort actions alphabetically\n    if (groupData?.settings?.sort\n      || (typeof groupData?.settings?.sort === \"undefined\" && Utils.getSetting(\"sortActions\"))) {\n      reorderedActions.sort((a, b) => a.name.localeCompare(b.name));\n    }\n\n    // Replace group actions\n    group.actions = reorderedActions;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add to available actions\n   * @private\n   * @param {Array} actions The actions\n   */\n  #addToAvailableActions(actions) {\n    actions.forEach((action, actionId) => {\n      if (!this.availableActions.has(actionId)) this.availableActions.set(actionId, action);\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get available actions as Tagify entries\n   * @public\n   * @returns {Array} The available actions as Tagify entries\n   */\n  getAvailableActionsAsTags() {\n    return [...this.availableActions.values()]\n      .map(action => this.#toTagify(action))\n      .sort((a, b) => a.value.localeCompare(b.value));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get selected actions as Tagify entries\n   * @public\n   * @param {object} groupData The group data\n   * @returns {Array}          The selected actions as Tagify entries\n   */\n  getSelectedActionsAsTags(groupData) {\n    const group = this.groupHandler.getGroup(groupData);\n    if (!group) return [];\n    return group.actions\n      .filter(action => action.selected === true)\n      .map(action => this.#toTagify(action));\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add action handler extender\n   * @public\n   * @param {object} actionHandlerExtender The action handler extender\n   */\n  addActionHandlerExtender(actionHandlerExtender) {\n    Logger.debug(\"Adding action handler extender...\", { actionHandlerExtender });\n    actionHandlerExtender.hudManager = this.hudManager;\n    actionHandlerExtender.groupHandler = this.groupHandler;\n    actionHandlerExtender.actionHandler = this;\n    this.actionHandlerExtenders.push(actionHandlerExtender);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Convert an action into a Tagify entry\n   * @private\n   * @param {object} actionData The action data\n   * @returns {object}          The Tagify entry\n   */\n  #toTagify(actionData) {\n    const { id, name, listName } = actionData;\n    return { id, name, type: \"action\", value: listName ?? name };\n  }\n\n  /* -------------------------------------------- */\n  /* Shortcuts to the HudManager properties       */\n  /* -------------------------------------------- */\n\n  /**\n   * Get character name\n   * @returns {string} The character name\n   */\n  get characterName() {\n    return this.hudManager?.characterName;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actor\n   * @returns {object} The actor\n   */\n  get actor() {\n    return this.hudManager?.actor;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set actor\n   */\n  set actor(actor) {\n    this.hudManager.actor = actor;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actors\n   * @returns {Array} The actors\n   */\n  get actors() {\n    return this.hudManager?.actors;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set actors\n   * @param {Array} actors The actors\n   */\n  set actors(actors) {\n    this.hudManager.actors = actors;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get token\n   * @returns {object} The token\n   */\n  get token() {\n    return this.hudManager?.token;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set token\n   */\n  set token(token) {\n    this.hudManager.token = token;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get tokens\n   * @returns {Array} The tokens\n   */\n  get tokens() {\n    return this.hudManager?.tokens;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Set tokens\n   * @param {Array} tokens The tokens\n   */\n  set tokens(tokens) {\n    this.hudManager.tokens = tokens;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the right mouse button was clicked\n   * @returns {boolean} Whether the right mouse button was clicked\n   */\n  get isRightClick() {\n    return this.hudManager?.isRightClick;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the ALT key was pressed\n   * @returns {boolean} Whether the ALT key was pressed\n   */\n  get isAlt() {\n    return this.hudManager?.isAlt;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the CTRL key was pressed\n   * @returns {boolean} Whether the CTRL key was pressed\n   */\n  get isCtrl() {\n    return this.hudManager?.isCtrl;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the SHIFT key was pressed\n   * @returns {boolean} Whether the SHIFT key was pressed\n   */\n  get isShift() {\n    return this.hudManager?.isShift;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the element was hovered\n   * @returns {boolean} Whether the element was hovered\n   */\n  get isHover() {\n    return this.hudManager?.isHover;\n  }\n}\n","import { ActionHandler } from \"./action-handler.mjs\";\n\n/**\n * An extension of the base ActionHandler which extends the HUD via core or system modules.\n */\nexport class ActionHandlerExtender extends ActionHandler {\n  constructor() {\n    super();\n  }\n\n  /**\n   * Extend action handler\n   * @override\n   */\n  extendActionHandler() {}\n}\n","import { DELIMITER } from \"../../core/constants.mjs\";\nimport { Logger, Utils } from \"../../core/utils.mjs\";\n\n/**\n * Resolves core actions triggered from the HUD\n */\nexport class RollHandler {\n  constructor() {\n    this.hudManager = null;\n    this.delimiter = DELIMITER;\n    this.preRollHandlers = [];\n    this.rollHandlerExtenders = [];\n  }\n\n  /**\n   * Throw error\n   * @public\n   * @param {*} err The error\n   */\n  throwInvalidValueErr(err) {\n    throw new Error(\n      `Error handling button click: ${err}`\n    );\n  }\n\n  /**\n   * Add roll handler extender\n   * @public\n   * @param {object} rollHandlerExtender The RollHandlerExtender instance\n   */\n  addRollHandlerExtender(rollHandlerExtender) {\n    Logger.debug(\"Adding roll handler extender...\", { rollHandlerExtender });\n    this.rollHandlerExtenders.push(rollHandlerExtender);\n  }\n\n  /**\n   * Handle action events\n   * @public\n   * @param {object} event The event\n   * @param {object} action The action\n   * @param {class} actionHandler The ActionHandler instance\n   */\n  async handleActionClickCore(event, action, actionHandler) {\n    try {\n      Logger.debug(\"Handling action click event\", { event });\n\n      // Update variables with current action context\n      this.action = action;\n\n      // If the action has an onClick function, call it and trigger a HUD update\n      if (typeof action?.onClick === \"function\") {\n        action.onClick();\n        Hooks.callAll(\"forceUpdateTokenActionHud\");\n        return;\n      }\n\n      // Get the value of the associated button\n      const buttonValue = this.#getButtonValue(event);\n\n      // Check pre-handlers in extenders\n      for (let handler of this.rollHandlerExtenders) {\n        handler.action = this.action;\n        if (handler.prehandleActionEvent(event, buttonValue, actionHandler)) {\n          return;\n        }\n      }\n\n      // Check pre-handlers\n      for (let handler of this.preRollHandlers) {\n        handler.action = this.action;\n        if (handler.prehandleActionEvent(event, buttonValue, actionHandler)) {\n          return;\n        }\n      }\n\n      // Check handlers in extenders\n      for (let handler of this.rollHandlerExtenders) {\n        handler.action = this.action;\n        if (handler.handleActionClick(event, buttonValue, actionHandler)) {\n          return;\n        }\n      }\n\n      // If the action was not yet handled, call the default method\n      this.handleActionClick(event, buttonValue);\n    } catch(error) {\n      Logger.error(\"Error handling action click event\", { error, event, action });\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Overide for the TAH system module\n   * @override\n   * @param {object} event       The event\n   * @param {string} buttonValue The button value\n   */\n  handleActionClick(event, buttonValue) {}\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle action hover events\n   * @param {object} event  The event\n   * @param {object} action The action\n   */\n  async handleActionHoverCore(event, action) {\n    Logger.debug(\"Handling action hover event\", { event });\n\n    // Update variables with current action context\n    this.action = action;\n\n    // If the action has an onHover function, call it\n    if (typeof action?.onHover === \"function\") {\n      action.onHover();\n      return;\n    }\n\n    // Get the value of the associated button\n    const buttonValue = this.#getButtonValue(event);\n\n    this.handleActionHover(event, buttonValue);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Overide for the TAH system module\n   * @override\n   * @param {object} event       The event\n   * @param {string} buttonValue The button value\n   */\n  handleActionHover(event, buttonValue) {}\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle group click events\n   * @param {object} event The event\n   * @param {group} group  The nest ID\n   */\n  async handleGroupClickCore(event, group) {\n    Logger.debug(`Handling click event for group [${group.name}]`, { event });\n\n    this.handleGroupClick(event, group);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Overide for the TAH system module\n   * @override\n   * @param {object} event The event\n   * @param {object} group The group\n   */\n  handleGroupClick(event, group) {}\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add a pre-roll handler\n   * @public\n   * @param {object} handler The roll handler\n   */\n  addPreRollHandler(handler) {\n    Logger.debug(`Adding pre-roll handler ${handler.constructor.name}`);\n    this.preRollHandlers.push(handler);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get button value\n   * @private\n   * @param {object} event  The event\n   * @returns {string}      The button value\n   */\n  #getButtonValue(event) {\n    if (!event) return null;\n    const buttonElement = event.target.querySelector(\".tah-action-button\") ?? event.target.closest(\".tah-action-button\");\n    return buttonElement?.value || null;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Renders the item sheet\n   * @public\n   * @param {object} actor  The actor\n   * @param {string} itemId The item id\n   * @returns {boolean}     Whether the item was rendered\n   */\n  renderItem(actor, itemId) {\n    // If actor is not specified, use the RollHandler's actor\n    if (!actor) {\n      actor = this.actor;\n    }\n\n    // Get the item\n    const item = Utils.getItem(actor, itemId);\n\n    // If the item is not found, return false\n    if (!item) return false;\n\n    // Render the item and return true\n    item.sheet.render(true);\n    return true;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the item sheet should be rendered\n   * @public\n   * @returns {boolean}\n   */\n  isRenderItem() {\n    return (this.isRightClick && !(this.isAlt || this.isCtrl || this.isShift));\n  }\n\n  /* -------------------------------------------- */\n  /* Shortcuts to the HudManager properties       */\n  /* -------------------------------------------- */\n\n  /**\n   * Get actor\n   * @returns {object} The actor\n   */\n  get actor() {\n    return this.hudManager?.actor;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get actors\n   * @returns {Array} The actors\n   */\n  get actors() {\n    return this.hudManager?.actors;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get token\n   * @returns {object} The token\n   */\n  get token() {\n    return this.hudManager?.token;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get tokens\n   * @returns {Array} The tokens\n   */\n  get tokens() {\n    return this.hudManager?.tokens;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the right mouse button was clicked\n   * @returns {boolean} Whether the right mouse button was clicked\n   */\n  get isRightClick() {\n    return this.hudManager.isRightClick;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the ALT key was pressed\n   * @returns {boolean} Whether the ALT key was pressed\n   */\n  get isAlt() {\n    return this.hudManager.isAlt;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the CTRL key was pressed\n   * @returns {boolean} Whether the CTRL key was pressed\n   */\n  get isCtrl() {\n    return this.hudManager.isCtrl;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the SHIFT key was pressed\n   * @returns {boolean} Whether the SHIFT key was pressed\n   */\n  get isShift() {\n    return this.hudManager.isShift;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Whether the element was hovered over\n   * @returns {boolean} Whether the element was hovered over\n   */\n  get isHover() {\n    return this.hudManager?.isHover;\n  }\n}\n","import { RollHandler } from \"./roll-handler.mjs\";\n\n/*\n * Used for adding support for actions not part of the core functions.\n * Returns true from prehandleActionEvent() if it can perform an action and stops\n * further actions being performed.\n */\nexport class PreRollHandler extends RollHandler {\n  /**\n   * Pre-handle action event\n   * @param {object} event        The event\n   * @param {string} buttonValue  The button value\n   * @param {class} actionHandler The ActionHandler instance\n   * @returns {boolean}\n   */\n  prehandleActionEvent(event, buttonValue, actionHandler) {\n    return false;\n  }\n}\n","import { RollHandler } from \"./roll-handler.mjs\";\n\n/**\n * An extension of the base RollHandler which extends the actions that can be handled\n */\nexport class RollHandlerExtender extends RollHandler {\n  constructor() {\n    super();\n  }\n\n  /**\n   * Pre-handle action event\n   * @param {object} event        The event\n   * @param {string} buttonValue  The button value\n   * @param {class} actionHandler The ActionHandler instance\n   * @returns {boolean}\n   */\n  prehandleActionEvent(event, buttonValue, actionHandler) {\n    return false;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Handle action click\n   * @override\n   * @param {object} event        The click event\n   * @param {string} buttonValue  The button value\n   * @param {class} actionHandler The ActionHandler instance\n   * @returns {boolean}\n   */\n  handleActionClick(event, buttonValue, actionHandler) {\n    return false;\n  }\n}\n","import { CUSTOM_STYLE, MODULE, TEMPLATE } from \"../core/constants.mjs\";\nimport { Utils } from \"../core/utils.mjs\";\n\nconst { ApplicationV2, HandlebarsApplicationMixin } = foundry.applications.api;\n\nexport class CustomStyleForm extends HandlebarsApplicationMixin(ApplicationV2) {\n  constructor(...args) {\n    super(args);\n  }\n\n  /* -------------------------------------------- */\n\n  static DEFAULT_OPTIONS = {\n    actions: {\n      reset: CustomStyleForm.reset\n    },\n    classes: [`${MODULE.ID}-app`, \"sheet\"],\n    id: \"token-action-hud-core-settings\",\n    form: {\n      closeOnSubmit: true,\n      handler: CustomStyleForm.submit\n    },\n    position: {\n      width: 600,\n      height: 680\n    },\n    tag: \"form\",\n    window: {\n      minimizable: true,\n      resizable: true,\n      title: \"tokenActionHud.settings.customStyle.form.title\"\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  static PARTS = {\n    form: {\n      template: TEMPLATE.customStyleForm\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  async _prepareContext() {\n    this.context = {\n      backgroundColor: Utils.getSetting(\"backgroundColor\", CUSTOM_STYLE.backgroundColor.default),\n      buttonHeight: Utils.getSetting(\"buttonHeight\", CUSTOM_STYLE.buttonHeight.default),\n      buttonBackgroundColor: Utils.getSetting(\"buttonBackgroundColor\", CUSTOM_STYLE.buttonBackgroundColor.default),\n      buttonHoverBackgroundColor: Utils.getSetting(\"buttonHoverBackgroundColor\", CUSTOM_STYLE.buttonHoverBackgroundColor.default),\n      buttonToggleActiveBackgroundColor: Utils.getSetting(\"buttonToggleActiveBackgroundColor\", CUSTOM_STYLE.buttonToggleActiveBackgroundColor.default),\n      buttonToggleHoverBackgroundColor: Utils.getSetting(\"buttonToggleHoverBackgroundColor\", CUSTOM_STYLE.buttonToggleHoverBackgroundColor.default),\n      buttonTextColor: Utils.getSetting(\"buttonTextColor\", CUSTOM_STYLE.buttonTextColor.default),\n      buttonHoverTextColor: Utils.getSetting(\"buttonHoverTextColor\", CUSTOM_STYLE.buttonHoverTextColor.default),\n      buttonToggleActiveTextColor: Utils.getSetting(\"buttonToggleActiveTextColor\", CUSTOM_STYLE.buttonToggleActiveTextColor.default),\n      buttonToggleHoverTextColor: Utils.getSetting(\"buttonToggleHoverTextColor\", CUSTOM_STYLE.buttonToggleHoverTextColor.default),\n      buttonBorderPrimaryColor: Utils.getSetting(\"buttonBorderPrimaryColor\", CUSTOM_STYLE.buttonBorderPrimaryColor.default),\n      buttonBorderSecondaryColor: Utils.getSetting(\"buttonBorderSecondaryColor\", CUSTOM_STYLE.buttonBorderSecondaryColor.default),\n      buttonHoverBorderPrimaryColor: Utils.getSetting(\"buttonHoverBorderPrimaryColor\", CUSTOM_STYLE.buttonHoverBorderPrimaryColor.default),\n      buttonHoverBorderSecondaryColor: Utils.getSetting(\"buttonHoverBorderSecondaryColor\", CUSTOM_STYLE.buttonHoverBorderSecondaryColor.default),\n      buttonToggleActiveBorderPrimaryColor: Utils.getSetting(\"buttonToggleActiveBorderPrimaryColor\", CUSTOM_STYLE.buttonToggleActiveBorderPrimaryColor.default),\n      buttonToggleActiveBorderSecondaryColor: Utils.getSetting(\"buttonToggleActiveBorderSecondaryColor\", CUSTOM_STYLE.buttonToggleActiveBorderSecondaryColor.default),\n      buttonToggleHoverBorderPrimaryColor: Utils.getSetting(\"buttonToggleHoverBorderPrimaryColor\", CUSTOM_STYLE.buttonToggleHoverBorderPrimaryColor.default),\n      buttonToggleHoverBorderSecondaryColor: Utils.getSetting(\"buttonToggleHoverBorderSecondaryColor\", CUSTOM_STYLE.buttonToggleHoverBorderSecondaryColor.default),\n      textPrimaryColor: Utils.getSetting(\"textPrimaryColor\", CUSTOM_STYLE.textPrimaryColor.default),\n      textSecondaryColor: Utils.getSetting(\"textSecondaryColor\", CUSTOM_STYLE.textSecondaryColor.default),\n      textTertiaryColor: Utils.getSetting(\"textTertiaryColor\", CUSTOM_STYLE.textTertiaryColor.default),\n      textHoverPrimaryColor: Utils.getSetting(\"textHoverPrimaryColor\", CUSTOM_STYLE.textHoverPrimaryColor.default),\n      textHoverSecondaryColor: Utils.getSetting(\"textHoverSecondaryColor\", CUSTOM_STYLE.textHoverSecondaryColor.default),\n      textHoverTertiaryColor: Utils.getSetting(\"textHoverTertiaryColor\", CUSTOM_STYLE.textHoverTertiaryColor.default)\n    };\n    return this.context;\n  }\n\n  /* -------------------------------------------- */\n\n  _onRender(context, options) {\n    super._onRender(context, options);\n    if (typeof ColorPicker !== \"undefined\") { ColorPicker.install(); }\n  }\n\n  /* -------------------------------------------- */\n\n  static async reset() {\n    for (const [key, value] of Object.entries(CUSTOM_STYLE)) {\n      Utils.setSetting(key, value.default);\n      document.querySelector(\":root\").style.setProperty(value.cssProperty, value.default);\n    }\n    this.render(true);\n  }\n\n  /* -------------------------------------------- */\n\n  static async submit(event, form, formData) {\n    const isCustom = Utils.getSetting(\"style\") === \"custom\";\n    for (const [key, value] of Object.entries(formData.object)) {\n      const customStyle = CUSTOM_STYLE[key];\n      if (value !== this.context[key]) {\n        Utils.setSetting(key, value);\n        if (isCustom) {\n          document.querySelector(\":root\").style.setProperty(customStyle.cssProperty, value);\n        }\n      }\n    }\n  }\n}\n","import { Logger, Utils } from \"../core/utils.mjs\";\n\n/**\n * Reset layout confirmation dialog\n * @public\n */\nexport async function resetLayoutDialog() {\n  await foundry.applications.api.DialogV2.confirm({\n    window: {\n      title: game.i18n.localize(\"tokenActionHud.dialog.resetLayout.title\")\n    },\n    content: `<p>${game.i18n.localize(\"tokenActionHud.dialog.resetLayout.content\")}</p>`,\n    modal: true,\n    yes: {\n      label: game.i18n.localize(\"tokenActionHud.dialog.button.yes\"),\n      callback: async () => resetLayout()\n    },\n    no: {\n      label: game.i18n.localize(\"tokenActionHud.dialog.button.no\")\n    }\n  });\n}\n\n/* -------------------------------------------- */\n\n/**\n * Reset user layout\n */\nasync function resetLayout() {\n  if (!game?.tokenActionHud) return;\n\n  const customLayoutElement = document.querySelector(\"#token-action-hud-core-settings input[name=customLayout]\");\n  if (customLayoutElement) {\n    await game.tokenActionHud.updateCachedSettings(\"customLayout\", customLayoutElement?.value ?? \"\");\n    await Utils.setSetting(\"customLayout\", customLayoutElement?.value ?? \"\");\n  }\n\n  const userCustomLayoutElement = document.querySelector(\"#token-action-hud-core-settings input[name=userCustomLayout]\");\n  if (userCustomLayoutElement) {\n    await game.tokenActionHud.updateCachedSettings(\"userCustomLayout\", userCustomLayoutElement?.value ?? \"\");\n    await Utils.setUserFlag(\"userCustomLayout\", userCustomLayoutElement?.value ?? \"\");\n  }\n\n  await game.tokenActionHud.resetLayout();\n  Logger.info(\"Layout reset\", true);\n}\n","import { Logger, Utils } from \"../core/utils.mjs\";\n\n/**\n * Reset all layouts confirmation dialog\n * @public\n */\nexport async function resetAllLayoutsDialog() {\n  await foundry.applications.api.DialogV2.confirm({\n    window: {\n      title: game.i18n.localize(\"tokenActionHud.dialog.resetAllLayouts.title\")\n    },\n    content: `<p>${game.i18n.localize(\"tokenActionHud.dialog.resetAllLayouts.content\")}</p>`,\n    modal: true,\n    yes: {\n      label: game.i18n.localize(\"tokenActionHud.dialog.button.yes\"),\n      callback: async () => resetAllLayouts()\n    },\n    no: {\n      label: game.i18n.localize(\"tokenActionHud.dialog.button.no\")\n    }\n  });\n}\n\n/* -------------------------------------------- */\n\n/**\n * Reset HUD layouts for everyone\n * @public\n */\nasync function resetAllLayouts() {\n  if (!game.tokenActionHud) return;\n\n  const customLayoutElement = document.querySelector(\"#token-action-hud-core-settings input[name=customLayout]\");\n  if (customLayoutElement) {\n    await Utils.setSetting(\"customLayout\", customLayoutElement?.value ?? \"\");\n  }\n\n  const userCustomLayoutElement = document.querySelector(\"#token-action-hud-core-settings input[name=userCustomLayout]\");\n  if (userCustomLayoutElement) {\n    await Utils.setUserFlag(\"userCustomLayout\", userCustomLayoutElement?.value ?? \"\");\n  }\n\n  await game.tokenActionHud.socket.executeForEveryone(\"reset\");\n  Logger.info(\"All layouts reset\", true);\n}\n","import { MODULE, LAYOUT_SETTING, TEMPLATE } from \"../core/constants.mjs\";\nimport { resetLayoutDialog } from \"../dialogs/reset-layout.mjs\";\nimport { resetAllLayoutsDialog } from \"../dialogs/reset-all-layouts.mjs\";\nimport { Utils } from \"../core/utils.mjs\";\n\nconst { ApplicationV2, HandlebarsApplicationMixin } = foundry.applications.api;\n\nexport class TahSettingsForm extends HandlebarsApplicationMixin(ApplicationV2) {\n  constructor(...args) {\n    super(args);\n\n    this.settings = {};\n  }\n\n  /* -------------------------------------------- */\n\n  static DEFAULT_OPTIONS = {\n    actions: {\n      exportLayout: TahSettingsForm.exportLayout,\n      resetLayout: resetLayoutDialog,\n      resetAllLayouts: resetAllLayoutsDialog,\n      reset: TahSettingsForm.reset\n    },\n    classes: [`${MODULE.ID}-app`, \"sheet\"],\n    id: \"token-action-hud-core-settings\",\n    form: {\n      closeOnSubmit: true,\n      handler: TahSettingsForm.submit\n    },\n    position: {\n      width: 600,\n      height: 800\n    },\n    tag: \"form\",\n    window: {\n      minimizable: true,\n      resizable: true\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  static PARTS = {\n    form: {\n      template: TEMPLATE.settings\n    }\n  };\n\n  /* -------------------------------------------- */\n\n  async _prepareContext() {\n    const settings = [];\n    const context = { settings };\n\n    for (const [key, setting] of Object.entries(this.settings)) {\n      const { scope, hint, icon, label, name, type, inputType, range, choices, action } = setting;\n\n      if (scope === \"world\" && !game.user.isGM) continue;\n\n      const value = (setting?.scope)\n        ? (scope === \"user\")\n          ? await Utils.getUserFlag(key)\n          : await Utils.getSetting(key)\n        : \"\";\n      const settingType = type instanceof Function ? type.name : \"String\";\n      const isButton = inputType === \"button\";\n      const isCheckbox = inputType === \"checkbox\";\n      const isFilePicker = inputType === \"filePicker\";\n      const filePickerType = (inputType === \"filePicker\") ? settingType ?? \"any\" : \"\";\n      const isNumber = inputType === \"number\";\n      const isRange = (inputType === \"range\") && range;\n      const isSelect = choices !== undefined;\n      settings.push({\n        id: key,\n        hint: game.i18n.localize(hint),\n        icon,\n        label: game.i18n.localize(label),\n        name: game.i18n.localize(name),\n        value,\n        type,\n        isButton,\n        action,\n        isCheckbox,\n        isFilePicker,\n        filePickerType,\n        isNumber,\n        isRange,\n        isSelect\n      });\n    }\n    return context;\n  }\n\n  /* -------------------------------------------- */\n\n  static exportLayout() {\n    if (!game.tokenActionHud) return;\n    game.tokenActionHud.hudManager.layoutHandler.exportLayout();\n  }\n\n  static async submit(event, form, formData) {\n    for (const [key, value] of Object.entries(formData.object)) {\n      switch (this.settings[key].scope) {\n        case \"client\":\n        case \"world\":\n          await Utils.setSetting(key, value); break;\n        case \"user\":\n          await Utils.setUserFlag(key, value); break;\n      }\n\n      await game.tokenActionHud.updateCachedSettings(key, value);\n    }\n\n    game.tokenActionHud.update();\n  }\n}\n\n/* -------------------------------------------- */\n\nexport class TahSettingsFormLayout extends TahSettingsForm {\n  constructor() {\n    super();\n    this.settings = LAYOUT_SETTING;\n  }\n\n  /* -------------------------------------------- */\n\n  static DEFAULT_OPTIONS = {\n    window: {\n      title: \"tokenActionHud.settings.layout.form.title\"\n    }\n  };\n}\n","import { CustomStyleForm } from \"../applications/custom-style-form.mjs\";\nimport { TahSettingsFormLayout } from \"../applications/settings-form.mjs\";\nimport { CUSTOM_STYLE, MODULE } from \"./constants.mjs\";\nimport { Logger, Utils } from \"./utils.mjs\";\n\n/**\n * When a module setting is changed, update the HUD settings\n * @param {string} key The setting key\n * @param {*} value    The setting value\n */\nfunction onChangeFunction(key, value) {\n  if (game.tokenActionHud) game.tokenActionHud.updateCachedSettings(key, value);\n}\n\n/* -------------------------------------------- */\n\n// Register key bindings\nHooks.on(\"init\", async () => {\n  game.keybindings.register(MODULE.ID, \"enableDisableHud\", {\n    name: game.i18n.localize(\"tokenActionHud.enableDisableHud\"),\n    editable: [],\n    onDown: () => { if (game.tokenActionHud) game.tokenActionHud.toggleHudEnable(); }\n  });\n\n  game.keybindings.register(MODULE.ID, \"collapseExpandHud\", {\n    name: game.i18n.localize(\"tokenActionHud.collapseExpandHud\"),\n    editable: [],\n    onDown: () => { if (game.tokenActionHud) game.tokenActionHud.toggleHudCollapse(); }\n  });\n});\n\n/* -------------------------------------------- */\n\n/**\n * Register module settings\n * @param {class} systemManager The system manager\n * @param {Array} rollHandlers  The available roll handlers\n * @param {object} styles       The styles\n */\nexport const registerSettingsCore = function(systemManager, rollHandlers, styles) {\n  game.settings.registerMenu(MODULE.ID, \"customStyle\", {\n    hint: game.i18n.localize(\"tokenActionHud.settings.customStyle.hint\"),\n    label: game.i18n.localize(\"tokenActionHud.settings.customStyle.label\"),\n    name: game.i18n.localize(\"tokenActionHud.settings.customStyle.name\"),\n    icon: \"fas fa-palette\",\n    type: CustomStyleForm,\n    restricted: false,\n    scope: \"client\"\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.registerMenu(MODULE.ID, \"layout\", {\n    hint: game.i18n.localize(\"tokenActionHud.settings.layout.hint\"),\n    label: game.i18n.localize(\"tokenActionHud.settings.layout.label\"),\n    name: game.i18n.localize(\"tokenActionHud.settings.layout.name\"),\n    icon: \"fas fa-table-layout\",\n    type: TahSettingsFormLayout,\n    restricted: false,\n    scope: \"client\"\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"startup\", {\n    name: \"One-Time Startup Prompt\",\n    scope: \"world\",\n    config: false,\n    type: Boolean,\n    default: false\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"migrationVersion\", {\n    name: \"Migration Version\",\n    scope: \"world\",\n    config: false,\n    type: String,\n    default: \"0.0\"\n  });\n\n  /* -------------------------------------------- */\n\n  const styleChoices = Object.fromEntries(Object.entries(styles).map(([key, value]) => [key, value.name]));\n\n  game.settings.register(MODULE.ID, \"style\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.style.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.style.hint\"),\n    scope: \"client\",\n    config: true,\n    type: String,\n    default: \"foundryVTT\",\n    choices: styleChoices,\n    onChange: value => {\n      Utils.switchCSS(value);\n      onChangeFunction(\"style\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"customLayout\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.customLayout.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.customLayout.hint\"),\n    scope: \"world\",\n    config: false,\n    type: String\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"userCustomLayout\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.userCustomLayout.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.userCustomLayout.hint\"),\n    scope: \"client\",\n    config: false,\n    type: String\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"direction\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.direction.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.direction.hint\"),\n    scope: \"client\",\n    config: true,\n    type: String,\n    default: \"auto\",\n    choices: {\n      auto: game.i18n.localize(\"tokenActionHud.settings.direction.choice.auto\"),\n      up: game.i18n.localize(\"tokenActionHud.settings.direction.choice.up\"),\n      down: game.i18n.localize(\"tokenActionHud.settings.direction.choice.down\")\n    },\n    onChange: value => {\n      onChangeFunction(\"direction\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"grid\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.grid.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.grid.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      onChangeFunction(\"grid\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"scale\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.scale.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.scale.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Number,\n    range: {\n      min: 0.5,\n      max: 2,\n      step: 0.05\n    },\n    default: 1,\n    onChange: value => {\n      onChangeFunction(\"scale\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"drag\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.drag.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.drag.hint\"),\n    scope: \"client\",\n    config: true,\n    type: String,\n    default: \"whenUnlocked\",\n    choices: {\n      always: game.i18n.localize(\"tokenActionHud.settings.drag.choices.always\"),\n      whenUnlocked: game.i18n.localize(\"tokenActionHud.settings.drag.choices.whenUnlocked\"),\n      never: game.i18n.localize(\"tokenActionHud.settings.drag.choices.never\")\n    },\n    onChange: value => {\n      onChangeFunction(\"drag\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"enable\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.enable.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.enable.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      onChangeFunction(\"enable\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"rollHandler\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.rollHandler.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.rollHandler.hint\"),\n    scope: \"world\",\n    config: true,\n    type: String,\n    choices: rollHandlers,\n    default: \"core\",\n    onChange: value => {\n      onChangeFunction(\"rollHandler\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"allow\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.allow.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.allow.hint\"),\n    scope: \"world\",\n    config: true,\n    type: String,\n    choices: {\n      4: game.i18n.localize(\"tokenActionHud.settings.allow.choice.4\"),\n      3: game.i18n.localize(\"tokenActionHud.settings.allow.choice.3\"),\n      2: game.i18n.localize(\"tokenActionHud.settings.allow.choice.2\"),\n      1: game.i18n.localize(\"tokenActionHud.settings.allow.choice.1\")\n    },\n    default: 1,\n    requiresReload: true\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"enableCustomization\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.enableCustomization.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.enableCustomization.hint\"),\n    scope: \"world\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      onChangeFunction(\"enableCustomization\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"alwaysShowHud\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.alwaysShowHud.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.alwaysShowHud.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      onChangeFunction(\"alwaysShowHud\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"displayCharacterName\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.displayCharacterName.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.displayCharacterName.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      onChangeFunction(\"displayCharacterName\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"sortActions\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.sortActions.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.sortActions.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      onChangeFunction(\"sortActions\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"displayIcons\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.displayIcons.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.displayIcons.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      onChangeFunction(\"displayIcons\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"tooltips\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.tooltips.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.tooltips.hint\"),\n    scope: \"client\",\n    config: true,\n    type: String,\n    default: \"full\",\n    choices: {\n      full: game.i18n.localize(\"tokenActionHud.settings.tooltips.choices.full\"),\n      nameOnly: game.i18n.localize(\"tokenActionHud.settings.tooltips.choices.nameOnly\"),\n      none: game.i18n.localize(\"tokenActionHud.settings.tooltips.choices.none\")\n    },\n    onChange: value => {\n      onChangeFunction(\"tooltips\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"tooltipDelay\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.tooltipDelay.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.tooltipDelay.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Number,\n    default: 1500,\n    onChange: value => {\n      setTooltipDelay(value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  const tooltipDelay = Utils.getSetting(\"tooltipDelay\") || 1500;\n  setTooltipDelay(tooltipDelay);\n\n  /**\n   * Set the tooltip delay\n   * @param {number} ms Delay amount in milliseconds\n   */\n  function setTooltipDelay(ms) {\n    const root = document.querySelector(\":root\");\n    root.style.setProperty(\"--tah-tooltip-delay\", `${ms}ms`);\n  }\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"clickOpenCategory\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.clickOpenCategory.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.clickOpenCategory.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      onChangeFunction(\"clickOpenCategory\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  if (Utils.isModuleActive(\"itemacro\") && !Utils.isModuleActive(\"midi-qol\")) {\n    game.settings.register(MODULE.ID, \"itemMacro\", {\n      name: game.i18n.localize(\"tokenActionHud.settings.itemMacro.name\"),\n      hint: game.i18n.localize(\"tokenActionHud.settings.itemMacro.hint\"),\n      scope: \"client\",\n      config: true,\n      type: String,\n      choices: {\n        both: game.i18n.localize(\"tokenActionHud.settings.itemMacro.choices.both\"),\n        itemMacro: game.i18n.localize(\"tokenActionHud.settings.itemMacro.choices.itemMacro\"),\n        original: game.i18n.localize(\"tokenActionHud.settings.itemMacro.choices.original\")\n      },\n      default: \"both\",\n      onChange: value => {\n        onChangeFunction(\"itemMacro\", value);\n      }\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"activeCssAsText\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.activeCssAsText.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.activeCssAsText.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      onChangeFunction(\"activeCssAsText\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"collapsibleSubgroups\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.collapsibleSubgroups.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.collapsibleSubgroups.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      onChangeFunction(\"collapsibleSubgroups\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  game.settings.register(MODULE.ID, \"debug\", {\n    name: game.i18n.localize(\"tokenActionHud.settings.debug.name\"),\n    hint: game.i18n.localize(\"tokenActionHud.settings.debug.hint\"),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      onChangeFunction(\"debug\", value);\n    }\n  });\n\n  /* -------------------------------------------- */\n\n  registerCustomStyleSettings();\n\n  systemManager.registerSettings(onChangeFunction);\n\n  Logger.debug(\"Available roll handlers\", { rollHandlers });\n};\n\n/* -------------------------------------------- */\n\n/**\n * Register color settings\n */\nfunction registerCustomStyleSettings() {\n  for (const [key, value] of Object.entries(CUSTOM_STYLE)) {\n    game.settings.register(MODULE.ID, key, {\n      scope: \"client\",\n      config: false,\n      type: value.type,\n      default: value.default\n    });\n  }\n}\n","import { ActionHandlerExtender } from \"./action-handler-extender.mjs\";\nimport { DELIMITER, ITEM_MACRO_ICON } from \"../../core/constants.mjs\";\nimport { Utils } from \"../../core/utils.mjs\";\n\n/**\n * Handler for building actions related to the Item Macro module.\n */\nexport class ItemMacroActionHandlerExtender extends ActionHandlerExtender {\n  constructor() {\n    super();\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Extend the action list\n   * @override\n   */\n  extendActionHandler() {\n    if (!this.actor) return;\n\n    const items = this.actor.items.filter(item => item.flags?.itemacro?.macro?.command);\n    if (!items?.length) return;\n\n    const itemMacroSetting = Utils.getSetting(\"itemMacro\");\n    if (itemMacroSetting === \"original\") return;\n\n    const replaceExisting = itemMacroSetting === \"itemMacro\";\n\n    Object.values(this.groupHandler.groups).forEach(group => {\n      this.#addGroupActions(items, group, replaceExisting);\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add group actions\n   * @private\n   * @param {Array} items     The items\n   * @param {object} group    The group\n   * @param {boolean} replace Whether to replace the action or not\n   */\n  #addGroupActions(items, group, replace) {\n    // Exit if no actions exist\n    if (!group?.actions?.length) return;\n\n    const actions = [];\n    for (const existingAction of group.actions) {\n      const item = items.find(item => item.id === existingAction.id);\n      if (!item) continue;\n\n      const existingItemMacroAction = group.actions.find(action => action.id === `itemMacro+${existingAction.id}`);\n      const actionToReplace = existingItemMacroAction ?? existingAction;\n\n      if (existingItemMacroAction) replace = true;\n\n      const macroAction = this.#createItemMacroAction(item, existingAction, actionToReplace, replace);\n\n      if (!replace) {\n        actions.push(macroAction);\n      }\n\n      if (!this.actionHandler.availableActions.has(macroAction.id)) {\n        this.actionHandler.availableActions.set(macroAction.id, macroAction);\n      }\n    }\n\n    this.#addActions(actions, group);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Create item macro action\n   * @private\n   * @param {object} item            The item\n   * @param {object} existingAction  The existing action\n   * @param {object} actionToReplace The action to replace\n   * @param {boolean} replace        Whether to replace the action or not\n   * @returns {object}               The item macro action\n   */\n  #createItemMacroAction(item, existingAction, actionToReplace, replace) {\n    const action = (replace) ? actionToReplace : Utils.deepClone(existingAction);\n    action.encodedValue = `itemMacro${existingAction.encodedValue?.substr(existingAction.encodedValue.indexOf(DELIMITER))}`;\n    action.id = `itemMacro+${existingAction.id}`;\n    action.fullName = existingAction.fullName;\n    action.listName = `Item Macro: ${existingAction.fullName}`;\n    action.name = existingAction.name;\n    action.img = existingAction.img;\n    action.itemMacroIcon = `<i class=\"${ITEM_MACRO_ICON.ICON}\" data-tooltip=\"${ITEM_MACRO_ICON.TOOLTIP}\"></i>`;\n    action.selected = existingAction.userSelected ?? existingAction.systemSelected;\n\n    action.onClick = () => {\n      try {\n        item.executeMacro();\n      } catch(err) {\n        Logger.debug(\"ItemMacro Error\", err);\n        return false;\n      }\n    };\n\n    return action;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add actions to the group\n   * @private\n   * @param {object} actions The actions\n   * @param {object} group   The group\n   */\n  #addActions(actions, group) {\n    actions.forEach(macroAction => {\n      const index = group.actions.findIndex(action => action.id === macroAction.id) + 1;\n      group.actions.splice(index, 0, macroAction);\n    });\n  }\n}\n","import { registerSettingsCore } from \"../core/settings.mjs\";\nimport { ItemMacroActionHandlerExtender } from \"../handlers/action-handlers/item-macro-extender.mjs\";\nimport { RollHandler } from \"../handlers/roll-handlers/roll-handler.mjs\";\nimport { MODULE, CSS_STYLE } from \"../core/constants.mjs\";\nimport { Logger, Utils } from \"../core/utils.mjs\";\n\nexport class SystemManager {\n  constructor() {\n    this.coreModuleId = MODULE.ID;\n    this.defaults = [];\n    this.styles = null;\n  }\n\n  /* -------------------------------------------- */\n  /*  Methods for system modules to override      */\n  /* -------------------------------------------- */\n\n  getActionHandler() {}\n\n  getRollHandler(rollHandlerId) {\n    return false;\n  }\n\n  getAvailableRollHandlers() {}\n\n  registerSettings(onChangeFunction) {}\n\n  async registerDefaults() {}\n\n  registerStyles() {}\n\n  /* -------------------------------------------- */\n\n  /**\n   * Initialise the system manager\n   */\n  async init() {\n    await this.#registerDefaultsCore();\n    this.#registerStylesCore();\n    this.#registerSettingsCore();\n  }\n\n\n  /* -------------------------------------------- */\n\n  /**\n   * Register defaults\n   * @private\n   * @returns {Array} The defaults\n   */\n  async #registerDefaultsCore() {\n    const defaults = await this.registerDefaults() ?? [];\n\n    Hooks.callAll(\"tokenActionHudCoreRegisterDefaults\", defaults);\n\n    if (defaults) {\n      this.defaults = defaults;\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Register styles\n   * @private\n   */\n  #registerStylesCore() {\n    const systemStyles = this.registerStyles() ?? {};\n    this.styles = foundry.utils.mergeObject(CSS_STYLE, systemStyles);\n\n    Hooks.callAll(\"tokenActionHudCoreRegisterStyles\", this.styles);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Register module settings\n   * @private\n   */\n  #registerSettingsCore() {\n    const rollHandlers = this.getAvailableRollHandlers();\n    registerSettingsCore(this, rollHandlers, this.styles);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Initialise the action handler\n   * @public\n   * @param {class} hudManager The HudManager instance\n   * @returns {class}          The ActionHandler instance\n   */\n  getActionHandlerCore(hudManager) {\n    const actionHandler = this.getActionHandler();\n    actionHandler.systemManager = this;\n\n    const { dataHandler, groupHandler } = hudManager;\n    actionHandler.hudManager = hudManager;\n    actionHandler.dataHandler = dataHandler;\n    actionHandler.groupHandler = groupHandler;\n    actionHandler.addGroup = groupHandler.addGroup.bind(groupHandler);\n    actionHandler.addGroupInfo = groupHandler.addGroupInfo.bind(groupHandler);\n    this.#addActionHandlerExtenders(groupHandler, actionHandler);\n\n    Hooks.callAll(\"tokenActionHudCoreAddActionHandler\", actionHandler);\n\n    return actionHandler;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add action handler extensions\n   * @public\n   * @param {class} groupHandler The GroupHandler instance\n   * @param {class} actionHandler The ActionHandler instance\n   */\n  #addActionHandlerExtenders(groupHandler, actionHandler) {\n    if (Utils.isModuleActive(\"itemacro\") && !Utils.isModuleActive(\"midi-qol\")) {\n      actionHandler.addActionHandlerExtender(new ItemMacroActionHandlerExtender(groupHandler, actionHandler));\n    }\n\n    Hooks.callAll(\"tokenActionHudCoreAddActionHandlerExtenders\", actionHandler);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Get the roll handler\n   * @public\n   * @param {class} hudManager The HudManager instance\n   * @returns {class}          The RollHandler instance\n   */\n  getRollHandlerCore(hudManager) {\n    let rollHandlerId = Utils.getSetting(\"rollHandler\");\n\n    if (!(rollHandlerId === \"core\" || Utils.isModuleActive(rollHandlerId))) {\n      Logger.error(rollHandlerId, game.i18n.localize(\"tokenActionHud.handlerNotFound\"));\n      rollHandlerId = \"core\";\n      Utils.setSetting(\"rollHandler\", rollHandlerId);\n    }\n\n    // If no system RollHandler is returned, use core RollHandler\n    const rollHandler = this.getRollHandler(rollHandlerId) ?? new RollHandler();\n    rollHandler.hudManager = hudManager;\n\n    this.#addRollHandlerExtenders(rollHandler);\n\n    Hooks.callAll(\"tokenActionHudCoreAddRollHandler\", rollHandler);\n\n    return rollHandler;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add roll handler extensions\n   * @public\n   * @param {class} rollHandler The roll handler\n   */\n  #addRollHandlerExtenders(rollHandler) {\n    Hooks.callAll(\"tokenActionHudCoreAddRollHandlerExtenders\", rollHandler);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add handler\n   * @param {Array} choices The choices\n   * @param {string} id     The module id\n   */\n  static addHandler(choices, id) {\n    if (Utils.isModuleActive(id)) {\n      const title = Utils.getModuleTitle(id);\n      foundry.utils.mergeObject(choices, { [id]: title });\n    }\n  }\n}\n","import { MODULE } from \"./constants.mjs\";\nimport { ActionHandler } from \"../handlers/action-handlers/action-handler.mjs\";\nimport { ActionHandlerExtender } from \"../handlers/action-handlers/action-handler-extender.mjs\";\nimport { DataHandler } from \"../handlers/data-handler.mjs\";\nimport { PreRollHandler } from \"../handlers/roll-handlers/pre-roll-handler.mjs\";\nimport { RollHandler } from \"../handlers/roll-handlers/roll-handler.mjs\";\nimport { RollHandlerExtender } from \"../handlers/roll-handlers/roll-handler-extender.mjs\";\nimport { SystemManager } from \"../managers/system-manager.mjs\";\nimport { Logger, Timer, Utils } from \"./utils.mjs\";\n\n/**\n * Register the API\n */\nexport function registerApi() {\n  const module = game.modules.get(MODULE.ID);\n  module.api = {\n    ActionHandlerExtender,\n    ActionHandler,\n    DataHandler,\n    Logger,\n    PreRollHandler,\n    RollHandler,\n    RollHandlerExtender,\n    SystemManager,\n    Timer,\n    Utils\n  };\n\n  Hooks.callAll(\"tokenActionHudCoreApiReady\", module);\n}\n","import { MODULE, TEMPLATE } from \"./core/constants.mjs\";\nimport { DataHandler } from \"./handlers/data-handler.mjs\";\nimport { MigrationManager } from \"./managers/migration-manager.mjs\";\nimport { TokenActionHud } from \"./applications/token-action-hud.mjs\";\nimport { Logger, Utils } from \"./core/utils.mjs\";\nimport { registerSocket, getSocket, isSocketlibActive } from \"./core/sockets.mjs\";\nimport { registerApi } from \"./core/api.mjs\";\n\nlet systemManager;\n\n/**\n * Register hooks\n */\nHooks.once(\"socketlib.ready\", registerSocket);\nHooks.on(\"ready\", registerApi);\nHooks.on(\"tokenActionHudSystemReady\", registerCoreModule);\nHooks.on(\"tokenActionHudCoreReady\", registerHud);\nHooks.on(\"renderHotbar\", (_, html) => addContextMenuListener(html, \"li.macro\"));\nHooks.on(\"renderSceneNavigation\", (_, html) => addContextMenuListener(html, \"li.scene.nav-item\"));\n\n/* -------------------------------------------- */\n\n/**\n * Register the core module\n * @param {object} systemModule The system module\n */\nasync function registerCoreModule(systemModule) {\n  // Exit if core module version is not compatible with the system module\n  if (!Utils.isSystemModuleCompatible(systemModule.api?.requiredCoreModuleVersion)) return;\n\n  // Exit if socketlit module is not installed or enabled\n  if (!isSocketlibActive()) return;\n\n  // Create new SystemManager and register core and system module settings\n  systemManager = new systemModule.api.SystemManager(MODULE.ID);\n  await systemManager.init();\n\n  // Set stylesheet to 'style' core module setting\n  Utils.switchCSS(Utils.getSetting(\"style\"));\n\n  // Register Handlebar helpers\n  Utils.registerHandlebars();\n\n  // Load templates\n  loadTemplates(Object.values(TEMPLATE));\n\n  Hooks.callAll(\"tokenActionHudCoreReady\");\n}\n\n/* -------------------------------------------- */\n\n/**\n * Register the TokenActionHud application\n */\nasync function registerHud() {\n  // Get socket\n  const socket = getSocket();\n\n  // Initialise DataHandler\n  const dataHandler = new DataHandler(socket);\n  await dataHandler.init();\n\n  // Initialise MigrationManager\n  const migrationManager = new MigrationManager(dataHandler, socket);\n  await migrationManager.init();\n\n  checkColorPicker();\n  registerHudHooks();\n\n  game.tokenActionHud = new TokenActionHud(systemManager, dataHandler, socket);\n  await game.tokenActionHud.init();\n\n  Hooks.callAll(\"tokenActionHudReady\");\n\n  game.tokenActionHud.update({ type: \"hook\", name: \"tokenActionHudCoreReady\" });\n}\n\n/* -------------------------------------------- */\n\n/**\n * Notify GM if the Color Picker is not active\n */\nfunction checkColorPicker() {\n  if (game.user.isGM && !game.modules.get(\"color-picker\")?.active && Utils.getSetting(\"startup\") === false) {\n    Logger.info(\"To enable color pickers, install the 'Color Picker' module.\", true);\n    Utils.setSetting(\"startup\", true);\n  }\n}\n\n/* -------------------------------------------- */\n\n/**\n * Register HUD-related hooks\n */\nfunction registerHudHooks() {\n  Hooks.on(\"renderTokenActionHud\", () => game.tokenActionHud.postRender());\n  const hooks = [\n    \"deleteActor\", \"updateActor\", \"createActiveEffect\", \"deleteActiveEffect\",\n    \"createCombat\", \"deleteCombat\", \"updateCombat\", \"updateCombatant\",\n    \"deleteCompendium\", \"updateCompendium\", \"createItem\", \"deleteItem\",\n    \"updateItem\", \"deleteMacro\", \"updateMacro\", \"controlToken\", \"deleteToken\",\n    \"updateToken\", \"closeSettingsConfig\", \"forceUpdateTokenActionHud\"\n  ];\n\n  hooks.forEach(hook => Hooks.on(hook, (...args) => handleHookEvent({ ...args }, hook)));\n}\n\n/* -------------------------------------------- */\n\n/**\n * Handle hook events\n * @param {object} hookData The hook data\n * @param {string} hookName The hook name\n */\nfunction handleHookEvent(hookData, hookName) {\n  if (!validateHookData(hookData, hookName)) return;\n  game.tokenActionHud.update({ type: \"hook\", name: hookName, data: hookData });\n}\n\n/* -------------------------------------------- */\n\n/**\n * Validate hook data\n * @param {object} hookData The hook data\n * @param {string} hookName The hook name\n * @returns {boolean}\n */\nfunction validateHookData(hookData, hookName) {\n  switch (hookName) {\n    case \"deleteActor\":\n    case \"updateActor\":\n      return game.tokenActionHud.isValidActorOrItemUpdate(hookData[0], hookData[1]);\n    case \"createActiveEffect\":\n    case \"deleteActiveEffect\":\n      return game.tokenActionHud.isControlledActor(hookData[0]?.parent);\n    case \"createCombatant\":\n    case \"updateCombatant\":\n      return game.tokenActionHud.isControlledActor(hookData[0]?.actor);\n    case \"deleteCompendium\":\n    case \"updateCompendium\":\n      return validateCompendium(hookData.source?.metadata?.id);\n    case \"createItem\":\n    case \"deleteItem\":\n    case \"updateItem\":\n      return game.tokenActionHud.isValidActorOrItemUpdate(hookData[0]?.actor);\n    case \"deleteMacro\":\n    case \"updateMacro\":\n      game.tokenActionHud.actionHandler.macroActionHandler.macroActions = null;\n      return true;\n    case \"updateToken\":\n      return Object.hasOwn(hookData[1], \"hidden\") && game.tokenActionHud.isValidTokenChange(hookData[0], hookData[1]);\n    default:\n      return true;\n  }\n}\n\n/* -------------------------------------------- */\n\n/**\n * Validate compendium hook\n * @param {string} id The compendium ID\n * @returns {boolean} Whether the compendium hook is valid\n */\nfunction validateCompendium(id) {\n  const compendiumHandler = game.tokenActionHud.actionHandler.compendiumActionHandler;\n  if (!compendiumHandler.isLinkedCompendium(id)) return false;\n  compendiumHandler.compendiumActions = new Map();\n  return true;\n}\n\n/* -------------------------------------------- */\n\n/**\n * Add context menu listeners\n * @param {object} html     The HTML\n * @param {string} selector The selector for the HTML element\n */\nfunction addContextMenuListener(html, selector) {\n  const element = html[0].querySelector(selector);\n  if (element) element.addEventListener(\"contextmenu\", sendHudToBottom);\n}\n\n/* -------------------------------------------- */\n\n/**\n * Send HUD to bottom\n */\nfunction sendHudToBottom() {\n  if (game.tokenActionHud?.element) {\n    game.tokenActionHud.element.style.zIndex = 20;\n  }\n}\n"],"names":["MODULE","ID","NAME","TEMPLATE_DIR","TEMPLATE","action","customStyleForm","group","hud","listSubgroup","settings","tabSubgroup","tagifyAppHud","tagifyAppGroup","tagifyAppSubgroup","DELIMITER","ACTION_TYPE","compendiumEntry","compendiumMacro","compendiumPlaylist","macro","COMPENDIUM_PACK_TYPES","CSS_STYLE","foundryVTT","class","file","moduleId","name","primaryColor","secondaryColor","tertiaryColor","compact","dockedLeft","isDocked","dockPosition","dockedCenterRight","collapseIcon","expandIcon","dockedRight","foundryVttLight","pathfinder","highContrast","custom","CUSTOM_STYLE","backgroundColor","cssProperty","type","String","default","buttonHeight","Number","buttonBackgroundColor","buttonBorderPrimaryColor","buttonBorderSecondaryColor","buttonTextColor","buttonHoverBorderPrimaryColor","buttonHoverBorderSecondaryColor","buttonHoverBackgroundColor","buttonHoverTextColor","buttonToggleActiveBackgroundColor","buttonToggleActiveBorderPrimaryColor","buttonToggleActiveBorderSecondaryColor","buttonToggleActiveTextColor","buttonToggleHoverBackgroundColor","buttonToggleHoverBorderPrimaryColor","buttonToggleHoverBorderSecondaryColor","buttonToggleHoverTextColor","textPrimaryColor","textSecondaryColor","textTertiaryColor","textHoverPrimaryColor","textHoverSecondaryColor","textHoverTertiaryColor","GROUP_TYPE","COMPENDIUM","CUSTOM","SYSTEM","SYSTEM_DERIVED","HUD","DEFAULT_HEIGHT","DEFAULT_WIDTH","DEFAULT_LEFT_POS","DEFAULT_TOP_POS","DEFAULT_SCALE","DEFAULT_ZINDEX","ITEM_MACRO_ICON","ICON","TOOLTIP","LAYOUT_SETTING","customLayout","hint","inputType","filePickerType","dtype","scope","userCustomLayout","exportLayout","label","icon","resetLayout","resetAllLayouts","SETTING","activeCssAsText","classes","variable","allow","alwaysShowHud","clickOpenCategory","customStyle","debug","direction","displayCharacterName","displayIcons","drag","enable","enableCustomization","grid","itemMacro","migrationVersion","reset","renderItemOnRightClick","rollHandler","scale","sortActions","startup","style","tooltips","Logger$1","Logger","info","message","notify","ui","notifications","console","log","error","permanent","data","isDebug","game","tokenActionHud","debugSetting","Utils","getSetting","dataClone","deepClone","Timer","constructor","milliseconds","this","timer","start","abort","Promise","resolve","setTimeout","clearTimeout","checkAllow","userRole","allowSetting","capitalize","value","replace","text","charAt","toUpperCase","substring","toLowerCase","original","options","foundry","utils","getActor","actorId","tokenId","token","canvas","tokens","placeables","find","id","actor","actors","get","getClosestGroupElement","event","target","closest","getControlledActors","controlled","map","getStatusEffect","statusId","effects","effect","statuses","every","status","getImage","entity","defaultImages","push","result","displayIconsSetting","img","includes","getItem","itemId","items","getToken","getControlledTokens","getFirstControlledToken","controlledToken","character","user","key","defaultValue","setSetting","set","getActorFlag","getFlag","setActorFlag","setFlag","unsetActorFlag","unsetFlag","getUserFlag","setUserFlag","unsetUserFlag","i18n","toTranslate","localize","isGmActive","users","some","isGM","active","isModuleActive","module","modules","getModuleTitle","title","getModuleVersion","version","humanizeBinding","binding","keybindings","stringParts","modifiers","reduce","parts","part","KeyboardManager","MODIFIER_CODES","unshift","getKeycodeDisplayString","join","median","numbers","mid","Math","floor","length","nums","sort","a","b","getUpperQuartileAverage","sortedNumbers","slice","startIndex","ceil","endIndex","sum","count","i","upperQuartileAverage","getModifier","num","sign","sortItems","Map","entries","localeCompare","sortItemsByName","switchCSS","Object","href","stylesheet","values","document","styleSheets","ss","disabled","setting","querySelector","setProperty","tahElement","classList","remove","add","registerHandlebars","Handlebars","registerHelper","string","reduceOp","args","reducer","Array","from","pop","first","shift","tokenActionHudCoreTrue","arguments","block","activeCssAsTextSetting","fn","inverse","getModuleVersionParts","moduleVersion","trigger","moduleVersionParts","split","major","minor","patch","isSystemModuleCompatible","requiredCoreModuleVersion","requiredCoreModuleVersionParts","coreModuleVersionParts","requiredVersion","installedVersion","getNestedGroups","groups","order","groupId","groupType","isArray","foundGroups","level","nestId","assign","keys","getGroupByNestId","findGroup","async","groupStyle","foundGroup","deleteGroupByNestId","findAndDeleteGroup","index","splice","deleteGroupsById","DataHandler","socket","init","createDirectories","all","private","isPrivate","fileMap","getFilePathsAsGm","isPersistentStorage","isNewerVersion","ForgeVTT","DATA_FOLDER","moduleDirectory","directoriesToCreate","world","directory","FilePicker","browse","catch","createDirectory","path","getFileParts","filename","folder","hasPermission","files","getFilePaths","executeAsGM","getFilePathsWithSocket","dataHandler","actorFiles","userFiles","canSaveData","saveDataAsGm","saveData","saveDataWithSocket","fileName","encodeURI","File","JSON","stringify","response","upload","has","canGetData","getDataAsGm","getData","getDataWithSocket","foundFile","foundFolder","endsWith","ms","Date","now","fetch","ok","json","getDataMigrate","folderPath","foundFolderPath","foundFilePath","then","MigrationManager","isSuccess","unsetOldFlags","migrateFiles","filter","objects","children","scene","scenes","err","CharacterHandler","hudManager","groupHandler","actionHandler","previousActorId","setCharacter","isCharacter","isMultipleTokens","controlledTokens","isSameActor","resetCharacter","handleMultipleTokens","handleSingleToken","characterName","isValidCharacter","t","testUserPermission","LayoutHandler","systemManager","defaultLayout","setDefaultLayout","setCustomLayout","softReset","hardReset","defaults","layout","userId","saveDataToFile","getTooltip","tooltip","content","styles","styleSetting","GroupHandler","layoutHandler","defaultGroups","actorGroups","userGroups","setDefaultGroups","setSavedActorGroups","setSavedUserGroups","defaultGroup","getUserGroups","savedUserData","prepareGroups","userGroup","createGroup","parentNestId","parentGroup","tabs","lists","getActorGroups","actorGroup","existingGroup","actions","getGroup","getGroups","selected","startsWith","getGroupIds","getGroupSettings","groupData","keepData","groupDataClone","nestIdParts","defaultSettings","showTitle","groupSettings","subtitleClass","groupSystem","system","commonProps","cssClass","info1","info2","info3","listName","isSelected","defaultSelected","updateGroups","groupsData","parentGroupData","childGroupData","existingGroups","existingParentGroup","saveGroupSettings","saveGroups","saveActor","saveUser","saveActorGroups","saveUserGroups","getReducedGroupData","keepActions","isPreset","userSelected","getSelectedGroupsAsTags","toTagify","getAvailableGroupAsTags","derivedGroups","getDerivedGroupsAsTags","systemGroups","getSystemGroupsAsTags","compendiumGroups","getCompendiumGroupsAsTags","macroGroups","getMacroGroupsAsTags","packs","pack","documentName","visible","metadata","addGroup","update","parentGroups","updateGroup","updateExistingGroups","removeGroup","addGroupInfo","groupInfo","forEach","setHasActions","hasActions","HudManager","getActionHandlerCore","getRollHandlerCore","characterHandler","isHudEnabled","buildHud","softResetHud","hardResetHud","previousActor","isGmInactiveUserNotified","prepareHud","buildActionsCore","prepareActions","handleHudEvent","eventType","getAction","registerKeyPresses","setIsHover","handleGroupClickCore","handleActionClickCore","handleActionHoverCore","setIsRightClick","setIsAlt","setIsCtrl","setIsShift","button","originalEvent","isRightClick","isModiferActive","keyboard","isModifierActive","MODIFIER_KEYS","ALT","altKey","emulateKeypress","force","downKeys","isAlt","CONTROL","ctrlKey","isCtrl","SHIFT","shiftKey","isShift","isHover","groupElement","dataset","actionButtonElement","actionId","availableActions","role","e","amd","exports","s","r","window","MutationObserver","WebKitMutationObserver","nodeType","observe","childList","subtree","addEventListener","parentElm","uid","selector","callbacks","setup","bind","bindEvents","prototype","namespace","childNodes","parentNode","removeChild","matches","draggable","gap","getItemsGap","firstElementChild","throttle","call","getDraggableElm","dragstart","saveInitialStyles","source","getInitialState","getBoundingClientRect","elm","idx","getNodeIndex","size","width","height","dataTransfer","effectAllowed","dragStart","afterDragStart","mode","dragover","preventDefault","stopPropagation","hoverDirection","dropEffect","getTargetDirection","directionAwareDragEnter","dragenter","isValidElm","bounding","cleanupLastTarget","abs","toggle","dragend","dragoverTimeout","cleanup","nextElementSibling","insertBefore","dragEnd","isTargetLastChild","lastElementChild","pageY","top","pageX","left","previousSibling","test","setAttribute","getAttribute","removeAttribute","getComputedStyle","parseInt","listeners","destroy","DragSort","n","Symbol","iterator","toString","TypeError","isEnabled","TAGIFY_DEBUG","apply","concat","warn","trim","o","indexOf","DOMParser","parseFromString","body","l","d","c","u","hasOwnProperty","hasInstance","g","next","done","h","p","return","normalize","navigator","userAgent","f","crypto","getRandomValues","Uint8Array","m","contains","classNames","tag","v","tagSelector","getSelection","getRangeAt","createTextNode","deleteContents","insertNode","w","__tagifyTagData","tagElm","y","rangeCount","setStartAfter","collapse","removeAllRanges","addRange","T","before","O","delimiters","pattern","tagTextProp","maxTags","addTagOnBlur","addTagOn","onChangeAfterBlur","duplicates","whitelist","blacklist","enforceWhitelist","userInput","focusable","keepInvalidTags","createInvalidTags","mixTagsAllowedAfter","mixTagsInterpolator","backspace","skipInvalid","pasteAsTags","editTags","clicks","keepInvalid","transformTag","a11y","focusableTags","mixMode","insertAfterTag","autoComplete","enabled","rightKey","tabKey","selectMode","input","focus","tagNoAnimation","tagInvalid","tagNotAllowed","scopeLoading","hasMaxTags","hasNoTags","empty","inputInvalid","dropdown","dropdownWrapper","dropdownHeader","dropdownFooter","dropdownItem","dropdownItemActive","dropdownItemHidden","dropdownItemSelected","dropdownInital","tagText","tagX","tagLoading","tagEditing","tagFlash","tagHide","classname","maxItems","searchKeys","fuzzySearch","caseSensitive","accentedSearch","includeSelectedTags","escapeHTML","highlightFirst","closeOnSelect","clearOnSelect","position","appendTarget","hooks","beforeRemoveTag","beforePaste","suggestionClick","beforeKeyDown","x","defineProperty","enumerable","configurable","writable","D","getOwnPropertySymbols","getOwnPropertyDescriptor","I","getOwnPropertyDescriptors","defineProperties","S","E","M","N","_dropdown","refs","DOM","__tagify","_","A","C","events","onKeyDown","onMouseOver","onMouseLeave","onClick","onScroll","state","hasFocus","composing","dropdownItemActiveSelector","getSuggestionDataByNode","tagify","getAllSuggestionsRefs","getNextOrPrevOption","dropdownItemSelector","highlightOption","hide","ArrowLeft","editing","getMappedValue","autocomplete","tagData","suggestionElm","selectOption","addTags","inputText","raw","charCodeAt","removeTags","editTag","scrollTop","scrollHeight","clientHeight","percentage","round","refilter","query","suggestedListItems","filterListItems","fill","findIndex","ddItemElm","ddItemData","suggest","offsetTop","normalizeTags","onEditTagDone","__isValid","toggleFocusClass","fillHeaderFooter","once","selectAll","suggestions","exact","isTagDuplicate","sortby","mapValueTo","createListHTML","templates","mappedValue","parseTemplate","getHeaderRef","getFooterRef","querySelectorAll","show","dropdownItemNoMatch","isLoading","readonly","dropdownHide__bindEventsTimeout","setStateSelection","render","removeEventListener","selection","flaggedTags","baseOffset","getAppendTarget","cloneNode","cssText","appendChild","dropdownContent","innerHTML","replaceChild","RTL","pageYOffset","fullscreenElement","webkitFullscreenElement","documentElement","max","clientWidth","innerWidth","startContainer","startOffset","createRange","setStart","setEnd","right","bottom","offsetLeft","placeAbove","pageXOffset","k","L","exceed","duplicate","notAllowed","j","wrapper","className","required","placeholder","getAttributes","P","V","F","R","H","B","W","K","U","customBinding","customEventsList","on","mainEvents","main","bindGlobal","isJQueryPlugin","jQuery","originalInput","removeAllTags","keydown","onKeydown","click","onClickScope","dblclick","onDoubleClickScope","paste","onPaste","drop","onDrop","compositionstart","onCompositionStart","compositionend","onCompositionEnd","inputMutationObserver","onInputDOMChange","disconnect","bindOriginaInputListener","clearInterval","originalInputValueObserverInterval","setInterval","observeOriginalInputValue","global","isIE","cb","onWindowKeyDown","onFocusBlur","onClickAnywhere","useCapture","unbindGlobal","textContent","relatedTarget","addNew","postUpdate","triggerChangeEvent","loading","getTagElms","activeElement","hasAttribute","anchorOffset","anchorNode","createElement","innerText","nodeValue","fromCharCode","previousElementSibling","Element","nodeName","min","nextSibling","blur","inputSuggestion","onInput","onMixTagsInput","inputElm","validateTag","toggleScopeValidation","isValid","search","createDocumentFragment","createTagElem","setRangeAtStartEnd","lastChild","withoutChangeEvent","cloneRange","focusNode","endOffset","match","lastIndexOf","prefix","matchedPatternCount","onInputIE","tagifyValue","loadOriginalValues","fixFirefoxLastTagNoCaret","clipboardData","pastedText","injectAtCaret","tagsElems","onEditTagInput","__tagId","editTagChangeDetected","originalIsValid","newValue","onEditTagPaste","onEditTagClick","onEditTagFocus","onEditTagBlur","__originalData","onEditTagkeydown","__originalHTML","editable","addedNodes","outerHTML","replaceWith","removedNodes","q","z","X","J","G","$","Proxy","removeAllCustomListeners","off","cloneData","triggerHandler","cloneEvent","HTMLElement","CustomEvent","detail","dispatchEvent","isFirefox","documentMode","getPersistedData","localStorage","parse","setPersistedData","setItem","Event","clearPersistedData","removeItem","applySettings","build","getCSSVars","autofocus","placeCaretAfterNode","getSetTagData","helpers","sameStr","removeCollectionProp","omit","isObject","parseHTML","extend","concatWithoutDups","getUID","isNodeTag","dataProps","setContentEditable","generateClassSelectors","RegExp","_delimiters","TEXTS","texts","getCustomAttributes","range","CSSVars","tagHideTransition","unit","getPropertyValue","integrated","originalInput_tabIndex","tabIndex","inputSelector","blockChangeEvent","parseMixTags","tagName","insertAdjacentHTML","lastOriginalValueReported","toggleClass","setPlaceholder","bubbles","simulated","_valueTracker","setValue","random","getTagTextNode","tagTextSelector","setTagTextNode","getLastTag","skipValidation","editTagToggleValidity","removeTagsFromValue","previousData","replaceTag","reCheckInvalidTags","getInvalidTagAttrs","updateValueByDOMTags","appendMixTags","validate","substr","replaceTextWithNode","getTagIdx","getTagIndexByValue","getTagElmByValue","flashTag","isTagBlacklisted","isTagWhitelisted","getWhitelistItem","setReadonly","contentEditable","setDisabled","Error","splitText","prepareNewTagNode","__preInvalidData","aggregatedInvalidInput","postProcessNewTagNode","selectTag","appendTag","addEmptyTag","addMixTags","prefixedTextToTag","createNodeIterator","NodeFilter","SHOW_TEXT","nextNode","node","__removed","parseFloat","clientTop","removeTagsFromDOM","setOriginalInputValue","debouncedUpdateTimeout","getInputValue","getCleanValue","getMixedTagsAsString","originalInputValueFormat","removeTag","ApplicationV2","HandlebarsApplicationMixin","applications","api","TagifyApp","super","dragSort","submit","categoryId","subcategoryId","static","resetActions","unselectAllTags","form","closeOnSubmit","handler","minimizable","resizable","_prepareContext","open","dialogType","tags","dialogData","dialogSubmit","prepareHook","dialog","TagifyAppHud","TagifyAppGroup","TagifyAppSubgroup","Hooks","app","html","tagInput","Infinity","onDragEnd","available","Tagify","tagifyInput","dropdownLabelElement","DialogV2","confirm","modal","yes","callback","resetActorData","no","_onKeyDown","close","defaultChoice","buttons","formData","slugify","replacement","strict","object","template","TagifyAppHelper","openEditHudApp","topLabel","choices","callAll","openEditGroupApp","choice","characterCount","customWidth","image","openEditSubgroupApp","getAvailableActionsAsTags","availableGroups","selectedActions","getSelectedActionsAsTags","selectedGroups","_style","updateActions","GroupResizer","minCols","isCustomWidth","spacing","resizeGroup","setVariables","subgroupsElement","setWidth","setHeight","resetVariables","setSubgroupsElement","resetGroupsElements","setSubgroupElementArr","actionsElements","availableHeight","availableWidth","gridWidth","subgroupElementArr","subgroupsElementPadding","subgroupsElementRect","level1GroupElement","groupsElements","maxHeight","overflowY","resetCSS","getGridWidth","emptyStyle","display","gridTemplateColumns","actionWidths","actionWidthsForMedian","actionsElement","actionElements","actionElement","actionRect","actionWidth","actionButtonText","actionButtonTextRect","actionButtonTextWidth","minActionButtonTextWidth","availableactionButtonTextWidth","resizeGrid","groupCustomWidth","assignCSS","squaredCols","sqrt","availableGroupWidth","availableCols","cols","resize","sqrtActions","currentRow","maxRowWidth","rowWidth","maxWidth","getAvailableWidth","windowWidth","screenDimensions","contentLeft","uiRight","uiRightClientWidth","subgroupsElementComputed","paddingLeft","paddingRight","hasGrid","subgroupElement","requestAnimationFrame","getAvailableHeight","windowHeight","innerHeight","contentBottom","contentTop","siblingsHeight","sibling","siblings","siblingHeight","uiTopBottom","uiTopBottomOffsetHeight","offsetHeight","element","elements","TokenActionHud","groupResizer","openGroups","Set","updatePendingTimer","updateTimer","closeTimer","renderTimer","clickGroup","clickSubgroup","clickAction","collapseHud","expandHud","lockHud","unlockHud","editHud","background","zIndex","frame","styleData","context","collapsibleSubgroups","cacheSettings","updateCachedSettings","updateSettingsPending","setPosition","_onRender","cacheElements","setInitialHudState","addHoverEvents","actionArr","tabSubgroupArr","editHudButton","listSubgroupsArr","subgroupsContainerArr","subgroupArr","listSubgroupTitleArr","groupButtonArr","collapseExpandContainer","collapseHudButton","expandHudButton","unlockButton","lockButton","isCollapsed","isUnlocked","toggleGroup","passive","dragEvent","handleActionHover","postRender","rendering","applyDirection","reopenGroups","toggleHudEnable","format","toggleHudCollapse","isCollapsing","toggleHudLock","isUnlocking","toggleElements","hideIfEmpty","bringToFront","currentTarget","handleGroupClick","collapseExpandSubgroup","isOpen","shouldOpen","toggleOtherGroups","delete","groupToIgnore","isParentToIgnore","groupsElement","imageElement","toggleGroupVisibility","parsedLevel","isDraggable","clientX","changedTouches","clientY","pos1","pos2","pos3","pos4","originalElementTop","originalElementLeft","newElementTop","newElementLeft","mouseMoveEvent","topPos","mouseUpEvent","onmousemove","ontouchmove","onmouseup","ontouchend","hudPosition","setDockedPosition","setUndockedPosition","interfaceElement","rightUiElement","leftUiElement","setPositionFromFlag","check","leftPos","obj","bool","resetPosition","copy","fromUserId","toUserIds","copyUserData","fromGroup","resetLayoutWithSocket","resetUserAndActorData","resetAllActorData","resetUserData","resetAllUserData","handleUpdate","performUpdate","isUpdatePending","waitForUpdateCompletion","maxWaitTime","interval","iterations","isUpdating","hasCompleted","initialised","windows","abortUpdate","closeHud","animate","isValidTokenChange","flags","isRelevantToken","isControlledActor","isValidActorOrItemUpdate","registerSocket","socketlib","registerModule","register","isSocketlibActive","getSocket","GenericActionHandler","buildActions","buildUtilities","buildSingleTokenUtilities","buildMultipleTokenUtilities","actionsData","toggleCombatId","toggleCombatName","inCombat","toggleCombatAction","toggleCombatant","toggleVisibilityId","toggleVisibilityName","hidden","toggleVisibilityAction","isHidden","addActions","toggleVisibilityname","CompendiumActionHandler","compendiumActions","packIds","packId","setActions","getIndex","actionType","getCompendiumActionType","entry","_id","function","getOnClick","getGroupId","documentId","getOnClickFunction","getOnClickEntry","journalEntry","getDocument","sheet","execute","isLinkedCompendium","MacroActionHandler","macroActions","getActions","macros","getListName","ownership","actionTypeName","ActionHandler","genericActionHandler","compendiumActionHandler","macroActionHandler","delimiter","actionHandlerExtenders","buildSystemActionsCore","buildGenericActionsCore","buildCompendiumActionsCore","buildMacroActionsCore","buildExtendedActionsCore","updateNonPresetActions","setCharacterLimit","groupIds","buildSystemActions","extender","extendActionHandler","nonPresetActions","nonPresetAction","availableAction","systemSelected","createAction","groupCharacterCount","subgroups","subgroup","subgroupCharacterCount","word","actionData","fullName","infoProps","onHover","encodedValue","icons","icon1","icon2","icon3","isAction","isItem","useRawHtmlName","addToAvailableActions","existingActions","reorderedActions","existingAction","existingActionId","actionClone","addActionHandlerExtender","actionHandlerExtender","ActionHandlerExtender","RollHandler","preRollHandlers","rollHandlerExtenders","throwInvalidValueErr","addRollHandlerExtender","rollHandlerExtender","buttonValue","getButtonValue","prehandleActionEvent","handleActionClick","addPreRollHandler","buttonElement","renderItem","item","isRenderItem","PreRollHandler","RollHandlerExtender","CustomStyleForm","ColorPicker","install","isCustom","resetLayoutDialog","customLayoutElement","userCustomLayoutElement","resetAllLayoutsDialog","executeForEveryone","TahSettingsForm","settingType","Function","isButton","isCheckbox","isFilePicker","isNumber","isRange","isSelect","undefined","TahSettingsFormLayout","onChangeFunction","onDown","registerSettingsCore","rollHandlers","registerMenu","restricted","config","Boolean","styleChoices","fromEntries","onChange","auto","up","down","step","always","whenUnlocked","never","requiresReload","full","nameOnly","none","setTooltipDelay","tooltipDelay","root","both","registerCustomStyleSettings","registerSettings","ItemMacroActionHandlerExtender","itemacro","command","itemMacroSetting","replaceExisting","addGroupActions","existingItemMacroAction","actionToReplace","macroAction","createItemMacroAction","itemMacroIcon","executeMacro","SystemManager","coreModuleId","getActionHandler","getRollHandler","rollHandlerId","getAvailableRollHandlers","registerDefaults","registerStyles","registerDefaultsCore","registerStylesCore","systemStyles","mergeObject","addActionHandlerExtenders","addRollHandlerExtenders","addHandler","registerApi","registerCoreModule","systemModule","loadTemplates","registerHud","migrationManager","checkColorPicker","registerHudHooks","hook","handleHookEvent","hookData","hookName","validateHookData","parent","validateCompendium","hasOwn","compendiumHandler","addContextMenuListener","sendHudToBottom"],"mappings":"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","x_google_ignoreList":[9,10]}
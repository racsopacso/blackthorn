var CFG={id:"actually-private-rolls",SETTINGS:{halfBlind:"halfBlind",allSeeingGM:"allSeeingGM"}};var registerPrivateRollsSettings=()=>{game.settings.register(CFG.id,CFG.SETTINGS.halfBlind,{name:"ActuallyPrivateRolls.Settings.HalfBlind.Label",hint:"ActuallyPrivateRolls.Settings.HalfBlind.Hint",scope:"world",type:Boolean,default:true,requiresReload:true,config:true});game.settings.register(CFG.id,CFG.SETTINGS.allSeeingGM,{name:"ActuallyPrivateRolls.Settings.AllSeeingGM.Label",hint:"ActuallyPrivateRolls.Settings.AllSeeingGM.Hint",scope:"world",type:Boolean,default:false,requiresReload:true,config:true})};Hooks.once("init",registerPrivateRollsSettings);var isMessageVisible=({isBlind,isAuthor,isWhisper,whisper}={})=>{if(isAuthor&&game.user.isGM)return true;if(isBlind&&isAuthor)return false;if(isWhisper)return isAuthor||whisper.includes(game.user.id);return true};var getMessageVisibility=(cm)=>{const whisper=cm.whisper??[],isWhisper=whisper.length>0,isBlind=isWhisper&&cm.blind,isAuthor=cm.isAuthor,isVisible=isMessageVisible({isWhisper,isBlind,isAuthor,whisper});return{whisper,isWhisper,isBlind,isAuthor,isVisible}};function getUserName(cm){const userId=cm._source.user;const user=cm.user??game.data.users.find((i)=>i._id==userId);return user?.name}var renderChatMessageEvent=(cm,[html])=>{if(game.user.isGM&&game.settings.get(CFG.id,CFG.SETTINGS.allSeeingGM))return;const{isAuthor,isVisible}=getMessageVisibility(cm);const baseMsg=html.dataset.messageId?html:html.closest("[data-message-id]");if(game.settings.get(CFG.id,CFG.SETTINGS.halfBlind)&&isAuthor&&!isVisible){baseMsg?.querySelector(".message-content")?.replaceChildren();const header=baseMsg?.querySelector(".message-header");const flavor=header?.querySelector(".flavor-text");if(!flavor){const msg=document.createElement("span");msg.classList.add("flavor-text");const userName=getUserName(cm);msg.textContent=game.i18n.format("ActuallyPrivateRolls.PrivateMessage",{user:userName});header?.append(msg)}}else baseMsg.classList.toggle("actually-private-roll",!isVisible)};Hooks.on("renderChatMessage",renderChatMessageEvent);function chatLogNotifyWrapper(wrapped,cm,options){const{isVisible}=getMessageVisibility(cm);if(!isVisible)return;wrapped.call(this,cm,options)}Hooks.once("init",()=>{libWrapper.register(CFG.id,"CONFIG.ui.chat.prototype.notify",chatLogNotifyWrapper,libWrapper.MIXED)});Hooks.once("ready",()=>{const mod=game.modules.get(CFG.id);console.log("Actually Private Rolls |",mod.version)});

//# debugId=85FC7E82A12CCE8C64756E2164756E21
//# sourceMappingURL=private-rolls.mjs.map

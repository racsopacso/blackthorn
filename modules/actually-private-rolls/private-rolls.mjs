var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});var CFG={id:"actually-private-rolls",SETTINGS:{halfBlind:"halfBlind",allSeeingGM:"allSeeingGM"}};var registerPrivateRollsSettings=__name(()=>{game.settings.register(CFG.id,CFG.SETTINGS.halfBlind,{name:"ActuallyPrivateRolls.Settings.HalfBlind.Label",hint:"ActuallyPrivateRolls.Settings.HalfBlind.Hint",scope:"world",type:Boolean,default:!0,requiresReload:!0,config:!0}),game.settings.register(CFG.id,CFG.SETTINGS.allSeeingGM,{name:"ActuallyPrivateRolls.Settings.AllSeeingGM.Label",hint:"ActuallyPrivateRolls.Settings.AllSeeingGM.Hint",scope:"world",type:Boolean,default:!1,requiresReload:!0,config:!0})},"registerPrivateRollsSettings");Hooks.once("init",registerPrivateRollsSettings);var isMessageVisible=__name(({isBlind,isAuthor,isWhisper,whisper}={})=>isAuthor&&game.user.isGM?!0:isBlind&&isAuthor?!1:isWhisper?isAuthor||whisper.includes(game.user.id):!0,"isMessageVisible"),getMessageVisibility=__name(cm=>{let cmData=game.release.generation>=10?cm:cm.data,whisper=cmData.whisper??[],isWhisper=whisper.length>0,isBlind=isWhisper&&cmData.blind,isAuthor=cm.isAuthor,isVisible=isMessageVisible({isWhisper,isBlind,isAuthor,whisper});return{whisper,isWhisper,isBlind,isAuthor,isVisible}},"getMessageVisibility");function getUserName(cm){let userId=cm._source.user;return(cm.user??game.data.users.find(i=>i._id==userId))?.name}__name(getUserName,"getUserName");var renderChatMessageEvent=__name((cm,[html])=>{if(game.user.isGM&&game.settings.get(CFG.id,CFG.SETTINGS.allSeeingGM))return;let{isAuthor,isVisible}=getMessageVisibility(cm),baseMsg=html.dataset.messageId?html:html.closest("[data-message-id]");if(game.settings.get(CFG.id,CFG.SETTINGS.halfBlind)&&isAuthor&&!isVisible){baseMsg?.querySelector(".message-content")?.replaceChildren();let header=baseMsg?.querySelector(".message-header");if(!header?.querySelector(".flavor-text")){let msg=document.createElement("span");msg.classList.add("flavor-text");let userName=getUserName(cm);msg.textContent=game.i18n.format("ActuallyPrivateRolls.PrivateMessage",{user:userName}),header?.append(msg)}}else baseMsg.classList.toggle("actually-private-roll",!isVisible)},"renderChatMessageEvent");Hooks.on("renderChatMessage",renderChatMessageEvent);function chatLogNotifyWrapper(wrapped,cm){let{isVisible}=getMessageVisibility(cm);isVisible&&wrapped.call(this,cm)}__name(chatLogNotifyWrapper,"chatLogNotifyWrapper");Hooks.once("init",()=>{libWrapper.register(CFG.id,"ChatLog.prototype.notify",chatLogNotifyWrapper,libWrapper.MIXED)});Hooks.once("ready",()=>{let mod=game.modules.get(CFG.id);console.log("Actually Private Rolls |",mod.version)});
//# sourceMappingURL=private-rolls.mjs.map

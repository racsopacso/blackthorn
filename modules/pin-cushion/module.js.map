{"version":3,"file":"module.js","sources":["../../src/scripts/lib/jquery.powertip.js","../../src/scripts/constants.js","../../src/scripts/lib/lib.js","../../src/scripts/settings.js","../../src/scripts/apps/BackgroundlessControlIcon.js","../../src/scripts/apps/PinCushionHUD.js","../../src/scripts/apps/PinCushion.js","../../src/scripts/api.js","../../src/scripts/socket.js","../../src/module.js"],"sourcesContent":["/*!\n PowerTip v1.3.2 (2022-03-06)\n https://stevenbenner.github.io/jquery-powertip/\n Copyright (c) 2022 Steven Benner (https://stevenbenner.com/).\n Released under MIT license.\n https://raw.github.com/stevenbenner/jquery-powertip/master/LICENSE.txt\n*/\n(function (root, factory) {\n  // support loading the plugin via common patterns\n  if (typeof define === \"function\" && define.amd) {\n    // load the plugin as an amd module\n    define([\"jquery\"], factory);\n  } else if (typeof module === \"object\" && module.exports) {\n    // load the plugin as a commonjs module\n    module.exports = factory(require(\"jquery\"));\n  } else {\n    // load the plugin as a global\n    factory(root.jQuery);\n  }\n})(this, function ($) {\n  // useful private variables\n  var $document = $(document),\n    $window = $(window),\n    $body = $(\"body\");\n\n  // constants\n  var DATA_DISPLAYCONTROLLER = \"displayController\",\n    DATA_HASACTIVEHOVER = \"hasActiveHover\",\n    DATA_FORCEDOPEN = \"forcedOpen\",\n    DATA_HASMOUSEMOVE = \"hasMouseMove\",\n    DATA_MOUSEONTOTIP = \"mouseOnToPopup\",\n    DATA_ORIGINALTITLE = \"originalTitle\",\n    DATA_POWERTIP = \"powertip\",\n    DATA_POWERTIPJQ = \"powertipjq\",\n    DATA_POWERTIPTARGET = \"powertiptarget\",\n    EVENT_NAMESPACE = \".powertip\",\n    RAD2DEG = 180 / Math.PI,\n    MOUSE_EVENTS = [\n      \"click\",\n      \"dblclick\",\n      \"mousedown\",\n      \"mouseup\",\n      \"mousemove\",\n      \"mouseover\",\n      \"mouseout\",\n      \"mouseenter\",\n      \"mouseleave\",\n      \"contextmenu\",\n    ];\n\n  /**\n   * Session data\n   * Private properties global to all powerTip instances\n   */\n  var session = {\n    elements: [],\n    tooltips: null,\n    isTipOpen: false,\n    isFixedTipOpen: false,\n    isClosing: false,\n    tipOpenImminent: false,\n    activeHover: null,\n    currentX: 0,\n    currentY: 0,\n    previousX: 0,\n    previousY: 0,\n    desyncTimeout: null,\n    closeDelayTimeout: null,\n    mouseTrackingActive: false,\n    delayInProgress: false,\n    windowWidth: 0,\n    windowHeight: 0,\n    scrollTop: 0,\n    scrollLeft: 0,\n  };\n\n  /**\n   * Collision enumeration\n   * @enum {number}\n   */\n  var Collision = {\n    none: 0,\n    top: 1,\n    bottom: 2,\n    left: 4,\n    right: 8,\n  };\n\n  /**\n   * Display hover tooltips on the matched elements.\n   * @param {(Object|string)=} opts The options object to use for the plugin, or\n   *     the name of a method to invoke on the first matched element.\n   * @param {*=} [arg] Argument for an invoked method (optional).\n   * @return {jQuery} jQuery object for the matched selectors.\n   */\n  $.fn.powerTip = function (opts, arg) {\n    var targetElements = this,\n      options,\n      tipController;\n\n    // don't do any work if there were no matched elements\n    if (!targetElements.length) {\n      return targetElements;\n    }\n\n    // handle api method calls on the plugin, e.g. powerTip('hide')\n    if ($.type(opts) === \"string\" && $.powerTip[opts]) {\n      return $.powerTip[opts].call(targetElements, targetElements, arg);\n    }\n\n    // extend options\n    options = $.extend({}, $.fn.powerTip.defaults, opts);\n\n    // handle repeated powerTip calls on the same element by destroying any\n    // original instance hooked to it and replacing it with this call\n    $.powerTip.destroy(targetElements);\n\n    // instantiate the TooltipController for this instance\n    tipController = new TooltipController(options);\n\n    // hook mouse and viewport dimension tracking\n    initTracking();\n\n    // setup the elements\n    targetElements.each(function elementSetup() {\n      var $this = $(this),\n        dataPowertip = $this.data(DATA_POWERTIP),\n        dataElem = $this.data(DATA_POWERTIPJQ),\n        dataTarget = $this.data(DATA_POWERTIPTARGET),\n        title = $this.attr(\"title\");\n\n      // attempt to use title attribute text if there is no data-powertip,\n      // data-powertipjq or data-powertiptarget. If we do use the title\n      // attribute, delete the attribute so the browser will not show it\n      if (!dataPowertip && !dataTarget && !dataElem && title) {\n        $this.data(DATA_POWERTIP, title);\n        $this.data(DATA_ORIGINALTITLE, title);\n        $this.removeAttr(\"title\");\n      }\n\n      // create hover controllers for each element\n      $this.data(DATA_DISPLAYCONTROLLER, new DisplayController($this, options, tipController));\n    });\n\n    // attach events to matched elements if the manual option is not enabled\n    if (!options.manual) {\n      // attach open events\n      $.each(options.openEvents, function (idx, evt) {\n        if ($.inArray(evt, options.closeEvents) > -1) {\n          // event is in both openEvents and closeEvents, so toggle it\n          targetElements.on(evt + EVENT_NAMESPACE, function elementToggle(event) {\n            $.powerTip.toggle(this, event);\n          });\n        } else {\n          targetElements.on(evt + EVENT_NAMESPACE, function elementOpen(event) {\n            $.powerTip.show(this, event);\n          });\n        }\n      });\n\n      // attach close events\n      $.each(options.closeEvents, function (idx, evt) {\n        if ($.inArray(evt, options.openEvents) < 0) {\n          targetElements.on(evt + EVENT_NAMESPACE, function elementClose(event) {\n            // set immediate to true for any event without mouse info\n            $.powerTip.hide(this, !isMouseEvent(event));\n          });\n        }\n      });\n\n      // attach escape key close event\n      targetElements.on(\"keydown\" + EVENT_NAMESPACE, function elementKeyDown(event) {\n        // always close tooltip when the escape key is pressed\n        if (event.keyCode === 27) {\n          $.powerTip.hide(this, true);\n        }\n      });\n    }\n\n    // remember elements that the plugin is attached to\n    session.elements.push(targetElements);\n\n    return targetElements;\n  };\n\n  /**\n   * Default options for the powerTip plugin.\n   */\n  $.fn.powerTip.defaults = {\n    fadeInTime: 200,\n    fadeOutTime: 100,\n    followMouse: false,\n    popupId: \"powerTip\",\n    popupClass: null,\n    intentSensitivity: 7,\n    intentPollInterval: 100,\n    closeDelay: 100,\n    placement: \"n\",\n    smartPlacement: false,\n    offset: 10,\n    mouseOnToPopup: false,\n    manual: false,\n    openEvents: [\"mouseenter\", \"focus\"],\n    closeEvents: [\"mouseleave\", \"blur\"],\n  };\n\n  /**\n   * Default smart placement priority lists.\n   * The first item in the array is the highest priority, the last is the lowest.\n   * The last item is also the default, which will be used if all previous options\n   * do not fit.\n   */\n  $.fn.powerTip.smartPlacementLists = {\n    n: [\"n\", \"ne\", \"nw\", \"s\"],\n    e: [\"e\", \"ne\", \"se\", \"w\", \"nw\", \"sw\", \"n\", \"s\", \"e\"],\n    s: [\"s\", \"se\", \"sw\", \"n\"],\n    w: [\"w\", \"nw\", \"sw\", \"e\", \"ne\", \"se\", \"n\", \"s\", \"w\"],\n    nw: [\"nw\", \"w\", \"sw\", \"n\", \"s\", \"se\", \"nw\"],\n    ne: [\"ne\", \"e\", \"se\", \"n\", \"s\", \"sw\", \"ne\"],\n    sw: [\"sw\", \"w\", \"nw\", \"s\", \"n\", \"ne\", \"sw\"],\n    se: [\"se\", \"e\", \"ne\", \"s\", \"n\", \"nw\", \"se\"],\n    \"nw-alt\": [\"nw-alt\", \"n\", \"ne-alt\", \"sw-alt\", \"s\", \"se-alt\", \"w\", \"e\"],\n    \"ne-alt\": [\"ne-alt\", \"n\", \"nw-alt\", \"se-alt\", \"s\", \"sw-alt\", \"e\", \"w\"],\n    \"sw-alt\": [\"sw-alt\", \"s\", \"se-alt\", \"nw-alt\", \"n\", \"ne-alt\", \"w\", \"e\"],\n    \"se-alt\": [\"se-alt\", \"s\", \"sw-alt\", \"ne-alt\", \"n\", \"nw-alt\", \"e\", \"w\"],\n  };\n\n  /**\n   * Public API\n   */\n  $.powerTip = {\n    /**\n     * Attempts to show the tooltip for the specified element.\n     * @param {jQuery|Element} element The element to open the tooltip for.\n     * @param {jQuery.Event=} event jQuery event for hover intent and mouse\n     *     tracking (optional).\n     * @return {jQuery|Element} The original jQuery object or DOM Element.\n     */\n    show: function apiShowTip(element, event) {\n      // if we were given a mouse event then run the hover intent testing,\n      // otherwise, simply show the tooltip asap\n      if (isMouseEvent(event)) {\n        trackMouse(event);\n        session.previousX = event.pageX;\n        session.previousY = event.pageY;\n        $(element).data(DATA_DISPLAYCONTROLLER).show();\n      } else {\n        $(element).first().data(DATA_DISPLAYCONTROLLER).show(true, true);\n      }\n      return element;\n    },\n\n    /**\n     * Repositions the tooltip on the element.\n     * @param {jQuery|Element} element The element the tooltip is shown for.\n     * @return {jQuery|Element} The original jQuery object or DOM Element.\n     */\n    reposition: function apiResetPosition(element) {\n      $(element).first().data(DATA_DISPLAYCONTROLLER).resetPosition();\n      return element;\n    },\n\n    /**\n     * Attempts to close any open tooltips.\n     * @param {(jQuery|Element)=} element The element with the tooltip that\n     *     should be closed (optional).\n     * @param {boolean=} immediate Disable close delay (optional).\n     * @return {jQuery|Element|undefined} The original jQuery object or DOM\n     *     Element, if one was specified.\n     */\n    hide: function apiCloseTip(element, immediate) {\n      var displayController;\n\n      // set immediate to true when no element is specified\n      immediate = element ? immediate : true;\n\n      // find the relevant display controller\n      if (element) {\n        displayController = $(element).first().data(DATA_DISPLAYCONTROLLER);\n      } else if (session.activeHover) {\n        displayController = session.activeHover.data(DATA_DISPLAYCONTROLLER);\n      }\n\n      // if found, hide the tip\n      if (displayController) {\n        displayController.hide(immediate);\n      }\n\n      return element;\n    },\n\n    /**\n     * Toggles the tooltip for the specified element. This will open a closed\n     * tooltip, or close an open tooltip.\n     * @param {jQuery|Element} element The element with the tooltip that\n     *     should be toggled.\n     * @param {jQuery.Event=} event jQuery event for hover intent and mouse\n     *     tracking (optional).\n     * @return {jQuery|Element} The original jQuery object or DOM Element.\n     */\n    toggle: function apiToggle(element, event) {\n      if (session.activeHover && session.activeHover.is(element)) {\n        // tooltip for element is active, so close it\n        $.powerTip.hide(element, !isMouseEvent(event));\n      } else {\n        // tooltip for element is not active, so open it\n        $.powerTip.show(element, event);\n      }\n      return element;\n    },\n\n    /**\n     * Destroy and roll back any powerTip() instance on the specified elements.\n     * If no elements are specified then all elements that the plugin is\n     * currently attached to will be rolled back.\n     * @param {(jQuery|Element)=} element The element with the powerTip instance.\n     * @return {jQuery|Element|undefined} The original jQuery object or DOM\n     *     Element, if one was specified.\n     */\n    destroy: function apiDestroy(element) {\n      var $element,\n        foundPowerTip = false,\n        runTipCheck = true,\n        i;\n\n      // if the plugin is not hooked to any elements then there is no point\n      // trying to destroy anything, or dealing with the possible errors\n      if (session.elements.length === 0) {\n        return element;\n      }\n\n      if (element) {\n        // make sure we're working with a jQuery object\n        $element = $(element);\n      } else {\n        // if we are being asked to destroy all instances, then iterate the\n        // array of jQuery objects that we've been tracking and call destroy\n        // for each group\n        $.each(session.elements, function cleanElsTracking(idx, els) {\n          $.powerTip.destroy(els);\n        });\n\n        // reset elements list\n        // if a dev calls .remove() on an element before calling this\n        // destroy() method then jQuery will have deleted all of the .data()\n        // information, so it will not be recognized as a PowerTip element,\n        // which could leave dangling references in this array - causing\n        // future destroy() (no param) invocations to not fully clean up -\n        // so make sure the array is empty and set a flag to skip the\n        // element check before proceeding\n        session.elements = [];\n        runTipCheck = false;\n\n        // set $element to an empty jQuery object to proceed\n        $element = $();\n      }\n\n      // check if PowerTip has been set on any of the elements - if PowerTip\n      // has not been found then return early to skip the slow .not()\n      // operation below - only if we did not reset the elements list above\n      if (runTipCheck) {\n        $element.each(function checkForPowerTip() {\n          var $this = $(this);\n          if ($this.data(DATA_DISPLAYCONTROLLER)) {\n            foundPowerTip = true;\n            return false;\n          }\n          return true;\n        });\n        if (!foundPowerTip) {\n          return element;\n        }\n      }\n\n      // if a tooltip is currently open for an element we are being asked to\n      // destroy then it should be forced to close\n      if (session.isTipOpen && !session.isClosing && $element.filter(session.activeHover).length > 0) {\n        // if the tooltip is waiting to close then cancel that delay timer\n        if (session.delayInProgress) {\n          session.activeHover.data(DATA_DISPLAYCONTROLLER).cancel();\n        }\n        // hide the tooltip, immediately\n        $.powerTip.hide(session.activeHover, true);\n      }\n\n      // unhook events and destroy plugin changes to each element\n      $element.off(EVENT_NAMESPACE).each(function destroy() {\n        var $this = $(this),\n          dataAttributes = [DATA_ORIGINALTITLE, DATA_DISPLAYCONTROLLER, DATA_HASACTIVEHOVER, DATA_FORCEDOPEN];\n\n        // revert title attribute\n        if ($this.data(DATA_ORIGINALTITLE)) {\n          $this.attr(\"title\", $this.data(DATA_ORIGINALTITLE));\n          dataAttributes.push(DATA_POWERTIP);\n        }\n\n        // remove data attributes\n        $this.removeData(dataAttributes);\n      });\n\n      // remove destroyed element from active elements collection\n      for (i = session.elements.length - 1; i >= 0; i--) {\n        session.elements[i] = session.elements[i].not($element);\n\n        // check if there are any more elements left in this collection, if\n        // there is not then remove it from the elements array\n        if (session.elements[i].length === 0) {\n          session.elements.splice(i, 1);\n        }\n      }\n\n      // if there are no active elements left then we will unhook all of the\n      // events that we've bound code to and remove the tooltip elements\n      if (session.elements.length === 0) {\n        $window.off(EVENT_NAMESPACE);\n        $document.off(EVENT_NAMESPACE);\n        session.mouseTrackingActive = false;\n        if (session.tooltips) {\n          session.tooltips.remove();\n          session.tooltips = null;\n        }\n      }\n\n      return element;\n    },\n  };\n\n  // API aliasing\n  // for backwards compatibility with versions earlier than 1.2.0\n  $.powerTip.showTip = $.powerTip.show;\n  $.powerTip.closeTip = $.powerTip.hide;\n\n  /**\n   * Creates a new CSSCoordinates object.\n   * @private\n   * @constructor\n   */\n  function CSSCoordinates() {\n    var me = this;\n\n    // initialize object properties\n    me.top = \"auto\";\n    me.left = \"auto\";\n    me.right = \"auto\";\n    me.bottom = \"auto\";\n\n    /**\n     * Set a property to a value.\n     * @private\n     * @param {string} property The name of the property.\n     * @param {number} value The value of the property.\n     */\n    me.set = function (property, value) {\n      if ($.isNumeric(value)) {\n        me[property] = Math.round(value);\n      }\n    };\n  }\n\n  /**\n   * Creates a new tooltip display controller.\n   * @private\n   * @constructor\n   * @param {jQuery} element The element that this controller will handle.\n   * @param {Object} options Options object containing settings.\n   * @param {TooltipController} tipController The TooltipController object for\n   *     this instance.\n   */\n  function DisplayController(element, options, tipController) {\n    var hoverTimer = null,\n      myCloseDelay = null;\n\n    /**\n     * Begins the process of showing a tooltip.\n     * @private\n     * @param {boolean=} immediate Skip intent testing (optional).\n     * @param {boolean=} forceOpen Ignore cursor position and force tooltip to\n     *     open (optional).\n     */\n    function openTooltip(immediate, forceOpen) {\n      cancelTimer();\n      if (!element.data(DATA_HASACTIVEHOVER)) {\n        if (!immediate) {\n          session.tipOpenImminent = true;\n          hoverTimer = setTimeout(function intentDelay() {\n            hoverTimer = null;\n            checkForIntent();\n          }, options.intentPollInterval);\n        } else {\n          if (forceOpen) {\n            element.data(DATA_FORCEDOPEN, true);\n          }\n          closeAnyDelayed();\n          tipController.showTip(element);\n        }\n      } else {\n        // cursor left and returned to this element, cancel close\n        cancelClose();\n      }\n    }\n\n    /**\n     * Begins the process of closing a tooltip.\n     * @private\n     * @param {boolean=} disableDelay Disable close delay (optional).\n     */\n    function closeTooltip(disableDelay) {\n      // if this instance already has a close delay in progress then halt it\n      if (myCloseDelay) {\n        myCloseDelay = session.closeDelayTimeout = clearTimeout(myCloseDelay);\n        session.delayInProgress = false;\n      }\n      cancelTimer();\n      session.tipOpenImminent = false;\n      if (element.data(DATA_HASACTIVEHOVER)) {\n        element.data(DATA_FORCEDOPEN, false);\n        if (!disableDelay) {\n          session.delayInProgress = true;\n          session.closeDelayTimeout = setTimeout(function closeDelay() {\n            session.closeDelayTimeout = null;\n            tipController.hideTip(element);\n            session.delayInProgress = false;\n            myCloseDelay = null;\n          }, options.closeDelay);\n          // save internal reference close delay id so we can check if the\n          // active close delay belongs to this instance\n          myCloseDelay = session.closeDelayTimeout;\n        } else {\n          tipController.hideTip(element);\n        }\n      }\n    }\n\n    /**\n     * Checks mouse position to make sure that the user intended to hover on the\n     * specified element before showing the tooltip.\n     * @private\n     */\n    function checkForIntent() {\n      // calculate mouse position difference\n      var xDifference = Math.abs(session.previousX - session.currentX),\n        yDifference = Math.abs(session.previousY - session.currentY),\n        totalDifference = xDifference + yDifference;\n\n      // check if difference has passed the sensitivity threshold\n      if (totalDifference < options.intentSensitivity) {\n        cancelClose();\n        closeAnyDelayed();\n        tipController.showTip(element);\n      } else {\n        // try again\n        session.previousX = session.currentX;\n        session.previousY = session.currentY;\n        openTooltip();\n      }\n    }\n\n    /**\n     * Cancels active hover timer.\n     * @private\n     * @param {boolean=} stopClose Cancel any active close delay timer.\n     */\n    function cancelTimer(stopClose) {\n      hoverTimer = clearTimeout(hoverTimer);\n      // cancel the current close delay if the active close delay is for this\n      // element or the stopClose argument is true\n      if ((session.closeDelayTimeout && myCloseDelay === session.closeDelayTimeout) || stopClose) {\n        cancelClose();\n      }\n    }\n\n    /**\n     * Cancels any active close delay timer.\n     * @private\n     */\n    function cancelClose() {\n      session.closeDelayTimeout = clearTimeout(session.closeDelayTimeout);\n      session.delayInProgress = false;\n    }\n\n    /**\n     * Asks any tooltips waiting on their close delay to close now.\n     * @private\n     */\n    function closeAnyDelayed() {\n      // if another element is waiting for its close delay then we should ask\n      // it to close immediately so we can proceed without unexpected timeout\n      // code being run during this tooltip's lifecycle\n      if (session.delayInProgress && session.activeHover && !session.activeHover.is(element)) {\n        session.activeHover.data(DATA_DISPLAYCONTROLLER).hide(true);\n      }\n    }\n\n    /**\n     * Repositions the tooltip on this element.\n     * @private\n     */\n    function repositionTooltip() {\n      tipController.resetPosition(element);\n    }\n\n    // expose the methods\n    this.show = openTooltip;\n    this.hide = closeTooltip;\n    this.cancel = cancelTimer;\n    this.resetPosition = repositionTooltip;\n  }\n\n  /**\n   * Creates a new Placement Calculator.\n   * @private\n   * @constructor\n   */\n  function PlacementCalculator() {\n    /**\n     * Compute the CSS position to display a tooltip at the specified placement\n     * relative to the specified element.\n     * @private\n     * @param {jQuery} element The element that the tooltip should target.\n     * @param {string} placement The placement for the tooltip.\n     * @param {number} tipWidth Width of the tooltip element in pixels.\n     * @param {number} tipHeight Height of the tooltip element in pixels.\n     * @param {number} offset Distance to offset tooltips in pixels.\n     * @return {CSSCoordinates} A CSSCoordinates object with the position.\n     */\n    function computePlacementCoords(element, placement, tipWidth, tipHeight, offset) {\n      var placementBase = placement.split(\"-\")[0], // ignore 'alt' for corners\n        coords = new CSSCoordinates(),\n        position;\n\n      if (isSvgElement(element)) {\n        position = getSvgPlacement(element, placementBase);\n      } else {\n        position = getHtmlPlacement(element, placementBase);\n      }\n\n      // calculate the appropriate x and y position in the document\n      switch (placement) {\n        case \"n\":\n          coords.set(\"left\", position.left - tipWidth / 2);\n          coords.set(\"bottom\", session.windowHeight - position.top + offset);\n          break;\n        case \"e\":\n          coords.set(\"left\", position.left + offset);\n          coords.set(\"top\", position.top - tipHeight / 2);\n          break;\n        case \"s\":\n          coords.set(\"left\", position.left - tipWidth / 2);\n          coords.set(\"top\", position.top + offset);\n          break;\n        case \"w\":\n          coords.set(\"top\", position.top - tipHeight / 2);\n          coords.set(\"right\", session.windowWidth - position.left + offset);\n          break;\n        case \"nw\":\n          coords.set(\"bottom\", session.windowHeight - position.top + offset);\n          coords.set(\"right\", session.windowWidth - position.left - 20);\n          break;\n        case \"nw-alt\":\n          coords.set(\"left\", position.left);\n          coords.set(\"bottom\", session.windowHeight - position.top + offset);\n          break;\n        case \"ne\":\n          coords.set(\"left\", position.left - 20);\n          coords.set(\"bottom\", session.windowHeight - position.top + offset);\n          break;\n        case \"ne-alt\":\n          coords.set(\"bottom\", session.windowHeight - position.top + offset);\n          coords.set(\"right\", session.windowWidth - position.left);\n          break;\n        case \"sw\":\n          coords.set(\"top\", position.top + offset);\n          coords.set(\"right\", session.windowWidth - position.left - 20);\n          break;\n        case \"sw-alt\":\n          coords.set(\"left\", position.left);\n          coords.set(\"top\", position.top + offset);\n          break;\n        case \"se\":\n          coords.set(\"left\", position.left - 20);\n          coords.set(\"top\", position.top + offset);\n          break;\n        case \"se-alt\":\n          coords.set(\"top\", position.top + offset);\n          coords.set(\"right\", session.windowWidth - position.left);\n          break;\n      }\n\n      return coords;\n    }\n\n    /**\n     * Finds the tooltip attachment point in the document for a HTML DOM element\n     * for the specified placement.\n     * @private\n     * @param {jQuery} element The element that the tooltip should target.\n     * @param {string} placement The placement for the tooltip.\n     * @return {Object} An object with the top,left position values.\n     */\n    function getHtmlPlacement(element, placement) {\n      var objectOffset = element.offset(),\n        objectWidth = element.outerWidth(),\n        objectHeight = element.outerHeight(),\n        left,\n        top;\n\n      // calculate the appropriate x and y position in the document\n      switch (placement) {\n        case \"n\":\n          left = objectOffset.left + objectWidth / 2;\n          top = objectOffset.top;\n          break;\n        case \"e\":\n          left = objectOffset.left + objectWidth;\n          top = objectOffset.top + objectHeight / 2;\n          break;\n        case \"s\":\n          left = objectOffset.left + objectWidth / 2;\n          top = objectOffset.top + objectHeight;\n          break;\n        case \"w\":\n          left = objectOffset.left;\n          top = objectOffset.top + objectHeight / 2;\n          break;\n        case \"nw\":\n          left = objectOffset.left;\n          top = objectOffset.top;\n          break;\n        case \"ne\":\n          left = objectOffset.left + objectWidth;\n          top = objectOffset.top;\n          break;\n        case \"sw\":\n          left = objectOffset.left;\n          top = objectOffset.top + objectHeight;\n          break;\n        case \"se\":\n          left = objectOffset.left + objectWidth;\n          top = objectOffset.top + objectHeight;\n          break;\n      }\n\n      return {\n        top: top,\n        left: left,\n      };\n    }\n\n    /**\n     * Finds the tooltip attachment point in the document for a SVG element for\n     * the specified placement.\n     * @private\n     * @param {jQuery} element The element that the tooltip should target.\n     * @param {string} placement The placement for the tooltip.\n     * @return {Object} An object with the top,left position values.\n     */\n    function getSvgPlacement(element, placement) {\n      var svgElement = element.closest(\"svg\")[0],\n        domElement = element[0],\n        point = svgElement.createSVGPoint(),\n        boundingBox = domElement.getBBox(),\n        matrix = domElement.getScreenCTM(),\n        halfWidth = boundingBox.width / 2,\n        halfHeight = boundingBox.height / 2,\n        placements = [],\n        placementKeys = [\"nw\", \"n\", \"ne\", \"e\", \"se\", \"s\", \"sw\", \"w\"],\n        coords,\n        rotation,\n        steps,\n        x;\n\n      /**\n       * Transform and append the current points to the placements list.\n       * @private\n       */\n      function pushPlacement() {\n        placements.push(point.matrixTransform(matrix));\n      }\n\n      // get bounding box corners and midpoints\n      point.x = boundingBox.x;\n      point.y = boundingBox.y;\n      pushPlacement();\n      point.x += halfWidth;\n      pushPlacement();\n      point.x += halfWidth;\n      pushPlacement();\n      point.y += halfHeight;\n      pushPlacement();\n      point.y += halfHeight;\n      pushPlacement();\n      point.x -= halfWidth;\n      pushPlacement();\n      point.x -= halfWidth;\n      pushPlacement();\n      point.y -= halfHeight;\n      pushPlacement();\n\n      // determine rotation\n      if (placements[0].y !== placements[1].y || placements[0].x !== placements[7].x) {\n        rotation = Math.atan2(matrix.b, matrix.a) * RAD2DEG;\n        steps = Math.ceil(((rotation % 360) - 22.5) / 45);\n        if (steps < 1) {\n          steps += 8;\n        }\n        while (steps--) {\n          placementKeys.push(placementKeys.shift());\n        }\n      }\n\n      // find placement\n      for (x = 0; x < placements.length; x++) {\n        if (placementKeys[x] === placement) {\n          coords = placements[x];\n          break;\n        }\n      }\n\n      return {\n        top: coords.y + session.scrollTop,\n        left: coords.x + session.scrollLeft,\n      };\n    }\n\n    // expose methods\n    this.compute = computePlacementCoords;\n  }\n\n  /**\n   * Creates a new tooltip controller.\n   * @private\n   * @constructor\n   * @param {Object} options Options object containing settings.\n   */\n  function TooltipController(options) {\n    var placementCalculator = new PlacementCalculator(),\n      tipElement = $(\"#\" + options.popupId);\n\n    // build and append tooltip div if it does not already exist\n    if (tipElement.length === 0) {\n      tipElement = $(\"<div/>\", { id: options.popupId });\n      // grab body element if it was not populated when the script loaded\n      // note: this hack exists solely for jsfiddle support\n      if ($body.length === 0) {\n        $body = $(\"body\");\n      }\n      $body.append(tipElement);\n      // remember the tooltip elements that the plugin has created\n      session.tooltips = session.tooltips ? session.tooltips.add(tipElement) : tipElement;\n    }\n\n    // hook mousemove for cursor follow tooltips\n    if (options.followMouse) {\n      // only one positionTipOnCursor hook per tooltip element, please\n      if (!tipElement.data(DATA_HASMOUSEMOVE)) {\n        $document.on(\"mousemove\" + EVENT_NAMESPACE, positionTipOnCursor);\n        $window.on(\"scroll\" + EVENT_NAMESPACE, positionTipOnCursor);\n        tipElement.data(DATA_HASMOUSEMOVE, true);\n      }\n    }\n\n    /**\n     * Gives the specified element the active-hover state and queues up the\n     * showTip function.\n     * @private\n     * @param {jQuery} element The element that the tooltip should target.\n     */\n    function beginShowTip(element) {\n      element.data(DATA_HASACTIVEHOVER, true);\n      // show tooltip, asap\n      tipElement.queue(function queueTipInit(next) {\n        showTip(element);\n        next();\n      });\n    }\n\n    /**\n     * Shows the tooltip, as soon as possible.\n     * @private\n     * @param {jQuery} element The element that the tooltip should target.\n     */\n    function showTip(element) {\n      var tipContent;\n\n      // it is possible, especially with keyboard navigation, to move on to\n      // another element with a tooltip during the queue to get to this point\n      // in the code. if that happens then we need to not proceed or we may\n      // have the fadeout callback for the last tooltip execute immediately\n      // after this code runs, causing bugs.\n      if (!element.data(DATA_HASACTIVEHOVER)) {\n        return;\n      }\n\n      // if the tooltip is open and we got asked to open another one then the\n      // old one is still in its fadeOut cycle, so wait and try again\n      if (session.isTipOpen) {\n        if (!session.isClosing) {\n          hideTip(session.activeHover);\n        }\n        tipElement.delay(100).queue(function queueTipAgain(next) {\n          showTip(element);\n          next();\n        });\n        return;\n      }\n\n      // trigger powerTipPreRender event\n      element.trigger(\"powerTipPreRender\");\n\n      // set tooltip content\n      tipContent = getTooltipContent(element);\n      if (tipContent) {\n        tipElement.empty().append(tipContent);\n      } else {\n        // we have no content to display, give up\n        return;\n      }\n\n      // trigger powerTipRender event\n      element.trigger(\"powerTipRender\");\n\n      session.activeHover = element;\n      session.isTipOpen = true;\n\n      tipElement.data(DATA_MOUSEONTOTIP, options.mouseOnToPopup);\n\n      // add custom class to tooltip element\n      tipElement.addClass(options.popupClass);\n\n      // set tooltip position\n      // revert to static placement when the \"force open\" flag was set because\n      // that flag means that we do not have accurate mouse position info\n      if (!options.followMouse || element.data(DATA_FORCEDOPEN)) {\n        positionTipOnElement(element);\n        session.isFixedTipOpen = true;\n      } else {\n        positionTipOnCursor();\n      }\n\n      // close tooltip when clicking anywhere on the page, with the exception\n      // of the tooltip's trigger element and any elements that are within a\n      // tooltip that has 'mouseOnToPopup' option enabled\n      // always enable this feature when the \"force open\" flag is set on a\n      // followMouse tooltip because we reverted to static placement above\n      if (!element.data(DATA_FORCEDOPEN) && !options.followMouse) {\n        $document.on(\"click\" + EVENT_NAMESPACE, function documentClick(event) {\n          var target = event.target;\n          if (target !== element[0]) {\n            if (options.mouseOnToPopup) {\n              if (target !== tipElement[0] && !$.contains(tipElement[0], target)) {\n                $.powerTip.hide();\n              }\n            } else {\n              $.powerTip.hide();\n            }\n          }\n        });\n      }\n\n      // if we want to be able to mouse on to the tooltip then we need to\n      // attach hover events to the tooltip that will cancel a close request\n      // on mouseenter and start a new close request on mouseleave\n      // only hook these listeners if we're not in manual mode\n      if (options.mouseOnToPopup && !options.manual && $.inArray(\"mouseleave\", options.closeEvents) > -1) {\n        tipElement.on(\"mouseenter\" + EVENT_NAMESPACE, function tipMouseEnter() {\n          // check activeHover in case the mouse cursor entered the\n          // tooltip during the fadeOut and close cycle\n          if (session.activeHover) {\n            session.activeHover.data(DATA_DISPLAYCONTROLLER).cancel();\n          }\n        });\n        tipElement.on(\"mouseleave\" + EVENT_NAMESPACE, function tipMouseLeave() {\n          // check activeHover in case the mouse cursor left the tooltip\n          // during the fadeOut and close cycle\n          if (session.activeHover) {\n            session.activeHover.data(DATA_DISPLAYCONTROLLER).hide();\n          }\n        });\n      }\n\n      // fadein\n      tipElement.fadeIn(options.fadeInTime, function fadeInCallback() {\n        // start desync polling\n        if (!session.desyncTimeout) {\n          session.desyncTimeout = setInterval(closeDesyncedTip, 500);\n        }\n\n        // trigger powerTipOpen event\n        element.trigger(\"powerTipOpen\");\n      });\n    }\n\n    /**\n     * Hides the tooltip.\n     * @private\n     * @param {jQuery} element The element that the tooltip should target.\n     */\n    function hideTip(element) {\n      // reset session\n      session.isClosing = true;\n      session.isTipOpen = false;\n\n      // stop desync polling\n      session.desyncTimeout = clearInterval(session.desyncTimeout);\n\n      // reset element state\n      element.data(DATA_HASACTIVEHOVER, false);\n      element.data(DATA_FORCEDOPEN, false);\n\n      // remove document click handler\n      $document.off(\"click\" + EVENT_NAMESPACE);\n\n      // unbind the mouseOnToPopup events if they were set\n      tipElement.off(EVENT_NAMESPACE);\n\n      // fade out\n      tipElement.fadeOut(options.fadeOutTime, function fadeOutCallback() {\n        var coords = new CSSCoordinates();\n\n        // reset session and tooltip element\n        session.activeHover = null;\n        session.isClosing = false;\n        session.isFixedTipOpen = false;\n        tipElement.removeClass();\n\n        // support mouse-follow and fixed position tips at the same time by\n        // moving the tooltip to the last cursor location after it is hidden\n        coords.set(\"top\", session.currentY + options.offset);\n        coords.set(\"left\", session.currentX + options.offset);\n        tipElement.css(coords);\n\n        // trigger powerTipClose event\n        element.trigger(\"powerTipClose\");\n      });\n    }\n\n    /**\n     * Moves the tooltip to the user's mouse cursor.\n     * @private\n     */\n    function positionTipOnCursor() {\n      var tipWidth, tipHeight, coords, collisions, collisionCount;\n\n      // to support having fixed tooltips on the same page as cursor tooltips,\n      // where both instances are referencing the same tooltip element, we\n      // need to keep track of the mouse position constantly, but we should\n      // only set the tip location if a fixed tip is not currently open, a tip\n      // open is imminent or active, and the tooltip element in question does\n      // have a mouse-follow using it.\n      if (\n        !session.isFixedTipOpen &&\n        (session.isTipOpen || (session.tipOpenImminent && tipElement.data(DATA_HASMOUSEMOVE)))\n      ) {\n        // grab measurements\n        tipWidth = tipElement.outerWidth();\n        tipHeight = tipElement.outerHeight();\n        coords = new CSSCoordinates();\n\n        // grab collisions\n        coords.set(\"top\", session.currentY + options.offset);\n        coords.set(\"left\", session.currentX + options.offset);\n        collisions = getViewportCollisions(coords, tipWidth, tipHeight);\n\n        // handle tooltip view port collisions\n        if (collisions !== Collision.none) {\n          collisionCount = countFlags(collisions);\n          if (collisionCount === 1) {\n            // if there is only one collision (bottom or right) then\n            // simply constrain the tooltip to the view port\n            if (collisions === Collision.right) {\n              coords.set(\"left\", session.scrollLeft + session.windowWidth - tipWidth);\n            } else if (collisions === Collision.bottom) {\n              coords.set(\"top\", session.scrollTop + session.windowHeight - tipHeight);\n            }\n          } else {\n            // if the tooltip has more than one collision then it is\n            // trapped in the corner and should be flipped to get it out\n            // of the user's way\n            coords.set(\"left\", session.currentX - tipWidth - options.offset);\n            coords.set(\"top\", session.currentY - tipHeight - options.offset);\n          }\n        }\n\n        // position the tooltip\n        tipElement.css(coords);\n      }\n    }\n\n    /**\n     * Sets the tooltip to the correct position relative to the specified target\n     * element. Based on options settings.\n     * @private\n     * @param {jQuery} element The element that the tooltip should target.\n     */\n    function positionTipOnElement(element) {\n      var priorityList, finalPlacement;\n\n      // when the followMouse option is enabled and the \"force open\" flag is\n      // set we revert to static positioning. since the developer may not have\n      // considered this scenario we should use smart placement\n      if (options.smartPlacement || (options.followMouse && element.data(DATA_FORCEDOPEN))) {\n        priorityList = $.fn.powerTip.smartPlacementLists[options.placement];\n\n        // iterate over the priority list and use the first placement option\n        // that does not collide with the view port. if they all collide\n        // then the last placement in the list will be used.\n        $.each(priorityList, function (idx, pos) {\n          // place tooltip and find collisions\n          var collisions = getViewportCollisions(\n            placeTooltip(element, pos),\n            tipElement.outerWidth(),\n            tipElement.outerHeight()\n          );\n\n          // update the final placement variable\n          finalPlacement = pos;\n\n          // break if there were no collisions\n          return collisions !== Collision.none;\n        });\n      } else {\n        // if we're not going to use the smart placement feature then just\n        // compute the coordinates and do it\n        placeTooltip(element, options.placement);\n        finalPlacement = options.placement;\n      }\n\n      // add placement as class for CSS arrows\n      tipElement.removeClass(\"w nw sw e ne se n s w se-alt sw-alt ne-alt nw-alt\");\n      tipElement.addClass(finalPlacement);\n    }\n\n    /**\n     * Sets the tooltip position to the appropriate values to show the tip at\n     * the specified placement. This function will iterate and test the tooltip\n     * to support elastic tooltips.\n     * @private\n     * @param {jQuery} element The element that the tooltip should target.\n     * @param {string} placement The placement for the tooltip.\n     * @return {CSSCoordinates} A CSSCoordinates object with the top, left, and\n     *     right position values.\n     */\n    function placeTooltip(element, placement) {\n      var iterationCount = 0,\n        tipWidth,\n        tipHeight,\n        coords = new CSSCoordinates();\n\n      // set the tip to 0,0 to get the full expanded width\n      coords.set(\"top\", 0);\n      coords.set(\"left\", 0);\n      tipElement.css(coords);\n\n      // to support elastic tooltips we need to check for a change in the\n      // rendered dimensions after the tooltip has been positioned\n      do {\n        // grab the current tip dimensions\n        tipWidth = tipElement.outerWidth();\n        tipHeight = tipElement.outerHeight();\n\n        // get placement coordinates\n        coords = placementCalculator.compute(element, placement, tipWidth, tipHeight, options.offset);\n\n        // place the tooltip\n        tipElement.css(coords);\n      } while (\n        // sanity check: limit to 5 iterations, and...\n        ++iterationCount <= 5 &&\n        // try again if the dimensions changed after placement\n        (tipWidth !== tipElement.outerWidth() || tipHeight !== tipElement.outerHeight())\n      );\n\n      return coords;\n    }\n\n    /**\n     * Checks for a tooltip desync and closes the tooltip if one occurs.\n     * @private\n     */\n    function closeDesyncedTip() {\n      var isDesynced = false,\n        hasDesyncableCloseEvent =\n          $.grep([\"mouseleave\", \"mouseout\", \"blur\", \"focusout\"], function (eventType) {\n            return $.inArray(eventType, options.closeEvents) !== -1;\n          }).length > 0;\n\n      // It is possible for the mouse cursor to leave an element without\n      // firing the mouseleave or blur event. This most commonly happens when\n      // the element is disabled under mouse cursor. If this happens it will\n      // result in a desynced tooltip because the tooltip was never asked to\n      // close. So we should periodically check for a desync situation and\n      // close the tip if such a situation arises.\n      if (session.isTipOpen && !session.isClosing && !session.delayInProgress && hasDesyncableCloseEvent) {\n        if (session.activeHover.data(DATA_HASACTIVEHOVER) === false || session.activeHover.is(\":disabled\")) {\n          // user moused onto another tip or active hover is disabled\n          isDesynced = true;\n        } else if (\n          !isMouseOver(session.activeHover) &&\n          !session.activeHover.is(\":focus\") &&\n          !session.activeHover.data(DATA_FORCEDOPEN)\n        ) {\n          // hanging tip - have to test if mouse position is not over the\n          // active hover and not over a tooltip set to let the user\n          // interact with it.\n          // for keyboard navigation: this only counts if the element does\n          // not have focus.\n          // for tooltips opened via the api: we need to check if it has\n          // the forcedOpen flag.\n          if (tipElement.data(DATA_MOUSEONTOTIP)) {\n            if (!isMouseOver(tipElement)) {\n              isDesynced = true;\n            }\n          } else {\n            isDesynced = true;\n          }\n        }\n\n        if (isDesynced) {\n          // close the desynced tip\n          hideTip(session.activeHover);\n        }\n      }\n    }\n\n    // expose methods\n    this.showTip = beginShowTip;\n    this.hideTip = hideTip;\n    this.resetPosition = positionTipOnElement;\n  }\n\n  /**\n   * Determine whether a jQuery object is an SVG element\n   * @private\n   * @param {jQuery} element The element to check\n   * @return {boolean} Whether this is an SVG element\n   */\n  function isSvgElement(element) {\n    return Boolean(window.SVGElement && element[0] instanceof SVGElement);\n  }\n\n  /**\n   * Determines if the specified jQuery.Event object has mouse data.\n   * @private\n   * @param {jQuery.Event=} event The jQuery.Event object to test.\n   * @return {boolean} True if there is mouse data, otherwise false.\n   */\n  function isMouseEvent(event) {\n    return Boolean(event && $.inArray(event.type, MOUSE_EVENTS) > -1 && typeof event.pageX === \"number\");\n  }\n\n  /**\n   * Initializes the viewport dimension cache and hooks up the mouse position\n   * tracking and viewport dimension tracking events.\n   * Prevents attaching the events more than once.\n   * @private\n   */\n  function initTracking() {\n    if (!session.mouseTrackingActive) {\n      session.mouseTrackingActive = true;\n\n      // grab the current viewport dimensions on load\n      getViewportDimensions();\n      $(getViewportDimensions);\n\n      // hook mouse move tracking\n      $document.on(\"mousemove\" + EVENT_NAMESPACE, trackMouse);\n\n      // hook viewport dimensions tracking\n      $window.on(\"resize\" + EVENT_NAMESPACE, trackResize);\n      $window.on(\"scroll\" + EVENT_NAMESPACE, trackScroll);\n    }\n  }\n\n  /**\n   * Updates the viewport dimensions cache.\n   * @private\n   */\n  function getViewportDimensions() {\n    session.scrollLeft = $window.scrollLeft();\n    session.scrollTop = $window.scrollTop();\n    session.windowWidth = $window.width();\n    session.windowHeight = $window.height();\n  }\n\n  /**\n   * Updates the window size info in the viewport dimensions cache.\n   * @private\n   */\n  function trackResize() {\n    session.windowWidth = $window.width();\n    session.windowHeight = $window.height();\n  }\n\n  /**\n   * Updates the scroll offset info in the viewport dimensions cache.\n   * @private\n   */\n  function trackScroll() {\n    var x = $window.scrollLeft(),\n      y = $window.scrollTop();\n    if (x !== session.scrollLeft) {\n      session.currentX += x - session.scrollLeft;\n      session.scrollLeft = x;\n    }\n    if (y !== session.scrollTop) {\n      session.currentY += y - session.scrollTop;\n      session.scrollTop = y;\n    }\n  }\n\n  /**\n   * Saves the current mouse coordinates to the session object.\n   * @private\n   * @param {jQuery.Event} event The mousemove event for the document.\n   */\n  function trackMouse(event) {\n    session.currentX = event.pageX;\n    session.currentY = event.pageY;\n  }\n\n  /**\n   * Tests if the mouse is currently over the specified element.\n   * @private\n   * @param {jQuery} element The element to check for hover.\n   * @return {boolean} True if the mouse is over the element, otherwise false.\n   */\n  function isMouseOver(element) {\n    // use getBoundingClientRect() because jQuery's width() and height()\n    // methods do not work with SVG elements\n    // compute width/height because those properties do not exist on the object\n    // returned by getBoundingClientRect() in older versions of IE\n    var elementPosition = element.offset(),\n      elementBox = element[0].getBoundingClientRect(),\n      elementWidth = elementBox.right - elementBox.left,\n      elementHeight = elementBox.bottom - elementBox.top;\n\n    return (\n      session.currentX >= elementPosition.left &&\n      session.currentX <= elementPosition.left + elementWidth &&\n      session.currentY >= elementPosition.top &&\n      session.currentY <= elementPosition.top + elementHeight\n    );\n  }\n\n  /**\n   * Fetches the tooltip content from the specified element's data attributes.\n   * @private\n   * @param {jQuery} element The element to get the tooltip content for.\n   * @return {(string|jQuery|undefined)} The text/HTML string, jQuery object, or\n   *     undefined if there was no tooltip content for the element.\n   */\n  function getTooltipContent(element) {\n    var tipText = element.data(DATA_POWERTIP),\n      tipObject = element.data(DATA_POWERTIPJQ),\n      tipTarget = element.data(DATA_POWERTIPTARGET),\n      targetElement,\n      content;\n\n    if (tipText) {\n      if ($.isFunction(tipText)) {\n        tipText = tipText.call(element[0]);\n      }\n      content = tipText;\n    } else if (tipObject) {\n      if ($.isFunction(tipObject)) {\n        tipObject = tipObject.call(element[0]);\n      }\n      if (tipObject.length > 0) {\n        content = tipObject.clone(true, true);\n      }\n    } else if (tipTarget) {\n      targetElement = $(\"#\" + tipTarget);\n      if (targetElement.length > 0) {\n        content = targetElement.html();\n      }\n    }\n\n    return content;\n  }\n\n  /**\n   * Finds any viewport collisions that an element (the tooltip) would have if it\n   * were absolutely positioned at the specified coordinates.\n   * @private\n   * @param {CSSCoordinates} coords Coordinates for the element.\n   * @param {number} elementWidth Width of the element in pixels.\n   * @param {number} elementHeight Height of the element in pixels.\n   * @return {number} Value with the collision flags.\n   */\n  function getViewportCollisions(coords, elementWidth, elementHeight) {\n    var viewportTop = session.scrollTop,\n      viewportLeft = session.scrollLeft,\n      viewportBottom = viewportTop + session.windowHeight,\n      viewportRight = viewportLeft + session.windowWidth,\n      collisions = Collision.none;\n\n    if (coords.top < viewportTop || Math.abs(coords.bottom - session.windowHeight) - elementHeight < viewportTop) {\n      collisions |= Collision.top;\n    }\n    if (\n      coords.top + elementHeight > viewportBottom ||\n      Math.abs(coords.bottom - session.windowHeight) > viewportBottom\n    ) {\n      collisions |= Collision.bottom;\n    }\n    if (coords.left < viewportLeft || coords.right + elementWidth > viewportRight) {\n      collisions |= Collision.left;\n    }\n    if (coords.left + elementWidth > viewportRight || coords.right < viewportLeft) {\n      collisions |= Collision.right;\n    }\n\n    return collisions;\n  }\n\n  /**\n   * Counts the number of bits set on a flags value.\n   * @param {number} value The flags value.\n   * @return {number} The number of bits that have been set.\n   */\n  function countFlags(value) {\n    var count = 0;\n    while (value) {\n      value &= value - 1;\n      count++;\n    }\n    return count;\n  }\n\n  // return api for commonjs and amd environments\n  return $.powerTip;\n});\n","const CONSTANTS = {\n  MODULE_ID: \"pin-cushion\",\n  PATH: `modules/pin-cushion/`,\n  MODULE_TITLE: \"Pin Cushion\",\n  PATH_TRANSPARENT: `modules/pin-cushion/assets/transparent.png`,\n  PATH_PDF_THUMBNAIL: `modules/pin-cushion/assets/file-pdf-solid.svg`,\n  FLAGS: {\n    USE_PIN_REVEALED: \"usePinIsRevealed\",\n    PIN_IS_REVEALED: \"pinIsRevealed\",\n    PIN_GM_TEXT: \"gmNote\",\n    HAS_BACKGROUND: \"hasBackground\",\n    RATIO_WIDTH: \"ratio\",\n    TEXT_ALWAYS_VISIBLE: \"textAlwaysVisible\",\n    PLAYER_ICON_STATE: \"PlayerIconState\",\n    PLAYER_ICON_PATH: \"PlayerIconPath\",\n    CUSHION_ICON: \"cushionIcon\",\n    SHOW_IMAGE: \"showImage\",\n    SHOW_IMAGE_EXPLICIT_SOURCE: \"showImageExplicitSource\",\n    HIDE_LABEL: \"hideLabel\",\n    DO_NOT_SHOW_JOURNAL_PREVIEW: \"doNotShowJournalPreview\",\n    TOOLTIP_PLACEMENT: \"tooltipPlacement\",\n    TOOLTIP_COLOR: \"tooltipColor\",\n    TOOLTIP_FORCE_REMOVE: \"tooltipForceRemove\",\n    TOOLTIP_SMART_PLACEMENT: \"tooltipSmartPlacement\",\n    TOOLTIP_FOLLOW_MOUSE: \"tooltipFollowMouse\",\n    PREVIEW_AS_TEXT_SNIPPET: \"previewAsTextSnippet\",\n    ABOVE_FOG: \"aboveFog\",\n    SHOW_ONLY_TO_GM: \"showOnlyToGM\",\n    PIN_IS_TRANSPARENT: \"pinIsTransparent\",\n    JAL_ANCHOR: \"anchor\",\n    NUMBER_WS_SUFFIX_ON_NAMEPLATE: \"numberWsSuffixOnNameplate\",\n    TOOLTIP_CUSTOM_DESCRIPTION: \"tooltipCustomDescription\",\n    TOOLTIP_SHOW_DESCRIPTION: \"tooltipShowDescription\",\n    TOOLTIP_SHOW_TITLE: \"tooltipShowTitle\",\n  },\n};\nCONSTANTS.PATH = `modules/${CONSTANTS.MODULE_ID}/`;\nCONSTANTS.PATH_TRANSPARENT = `modules/${CONSTANTS.MODULE_ID}/assets/transparent.png`;\nexport default CONSTANTS;\n","import CONSTANTS from \"../constants.js\";\n// =============================\n// Module Generic function\n// =============================\nexport async function getToken(documentUuid) {\n  const document = await fromUuid(documentUuid);\n  //@ts-ignore\n  return document?.token ?? document;\n}\nexport function getOwnedTokens(priorityToControlledIfGM) {\n  const gm = game.user?.isGM;\n  if (gm) {\n    if (priorityToControlledIfGM) {\n      const arr = canvas.tokens?.controlled;\n      if (arr && arr.length > 0) {\n        return arr;\n      } else {\n        return canvas.tokens?.placeables;\n      }\n    } else {\n      return canvas.tokens?.placeables;\n    }\n  }\n  if (priorityToControlledIfGM) {\n    const arr = canvas.tokens?.controlled;\n    if (arr && arr.length > 0) {\n      return arr;\n    }\n  }\n  let ownedTokens = canvas.tokens?.placeables.filter((token) => token.isOwner && (!token.document.hidden || gm));\n  if (ownedTokens.length === 0 || !canvas.tokens?.controlled[0]) {\n    ownedTokens = canvas.tokens?.placeables.filter(\n      (token) => (token.observer || token.isOwner) && (!token.document.hidden || gm)\n    );\n  }\n  return ownedTokens;\n}\nexport function is_UUID(inId) {\n  return typeof inId === \"string\" && (inId.match(/\\./g) || []).length && !inId.endsWith(\".\");\n}\nexport function getUuid(target) {\n  // If it's an actor, get its TokenDocument\n  // If it's a token, get its Document\n  // If it's a TokenDocument, just use it\n  // Otherwise fail\n  const document = getDocument(target);\n  return document?.uuid ?? false;\n}\nexport function getDocument(target) {\n  if (target instanceof foundry.abstract.Document) return target;\n  return target?.document;\n}\nexport function isRealNumber(inNumber) {\n  return !isNaN(inNumber) && typeof inNumber === \"number\" && isFinite(inNumber);\n}\nexport function isGMConnected() {\n  return !!Array.from(game.users).find((user) => user.isGM && user.active);\n}\nexport function isGMConnectedAndSocketLibEnable() {\n  return isGMConnected(); // && !game.settings.get(CONSTANTS.MODULE_ID, 'doNotUseSocketLibFeature');\n}\nexport function wait(ms) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\nexport function isActiveGM(user) {\n  return user.active && user.isGM;\n}\nexport function getActiveGMs() {\n  return game.users?.filter(isActiveGM);\n}\nexport function isResponsibleGM() {\n  if (!game.user?.isGM) return false;\n  return !getActiveGMs()?.some((other) => other.document._id < game.user?.document._id);\n}\n// ================================\n// Logger utility\n// ================================\n// export let debugEnabled = 0;\n// 0 = none, warnings = 1, debug = 2, all = 3\nexport function debug(msg, args = \"\") {\n  //if (game.settings.get(CONSTANTS.MODULE_ID, 'debug')) {\n  console.log(`DEBUG | ${CONSTANTS.MODULE_ID} | ${msg}`, args);\n  //}\n  return msg;\n}\nexport function log(message) {\n  message = `${CONSTANTS.MODULE_ID} | ${message}`;\n  console.log(message.replace(\"<br>\", \"\\n\"));\n  return message;\n}\nexport function notify(message) {\n  message = `${CONSTANTS.MODULE_ID} | ${message}`;\n  ui.notifications?.notify(message);\n  console.log(message.replace(\"<br>\", \"\\n\"));\n  return message;\n}\nexport function info(info, notify = false) {\n  info = `${CONSTANTS.MODULE_ID} | ${info}`;\n  if (notify) ui.notifications?.info(info);\n  console.log(info.replace(\"<br>\", \"\\n\"));\n  return info;\n}\nexport function warn(warning, notify = false) {\n  warning = `${CONSTANTS.MODULE_ID} | ${warning}`;\n  if (notify) ui.notifications?.warn(warning);\n  console.warn(warning.replace(\"<br>\", \"\\n\"));\n  return warning;\n}\nexport function error(error, notify = true) {\n  error = `${CONSTANTS.MODULE_ID} | ${error}`;\n  if (notify) ui.notifications?.error(error);\n  return new Error(error.replace(\"<br>\", \"\\n\"));\n}\nexport function timelog(message) {\n  warn(Date.now(), message);\n}\nexport const i18n = (key) => {\n  return game.i18n.localize(key)?.trim();\n};\nexport const i18nFormat = (key, data = {}) => {\n  return game.i18n.format(key, data)?.trim();\n};\n// export const setDebugLevel = (debugText: string): void => {\n//   debugEnabled = { none: 0, warn: 1, debug: 2, all: 3 }[debugText] || 0;\n//   // 0 = none, warnings = 1, debug = 2, all = 3\n//   if (debugEnabled >= 3) CONFIG.debug.hooks = true;\n// };\nexport function dialogWarning(message, icon = \"fas fa-exclamation-triangle\") {\n  return `<p class=\"${CONSTANTS.MODULE_ID}-dialog\">\n        <i style=\"font-size:3rem;\" class=\"${icon}\"></i><br><br>\n        <strong style=\"font-size:1.2rem;\">${CONSTANTS.MODULE_ID}</strong>\n        <br><br>${message}\n    </p>`;\n}\n// =================================================================================\n\nexport function isPlacementVertical(tooltipPlacement) {\n  // n, e, s, w, nw, ne, sw, se, nw-alt, ne-alt, sw-alt\n  const arr = [\"n\", \"s\", \"nw\", \"ne\", \"sw\", \"se\", \"nw-alt\", \"ne-alt\", \"sw-alt\"];\n  if (arr.includes(tooltipPlacement)) {\n    return true;\n  } else {\n    return false;\n  }\n}\n/*\nfunction getOffsetSum(elem) {\n    let top=0, left=0\n    while(elem) {\n        top = top + parseInt(elem.offsetTop)\n        left = left + parseInt(elem.offsetLeft)\n        elem = elem.offsetParent\n    }\n\n    return {top: top, left: left}\n}\n\n\nfunction getOffsetRect(elem) {\n    let box = elem.getBoundingClientRect()\n\n    let body = document.body\n    let docElem = document.documentElement\n\n    let scrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop\n    let scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft\n\n    let clientTop = docElem.clientTop || body.clientTop || 0\n    let clientLeft = docElem.clientLeft || body.clientLeft || 0\n\n    let top  = box.top +  scrollTop - clientTop\n    let left = box.left + scrollLeft - clientLeft\n\n    return { top: Math.round(top), left: Math.round(left) }\n}\n\n\nexport function getOffset(elem) {\n    if (elem.getBoundingClientRect) {\n        return getOffsetRect(elem)\n    } else {\n        return getOffsetSum(elem)\n    }\n}\n*/\n\nexport function stripQueryStringAndHashFromPath(url) {\n  let myUrl = url;\n  if (!myUrl) {\n    return myUrl;\n  }\n  if (myUrl.includes(\"?\")) {\n    myUrl = myUrl.split(\"?\")[0];\n  }\n  if (myUrl.includes(\"#\")) {\n    myUrl = myUrl.split(\"#\")[0];\n  }\n  return myUrl;\n}\n\nexport function isAlt() {\n  // check if Alt and only Alt is being pressed during the drop event.\n  const alts = new Set([\"Alt\", \"AltLeft\"]);\n  return game.keyboard?.downKeys.size === 1 && game.keyboard.downKeys.intersects(alts);\n}\n\nexport function retrieveFirstImageFromJournalId(id, pageId, noDefault) {\n  const journalEntry = game.journal.get(id);\n  let firstImage = undefined;\n  if (!journalEntry) {\n    return firstImage;\n  }\n  // Support old data image\n  // if (journalEntry?.data?.img) {\n  // \treturn stripQueryStringAndHashFromPath(journalEntry?.data?.img);\n  // }\n  // Support new image type journal\n  if (journalEntry?.pages.size > 0) {\n    const sortedArray = journalEntry.pages.contents.sort((a, b) => a.sort - b.sort);\n    if (pageId) {\n      const pageSelected = sortedArray.find((page) => page.id === pageId);\n      if (pageSelected) {\n        if (pageSelected.type === \"image\" && pageSelected.src) {\n          firstImage = stripQueryStringAndHashFromPath(pageSelected.src);\n        }\n        // this should manage all MJE type\n        else if (pageSelected.src) {\n          firstImage = stripQueryStringAndHashFromPath(pageSelected.src);\n        }\n      }\n    }\n    // const shouldCheckForDefault = !noDefault && pageId?.length > 0;\n    if (!noDefault && !firstImage) {\n      for (const pageEntry of sortedArray) {\n        if (pageEntry.type === \"image\" && pageEntry.src) {\n          firstImage = stripQueryStringAndHashFromPath(pageEntry.src);\n          break;\n        } else if (pageEntry.src && pageEntry.type === \"pdf\") {\n          firstImage = stripQueryStringAndHashFromPath(pageEntry.src);\n          break;\n        }\n        // this should manage all MJE type\n        else if (pageEntry.src) {\n          firstImage = stripQueryStringAndHashFromPath(pageEntry.src);\n          break;\n        }\n      }\n    }\n  }\n  return firstImage;\n}\n\nexport function retrieveFirstTextFromJournalId(id, pageId, noDefault) {\n  const journalEntry = game.journal.get(id);\n  let firstText = undefined;\n  if (!journalEntry) {\n    return firstText;\n  }\n  // Support old data image\n  // if (journalEntry?.data?.img) {\n  // \treturn stripQueryStringAndHashFromPath(journalEntry?.data?.img);\n  // }\n  // Support new image type journal\n  if (journalEntry?.pages.size > 0) {\n    const sortedArray = journalEntry.pages.contents.sort((a, b) => a.sort - b.sort);\n    if (pageId) {\n      const pageSelected = sortedArray.find((page) => page.id === pageId);\n      if (pageSelected) {\n        if (pageSelected.type === \"text\" && pageSelected.text?.content) {\n          firstText = pageSelected.text?.content;\n        }\n        // this should manage all MJE type\n        else if (pageSelected.text?.content) {\n          firstText = pageSelected.text?.content;\n        }\n      }\n    }\n    // const shouldCheckForDefault = !noDefault && pageId?.length > 0;\n    if (!noDefault && !firstText) {\n      for (const journalEntry of sortedArray) {\n        if (journalEntry.type === \"text\" && journalEntry.text?.content) {\n          firstText = journalEntry.text?.content;\n          break;\n        }\n        // this should manage all MJE type\n        else if (journalEntry.text?.content) {\n          firstText = journalEntry.text?.content;\n          break;\n        }\n      }\n    }\n  }\n  return firstText;\n}\n","import { PinCushion } from \"./apps/PinCushion.js\";\nimport CONSTANTS from \"./constants.js\";\nimport { i18n } from \"./lib/lib.js\";\n\nexport const registerSettings = function () {\n  game.settings.registerMenu(CONSTANTS.MODULE_ID, \"resetAllSettings\", {\n    name: `pin-cushion.SETTINGS.reset.name`,\n    hint: `pin-cushion.SETTINGS.reset.hint`,\n    icon: \"fas fa-coins\",\n    type: ResetSettingsDialog,\n    restricted: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"forceToShowNotes\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.forceToShowNotesN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.forceToShowNotesH`),\n    scope: \"world\",\n    config: true,\n    default: true,\n    type: Boolean,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"previewMaxLength\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.PreviewMaxLengthN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.PreviewMaxLengthH`),\n    scope: \"world\",\n    type: Number,\n    default: 500,\n    config: true,\n    onChange: (s) => {},\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"previewDelay\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.PreviewDelayN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.PreviewDelayH`),\n    scope: \"world\",\n    type: Number,\n    default: 500,\n    config: true,\n    onChange: (s) => {},\n    //@ts-ignore\n    range: { min: 100, max: 3000, step: 100 }, // bug https://github.com/p4535992/foundryvtt-pin-cushion/issues/18\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"defaultJournalPermission\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.DefaultJournalPermissionN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.DefaultJournalPermissionH`),\n    scope: \"world\",\n    type: Number,\n    choices: Object.entries(CONST.DOCUMENT_PERMISSION_LEVELS).reduce((acc, [perm, key]) => {\n      acc[key] = game.i18n.localize(`pin-cushion.SETTINGS.DefaultJournalPermission.PERMISSION.${perm}`);\n      return acc;\n    }, {}),\n    default: 0,\n    config: true,\n    onChange: (s) => {},\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"defaultJournalFolder\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.DefaultJournalFolderN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.DefaultJournalFolderH`),\n    scope: \"world\",\n    type: String,\n    choices: {\n      none: game.i18n.localize(`pin-cushion.None`),\n      perUser: game.i18n.localize(`pin-cushion.PerUser`),\n      specificFolder: game.i18n.localize(`pin-cushion.PerSpecificFolder`),\n    },\n    default: \"none\",\n    config: true,\n    onChange: (s) => {\n      // Only run check for folder creation for the main GM\n      if (s === \"perUser\" && game.user === game.users.find((u) => u.isGM && u.active)) {\n        PinCushion._createFolders();\n      }\n    },\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"defaultNoteImageOnCreate\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.defaultNoteImageOnCreateN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.defaultNoteImageOnCreateH`),\n    scope: \"world\",\n    type: String,\n    default: \"\",\n    config: true,\n    filePicker: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"specificFolder\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.SpecificFolderN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.SpecificFolderH`),\n    scope: \"world\",\n    type: String,\n    choices: () => {\n      const folders = game.journal.directory.folders.sort((a, b) => a.name.localeCompare(b.name));\n      const arrObj = {};\n      arrObj[\"\"] = \"Select a journal folder\";\n      Object.entries(folders).reduce((folder, [k, v]) => {\n        folder[v.id] = v.name;\n        arrObj[v.id] = v.name;\n        return folder;\n      }, {});\n      return arrObj;\n    },\n    default: 0,\n    config: true,\n    onChange: (s) => {},\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"enableBackgroundlessPins\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.EnableBackgroundlessPinsN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.EnableBackgroundlessPinsH`),\n    scope: \"world\",\n    type: Boolean,\n    default: true,\n    config: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"showJournalImageByDefault\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.ShowJournalImageByDefaultN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.ShowJournalImageByDefaultH`),\n    scope: \"world\",\n    type: Boolean,\n    default: true,\n    config: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"enableTooltipByDefault\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.enableTooltipByDefaultN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.enableTooltipByDefaultH`),\n    scope: \"world\",\n    type: Boolean,\n    default: false,\n    config: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"enableAutoScaleNamePlatesNote\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.enableAutoScaleNamePlatesNoteN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.enableAutoScaleNamePlatesNoteH`),\n    scope: \"world\",\n    type: Boolean,\n    default: false,\n    config: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"enableDragNoteOnTokenLayerIfGM\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.enableDragNoteOnTokenLayerIfGMN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.enableDragNoteOnTokenLayerIfGMH`),\n    scope: \"world\",\n    type: Boolean,\n    default: true,\n    config: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"playerIconAutoOverride\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.PlayerIconAutoOverrideN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.PlayerIconAutoOverrideH`),\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"playerIconPathDefault\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.PlayerIconPathDefaultN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.PlayerIconPathDefaultH`),\n    scope: \"world\",\n    config: true,\n    default: \"icons/svg/book.svg\",\n    type: String,\n    filePicker: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"noteGM\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.noteGMN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.noteGMH`),\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"revealedNotes\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.revealedNotesN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.revealedNotesH`),\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"revealedNotesTintColorLink\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.revealedNotesTintColorLinkN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.revealedNotesTintColorLinkH`),\n    scope: \"world\",\n    type: String,\n    default: \"#7CFC00\",\n    config: true,\n    onChange: () => {\n      if (canvas?.ready) {\n        canvas.notes.placeables.forEach((note) => note.draw());\n        //for (let note of canvas.notes.objects) note.draw();\n      }\n    },\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"revealedNotesTintColorNotLink\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.revealedNotesTintColorNotLinkN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.revealedNotesTintColorNotLinkH`),\n    scope: \"world\",\n    type: String,\n    default: \"#c000c0\",\n    config: true,\n    onChange: () => {\n      if (canvas?.ready) {\n        canvas.notes.placeables.forEach((note) => note.draw());\n        //for (let note of canvas.notes.objects) note.draw();\n      }\n    },\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"revealedNotesTintColorRevealed\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.revealedNotesTintColorRevealedN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.revealedNotesTintColorRevealedH`),\n    scope: \"world\",\n    type: String,\n    default: \"#ffff00\",\n    config: true,\n    onChange: () => refresh(),\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"revealedNotesTintColorNotRevealed\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.revealedNotesTintColorNotRevealedN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.revealedNotesTintColorNotRevealedH`),\n    scope: \"world\",\n    type: String,\n    default: \"#ff0000\",\n    config: true,\n    onChange: () => refresh(),\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"enableJournalThumbnailForGMs\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.enableJournalThumbnailForGMsN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.enableJournalThumbnailForGMsH`),\n    scope: \"world\",\n    type: Boolean,\n    default: true,\n    config: true,\n    onchange: () => window.location.reload(),\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"enableJournalThumbnailForPlayers\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.enableJournalThumbnailForPlayersN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.enableJournalThumbnailForPlayersH`),\n    scope: \"world\",\n    type: Boolean,\n    default: true,\n    config: true,\n    onchange: () => window.location.reload(),\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"journalThumbnailPosition\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.journalThumbnailPositionN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.journalThumbnailPositionH`),\n    scope: \"world\",\n    config: true,\n    default: \"right\",\n    type: String,\n    choices: {\n      right: \"Right\",\n      left: \"Left\",\n    },\n    onChange: () => game.journal.render(),\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"fontSize\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.fontSizeN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.fontSizeH`),\n    scope: \"client\",\n    type: String,\n    default: \"\",\n    config: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"maxWidth\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.maxWidthN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.maxWidthH`),\n    scope: \"client\",\n    type: Number,\n    default: 800,\n    config: true,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"tooltipUseMousePositionForCoordinates\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.tooltipUseMousePositionForCoordinatesN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.tooltipUseMousePositionForCoordinatesH`),\n    scope: \"world\",\n    config: true,\n    default: true,\n    type: Boolean,\n  });\n\n  // DEPRECATED ON V11\n  //   game.settings.register(CONSTANTS.MODULE_ID, \"oneClickNoteCreation\", {\n  //     name: game.i18n.localize(`pin-cushion.SETTINGS.oneClickNoteCreationN`),\n  //     hint: game.i18n.localize(`pin-cushion.SETTINGS.oneClickNoteCreationH`),\n  //     scope: \"world\",\n  //     config: true,\n  //     default: false,\n  //     type: Boolean,\n  //   });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"enableJournalAnchorLink\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.enableJournalAnchorLinkN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.enableJournalAnchorLinkH`),\n    scope: \"world\",\n    config: true,\n    default: true,\n    type: Boolean,\n  });\n\n  game.settings.register(CONSTANTS.MODULE_ID, \"enableJournalDirectoryPages\", {\n    name: game.i18n.localize(`pin-cushion.SETTINGS.enableJournalDirectoryPagesN`),\n    hint: game.i18n.localize(`pin-cushion.SETTINGS.enableJournalDirectoryPagesH`),\n    scope: \"world\",\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n\n  // =====================\n  // START MATT INTEGRATION\n  // =====================\n  /*\n\tgame.settings.register(CONSTANTS.MODULE_ID, \"allow-note\", {\n\t\tname: game.i18n.localize(`pin-cushion.SETTINGS.allowNoteN`),\n\t\thint: game.i18n.localize(`pin-cushion.SETTINGS.allowNoteH`),\n\t\tscope: \"world\",\n\t\tconfig: true,\n\t\tdefault: false,\n\t\ttype: Boolean\n\t});\n\n\tgame.settings.register(CONSTANTS.MODULE_ID, \"prevent-when-paused\", {\n\t\tname: game.i18n.localize(`pin-cushion.SETTINGS.preventWhenPausedN`),\n\t\thint: game.i18n.localize(`pin-cushion.SETTINGS.preventWhenPausedH`),\n\t\tscope: \"world\",\n\t\tconfig: true,\n\t\tdefault: true,\n\t\ttype: Boolean\n\t});\n\n\tgame.settings.register(CONSTANTS.MODULE_ID, \"allow-note-passthrough\", {\n\t\tname: game.i18n.localize(`pin-cushion.SETTINGS.allowNotePassthroughN`),\n\t\thint: game.i18n.localize(`pin-cushion.SETTINGS.allowNotePassthroughH`),\n\t\tscope: \"world\",\n\t\tconfig: true,\n\t\tdefault: true,\n\t\ttype: Boolean\n\t});\n\t*/\n  // =====================\n  // END MATT INTEGRATION\n  // =====================\n};\nclass ResetSettingsDialog extends FormApplication {\n  constructor(...args) {\n    //@ts-ignore\n    super(...args);\n    //@ts-ignore\n    return new Dialog({\n      title: game.i18n.localize(`${CONSTANTS.MODULE_ID}.dialogs.resetsettings.title`),\n      content:\n        '<p style=\"margin-bottom:1rem;\">' +\n        game.i18n.localize(`${CONSTANTS.MODULE_ID}.dialogs.resetsettings.content`) +\n        \"</p>\",\n      buttons: {\n        confirm: {\n          icon: '<i class=\"fas fa-check\"></i>',\n          label: game.i18n.localize(`${CONSTANTS.MODULE_ID}.dialogs.resetsettings.confirm`),\n          callback: async () => {\n            const worldSettings = game.settings.storage\n              ?.get(\"world\")\n              ?.filter((setting) => setting.key.startsWith(`${CONSTANTS.MODULE_ID}.`));\n            for (let setting of worldSettings) {\n              console.log(`Reset setting '${setting.key}'`);\n              await setting.delete();\n            }\n            //window.location.reload();\n          },\n        },\n        cancel: {\n          icon: '<i class=\"fas fa-times\"></i>',\n          label: game.i18n.localize(`${CONSTANTS.MODULE_ID}.dialogs.resetsettings.cancel`),\n        },\n      },\n      default: \"cancel\",\n    });\n  }\n  async _updateObject(event, formData) {\n    // do nothing\n  }\n}\n","import { error, warn } from \"../lib/lib.js\";\n\nexport class BackgroundlessControlIcon extends ControlIcon {\n  /**\n   * Override ControlIcon#draw to remove drawing of the background.\n   */\n  async draw() {\n    // Load the icon texture\n    if (!this.iconSrc) {\n      this.texture = PIXI.Texture.EMPTY;\n    } else {\n      try {\n        this.texture = this.texture ?? (await loadTexture(this.iconSrc));\n      } catch (e) {\n        error(e);\n        this.texture = PIXI.Texture.EMPTY;\n      }\n    }\n\n    // Don't draw a destroyed Control\n    if (this.destroyed) return this;\n\n    // Draw border\n    this.border\n      .clear()\n      .lineStyle(2, this.borderColor, 1.0)\n      .drawRoundedRect(...this.rect, 5)\n      .endFill();\n    this.border.visible = false;\n\n    // Hide the background\n    this.bg.visible = false;\n\n    // Draw icon\n    try {\n      this.icon.texture = this.texture ?? (this.iconSrc ? await loadTexture(this.iconSrc) : \"icons/svg/cancel.svg\");\n      this.icon.width = this.icon.height = this.size;\n      this.icon.tint = Number.isNumeric(this.tintColor) ? this.tintColor : 0xffffff;\n    } catch (e) {\n      warn(e.stack);\n      this.icon.texture = \"icons/svg/cancel.svg\";\n      this.icon.width = this.icon.height = this.size;\n      this.icon.tint = Number.isNumeric(this.tintColor) ? this.tintColor : 0xffffff;\n    }\n    return this;\n  }\n}\n","import CONSTANTS from \"../constants.js\";\nimport {\n  isPlacementVertical,\n  isRealNumber,\n  retrieveFirstImageFromJournalId,\n  retrieveFirstTextFromJournalId,\n} from \"../lib/lib.js\";\nimport { PinCushion } from \"./PinCushion.js\";\n\n/**\n * @class PinCushionHUD\n *\n * A HUD extension that shows the Note preview\n */\nexport class PinCushionHUD extends BasePlaceableHUD {\n  constructor(note, options) {\n    super(note, options);\n    this.data = note;\n  }\n\n  /**\n   * Retrieve and override default options for this application\n   */\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      id: \"pin-cushion-hud\",\n      classes: [...super.defaultOptions.classes, \"pin-cushion-hud\"],\n      // width: 400,\n      // height: 200,\n      minimizable: false,\n      resizable: false,\n      template: \"modules/pin-cushion/templates/journal-preview.html\",\n    });\n  }\n\n  /**\n   * Get data for template\n   */\n  async getData() {\n    const data = super.getData();\n    const entry = this.object.entry;\n    let entryName = data.text;\n    let entryIsOwner = true;\n    let entryId = undefined;\n    let entryIcon = data.texture?.src;\n    let entryContent = data.text;\n    if (entry) {\n      entryName = entry.name;\n      entryId = entry.id;\n      entryIsOwner = entry.isOwner ?? true;\n      entryIcon = retrieveFirstImageFromJournalId(entryId, this.object.page?.id, false);\n      if (!entryIcon && data.icon) {\n        entryIcon = data.icon;\n      }\n      entryContent = retrieveFirstTextFromJournalId(entryId, this.object.page?.id, false);\n      if (!entryContent && data.text) {\n        entryContent = data.text;\n      }\n    }\n    // TODO The getFlag was returning as 'not a function', for whatever reason...\n    // const showImage = this.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.SHOW_IMAGE);\n    const showImage = getProperty(this.object.document.flags[CONSTANTS.MODULE_ID], CONSTANTS.FLAGS.SHOW_IMAGE);\n    const showImageExplicitSource = getProperty(\n      this.object.document.flags[CONSTANTS.MODULE_ID],\n      CONSTANTS.FLAGS.SHOW_IMAGE_EXPLICIT_SOURCE\n    );\n    const tooltipCustomDescription = getProperty(\n      this.object.document.flags[CONSTANTS.MODULE_ID],\n      CONSTANTS.FLAGS.TOOLTIP_CUSTOM_DESCRIPTION\n    );\n\n    let content;\n    if (showImage) {\n      const imgToShow = showImageExplicitSource ? showImageExplicitSource : entryIcon;\n      if (imgToShow && imgToShow.length > 0) {\n        content = await TextEditor.enrichHTML(`<img class='image' src='${imgToShow}' alt=''></img>`, {\n          secrets: entryIsOwner,\n          documents: true,\n          async: true,\n        });\n      } else {\n        content = await TextEditor.enrichHTML(`<img class='image' src='${CONSTANTS.PATH_TRANSPARENT}' alt=''></img>`, {\n          secrets: entryIsOwner,\n          documents: true,\n          async: true,\n        });\n      }\n    } else {\n      if (!entry && tooltipCustomDescription) {\n        const previewMaxLength = game.settings.get(CONSTANTS.MODULE_ID, \"previewMaxLength\");\n        const textContent = tooltipCustomDescription;\n        content =\n          textContent.length > previewMaxLength ? `${textContent.substr(0, previewMaxLength)} ...` : textContent;\n      } else {\n        const previewTypeAsText = getProperty(\n          this.object.document.flags[CONSTANTS.MODULE_ID],\n          CONSTANTS.FLAGS.PREVIEW_AS_TEXT_SNIPPET\n        );\n        let firstContent = entryContent ?? \"\";\n        // START Support for 'Journal Anchor Links' JAL\n        if (this.object.document.entryId) {\n          firstContent = firstContent.replaceAll(\n            \"@UUID[.\",\n            \"@UUID[JournalEntry.\" + this.object.document.entryId + \".JournalEntryPage.\"\n          );\n          firstContent = firstContent.replaceAll(`data-uuid=\".`, `data-uuid=\"JournalEntry.\"`);\n        }\n        // END Support for 'Journal Anchor Links' JAL\n        if (!previewTypeAsText) {\n          content = await TextEditor.enrichHTML(firstContent, {\n            secrets: entryIsOwner,\n            documents: true,\n            async: true,\n          });\n        } else {\n          const previewMaxLength = game.settings.get(CONSTANTS.MODULE_ID, \"previewMaxLength\");\n          const textContent = $(firstContent).text();\n          content =\n            textContent.length > previewMaxLength ? `${textContent.substr(0, previewMaxLength)} ...` : textContent;\n        }\n      }\n    }\n\n    // START Support for 'Journal Anchor Links'\n    if (this.object.document.entryId) {\n      content = content.replaceAll(\n        \"@UUID[.\",\n        \"@UUID[JournalEntry.\" + this.object.document.entryId + \".JournalEntryPage.\"\n      );\n      // content = content.replaceAll(`data-uuid=\".`, `data-uuid=\"JournalEntry.\"`);\n    }\n    // END Support for 'Journal Anchor Links'\n\n    let titleTooltip = entryName; // by default is the title of the journal\n    const newtextGM = getProperty(this.object.document.flags[CONSTANTS.MODULE_ID], CONSTANTS.FLAGS.PIN_GM_TEXT);\n    if (game.user.isGM && game.settings.get(CONSTANTS.MODULE_ID, \"noteGM\") && newtextGM) {\n      titleTooltip = newtextGM;\n    } else if (data.text && data.text !== titleTooltip) {\n      titleTooltip = data.text;\n    }\n\n    let bodyPlaceHolder = `<img class='image' src='${CONSTANTS.PATH_TRANSPARENT}' alt=''></img>`;\n\n    data.tooltipId = this.object.id;\n    data.title = titleTooltip;\n    // data.body = content;\n    data.body = bodyPlaceHolder;\n\n    const fontSize = game.settings.get(CONSTANTS.MODULE_ID, \"fontSize\") || canvas.grid.size / 5;\n    const maxWidth = game.settings.get(CONSTANTS.MODULE_ID, \"maxWidth\") || 400;\n\n    data.titleTooltip = titleTooltip;\n    data.content = content;\n    data.fontSize = fontSize;\n    data.maxWidth = maxWidth;\n\n    const isTooltipShowTitleS = getProperty(\n      this.object.document.flags[CONSTANTS.MODULE_ID],\n      CONSTANTS.FLAGS.TOOLTIP_SHOW_TITLE\n    );\n    const isTooltipShowDescriptionS = getProperty(\n      this.object.document.flags[CONSTANTS.MODULE_ID],\n      CONSTANTS.FLAGS.TOOLTIP_SHOW_DESCRIPTION\n    );\n\n    const isTooltipShowTitle = String(isTooltipShowTitleS) === \"true\" ? true : false;\n    const isTooltipShowDescription = String(isTooltipShowDescriptionS) === \"true\" ? true : false;\n\n    this.contentTooltip = await TextEditor.enrichHTML(`\n          <div id=\"container\" class=\"pin-cushion-hud-container\" style=\"font-size:${fontSize}px; max-width:${maxWidth}px\">\n              ${isTooltipShowTitle ? `<div id=\"header\"><h3>${titleTooltip}</h3></div><hr/>` : ``}\n              ${isTooltipShowDescription ? `<div id=\"content\">${content} </div>` : ``}\n          </div>\n\n      `);\n    return data;\n  }\n\n  /**\n   * Set app position\n   */\n  setPosition() {\n    // {left, top, width, height, scale}={}){\n    if (!this.object) {\n      return;\n    }\n    const fontSize = game.settings.get(CONSTANTS.MODULE_ID, \"fontSize\") || canvas.grid.size / 5;\n    const maxWidth = game.settings.get(CONSTANTS.MODULE_ID, \"maxWidth\");\n\n    const tooltipPlacement =\n      getProperty(this.object.document.flags[CONSTANTS.MODULE_ID], CONSTANTS.FLAGS.TOOLTIP_PLACEMENT) ?? \"e\";\n\n    const tooltipSmartPlacement =\n      getProperty(this.object.document.flags[CONSTANTS.MODULE_ID], CONSTANTS.FLAGS.TOOLTIP_SMART_PLACEMENT) ?? false;\n\n    const tooltipFollowMouse =\n      getProperty(this.object.document.flags[CONSTANTS.MODULE_ID], CONSTANTS.FLAGS.TOOLTIP_FOLLOW_MOUSE) ?? false;\n\n    const isVertical = isPlacementVertical(tooltipPlacement);\n\n    let orientation = \"\";\n    if (tooltipPlacement.includes(\"e\")) {\n      orientation = \"right\";\n    } else {\n      orientation = \"left\";\n    }\n\n    // WITH TOOLTIP\n    let x = 0;\n    let y = 0;\n    if (game.settings.get(CONSTANTS.MODULE_ID, \"tooltipUseMousePositionForCoordinates\")) {\n      // const positionMouse = canvas.app.renderer.plugins.interaction.mouse.getLocalPosition(canvas.app.stage);\n      const positionMouse = canvas.mousePosition;\n      x = positionMouse.x;\n      y = positionMouse.y;\n    } else {\n      x = this.object.center ? this.object.center.x : this.object.x;\n      y = this.object.center ? this.object.center.y : this.object.y;\n    }\n\n    // if (isVertical) {\n    //   x = x - this.object.size / 2;\n    // }\n\n    const ratio = getProperty(this.object.document.flags[CONSTANTS.MODULE_ID], CONSTANTS.FLAGS.RATIO_WIDTH) ?? 1;\n    const ratio_width = isRealNumber(ratio) ? ratio : 1;\n    const viewWidth = visualViewport.width;\n\n    // const height = this.object.controlIcon.texture?.height\n    //   ? this.object.controlIcon.texture?.height - this.object.tooltip.height\n    //   : this.object.controlIcon.height - this.object.tooltip.height;\n\n    /*\n    const width = this.object.controlIcon.width * ratio_width;\n    const height = this.object.controlIcon.height - this.object.tooltip.height;\n    const left = x - (this.object.document?.iconSize / 2 || 0);\n    const top = y - height / 2;\n    */\n\n    const width = this.object.controlIcon.width; //  * ratio_width;\n    const height = this.object.controlIcon.height;\n    let left = x - width / 2;\n    if (ratio_width != 1) {\n      // left = x - (width / 2) * ratio_width; // correct shifting for the new scale.\n      // left = (x + ratio_width * (this.object.document?.iconSize / 2) - (width * ratio_width * 4));\n      left = x + ratio_width * (width / 2) - (width * ratio_width) / 2;\n    }\n    const top = y - height / 2;\n\n    const position = {\n      height: height + \"px\",\n      width: width + \"px\",\n      left: left + \"px\",\n      top: top + \"px\",\n      \"font-size\": fontSize + \"px\",\n      \"max-width\": maxWidth + \"px\",\n    };\n    this.element.css(position);\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    // const elementToTooltip = html;\n    let elementToTooltip = this.element;\n    // let mouseOnDiv = html; // this.element; // this.element.parent()[0];\n    if (!elementToTooltip.document) {\n      elementToTooltip = $(elementToTooltip);\n    }\n\n    const fontSize = game.settings.get(CONSTANTS.MODULE_ID, \"fontSize\") || canvas.grid.size / 5;\n    const maxWidth = game.settings.get(CONSTANTS.MODULE_ID, \"maxWidth\");\n\n    const tooltipPlacement =\n      getProperty(this.object.document.flags[CONSTANTS.MODULE_ID], CONSTANTS.FLAGS.TOOLTIP_PLACEMENT) ?? \"e\";\n\n    const tooltipSmartPlacement =\n      getProperty(this.object.document.flags[CONSTANTS.MODULE_ID], CONSTANTS.FLAGS.TOOLTIP_SMART_PLACEMENT) ?? false;\n\n    const tooltipFollowMouse =\n      getProperty(this.object.document.flags[CONSTANTS.MODULE_ID], CONSTANTS.FLAGS.TOOLTIP_FOLLOW_MOUSE) ?? false;\n\n    const tooltipColor =\n      getProperty(this.object.document.flags[CONSTANTS.MODULE_ID], CONSTANTS.FLAGS.TOOLTIP_COLOR) ?? \"\";\n\n    let orientation = \"\";\n    if (tooltipPlacement.includes(\"e\")) {\n      orientation = \"right\";\n    } else {\n      orientation = \"left\";\n    }\n\n    const isVertical = isPlacementVertical(tooltipPlacement);\n\n    // WITH TOOLTIP\n    let x = 0;\n    let y = 0;\n    if (game.settings.get(CONSTANTS.MODULE_ID, \"tooltipUseMousePositionForCoordinates\")) {\n      // const positionMouse = canvas.app.renderer.plugins.interaction.mouse.getLocalPosition(canvas.app.stage);\n      const positionMouse = canvas.mousePosition;\n      x = positionMouse.x;\n      y = positionMouse.y;\n    } else {\n      x = this.object.center ? this.object.center.x : this.object.x;\n      y = this.object.center ? this.object.center.y : this.object.y;\n    }\n\n    // if (isVertical) {\n    //   x = x - this.object.size / 2;\n    // }\n\n    const ratio = getProperty(this.object.document.flags[CONSTANTS.MODULE_ID], CONSTANTS.FLAGS.RATIO_WIDTH) ?? 1;\n    const ratio_width = isRealNumber(ratio) ? ratio : 1;\n    const viewWidth = visualViewport.width;\n\n    // const height = this.object.controlIcon.texture?.height\n    //   ? this.object.controlIcon.texture?.height - this.object.tooltip.height\n    //   : this.object.controlIcon.height - this.object.tooltip.height;\n\n    /*\n    const width = this.object.controlIcon.width * ratio_width;\n    const height = this.object.controlIcon.height - this.object.tooltip.height;\n    const left = x - (this.object.document?.iconSize / 2 || 0); // orientation === \"right\" ? x - width : x + width;\n    const top = y - height / 2;\n    */\n\n    const width = this.object.controlIcon.width; // * ratio_width;\n    const height = this.object.controlIcon.height;\n    let left = x - width / 2;\n    if (ratio_width != 1) {\n      // left = x - (width / 2) * ratio_width; // correct shifting for the new scale.\n      // left = (x + ratio_width * (this.object.document?.iconSize / 2) - (width * ratio_width * 4));\n      left = x + ratio_width * (width / 2) - (width * ratio_width) / 2;\n    }\n    const top = y - height / 2;\n\n    // const orientation =\n    //   (this.object.getGlobalPosition()?.x ?? 0) < viewWidth / 2 ? \"right\" : \"left\";\n    // const top = y - height / 2;\n    // const left = orientation === \"right\" ? x + width : x - width;\n\n    /*\n    const width = this.object.size * ratio; //this.object.width * ratio;\n    const height = this.object.height - this.object.tooltip.height; // this.object.size;\n    const left = x - this.object.size/2;  // - this.object.width/2 + offset,\n    const top = y - this.object.size/2; // - this.object.height/2 + offset\n    */\n\n    const position = {\n      height: height + \"px\",\n      width: width + \"px\",\n      left: left + \"px\",\n      top: top + \"px\",\n    };\n    elementToTooltip.css(position);\n\n    // $.powerTip.hide(html);\n\n    // let popupId = tooltipColor ? 'powerTip-'+tooltipColor : 'powerTip';\n    const tooltipPopupClass = tooltipColor\n      ? \"pin-cushion-hud-tooltip-\" + tooltipColor\n      : \"pin-cushion-hud-tooltip-default\";\n\n    const tooltipTipContent = $(this.contentTooltip);\n\n    elementToTooltip.data(\"powertipjq\", tooltipTipContent);\n\n    // if (tooltipFollowMouse) {\n    //   elementToTooltip.powerTip({\n    //     popupClass: tooltipPopupClass,\n    //     followMouse: true,\n    //   });\n    // } else {\n    elementToTooltip.powerTip({\n      // \t(default: 'powerTip') HTML id attribute for the tooltip div.\n      // popupId: popupId, // e.g. default 'powerTip'\n\n      // (default: 'n') Placement location of the tooltip relative to the element it is open for.\n      // Values can be n, e, s, w, nw, ne, sw, se, nw-alt, ne-alt, sw-alt,\n      // or se-alt (as in north, east, south, and west).\n      // This only matters if followMouse is set to false.\n      placement: tooltipPlacement,\n\n      // (default: false) When enabled the plugin will try to keep tips inside the browser viewport.\n      // If a tooltip would extend outside of the viewport then its placement will be changed to an\n      // orientation that would be entirely within the current viewport.\n      // Only applies if followMouse is set to false.\n      smartPlacement: tooltipSmartPlacement,\n\n      // (default: false) Allow the mouse to hover on the tooltip.\n      // This lets users interact with the content in the tooltip.\n      // Only applies if followMouse is set to false and manual is set to false.\n      mouseOnToPopup: true,\n\n      // (default: false) If set to true the tooltip will follow the users mouse cursor.\n      // Note that if a tooltip with followMouse enabled is opened by an event without\n      // mouse data (like focus via keyboard navigation) then it will revert to static\n      // placement with smart positioning enabled. So you may wish to set placement as well.\n      followMouse: false,\n\n      // (default: '') Space separated custom HTML classes for the tooltip div.\n      // Since this plugs directly into jQuerys addClass() method it will\n      // also accept a function that returns a string.\n      popupClass: tooltipPopupClass,\n\n      // (default: 10) Pixel offset of the tooltip.\n      // This will be the offset from the element the tooltip is open for, or\n      // from the mouse cursor if followMouse is true.\n      offset: 10,\n\n      // (default: 100) Time in milliseconds to wait after mouse cursor leaves\n      // the element before closing the tooltip. This serves two purposes: first,\n      // it is the mechanism that lets the mouse cursor reach the tooltip\n      // (cross the gap between the element and the tooltip div) for mouseOnToPopup tooltips.\n      // And, second, it lets the cursor briefly leave the element and return without causing\n      // the whole fade-out, intent test, and fade-in cycle to happen.\n      closeDelay: 0,\n\n      // (default: 100) Hover intent polling interval in milliseconds.\n      intentPollInterval: 0,\n    });\n    // }\n    $.powerTip.show(elementToTooltip);\n  }\n\n  // clear(){\n  //   let mouseOnDiv = this.element; // this.element.parent()[0];\n  //   if(!mouseOnDiv.data){\n  //     mouseOnDiv = $(mouseOnDiv);\n  //   }\n  //   $.powerTip.hide(mouseOnDiv);\n  // }\n}\n","import API from \"../api.js\";\nimport CONSTANTS from \"../constants.js\";\nimport {\n  i18n,\n  i18nFormat,\n  info,\n  isAlt,\n  isRealNumber,\n  log,\n  retrieveFirstImageFromJournalId,\n  stripQueryStringAndHashFromPath,\n} from \"../lib/lib.js\";\nimport { registerSettings } from \"../settings.js\";\nimport { BackgroundlessControlIcon } from \"./BackgroundlessControlIcon.js\";\nimport { PinCushionHUD } from \"./PinCushionHUD.js\";\n\n/**\n * A class for managing additional Map Pin functionality\n * @author Evan Clarke (errational#2007)\n */\nexport class PinCushion {\n  constructor() {\n    // Storage for requests sent over a socket, pending GM execution\n    this._requests = {};\n  }\n\n  /* -------------------------------- Constants ------------------------------- */\n\n  static get DIALOG() {\n    const defaultPermission = game.settings.get(CONSTANTS.MODULE_ID, \"defaultJournalPermission\");\n    let defaultPermissionName = \"NONE\";\n    if (String(defaultPermission) === \"0\") {\n      defaultPermissionName = \"NONE\";\n    }\n    if (String(defaultPermission) === \"1\") {\n      defaultPermissionName = \"LIMITED\";\n    }\n    if (String(defaultPermission) === \"2\") {\n      defaultPermissionName = \"OBSERVER\";\n    }\n    if (String(defaultPermission) === \"3\") {\n      defaultPermissionName = \"OWNER\";\n    }\n    // none, perUser, specificFolder\n    const defaultFolder = game.settings.get(CONSTANTS.MODULE_ID, \"defaultJournalFolder\");\n\n    const specificFolder = game.settings.get(CONSTANTS.MODULE_ID, \"specificFolder\");\n    const specificFolderObj =\n      game.journal.directory.folders.find((f) => f.name === specificFolder || f.id === specificFolder) ??\n      game.journal.directory.folders[Number(specificFolder)] ??\n      undefined;\n    const specificFolderName = specificFolderObj ? specificFolderObj.name : \"\";\n\n    const folders = game.journal.directory.folders\n      .sort((a, b) => a.name.localeCompare(b.name))\n      .filter((folder) => folder.displayed)\n      .map((folder) => `<option value=\"${folder.id}\">${folder.name}</option>`)\n      .join(\"\\n\");\n\n    return {\n      content: `\n            <div class=\"form-group\">\n              <label>\n                <p class=\"notes\">${i18n(\"pin-cushion.Name\")}</p>\n              </label>\n              <input name=\"name\" type=\"text\"/>\n              <label>\n                <p class=\"notes\">${i18n(\"pin-cushion.DefaultPermission\")}</p>\n              </label>\n              <select id=\"cushion-permission\" style=\"width: 100%;\">\n                <option value=\"0\"\n                  ${String(defaultPermission) === \"0\" ? \"selected\" : \"\"}>\n                  ${i18n(\"PERMISSION.NONE\")}${String(defaultPermission) === \"0\" ? \" <i>(default)</i>\" : \"\"}\n                </option>\n                <option value=\"1\"\n                  ${String(defaultPermission) === \"1\" ? \"selected\" : \"\"}>\n                  ${i18n(\"PERMISSION.LIMITED\")}${String(defaultPermission) === \"1\" ? \" <i>(default)</i>\" : \"\"}\n                </option>\n                <option value=\"2\"\n                  ${String(defaultPermission) === \"2\" ? \"selected\" : \"\"}>\n                  ${i18n(\"PERMISSION.OBSERVER\")}${String(defaultPermission) === \"2\" ? \" <i>(default)</i>\" : \"\"}\n                </option>\n                <option value=\"3\"\n                  ${String(defaultPermission) === \"3\" ? \"selected\" : \"\"}>\n                  ${i18n(\"PERMISSION.OWNER\")}${String(defaultPermission) === \"3\" ? \" <i>(default)</i>\" : \"\"}\n                </option>\n              </select>\n              <label>\n                <p class=\"notes\">${i18n(\"pin-cushion.Folder\")}</p>\n              </label>\n              <select id=\"cushion-folder\" style=\"width: 100%;\">\n                <option\n                  value=\"none\"\n                  ${defaultFolder === \"none\" ? \"selected\" : \"\"}>\n                    ${i18n(\"pin-cushion.None\")}\n                </option>\n                <option value=\"perUser\" ${defaultFolder === \"perUser\" ? \"selected\" : \"\"}>\n                  ${i18n(\"pin-cushion.PerUser\")} <i>(${game.user.name})</i>\n                </option>\n                <option\n                  value=\"specificFolder\"\n                  ${defaultFolder === \"specificFolder\" ? \"selected\" : \"\"}>\n                    ${i18n(\"pin-cushion.PerSpecificFolder\")} <i>(${specificFolderName})</i>\n                </option>\n                <option disabled>${i18n(\"pin-cushion.ExistingFolders\")}</option>\n                ${folders}\n              </select>\n            </div>\n            </br>\n            `,\n      title: \"Create a Map Pin\",\n    };\n  }\n\n  static get NOTESLAYER() {\n    return \"NotesLayer\";\n  }\n\n  static get FONT_SIZE() {\n    return 16;\n  }\n\n  static autoScaleNotes(canvas) {\n    const enableAutoScaleNamePlatesNote = game.settings.get(CONSTANTS.MODULE_ID, \"enableAutoScaleNamePlatesNote\");\n    if (enableAutoScaleNamePlatesNote) {\n      if (canvas.notes) {\n        for (let note of canvas.notes.placeables) {\n          note.tooltip.scale.set(PinCushion._calculateAutoScale(canvas.scene.dimensions.size, canvas.stage.scale.x));\n        }\n      }\n    }\n  }\n\n  static _calculateAutoScale(sceneDimensionSize, zoomStage) {\n    // Taken from Easy Ruler Scale, a mod by Kandashi\n    // https://github.com/kandashi/easy-ruler-scale\n    const gs = sceneDimensionSize / 100;\n    const zs = 1 / zoomStage;\n    return Math.max(gs * zs, 0.8);\n  }\n\n  /**\n   * Render a file-picker button linked to an <input> field\n   * @param {object} options              Helper options\n   * @param {string} [options.type]       The type of FilePicker instance to display\n   * @param {string} [options.target]     The field name in the target data\n   * @param {string} [options.customClass] The field name in the custom class\n   * @return {Handlebars.SafeString|string}\n   */\n  static filePicker(type, target, customClass = \"file-picker\") {\n    // const type = options.hash['type'];\n    // const target = options.hash['target'];\n    if (!target) throw new Error(\"You must define the name of the target field.\");\n\n    // Do not display the button for users who do not have browse permission\n    if (game.world && !game.user.can(\"FILES_BROWSE\")) return \"\";\n\n    // Construct the HTML\n    const tooltip = game.i18n.localize(\"FILES.BrowseTooltip\");\n    return new Handlebars.SafeString(`\n    <button type=\"button\" name=\"${customClass}\" class=\"${customClass}\" data-type=\"${type}\" data-target=\"${target}\" title=\"${tooltip}\" tabindex=\"-1\">\n        <i class=\"fas fa-file-import fa-fw\"></i>\n    </button>`);\n  }\n\n  /* --------------------------------- Methods -------------------------------- */\n\n  /**\n   * Creates and renders a dialog for name entry\n   * @param {*} data\n   * break callbacks out into separate methods\n   */\n  _createDialog(data) {\n    new Dialog({\n      title: PinCushion.DIALOG.title,\n      content: PinCushion.DIALOG.content,\n      buttons: {\n        save: {\n          label: \"Save\",\n          icon: `<i class=\"fas fa-check\"></i>`,\n          callback: (html) => {\n            return this.createNoteFromCanvas(html, data);\n          },\n        },\n        cancel: {\n          label: \"Cancel\",\n          icon: `<i class=\"fas fa-times\"></i>`,\n          callback: (e) => {\n            // Maybe do something in the future\n          },\n        },\n      },\n      default: \"save\",\n    }).render(true);\n  }\n\n  /**\n   * Creates a Note from the Pin Cushion dialog\n   * @param {*} html\n   * @param {*} data\n   */\n  async createNoteFromCanvas(html, eventData) {\n    const input = html.find(\"input[name='name']\");\n\n    if (!input[0].value) {\n      ui.notifications.warn(i18n(\"pin-cushion.MissingPinName\"));\n      return;\n    }\n    // Permissions the Journal Entry will be created with\n    const permission = {\n      [game.userId]: CONST.DOCUMENT_PERMISSION_LEVELS.OWNER,\n      default: parseInt($(\"#cushion-permission\").val()) ?? 0,\n    };\n\n    const defaultJournalPermission = game.settings.get(CONSTANTS.MODULE_ID, \"defaultJournalPermission\");\n    if (\n      isRealNumber(defaultJournalPermission) &&\n      (!isRealNumber(permission.default) || permission.default === 0) &&\n      defaultJournalPermission >= 0\n    ) {\n      permission.default = defaultJournalPermission;\n    }\n\n    // Get folder ID for Journal Entry\n    let folder;\n    const selectedFolder = $(\"#cushion-folder\").val();\n    if (selectedFolder === \"none\") {\n      folder = undefined;\n    } else if (selectedFolder === \"perUser\") {\n      folder = PinCushion.getFolder(game.user.name, selectedFolder);\n      if (!game.user.isGM && folder === undefined) {\n        // Request folder creation when perUser is set and the entry is created by a user\n        // Since only the ID is required, instantiating a Folder from the data is not necessary\n        // folder = (await PinCushion.requestEvent({ action: \"createFolder\" }))?._id;\n        // TODO for some reason this will give me a error\n        // folder = (await pinCushionSocket.executeAsGM('requestEvent', { action: \"createFolder\" }))?._id;\n      }\n    } else if (selectedFolder === \"specificFolder\") {\n      const settingSpecificFolder = game.settings.get(CONSTANTS.MODULE_ID, \"specificFolder\");\n      folder = PinCushion.getFolder(game.user.name, selectedFolder, settingSpecificFolder);\n    } else {\n      folder = selectedFolder; // Folder is already given as ID\n    }\n    const entry = await JournalEntry.create({\n      name: `${input[0].value}`,\n      ownership: permission,\n      ...(folder && { folder }),\n    });\n\n    if (!entry) {\n      return;\n    }\n\n    // offsely add fields required by Foundry's drop handling\n    const entryData = entry.toJSON();\n    entryData.id = entry.id;\n    entryData.uuid = \"JournalEntry.\" + entry.id;\n    entryData.type = \"JournalEntry\";\n\n    if (canvas.activeLayer.name !== PinCushion.NOTESLAYER) {\n      await canvas.notes.activate();\n    }\n\n    await canvas.activeLayer._onDropData(eventData, entryData);\n  }\n\n  /**\n   * Gets the JournalEntry Folder ID to be used for JournalEntry creations, if any.\n   *\n   * @static\n   * @param {string} name - The player name to check folders against, defaults to current user's name\n   * @param {string} setting - The module setting set for journal default\n   * @param {string} folderName - The explicit name of the folder\n   * @returns {string|undefined} The folder's ID, or undefined if there is no target folder\n   */\n  static getFolder(name, setting, folderName) {\n    name = name ?? game.user.name;\n    switch (setting) {\n      // No target folder set\n      case \"none\":\n        return undefined;\n      // Target folder should match the user's name\n      case \"perUser\":\n        return game.journal.directory.folders.find((f) => f.name === name)?.id ?? undefined;\n      case \"specificFolder\":\n        return (\n          game.journal.directory.folders.find((f) => f.name === folderName || f.id === folderName)?.id ??\n          game.journal.directory.folders[Number(folderName)]?.id ??\n          undefined\n        );\n      default:\n        return name;\n    }\n  }\n\n  /**\n   * Checks for missing Journal Entry folders and creates them\n   *\n   * @static\n   * @private\n   * @returns {void}\n   */\n  static async _createFolders() {\n    // Collect missing folders\n    const setting = game.settings.get(CONSTANTS.MODULE_ID, \"defaultJournalFolder\");\n    const missingFolders = game.users\n      .filter((u) => !u.isGM && PinCushion.getFolder(u.name, setting) === undefined)\n      .map((user) => ({\n        name: user.name,\n        type: \"JournalEntry\",\n        parent: null,\n        sorting: \"a\",\n      }));\n    if (missingFolders.length) {\n      // Ask for folder creation confirmation in a dialog\n      const createFolders = await new Promise((resolve, reject) => {\n        new Dialog({\n          title: i18n(\"pin-cushion.CreateMissingFoldersT\"),\n          content: i18n(\"pin-cushion.CreateMissingFoldersC\"),\n          buttons: {\n            yes: {\n              label: `<i class=\"fas fa-check\"></i> ${i18n(\"Yes\")}`,\n              callback: () => resolve(true),\n            },\n            no: {\n              label: `<i class=\"fas fa-times\"></i> ${i18n(\"No\")}`,\n              callback: () => reject(),\n            },\n          },\n          default: \"yes\",\n          close: () => reject(),\n        }).render(true);\n      }).catch((_) => {});\n      // Create folders\n      if (createFolders) await Folder.create(missingFolders);\n    }\n  }\n\n  /**\n   * Replaces icon selector in Notes Config form with filepicker\n   * @param {*} app\n   * @param {*} html\n   * @param {*} noteData\n   */\n  static _replaceIconSelector(app, html, noteData, explicitImageValue) {\n    // const currentIconSelector = stripQueryStringAndHashFromPath(\n    // \texplicitImageValue ? explicitImageValue : noteData.document.texture.src\n    // );\n    const currentIconSelector = stripQueryStringAndHashFromPath(explicitImageValue);\n\n    // you can see this only if you have the file browser permissions\n    const hasPermissionsToUploadFile = game.user.can(\"FILES_BROWSE\");\n    if (hasPermissionsToUploadFile) {\n      // \tconst filePickerHtml = `\n      // \t\t<img class=\"pin-cushion-journal-icon\" src=\"${currentIconSelector}\" />\n      // \t\t<input\n      // \t\t\ttype=\"text\"\n      // \t\t\tname=\"icon\"\n      // \t\t\ttitle=\"Icon Path\"\n      // \t\t\tclass=\"icon-path\"\n      // \t\t\tvalue=\"${currentIconSelector}\"\n      // \t\t\tplaceholder=\"/icons/example.svg\"\n      // \t\t\tdata-dtype=\"String\">\n      // \t\t</input>\n      // \t\t${this.filePicker(\"image\", `icon`, `file-picker`)}\n      // `;\n\n      // /*\n      // <button type=\"button\"\n      // \tname=\"file-picker\"\n      // \tclass=\"file-picker\"\n      // \tdata-type=\"image\"\n      // \tdata-target=\"icon\"\n      // \ttitle=\"Browse Files\"\n      // \ttabindex=\"-1\">\n      // \t<i class=\"fas fa-file-import fa-fw\"></i>\n      // </button>\n      // */\n      // /*\n      // <div class=\"form-fields\">\n      //     <input type=\"text\" name=\"icon.custom\" value=\"moulinette/images/img/npccampaign01/Jeanna_Silverchain.Avatar.png\">\n      // \t<button type=\"button\" class=\"file-picker\" data-type=\"image\" data-target=\"icon.custom\" title=\"Browse Files\" tabindex=\"-1\">\n      // \t\t<i class=\"fas fa-file-import fa-fw\"></i>\n      // \t</button>\n      // </div>\n      // */\n\n      // \t// const iconSelector = html.find(\"select[name='icon.selected']\");\n      const iconCustomSelector = html.find(\"input[name='icon.custom']\");\n      if (iconCustomSelector?.length > 0) {\n        iconCustomSelector.val(currentIconSelector);\n        iconCustomSelector.on(\"change\", function () {\n          const p = iconCustomSelector.parent().find(\".pin-cushion-journal-icon\");\n          const valueIconSelector = html.find(\"select[name='icon.selected']\")?.val();\n          if (valueIconSelector) {\n            p[0].src = valueIconSelector;\n          } else {\n            p[0].src = this.value;\n          }\n        });\n        // iconCustomSelector.replaceWith(filePickerHtml);\n        // \t// Detect and activate file-picker buttons\n        // \t//html.find(\"button.file-picker\").on(\"click\", app._activateFilePicker.bind(app));\n        // \thtml.find(\"button.file-picker\").each((i, button) => (button.onclick = app._activateFilePicker.bind(app)));\n        const iconSelector = html.find(\"select[name='icon.selected']\");\n        // Need this...\n        if (iconSelector?.val() === \"icons/svg/book.svg\" && currentIconSelector) {\n          iconSelector?.val(\"\").change();\n        }\n        if (iconSelector?.length > 0) {\n          iconSelector.on(\"change\", function () {\n            const p = iconCustomSelector.parent().find(\".pin-cushion-journal-icon\");\n            const valueIconSelector = html.find(\"select[name='icon.selected']\")?.val();\n            if (valueIconSelector) {\n              p[0].src = valueIconSelector;\n            } else {\n              p[0].src = currentIconSelector;\n            }\n          });\n          const valueIconSelector = html.find(\"select[name='icon.selected']\")?.val();\n          if (valueIconSelector) {\n            iconCustomSelector.parent().prepend(`<img class=\"pin-cushion-journal-icon\" src=\"${valueIconSelector}\" />`);\n          } else {\n            // https://gitlab.com/tiwato/journal_icon_numbers/-/issues/33\n            iconCustomSelector.prop(\"disabled\", false);\n            iconCustomSelector\n              .parent()\n              .prepend(`<img class=\"pin-cushion-journal-icon\" src=\"${currentIconSelector}\" />`);\n          }\n        } else {\n          iconCustomSelector.parent().prepend(`<img class=\"pin-cushion-journal-icon\" src=\"${currentIconSelector}\" />`);\n        }\n      }\n      // TODO BETTER MANAGEMENT\n      const currentpageSelector = \"\";\n      const pageCustomSelector = html.find(\"select[name='pageId']\");\n      // Journal Id\n      const valuejournalSelector = html.find(\"select[name='entryId']\")?.val();\n      if (pageCustomSelector && valuejournalSelector) {\n        const pageSelector = html.find(\"select[name='pageId']\");\n\n        if (pageSelector?.length > 0) {\n          pageSelector.on(\"change\", function () {\n            const p = pageCustomSelector.parent().find(\".pin-cushion-page-icon\");\n\n            // Pageid\n            const valuepageSelector = html.find(\"select[name='pageId']\")?.val();\n            if (valuepageSelector) {\n              const pageiimage = retrieveFirstImageFromJournalId(valuejournalSelector, valuepageSelector, true);\n              if (pageiimage) {\n                p[0].src = pageiimage;\n              } else {\n                p[0].src = currentpageSelector;\n              }\n            } else {\n              p[0].src = currentpageSelector;\n            }\n          });\n          const valuepageSelector = html.find(\"select[name='pageId']\")?.val();\n          const pageiimage = retrieveFirstImageFromJournalId(valuejournalSelector, valuepageSelector, true);\n          if (pageiimage) {\n            pageCustomSelector.parent().prepend(`<img class=\"pin-cushion-page-icon\" src=\"${pageiimage}\" />`);\n          } else {\n            // https://gitlab.com/tiwato/journal_icon_numbers/-/issues/33\n            // pageCustomSelector.prop(\"disabled\", false);\n            pageCustomSelector.parent().prepend(`<img class=\"pin-cushion-page-icon\" src=\"${currentpageSelector}\" />`);\n          }\n        } else {\n          pageCustomSelector.parent().prepend(`<img class=\"pin-cushion-page-icon\" src=\"${currentpageSelector}\" />`);\n        }\n      }\n    }\n\n    // TODO add image to default options ?\n    // const iconSelector = html.find(\"select[name='icon.selected']\");\n    // if(iconSelector?.length > 0) {\n    // \ticonSelector.children('option').each( function() {\n    // \t\tconst option = $(this);\n    // \t\toption.prepend(`<img class=\"\" src=\"${option[0].value}\" />`);\n    // \t});\n    // }\n  }\n\n  static _addNoteGM(app, html, noteData) {\n    let gmNoteFlagRef = `flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.PIN_GM_TEXT}`;\n    // Input for GM Label\n    let gmtext = noteData.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.PIN_GM_TEXT);\n    if (!gmtext) gmtext = \"\";\n    let gm_text_h = $(\n      `<div class=\"form-group\">\n        <label for=\"${gmNoteFlagRef}\">${i18n(\"pin-cushion.GMLabel\")}</label>\n        <div class=\"form-fields\">\n          <textarea\n            name=\"${gmNoteFlagRef}\">${gmtext.trim() ?? \"\"}</textarea>\n        </div>\n      </div>`\n    );\n    // html.find(\"input[name='text']\").parent().parent().after(gm_text_h);\n\n    /*\n    <div class=\"form-group\">\n        <label>Text Label</label>\n        <div class=\"form-fields\">\n            <input type=\"text\" name=\"text\" value=\"as22\" placeholder=\"TEST4\">\n        </div>\n    </div>\n    */\n\n    // <input type=\"text\" name=\"text\" value=\"${initial_text.trim() ?? ''}\" placeholder=\"${noteData.entry.name}\">\n\n    // Multiline input for Text Label\n    // this.document.text || this.entry?.name || \"Unknown\"\n    let initial_text = noteData.document.text ?? noteData.entry?.name;\n    if (!initial_text) initial_text = \"\";\n    let initial_text_h = $(\n      `<div class=\"form-group\">\n        <label for=\"text\">${i18n(\"pin-cushion.PlayerLabel\")}</label>\n        <div class=\"form-fields\">\n          <textarea name=\"text\"\n            placeholder=\"${noteData.entry?.name ?? \"\"}\">${initial_text.trim() ?? \"\"}</textarea>\n        </div>\n      </div>`\n    );\n    html.find(\"input[name='text']\").parent().parent().after(initial_text_h);\n\n    // Hide the old text label input field\n    html.find(\"input[name='text']\").parent().parent().remove();\n\n    html.find(\"textarea[name='text']\").parent().parent().before(gm_text_h);\n\n    //let reveal_icon = $(`<div class='form-group'><label>Icon follows Reveal</label><div class='form-fields'><input type='checkbox' name='useRevealIcon'></div></div>`)\n    //html.find(\"select[name='icon']\").parent().parent().after(reveal_icon);\n\n    // // Force a recalculation of the height\n    // if (!app._minimized) {\n    //   let pos = app.position;\n    //   pos.height = 'auto';\n    //   app.setPosition(pos);\n    // }\n  }\n\n  /**\n   * If the Note has a GM-NOTE on it, then display that as the tooltip instead of the normal text\n   * @param {function} [wrapped] The wrapped function provided by libWrapper\n   * @param {object}   [args]    The normal arguments to Note#drawTooltip\n   * @returns {PIXI.Text}\n   */\n  static _addDrawTooltipWithNoteGM(wrapped, ...args) {\n    //const enableNoteGM = game.settings.get(CONSTANTS.MODULE_ID, 'noteGM');\n\n    const hideLabel =\n      (this.document\n        ? this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.HIDE_LABEL)\n        : this.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.HIDE_LABEL)) ?? false;\n\n    const numberWsSuffixOnNameplate =\n      (this.document\n        ? this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.NUMBER_WS_SUFFIX_ON_NAMEPLATE)\n        : this.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.NUMBER_WS_SUFFIX_ON_NAMEPLATE)) ?? 0;\n\n    const ratio_width = isRealNumber(this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.RATIO_WIDTH))\n      ? this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.RATIO_WIDTH)\n      : 1;\n\n    // Only override default if flag(CONSTANTS.MODULE_ID,CONSTANTS.FLAGS.PIN_GM_TEXT) is set\n    if (game.user.isGM) {\n      const newtextGM = this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.PIN_GM_TEXT);\n      if (newtextGM && newtextGM.length > 0) {\n        let result = wrapped(...args);\n        if (hideLabel) {\n          result.text = \"\";\n          // this.document.text = '';\n        } else {\n          if (numberWsSuffixOnNameplate > 0) {\n            result.text = newtextGM + \" \".repeat(numberWsSuffixOnNameplate);\n          } else if (numberWsSuffixOnNameplate < 0) {\n            result.text = \" \".repeat(numberWsSuffixOnNameplate * -1) + newtextGM;\n          } else {\n            result.text = newtextGM;\n          }\n          // this.document.text = newtextGM;\n        }\n\n        if (ratio_width != 1) {\n          let x = result.x;\n          let left = x + ratio_width * (this.size / 2) - 16;\n          result.x = left;\n        }\n        return result;\n      }\n    }\n\n    //// Set a different label to be used while we call the original Note.prototype._drawTooltip\n    ////\n    //// Note#text          = get text()  { return this.document.label; }\n    //// NoteDocument#label = get label() { return this.text || this.entry?.name || \"Unknown\"; }\n    //// but NoteDocument#document.text can be modified :-)\n    ////\n    //// let saved_text = this.document.text;\n    // this.document.text = newtext;\n    let result = wrapped(...args);\n    //// this.document.text = saved_text;\n\n    if (hideLabel) {\n      result.text = \"\";\n    } else {\n      if (numberWsSuffixOnNameplate > 0) {\n        result.text = result.text + \" \".repeat(numberWsSuffixOnNameplate);\n      } else if (numberWsSuffixOnNameplate < 0) {\n        result.text = \" \".repeat(numberWsSuffixOnNameplate * -1) + result.text;\n      }\n    }\n    if (ratio_width != 1) {\n      let x = result.x;\n      let left = x + ratio_width * (this.size / 2) - 16;\n      result.x = left;\n    }\n\n    return result;\n  }\n\n  /**\n   * Draw the map note Tooltip as a Text object\n   * @returns {PIXI.Text}\n   */\n  static _addDrawTooltip2(wrapped, ...args) {\n    const hideLabel =\n      (this.document\n        ? this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.HIDE_LABEL)\n        : this.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.HIDE_LABEL)) ?? false;\n\n    const numberWsSuffixOnNameplate =\n      (this.document\n        ? this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.NUMBER_WS_SUFFIX_ON_NAMEPLATE)\n        : this.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.NUMBER_WS_SUFFIX_ON_NAMEPLATE)) ?? 0;\n\n    const ratio_width = isRealNumber(this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.RATIO_WIDTH))\n      ? this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.RATIO_WIDTH)\n      : 1;\n\n    let result = wrapped(...args);\n    if (hideLabel) {\n      result.text = \"\";\n    } else {\n      if (numberWsSuffixOnNameplate > 0) {\n        result.text = result.text + \" \".repeat(numberWsSuffixOnNameplate);\n      } else if (numberWsSuffixOnNameplate < 0) {\n        result.text = \" \".repeat(numberWsSuffixOnNameplate * -1) + result.text;\n      }\n    }\n    if (ratio_width != 1) {\n      let x = result.x;\n      let left = x + ratio_width * (this.size / 2) - 16;\n      result.x = left;\n    }\n    return result;\n  }\n\n  /**\n   * Wraps the default Note#isVisible to allow the visibility of scene Notes to be controlled by the reveal\n   * state stored in the Note (overriding the default visibility which is based on link accessibility).\n   * @param {function} [wrapped] The wrapper function provided by libWrapper\n   * @param {Object}   [args]    The arguments for Note#refresh\n   * @return [Note]    This Note\n   */\n  static _isVisible(wrapped, ...args) {\n    let result = wrapped(...args);\n    const showOnlyToGM = this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.SHOW_ONLY_TO_GM) ?? false;\n    if (String(showOnlyToGM) === \"true\") {\n      if (!game.user.isGM) {\n        return false;\n      }\n    }\n    /*\n        We only want to change the check of testUserPermission here\n        Note#isVisible()\n            const accessTest = this.page ? this.page : this.entry;\n            const access = accessTest?.testUserPermission(game.user, \"LIMITED\") ?? true;\n            if ( (access === false) || !canvas.effects.visibility.tokenVision || this.document.global ) return access;\n            const point = {x: this.document.x, y: this.document.y};\n            const tolerance = this.document.iconSize / 4;\n            return canvas.effects.visibility.testVisibility(point, {tolerance, object: this});\n        */\n    // See if reveal state is enabled for this note.\n    if (!this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.USE_PIN_REVEALED)) {\n      return wrapped(...args);\n    }\n\n    // Replace the testUserPermission test of Note#isVisible\n    const access = this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.PIN_IS_REVEALED);\n    // Standard version of Note#isVisible\n    if (access === false || !canvas.effects.visibility.tokenVision || this.document.global) {\n      return access;\n    }\n    const point = { x: this.document.x, y: this.document.y };\n    const tolerance = this.document.iconSize / 4;\n    return canvas.effects.visibility.testVisibility(point, { tolerance, object: this });\n  }\n\n  /**\n   * Ensure player notes are updated immediately\n   * @param {*} wrapped\n   * @param  {...any} args\n   * @returns\n   */\n  static _noteUpdate(wrapped, ...args) {\n    const revealedNotes = game.settings.get(CONSTANTS.MODULE_ID, \"revealedNotes\");\n    const [data, options, userId] = args;\n    if (revealedNotes) {\n      // Foundry V11: Note#_onUpdate needs to set refreshText render flag\n      let result = wrapped(data, options, userId);\n      if (this.renderFlags && /*getProperty(data, NOTE_FLAG)*/ data?.flags && data?.flags[CONSTANTS.MODULE_ID]) {\n        // Ensure everything is redrawn - since icon colour might change, not just visibility\n        this.renderFlags.set({ redraw: true });\n      }\n      return result;\n    } else {\n      if (this.renderFlags && /*getProperty(data, NOTE_FLAG)*/ data?.flags && data?.flags[CONSTANTS.MODULE_ID]) {\n        // Ensure everything is redrawn - since icon colour might change, not just visibility\n        this.renderFlags.set({ redraw: true });\n      }\n      return wrapped(...args);\n    }\n  }\n\n  static _applyRenderFlags(wrapped, ...args) {\n    let result = wrapped(...args);\n    const hideLabel = this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.HIDE_LABEL) ?? false;\n    const numberWsSuffixOnNameplate =\n      this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.NUMBER_WS_SUFFIX_ON_NAMEPLATE) ?? 0;\n\n    if (hideLabel) {\n      this.tooltip.visible = false;\n    } else {\n      let textAlwaysVisible = this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TEXT_ALWAYS_VISIBLE) ?? false;\n      if (textAlwaysVisible === true) {\n        this.tooltip.visible = true;\n      }\n    }\n    //TODO Loop memory usage ??\n    // this.refresh();\n\n    return result;\n  }\n\n  /**\n   * Wraps the default Note#refresh to allow the visibility of scene Notes to be controlled by the reveal\n   * state stored in the Note (overriding the default visibility which is based on link accessibility).\n   * @param {function} [wrapped] The wrapper function provided by libWrapper\n   * @param {Object}   [args]    The arguments for Note#refresh\n   * @return [Note]    This Note\n   */\n  static _noteRefresh(wrapped, ...args) {\n    let result = wrapped(...args);\n\n    let textAlwaysVisible = this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TEXT_ALWAYS_VISIBLE) ?? false;\n    // let textVisible = this.hover;\n    if (textAlwaysVisible === true) {\n      // Keep tooltip always visible\n      // Though could make an option out of that too. Would be nicer\n      // TODO it's seem we don't need this\n      // this.position.set(this.document.x, this.document.y);\n      // this.controlIcon.border.visible = this.hover;\n\n      // textVisible = true;\n      this.tooltip.visible = true;\n    }\n    // this.tooltip.visible = textVisible;\n    //this.visible = this.entry?.testUserPermission(game.user, \"LIMITED\") ?? true;\n\n    let text = this.children[1]; // 0 is the ControlIcon, 1 is the PreciseText\n    // Text is created bevor this point. So we can modify it here.\n    let ratio = this.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.RATIO_WIDTH);\n    if (ratio && text?.x) {\n      text.x = (this.size * (ratio - 1)) / 2; // correct shifting for the new scale.\n    }\n    // Bug fixing :Always (when hover) show name of pin up (above) to others pin\n    // https://stackoverflow.com/questions/24909371/move-item-in-array-to-last-position\n    if (!isAlt() && this.hover) {\n      const fromIndex = canvas.notes.placeables.findIndex((note) => note.id === this.id) || 0;\n      canvas.notes.placeables.push(canvas.notes.placeables.splice(fromIndex, 1)[0]);\n    }\n\n    /*\n        // NEW FEATURE : Above fog feature\n        let aboveFogS = String(\n        getProperty(this.document, `this.document.flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.ABOVE_FOG}`),\n        );\n        if (aboveFogS !== 'true' && aboveFogS !== 'false') {\n        aboveFogS = 'false';\n        }\n        const aboveFog = String(aboveFogS) === 'true' ? true : false;\n        if(aboveFog){\n        setProperty(this,`zIndex`, 300);\n        }\n        */\n\n    return result;\n  }\n\n  /* -------------------------------- Listeners ------------------------------- */\n\n  /**\n   * Handles doubleclicks\n   * @param {*} event\n   */\n  static _onDoubleClick(event) {\n    if (canvas.activeLayer._hover) {\n      return;\n    }\n\n    // Silently return when note creation permissions are missing\n    if (!game.user.can(\"NOTE_CREATE\")) return;\n\n    // Warn user when notes can be created, but journal entries cannot\n    if (!game.user.can(\"JOURNAL_CREATE\")) {\n      ui.notifications.warn(\n        game.i18n.format(\"PinCushion.AllowPlayerNotes\", {\n          permission: i18n(\"PERMISSION.JournalCreate\"),\n        })\n      );\n      return;\n    }\n\n    const data = {\n      clientX: event.data.global.x,\n      clientY: event.data.global.y,\n    };\n\n    API.pinCushion._createDialog(data);\n  }\n\n  //   static async _onSingleClick(event) {\n  //     log(\n  //       `Note_onClickLeft: ${event.data.origin.x} ${event.data.origin.y} == ${event.data.global.x} ${event.data.global.y}`\n  //     );\n  //     // Create a new Note at the cursor position and open the Note configuration window for it.\n  //     const noteData = { x: event.data.origin.x, y: event.data.origin.y };\n  //     this._createPreview(noteData, { top: event.data.global.y - 20, left: event.data.global.x + 40 });\n  //   }\n\n  static _drawControlIconInternal(noteInternal) {\n    // Wraps the default Note#_drawControlIcon so that we can override the stored icon tint based\n    // on whether the link is accessible for the current player (or not). This is only done for links which\n    // are using the \"revealed\" flag.\n    const revealedNotes = game.settings.get(CONSTANTS.MODULE_ID, \"revealedNotes\");\n    if (revealedNotes) {\n      if (game.user.isGM) {\n        // Replacement for Note#_drawControlIcon for GMs, to show which pins are revealed.\n        const is_revealed = noteInternal.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.PIN_IS_REVEALED);\n        if (is_revealed != undefined) {\n          const colour = game.settings.get(\n            CONSTANTS.MODULE_ID,\n            is_revealed ? \"revealedNotesTintColorRevealed\" : \"revealedNotesTintColorNotRevealed\"\n          );\n          if (colour?.length > 0) {\n            // Temporarily set the icon tint\n            const saved = noteInternal.document.texture.tint;\n            noteInternal.document.texture.tint = colour;\n            // const result = wrapped(...args);\n            noteInternal.document.texture.tint = saved;\n            // return result;\n          }\n        }\n      } else {\n        // if (!noteInternal.document.getFlag(MODULE_ID, USE_PIN_REVEALED)) return wrapped(...args);\n        const use_reveal = noteInternal.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.USE_PIN_REVEALED);\n        if (use_reveal === undefined || !use_reveal) {\n          // return wrapped(...args);\n        } else {\n          const value = noteInternal.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.USE_PIN_REVEALED);\n          if (value !== undefined) {\n            const is_linked = noteInternal.entry?.testUserPermission(\n              game.user,\n              CONST.DOCUMENT_OWNERSHIP_LEVELS.LIMITED\n            );\n            const colour = game.settings.get(\n              CONSTANTS.MODULE_ID,\n              is_linked ? \"revealedNotesTintColorLink\" : \"revealedNotesTintColorNotLink\"\n            );\n            if (colour?.length > 0) {\n              // Temporarily set the icon tint\n              const saved = noteInternal.document.texture.tint;\n              noteInternal.document.texture.tint = colour;\n              // const result = wrapped(...args);\n              noteInternal.document.texture.tint = saved;\n              // return result;\n            }\n          }\n        }\n      }\n    }\n\n    let tint = noteInternal.document.texture.tint ? Color.from(noteInternal.document.texture.tint) : null;\n    let currentIcon = noteInternal.document.texture.src;\n    const pinIsTransparent = noteInternal.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.PIN_IS_TRANSPARENT);\n    if (String(pinIsTransparent) === \"true\") {\n      currentIcon = CONSTANTS.PATH_TRANSPARENT;\n    }\n\n    let iconData = {\n      texture: stripQueryStringAndHashFromPath(currentIcon),\n      size: noteInternal.size,\n      tint: tint,\n    };\n    let icon;\n    // this is note\n    if (noteInternal.document && noteInternal.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.HAS_BACKGROUND)) {\n      icon = new ControlIcon(iconData);\n      icon.x -= noteInternal.size / 2;\n      icon.y -= noteInternal.size / 2;\n    } else {\n      const enableBackgroundlessPins = game.settings.get(CONSTANTS.MODULE_ID, \"enableBackgroundlessPins\");\n      if (enableBackgroundlessPins) {\n        icon = new BackgroundlessControlIcon(iconData);\n        icon.x -= noteInternal.size / 2;\n        icon.y -= noteInternal.size / 2;\n      } else {\n        icon = new ControlIcon(iconData);\n        icon.x -= noteInternal.size / 2;\n        icon.y -= noteInternal.size / 2;\n      }\n    }\n    const ratio_width = isRealNumber(noteInternal.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.RATIO_WIDTH))\n      ? noteInternal.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.RATIO_WIDTH)\n      : 1;\n    if (ratio_width != 1) {\n      if (noteInternal.document) {\n        icon.width = icon.width * ratio_width; // TODO not sure about this\n      }\n      // else{\n      //   icon.width = noteInternal.getFlag(CONSTANTS.MODULE_ID,  CONSTANTS.FLAGS.RATIO_WIDTH); // compatibility 0.8.9\n      // }\n      // TODO need to centre text of the nameplate ??\n      // https://github.com/p4535992/foundryvtt-pin-cushion/issues/66\n      // https://github.com/p4535992/foundryvtt-pin-cushion/issues/52\n    }\n    // PATCH MODULE autoIconFlags\n    if (noteInternal.document?.flags?.autoIconFlags) {\n      const flagsAutomaticJournalIconNumbers = {\n        autoIcon: noteInternal.document?.flags.autoIconFlags.autoIcon,\n        iconType: noteInternal.document?.flags.autoIconFlags.iconType,\n        iconText: noteInternal.document?.flags.autoIconFlags.iconText,\n        foreColor: noteInternal.document?.flags.autoIconFlags.foreColor,\n        backColor: noteInternal.document?.flags.autoIconFlags.backColor,\n        fontFamily: noteInternal.document?.flags.autoIconFlags.fontFamily,\n      };\n      if (flagsAutomaticJournalIconNumbers.fontFamily) {\n        noteInternal.document.fontFamily = flagsAutomaticJournalIconNumbers.fontFamily;\n      }\n      //noteInternal.controlIcon?.bg?.fill = flagsAutomaticJournalIconNumbers.backColor;\n    }\n    // icon.x -= noteInternal.size / 2;\n    // icon.y -= noteInternal.size / 2;\n    return icon;\n    // } else {\n    //   return undefined;\n    // }\n  }\n\n  /**\n   * Handles draw control icon\n   * @param {*} event\n   */\n  static _drawControlIcon(...args) {\n    const res = PinCushion._drawControlIconInternal(this);\n    /*\n        // Above fog feature\n        let aboveFogS = String(\n        getProperty(this.document, `this.document.flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.ABOVE_FOG}`),\n        );\n        if (aboveFogS !== 'true' && aboveFogS !== 'false') {\n        aboveFogS = 'false';\n        }\n        const aboveFog = String(aboveFogS) === 'true' ? true : false;\n        if(aboveFog){\n        setProperty(this,`zIndex`, 300);\n        }\n        */\n    if (res === undefined) {\n      // return wrapped(...args);\n    } else {\n      return res;\n    }\n  }\n\n  /**\n   * Defines the icon to be drawn for players if enabled.\n   */\n  static _onPrepareNoteData(wrapped) {\n    wrapped();\n\n    // IF not GM and IF  = enabled then take flag path as note.document.texture.src\n    if (!game.user.isGM) {\n      if (this?.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.PLAYER_ICON_STATE)) {\n        this.texture.src = stripQueryStringAndHashFromPath(\n          this.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.PLAYER_ICON_PATH)\n        );\n      }\n    }\n  }\n\n  static _renderJournalThumbnail(app, html) {\n    game.journal.render();\n  }\n\n  static _addJournalThumbnail(app, html, data) {\n    if (\n      (game.user.isGM && game.settings.get(CONSTANTS.MODULE_ID, \"enableJournalThumbnailForGMs\")) ||\n      (!game.user.isGM && game.settings.get(CONSTANTS.MODULE_ID, \"enableJournalThumbnailForPlayers\"))\n    ) {\n      app.documents.forEach((j) => {\n        const htmlEntry = html.find(`.directory-item.document[data-document-id=\"${j.id}\"]`);\n        if (htmlEntry.length !== 1) {\n          return;\n        }\n        // const journalEntryImage = stripQueryStringAndHashFromPath(j.data.img);\n        // \thtmlEntry.prepend(`<img class=\"pin-cushion-thumbnail sidebar-image journal-entry-image\" src=\"${journalEntryImage}\" title=\"${j.name}\"\n        //   alt='Journal Entry Thumbnail'>`);\n        const journalEntryImage = retrieveFirstImageFromJournalId(j.id, undefined, false);\n        if (!journalEntryImage) {\n          return;\n        }\n        let thumbnail = null;\n        if (journalEntryImage.endsWith(\".pdf\")) {\n          // thumbnail = $(\n          // \t`\n          // \t<object data=\"${journalEntryImage}\" type=\"application/pdf\" class=\"pin-cushion-thumbnail sidebar-image journal-entry-image\">\n          // \t\t<embed class=\"pin-cushion-thumbnail sidebar-image journal-entry-image\" src=\"${journalEntryImage}\" type=\"application/pdf\">\n          // \t\t\t<p>This browser does not support PDFs. Please download the PDF to view it: <a href=\"${journalEntryImage}\">Download PDF</a>.</p>\n          // \t\t</embed>\n          // \t</object>\n          // \t`\n          // );\n          thumbnail = $(\n            `<img class=\"pin-cushion-thumbnail sidebar-image journal-entry-image\" src=\"${CONSTANTS.PATH_PDF_THUMBNAIL}\" title=\"${j.name}\" alt='Journal Entry Thumbnail'>`\n          );\n        } else {\n          thumbnail = $(\n            `<img class=\"pin-cushion-thumbnail sidebar-image journal-entry-image\" src=\"${journalEntryImage}\" title=\"${j.name}\" alt='Journal Entry Thumbnail'>`\n          );\n        }\n        switch (game.settings.get(CONSTANTS.MODULE_ID, \"journalThumbnailPosition\")) {\n          case \"right\": {\n            htmlEntry.append(thumbnail);\n            break;\n          }\n          case \"left\": {\n            htmlEntry.prepend(thumbnail);\n            break;\n          }\n          default: {\n            warn(`Must set 'right' or 'left' for sidebar thumbnail image`);\n          }\n        }\n      });\n    }\n  }\n\n  static _deleteJournalDirectoryPagesEntry() {\n    if (game.settings.get(CONSTANTS.MODULE_ID, \"enableJournalDirectoryPages\")) {\n      ui.sidebar.tabs.journal.render(true);\n      for (let window of [...Object.values(ui.windows)].filter((w) => w.title == \"Journal Directory\")) {\n        window.render(true);\n      }\n    }\n  }\n\n  static _createJournalDirectoryPagesEntry() {\n    if (game.settings.get(CONSTANTS.MODULE_ID, \"enableJournalDirectoryPages\")) {\n      ui.sidebar.tabs.journal.render(true);\n      for (let window of [...Object.values(ui.windows)].filter((w) => w.title == \"Journal Directory\")) {\n        window.render(true);\n      }\n    }\n  }\n\n  static _addJournalDirectoryPages(app, html, options) {\n    if (game.settings.get(CONSTANTS.MODULE_ID, \"enableJournalDirectoryPages\")) {\n      for (let j of app.documents) {\n        if (!j.pages.size) continue;\n        let $li = html.find(`li[data-document-id=\"${j.id}\"]`);\n        $li.css({ flex: \"unset\", display: \"block\" });\n        let $button = $(\n          `<a class=\"toggle\" style=\"width:50px; float: right; text-align: right; padding-right: .5em;\"><i class=\"fa-solid fa-caret-down\"></i></a>`\n        ).click(function (e) {\n          e.stopPropagation();\n          $(this).parent().parent().find(\"ol\").toggle();\n          $(this).parent().parent().find(\"ol\").is(\":hidden\")\n            ? $(this).html('<i class=\"fa-solid fa-caret-down\"></i>')\n            : $(this).html('<i class=\"fa-solid fa-caret-up\"></i>');\n        });\n        $li.find(\"h4\").append($button).css({ \"flex-basis\": \"100%\", overflow: \"ellipsis\" });\n        let $ol = $(`<ol class=\"journal-pages\" style=\"width:100%; margin-left: 1em;\" start=\"0\"></ol>`);\n        $ol.hide();\n        for (let p of j.pages.contents.sort((a, b) => {\n          return a.sort - b.sort;\n        }))\n          $ol.append($(`<li class=\"journal-page\" data-page-uuid=\"${p.uuid}\"><a>${p.name}</a></li>`));\n        $li.append($ol);\n      }\n      $(html)\n        .find(\"li.journal-page > a\")\n        .click(function (e) {\n          e.stopPropagation();\n          let page = fromUuidSync($(this).parent().data().pageUuid);\n          if (!page) return;\n          page.parent.sheet.render(true, { pageId: page.id, focus: true });\n        })\n        .contextmenu(function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n          let page = fromUuidSync($(this).parent().data().pageUuid);\n          if (!page) return;\n          page.sheet.render(true);\n        });\n    }\n  }\n\n  /**\n   * Sets whether this Note is revealed (visible) to players; overriding the default FoundryVTT rules.\n   * The iconTint/texture.tint will also be set on the Note based on whether there is a link that the player can access.\n   * If this function is never called then the default FoundryVTT visibility rules will apply\n   * @param [NoteData] [notedata] The NoteData whose visibility is to be set (can be used before the Note has been created)\n   * @param {Boolean}  [visible]  pass in true if the Note should be revealed to players\n   */\n  static setNoteRevealed(notedata, visible) {\n    const revealedNotes = game.settings.get(CONSTANTS.MODULE_ID, \"revealedNotes\");\n    if (revealedNotes) {\n      visible = getProperty(notedata, `flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.PIN_IS_REVEALED}`);\n      if (visible) {\n        const FLAG_IS_REVEALED = `flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.PIN_IS_REVEALED}`;\n        const FLAG_USE_REVEALED = `flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.USE_PIN_REVEALED}`;\n        // notedata might not exist as a Note, so setFlag is not available\n        setProperty(notedata, FLAG_USE_REVEALED, true);\n        setProperty(notedata, FLAG_IS_REVEALED, visible);\n      }\n    }\n  }\n\n  static renderHeadsUpDisplayV1(hud, html, data) {\n    canvas.hud.PinCushion = new PinCushionHUD();\n    const hudTemp = document.createElement(\"template\");\n    hudTemp.id = \"pin-cushion-hud\";\n    html.append(hudTemp);\n  }\n\n  /**\n   * Note.prototype._onClickLeft and Note.prototype._onClickRight seem to work only on the NoteLayer\n   * @href https://github.com/foundryvtt/foundryvtt/issues/8770\n   * @param {*} wrapped\n   * @param  {...any} args\n   * @returns\n   */\n  static _canControl(wrapped, ...args) {\n    if (canvas.activeLayer instanceof TokenLayer) {\n      info(`Applied can control override`);\n      const [user, event] = args;\n      if (this.isPreview) {\n        return false;\n      }\n      // return this.document.canUserModify(user, \"update\");\n      const enableDragNoteOnTokenLayerIfGM = game.settings.get(CONSTANTS.MODULE_ID, \"enableDragNoteOnTokenLayerIfGM\");\n      if (enableDragNoteOnTokenLayerIfGM && game.user.isGM) {\n        return true;\n      }\n    }\n    let result = wrapped(...args);\n    return result;\n  }\n}\n","import { PinCushion } from \"./apps/PinCushion.js\";\n// import { PinCushionContainer } from \"./apps/PinCushionContainer.js\";\n// import { PinCushionHUDV2 } from \"./apps/PinCushionHUDV2.js\";\nimport { error, warn } from \"./lib/lib.js\";\n\nconst API = {\n  pinCushion: new PinCushion(),\n  // pinCushionContainers: {},\n  /**\n   * Request an action to be executed with GM privileges.\n   *\n   * @static\n   * @param {object} message - The object that will get emitted via socket\n   * @param {string} message.action - The specific action to execute\n   * @returns {Promise} The promise of the action which will be resolved after execution by the GM\n   */\n  async requestEventArr(...inAttributes) {\n    if (!Array.isArray(inAttributes)) {\n      throw error(\"requestEventArr | inAttributes must be of type array\");\n    }\n    const [message] = inAttributes; // e.g. { action: \"createFolder\" }\n    // A request has to define what action should be executed by the GM\n    // if (!'action' in message) {\n    //   return;\n    // }\n    if (!Object.keys(message)?.includes(\"action\")) {\n      warn(`Message doesn't contain the 'action'`);\n      return;\n    }\n    const id = `${game.user.id}_${Date.now()}_${randomID()}`;\n    message.id = id;\n    // let baseFolder = (\n    //   game.folders?.contents.filter(\n    //     (x) => x.type == 'Journal' && f.name?.toLowerCase() == game.user.name.toLowerCase(),\n    //   )[0]\n    // );\n    let baseFolder = game.journal.directory.folders.find(\n      (f) => f.name?.toLowerCase() === game.user.name?.toLowerCase()\n    );\n    if (!baseFolder) {\n      baseFolder = await Folder.create({\n        id: message.id,\n        name: game.user.name,\n        type: \"Journal\",\n        parent: null,\n      });\n    }\n    return baseFolder;\n  },\n\n  async setNoteRevealedArr(...inAttributes) {\n    if (!Array.isArray(inAttributes)) {\n      throw error(\"requestEventArr | inAttributes must be of type array\");\n    }\n    const [notedata, visible] = inAttributes; // e.g. { action: \"createFolder\" }\n    this.setNoteRevealed(notedata, visible);\n  },\n\n  async setNoteRevealed(notedata, visible) {\n    PinCushion.setNoteRevealed(notedata, visible);\n  },\n};\nexport default API;\n","import CONSTANTS from \"./constants.js\";\nimport API from \"./api.js\";\nimport { debug } from \"./lib/lib.js\";\nimport { setSocket } from \"../module.js\";\n\nexport let pinCushionSocket;\nexport function registerSocket() {\n  debug(\"Registered pinCushionSocket\");\n  if (pinCushionSocket) {\n    return pinCushionSocket;\n  }\n\n  // eslint-disable-next-line no-undef\n  pinCushionSocket = socketlib.registerModule(CONSTANTS.MODULE_ID);\n\n  pinCushionSocket.register(\"requestEvent\", (...args) => API.requestEventArr(...args));\n  pinCushionSocket.register(\"setNoteRevealed\", (...args) => API.setNoteRevealedArr(...args));\n\n  setSocket(pinCushionSocket);\n  return pinCushionSocket;\n}\n","/* ------------------------------------ */\n/* Other Hooks\t\t\t\t\t\t\t*/\n/* ------------------------------------ */\n\nimport * as powertip from \"./scripts/lib/jquery.powertip.js\";\nimport API from \"./scripts/api.js\";\nimport CONSTANTS from \"./scripts/constants.js\";\nimport {\n  log,\n  debug,\n  isRealNumber,\n  stripQueryStringAndHashFromPath,\n  error,\n  retrieveFirstImageFromJournalId,\n  i18n,\n  warn,\n} from \"./scripts/lib/lib.js\";\nimport { registerSettings } from \"./scripts/settings.js\";\nimport { pinCushionSocket, registerSocket } from \"./scripts/socket.js\";\nimport { PinCushionHUD } from \"./scripts/apps/PinCushionHUD.js\";\nimport { PinCushion } from \"./scripts/apps/PinCushion.js\";\n// import { ActionConfig } from \"/modules/monks-active-tiles/apps/action-config.js\";\n// import { MonksActiveTiles } from \"/modules/monks-active-tiles/monks-active-tiles.js\";\n// import { PinCushionContainer } from \"./scripts/apps/PinCushionContainer.js\";\n// import { PinCushionHUDV2 } from \"./scripts/apps/PinCushionHUDV2.js\";\n// import { noteControl } from \"./scripts/apps/NoteControl.js\";\n\n/**\n * Initialization helper, to set API.\n * @param api to set to game module.\n */\nexport function setApi(api) {\n  const data = game.modules.get(CONSTANTS.MODULE_ID);\n  data.api = api;\n}\n/**\n * Returns the set API.\n * @returns Api from games module.\n */\nexport function getApi() {\n  const data = game.modules.get(CONSTANTS.MODULE_ID);\n  return data.api;\n}\n/**\n * Initialization helper, to set Socket.\n * @param socket to set to game module.\n */\nexport function setSocket(socket) {\n  const data = game.modules.get(CONSTANTS.MODULE_ID);\n  data.socket = socket;\n}\n/*\n * Returns the set socket.\n * @returns Socket from games module.\n */\nexport function getSocket() {\n  const data = game.modules.get(CONSTANTS.MODULE_ID);\n  return data.socket;\n}\n\n/* -------------------------------------------------------------------------- */\n/*                                    Hooks                                   */\n/* -------------------------------------------------------------------------- */\n\n/* ------------------------------------ */\n/* Initialize module\t\t\t\t\t*/\n/* ------------------------------------ */\nHooks.once(\"init\", function () {\n  log(\" init \" + CONSTANTS.MODULE_ID);\n  // TODO TO REMOVE\n  globalThis.PinCushion = PinCushion;\n  // globalThis.setNoteRevealed = setNoteRevealed; // Seem not necessary\n  // globalThis.setNoteGMtext = setNoteGMtext // Seem not necessary\n  registerSettings();\n\n  // // href: https://stackoverflow.com/questions/8853396/logical-operator-in-a-handlebars-js-if-conditional/16315366#16315366\n  // // e.g. {{#ifCond var1 '==' var2}}\n  // Handlebars.registerHelper(\"ifCond\", function (v1, operator, v2, options) {\n  // \tswitch (operator) {\n  // \t\tcase \"==\": {\n  // \t\t\treturn v1 == v2 ? options.fn(this) : options.inverse(this);\n  // \t\t}\n  // \t\tcase \"===\": {\n  // \t\t\treturn v1 === v2 ? options.fn(this) : options.inverse(this);\n  // \t\t}\n  // \t\tcase \"!=\": {\n  // \t\t\treturn v1 != v2 ? options.fn(this) : options.inverse(this);\n  // \t\t}\n  // \t\tcase \"!==\": {\n  // \t\t\treturn v1 !== v2 ? options.fn(this) : options.inverse(this);\n  // \t\t}\n  // \t\tcase \"<\": {\n  // \t\t\treturn v1 < v2 ? options.fn(this) : options.inverse(this);\n  // \t\t}\n  // \t\tcase \"<=\": {\n  // \t\t\treturn v1 <= v2 ? options.fn(this) : options.inverse(this);\n  // \t\t}\n  // \t\tcase \">\": {\n  // \t\t\treturn v1 > v2 ? options.fn(this) : options.inverse(this);\n  // \t\t}\n  // \t\tcase \">=\": {\n  // \t\t\treturn v1 >= v2 ? options.fn(this) : options.inverse(this);\n  // \t\t}\n  // \t\tcase \"&&\": {\n  // \t\t\treturn v1 && v2 ? options.fn(this) : options.inverse(this);\n  // \t\t}\n  // \t\tcase \"||\": {\n  // \t\t\treturn v1 || v2 ? options.fn(this) : options.inverse(this);\n  // \t\t}\n  // \t\tdefault: {\n  // \t\t\treturn options.inverse(this);\n  // \t\t}\n  // \t}\n  // });\n\n  Hooks.once(\"socketlib.ready\", registerSocket);\n\n  // eslint-disable-next-line no-undef\n  libWrapper.register(CONSTANTS.MODULE_ID, \"NotesLayer.prototype._onClickLeft2\", PinCushion._onDoubleClick, \"OVERRIDE\");\n\n  const enablePlayerIconAutoOverride = game.settings.get(CONSTANTS.MODULE_ID, \"playerIconAutoOverride\");\n  if (enablePlayerIconAutoOverride) {\n    // eslint-disable-next-line no-undef\n    libWrapper.register(\n      CONSTANTS.MODULE_ID,\n      \"NoteDocument.prototype.prepareData\",\n      PinCushion._onPrepareNoteData,\n      \"WRAPPER\"\n    );\n  }\n  // ====================================\n  // START SUPPORT MATT\n  // ====================================\n  /*\n\tconst allowNote = game.settings.get(CONSTANTS.MODULE_ID, \"allow-note\");\n\tif (game.modules.get(\"monks-active-tiles\")?.active && allowNote) {\n\t\tlibWrapper.register(CONSTANTS.MODULE_ID, \"Note.prototype._onClickLeft\", noteControl, \"WRAPPER\");\n\t\tlibWrapper.register(CONSTANTS.MODULE_ID, \"Note.prototype._onClickRight\", noteControl, \"WRAPPER\");\n\t}\n\t*/\n  // ====================================\n  // END SUPPORT MATT\n  // ====================================\n});\n\n/* ------------------------------------ */\n/* Setup module\t\t\t\t\t\t\t*/\n/* ------------------------------------ */\nHooks.once(\"setup\", function () {\n  setApi(API);\n\n  const forceToShowNotes = game.settings.get(CONSTANTS.MODULE_ID, \"forceToShowNotes\");\n  if (forceToShowNotes) {\n    // Automatically flag journal notes to show on the map without having to have your players turn it on themselves.\n    game.settings.set(\"core\", \"notesDisplayToggle\", true);\n  }\n\n  const enableAutoScaleNamePlatesNote = game.settings.get(CONSTANTS.MODULE_ID, \"enableAutoScaleNamePlatesNote\");\n  if (enableAutoScaleNamePlatesNote) {\n    Hooks.once(\"canvasReady\", () => {\n      Hooks.on(\"canvasPan\", (c) => {\n        if (game.scenes.get(c.scene.id).isView) {\n          PinCushion.autoScaleNotes(c);\n        }\n      });\n    });\n  }\n});\n\n/* ------------------------------------ */\n/* When ready\t\t\t\t\t\t\t*/\n/* ------------------------------------ */\n\nHooks.once(\"ready\", function () {\n  if (!game.modules.get(\"lib-wrapper\")?.active && game.user?.isGM) {\n    let word = \"install and activate\";\n    if (game.modules.get(\"lib-wrapper\")) word = \"activate\";\n    throw error(`Requires the 'libWrapper' module. Please ${word} it.`);\n  }\n  if (!game.modules.get(\"socketlib\")?.active && game.user?.isGM) {\n    let word = \"install and activate\";\n    if (game.modules.get(\"socketlib\")) word = \"activate\";\n    throw error(`Requires the 'socketlib' module. Please ${word} it.`);\n  }\n  // Instantiate PinCushion instance for central socket request handling\n  // game.pinCushion = new PinCushion();\n});\n\n/**\n * Hook on note config render to inject filepicker and remove selector\n * Update Note config window with a text box to allow entry of GM-text.\n * Also replace single-line of \"Text Label\" with a textarea to allow multi-line text.\n * @param {NoteConfig} app    The Application instance being rendered (NoteConfig)\n * @param {jQuery} html       The inner HTML of the document that will be displayed and may be modified\n * @param {object] data       The object of data used when rendering the application (from NoteConfig#getData)\n */\nHooks.on(\"renderNoteConfig\", async (app, html, noteData) => {\n  if (!app.object.flags[CONSTANTS.MODULE_ID]) {\n    // TODO WHY IS THIS NOT WORKING ??\n    // setProperty(app.object.flags[CONSTANTS.MODULE_ID], {});\n    app.object.flags[CONSTANTS.MODULE_ID] = {};\n  }\n  let entity = app.object.flags[CONSTANTS.MODULE_ID] || {};\n\n  // TODO THIS CODE CAN B DONE MUCH BETTER...\n  const showJournalImageByDefault = game.settings.get(CONSTANTS.MODULE_ID, \"showJournalImageByDefault\");\n\n  if (\n    showJournalImageByDefault &&\n    noteData.document.entryId &&\n    !app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.CUSHION_ICON)\n  ) {\n    // Journal id\n    const journal = game.journal.get(noteData.document.entryId);\n    if (journal) {\n      const journalEntryImage = retrieveFirstImageFromJournalId(journal.id, app.object?.pageId, false);\n      if (journalEntryImage) {\n        setProperty(noteData.document.texture, \"src\", stripQueryStringAndHashFromPath(journalEntryImage));\n      }\n    } else {\n      warn(`The journal with id '${noteData.document.entryId}' do not exists anymore`);\n    }\n  }\n\n  const defaultNoteImageOnCreate = game.settings.get(CONSTANTS.MODULE_ID, \"defaultNoteImageOnCreate\");\n\n  let tmp = undefined;\n  if (noteData.icon.custom) {\n    tmp = stripQueryStringAndHashFromPath(noteData.icon.custom);\n  } else if (app.object.texture.src) {\n    tmp = stripQueryStringAndHashFromPath(app.object.texture.src);\n  } else if (noteData.document.texture.src) {\n    tmp = stripQueryStringAndHashFromPath(noteData.document.texture.src);\n  }\n  // TODO find a better method for the double check\n  if (tmp === \"icons/svg/book.svg\" && noteData.icon.custom) {\n    tmp = stripQueryStringAndHashFromPath(noteData.icon.custom);\n  }\n  if (tmp === \"icons/svg/book.svg\" && defaultNoteImageOnCreate) {\n    tmp = stripQueryStringAndHashFromPath(defaultNoteImageOnCreate);\n  }\n  if (tmp === \"icons/svg/book.svg\" && noteData.document.texture.src) {\n    tmp = stripQueryStringAndHashFromPath(noteData.document.texture.src);\n  }\n  const pinCushionIcon = getProperty(app.object.flags, `${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.CUSHION_ICON}`);\n  if (pinCushionIcon) {\n    tmp = stripQueryStringAndHashFromPath(pinCushionIcon);\n  }\n\n  PinCushion._replaceIconSelector(app, html, noteData, tmp);\n  //Causes a bug when attempting to place an journal entry onto the canvas in Foundry 9.\n  //await app.object.setFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.CUSHION_ICON, tmp);\n  setProperty(app.object.flags[CONSTANTS.MODULE_ID], CONSTANTS.FLAGS.CUSHION_ICON, tmp);\n\n  const enableNoteGM = game.settings.get(CONSTANTS.MODULE_ID, \"noteGM\");\n  if (enableNoteGM) {\n    PinCushion._addNoteGM(app, html, noteData);\n  }\n\n  const enableJournalAnchorLink = game.settings.get(CONSTANTS.MODULE_ID, \"enableJournalAnchorLink\");\n  if (enableJournalAnchorLink && !game.modules.get(\"jal\")?.active) {\n    function getOptions(page, current) {\n      let options = \"<option></option>\";\n      for (const key in page?.toc) {\n        const section = page.toc[key];\n        options += `<option value=\"${section.slug}\"${section.slug === current ? \" selected\" : \"\"}>${\n          section.text\n        }</option>`;\n      }\n      return options;\n    }\n    // <select name=\"flags.anchor.slug\">${getOptions(noteData.document.page, noteData.document.flags.anchor?.slug)}</select>\n    let anchorData = getProperty(noteData.document.flags, `${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.JAL_ANCHOR}`); // noteData.document.flags.anchor;\n    let pageData = noteData.document.page;\n    let select = $(`\n\t\t<div class='form-group'>\n\t\t\t<label>${i18n(`${CONSTANTS.MODULE_ID}.PageSection`)}</label>\n\t\t\t<div class='form-fields'>\n\t\t\t\t<select name=\"flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.JAL_ANCHOR}.slug\">\n\t\t\t\t\t${getOptions(pageData, anchorData?.slug)}\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t</div>`);\n    const pageid = html.find(\"select[name='pageId']\");\n    pageid.parent().parent().after(select);\n\n    // on change of page or journal entry\n    function _updateSectionList() {\n      const newjournalid = app.form.elements.entryId?.value;\n      const newpageid = app.form.elements.pageId?.value;\n      const journal = game.journal.get(newjournalid);\n      const newpage = journal?.pages.get(newpageid);\n      log(`selected page changed to ${newpageid}`);\n      // getOptions(newpage, data.document.flags.anchor?.slug))\n      log(\"new options =\" + getOptions(newpage, anchorData?.slug));\n      // app.form.elements[\"flags.anchor.slug\"].innerHTML = getOptions(newpage, data.document.flags.anchor?.slug);\n      app.form.elements[`flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.JAL_ANCHOR}.slug`].innerHTML = getOptions(\n        newpage,\n        anchorData?.slug\n      );\n      // app.form.elements[\"flags.anchor.slug\"].innerHTML\n      log(\n        \"new innerHtml\" + app.form.elements[`flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.JAL_ANCHOR}.slug`].innerHTML\n      );\n    }\n    html.find(\"select[name='entryId']\").change(_updateSectionList);\n    pageid.change(_updateSectionList);\n  }\n\n  // PinCushion._addShowImageField(app, html, noteData);\n  // PinCushion._addPinIsTransparentField(app, html, noteData);\n  // PinCushion._addShowOnlyToGMField(app, html, noteData);\n  // PinCushion._addBackgroundField(app, html, noteData);\n  // PinCushion._addHideLabel(app, html, noteData);\n\n  // const enablePlayerIcon = game.settings.get(CONSTANTS.MODULE_ID, \"playerIconAutoOverride\");\n  // if (enablePlayerIcon) {\n  // \tPinCushion._addPlayerIconField(app, html, noteData);\n  // }\n\n  // const enableNoteTintColorLink = game.settings.get(CONSTANTS.MODULE_ID, \"revealedNotes\");\n  // if (enableNoteTintColorLink) {\n  //\tPinCushion._addNoteTintColorLink(app, html, noteData);\n  // }\n\n  // PinCushion._addPreviewAsTextSnippet(app, html, noteData);\n  // PinCushion._addDoNotShowJournalPreview(app, html, noteData);\n\n  // PinCushion._addTooltipHandler(app, html, noteData);\n\n  // TODO\n  //PinCushion._addAboveFog(app, html, data);\n\n  // Force a recalculation of the height (for the additional field)\n  if (!app._minimized) {\n    let pos = app.position;\n    pos.height = \"auto\";\n    app.setPosition(pos);\n  }\n\n  if (!game.user.isGM) {\n    return;\n  }\n\n  // ====================================\n  // START SUPPORT MATT\n  // ====================================\n  /*\n\tconst allowNote = game.settings.get(CONSTANTS.MODULE_ID, \"allow-note\");\n\tlet triggerData = {};\n\tlet tilename = \"\";\n\tlet noteTriggersHtml = \"\";\n\tif (game.modules.get(\"monks-active-tiles\")?.active && allowNote) {\n\t\tlet entity = app.object.flags[\"monks-active-tiles\"]?.entity || {};\n\t\tif (typeof entity == \"string\" && entity) {\n\t\t\tentity = JSON.parse(entity);\n\t\t}\n\n\t\tif (entity.id) {\n\t\t\ttilename =\n\t\t\t\tentity.id == \"within\" ? i18n(\"MonksActiveTiles.WithinWall\") : await MonksActiveTiles.entityName(entity);\n\t\t}\n\t\ttriggerData = mergeObject(\n\t\t\t{\n\t\t\t\ttilename: tilename,\n\t\t\t\tshowtagger: game.modules.get(\"tagger\")?.active\n\t\t\t},\n\t\t\tapp.object.flags[\"monks-active-tiles\"] || {}\n\t\t);\n\t\ttriggerData.entity = JSON.stringify(entity);\n\t\tnoteTriggersHtml = await renderTemplate(\n\t\t\t`modules/${CONSTANTS.MODULE_ID}/templates/note-triggers-config.html`,\n\t\t\ttriggerData\n\t\t);\n\t}\n\t*/\n  // ====================================\n  // END SUPPORT MATT\n  // ====================================\n\n  // ====================================\n  // General\n  // ====================================\n  const showImageExplicitSource = stripQueryStringAndHashFromPath(\n    app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.SHOW_IMAGE_EXPLICIT_SOURCE) ?? \"\"\n  );\n  const showImage = app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.SHOW_IMAGE) ?? false;\n  const pinIsTransparent = app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.PIN_IS_TRANSPARENT) ?? false;\n  const showOnlyToGM = app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.SHOW_ONLY_TO_GM) ?? false;\n\n  const hasBackground =\n    (app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.HAS_BACKGROUND)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.HAS_BACKGROUND)) ?? 0;\n  const ratio =\n    (app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.RATIO_WIDTH)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.RATIO_WIDTH)) ?? 1;\n  const textAlwaysVisible =\n    (app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TEXT_ALWAYS_VISIBLE)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TEXT_ALWAYS_VISIBLE)) ?? false;\n  const hideLabel =\n    (app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.HIDE_LABEL)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.HIDE_LABEL)) ?? false;\n\n  const numberWsSuffixOnNameplate =\n    (app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.NUMBER_WS_SUFFIX_ON_NAMEPLATE)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.NUMBER_WS_SUFFIX_ON_NAMEPLATE)) ?? 0;\n\n  // ====================================\n  // enablePlayerIcon\n  // ====================================\n  const enablePlayerIcon = game.settings.get(CONSTANTS.MODULE_ID, \"playerIconAutoOverride\");\n  // Adds fields to set player-only note icons\n  // Get default values set by GM\n  const defaultState = game.settings.get(CONSTANTS.MODULE_ID, \"playerIconAutoOverride\") ?? ``;\n  const defaultPath = game.settings.get(CONSTANTS.MODULE_ID, \"playerIconPathDefault\") ?? ``;\n\n  const playerIconState =\n    getProperty(noteData, `document.flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.PLAYER_ICON_STATE}`) ?? defaultState;\n  const playerIconPath = stripQueryStringAndHashFromPath(\n    getProperty(noteData, `document.flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.PLAYER_ICON_PATH}`) ?? defaultPath\n  );\n\n  // ====================================\n  // revealedNotes\n  // ====================================\n  const enableNoteTintColorLink = game.settings.get(CONSTANTS.MODULE_ID, \"revealedNotes\");\n  let pinIsRevealed =\n    getProperty(noteData, `document.flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.PIN_IS_REVEALED}`) ?? true;\n  // Check box for REVEALED state\n  let usePinIsRevealed =\n    getProperty(noteData, `document.flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.USE_PIN_REVEALED}`) ?? false;\n\n  // ====================================\n  // Tooltip\n  // ====================================\n\n  let doNotShowJournalPreviewS = String(\n    app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.DO_NOT_SHOW_JOURNAL_PREVIEW)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.DO_NOT_SHOW_JOURNAL_PREVIEW)\n  );\n  if (doNotShowJournalPreviewS !== \"true\" && doNotShowJournalPreviewS !== \"false\") {\n    if (game.settings.get(CONSTANTS.MODULE_ID, \"enableTooltipByDefault\")) {\n      doNotShowJournalPreviewS = \"false\";\n    } else {\n      doNotShowJournalPreviewS = \"true\";\n    }\n  }\n  const doNotShowJournalPreview = String(doNotShowJournalPreviewS) === \"true\" ? true : false;\n\n  const previewAsTextSnippet =\n    (app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.PREVIEW_AS_TEXT_SNIPPET)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.PREVIEW_AS_TEXT_SNIPPET)) ?? false;\n\n  const tooltipPlacement =\n    (app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_PLACEMENT)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_PLACEMENT)) ?? \"e\";\n\n  const tooltipColor =\n    (app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_COLOR)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_COLOR)) ?? \"\";\n\n  const tooltipForceRemove =\n    (app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_FORCE_REMOVE)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_FORCE_REMOVE)) ?? false;\n\n  const tooltipSmartPlacement =\n    (app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_SMART_PLACEMENT)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_SMART_PLACEMENT)) ?? false;\n\n  const tooltipFollowMouse =\n    (app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_FOLLOW_MOUSE)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_FOLLOW_MOUSE)) ?? false;\n\n  const tooltipPlacementHtml = `\n\t\t<select\n\t\tid=\"pin-cushion-tooltip-placement\"\n\t\tstyle=\"width: 100%;\"\n\t\tname=\"flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.TOOLTIP_PLACEMENT}\">\n\t\t<option\n\t\t\tvalue=\"nw-alt\"\n\t\t\t${tooltipPlacement === \"nw-alt\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Placement.choices.north-west-alt\")}\n\t\t</option>\n\t\t<option\n\t\t\tvalue=\"nw\"\n\t\t\t${tooltipPlacement === \"nw\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Placement.choices.north-west\")}\n\t\t</option>\n\t\t<option\n\t\t\tvalue=\"n\"\n\t\t\t${tooltipPlacement === \"n\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Placement.choices.north\")}\n\t\t\t</option>\n\t\t<option\n\t\t\tvalue=\"ne\"\n\t\t\t${tooltipPlacement === \"ne\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Placement.choices.north-east\")}\n\t\t\t</option>\n\t\t<option\n\t\t\tvalue=\"ne-alt\"\n\t\t\t${tooltipPlacement === \"ne-alt\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Placement.choices.north-east-alt\")}\n\t\t\t</option>\n\t\t<option\n\t\t\tvalue=\"w\"\n\t\t\t${tooltipPlacement === \"w\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Placement.choices.west\")}\n\t\t\t</option>\n\t\t<option\n\t\t\tvalue=\"e\"\n\t\t\t${tooltipPlacement === \"e\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Placement.choices.east\")}\n\t\t\t</option>\n\t\t<option\n\t\t\tvalue=\"sw-alt\"\n\t\t\t${tooltipPlacement === \"sw-alt\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Placement.choices.south-west-alt\")}\n\t\t\t</option>\n\t\t<option\n\t\t\tvalue=\"sw\"\n\t\t\t${tooltipPlacement === \"sw\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Placement.choices.south-west\")}\n\t\t</option>\n\t\t<option\n\t\t\tvalue=\"s\"\n\t\t\t${tooltipPlacement === \"s\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Placement.choices.south\")}\n\t\t</option>\n\t\t<option\n\t\t\tvalue=\"se\"\n\t\t\t${tooltipPlacement === \"se\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Placement.choices.south-east\")}\n\t\t</option>\n\t\t<option\n\t\t\tvalue=\"se-alt\"\n\t\t\t${tooltipPlacement === \"se-alt\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Placement.choices.south-east-alt\")}\n\t\t</option>\n\t\t</select>\n\t`;\n  const tooltipColorHtml = `\n\t<select\n\t\tid=\"pin-cushion-tooltip-color\"\n\t\tstyle=\"width: 100%;\"\n\t\tname=\"flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.TOOLTIP_COLOR}\">\n\t\t<option\n\t\tvalue=\"\" ${tooltipColor === \"\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Color.choices.default\")}\n\t\t</option>\n\t\t<option\n\t\tvalue=\"blue\"\n\t\t${tooltipColor === \"blue\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Color.choices.blue\")}\n\t\t</option>\n\t\t<option\n\t\tvalue=\"dark\"\n\t\t${tooltipColor === \"dark\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Color.choices.dark\")}\n\t\t</option>\n\t\t<option\n\t\tvalue=\"green\"\n\t\t${tooltipColor === \"green\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Color.choices.green\")}\n\t\t</option>\n\t\t<option\n\t\tvalue=\"light\"\n\t\t${tooltipColor === \"light\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Color.choices.light\")}\n\t\t</option>\n\t\t<option\n\t\tvalue=\"orange\"\n\t\t${tooltipColor === \"orange\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Color.choices.orange\")}\n\t\t</option>\n\t\t<option value=\"purple\"\n\t\t${tooltipColor === \"purple\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Color.choices.purple\")}\n\t\t</option>\n\t\t<option\n\t\tvalue=\"red\"\n\t\t${tooltipColor === \"red\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Color.choices.red\")}\n\t\t</option>\n\t\t<option\n\t\tvalue=\"yellow\"\n\t\t${tooltipColor === \"yellow\" ? \"selected\" : \"\"}>\n\t\t\t${i18n(\"pin-cushion.Tooltip.Color.choices.yellow\")}\n\t\t</option>\n\t</select>\n\t`;\n\n  const tooltipCustomDescription =\n    (app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_CUSTOM_DESCRIPTION)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_CUSTOM_DESCRIPTION)) ?? \"\";\n\n  let tooltipShowDescriptionS = String(\n    app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_SHOW_DESCRIPTION)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_SHOW_DESCRIPTION)\n  );\n  if (tooltipShowDescriptionS !== \"true\" && tooltipShowDescriptionS !== \"false\") {\n    tooltipShowDescriptionS = \"true\";\n  }\n  const tooltipShowDescription = String(tooltipShowDescriptionS) === \"true\" ? true : false;\n\n  let tooltipShowTitleS = String(\n    app.document\n      ? app.document.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_SHOW_TITLE)\n      : app.object.getFlag(CONSTANTS.MODULE_ID, CONSTANTS.FLAGS.TOOLTIP_SHOW_TITLE)\n  );\n  if (tooltipShowTitleS !== \"true\" && tooltipShowTitleS !== \"false\") {\n    tooltipShowTitleS = \"true\";\n  }\n  const tooltipShowTitle = String(tooltipShowTitleS) === \"true\" ? true : false;\n\n  // ====================================\n  // Other\n  // ====================================\n  const enableBackgroundlessPins = game.settings.get(CONSTANTS.MODULE_ID, \"enableBackgroundlessPins\");\n\n  let pinCushionData = mergeObject(\n    {\n      yesUploadFile: game.user.can(\"FILES_BROWSE\"),\n      noUploadFile: !game.user.can(\"FILES_BROWSE\"),\n      showImageExplicitSource: showImageExplicitSource,\n\n      showImage: showImage,\n      pinIsTransparent: pinIsTransparent,\n      showOnlyToGM: showOnlyToGM,\n      hasBackground: hasBackground,\n      ratio: ratio,\n      textAlwaysVisible: textAlwaysVisible,\n      hideLabel: hideLabel,\n      numberWsSuffixOnNameplate: numberWsSuffixOnNameplate,\n\n      enablePlayerIcon: enablePlayerIcon,\n      playerIconState: playerIconState,\n      playerIconPath: playerIconPath,\n\n      enableNoteTintColorLink: enableNoteTintColorLink,\n      pinIsRevealed: pinIsRevealed,\n      usePinIsRevealed: usePinIsRevealed,\n\n      previewAsTextSnippet: previewAsTextSnippet,\n      doNotShowJournalPreview: doNotShowJournalPreview,\n\n      tooltipPlacement: tooltipPlacement,\n      tooltipColor: tooltipColor,\n      tooltipForceRemove: tooltipForceRemove,\n      tooltipSmartPlacement: tooltipSmartPlacement,\n      tooltipFollowMouse: tooltipFollowMouse,\n\n      enableBackgroundlessPins: enableBackgroundlessPins,\n      enableNoteGM: enableNoteGM,\n\n      tooltipColorHtml: tooltipColorHtml,\n      tooltipPlacementHtml: tooltipPlacementHtml,\n\n      tooltipCustomDescription: tooltipCustomDescription,\n      tooltipShowDescription: tooltipShowDescription,\n      tooltipShowTitle: tooltipShowTitle,\n    },\n    app.object.flags[CONSTANTS.MODULE_ID] || {}\n  );\n  // pinCushionData.entity = JSON.stringify(entity);\n  let noteHtml = await renderTemplate(`modules/${CONSTANTS.MODULE_ID}/templates/note-config.html`, pinCushionData);\n\n  if ($(\".sheet-tabs\", html).length) {\n    $(\".sheet-tabs\", html).append(\n      $(\"<a>\")\n        .addClass(\"item\")\n        .attr(\"data-tab\", \"pincushion\")\n        .html('<i class=\"fas fa-map-marker-plus\"></i> Pin Cushion (GM Only)')\n    );\n    $(\"<div>\")\n      .addClass(\"tab action-sheet\")\n      .attr(\"data-tab\", \"pincushion\")\n      .html(noteHtml)\n      .insertAfter($(\".tab:last\", html));\n\n    // ====================================\n    // START SUPPORT MATT\n    // ====================================\n    /*\n\t\tif (game.modules.get(\"monks-active-tiles\")?.active && allowNote) {\n\t\t\t$(\".sheet-tabs\", html).append(\n\t\t\t\t$(\"<a>\").addClass(\"item\").attr(\"data-tab\", \"triggers\").html('<i class=\"fas fa-running\"></i> Triggers')\n\t\t\t);\n\t\t\t$(\"<div>\")\n\t\t\t\t.addClass(\"tab action-sheet\")\n\t\t\t\t.attr(\"data-tab\", \"triggers\")\n\t\t\t\t.html(noteTriggersHtml)\n\t\t\t\t.insertAfter($(\".tab:last\", html));\n\t\t}\n\t\t*/\n    // ====================================\n    // END SUPPORT MATT\n    // ====================================\n  } else {\n    let root = $(\"form\", html);\n    if (root.length == 0) root = html;\n    let basictab = $(\"<div>\").addClass(\"tab\").attr(\"data-tab\", \"basic\");\n    $(\"> *:not(button):not(footer)\", root).each(function () {\n      basictab.append(this);\n    });\n\n    // ====================================\n    // START SUPPORT MATT\n    // ====================================\n    /*\n\t\tif (game.modules.get(\"monks-active-tiles\")?.active && allowNote) {\n\t\t\t$(root)\n\t\t\t\t.prepend($(\"<div>\").addClass(\"tab action-sheet\").attr(\"data-tab\", \"triggers\").html(noteTriggersHtml))\n\t\t\t\t.prepend($(\"<div>\").addClass(\"tab action-sheet\").attr(\"data-tab\", \"pincushion\").html(noteHtml))\n\t\t\t\t.prepend(basictab)\n\t\t\t\t.prepend(\n\t\t\t\t\t$(\"<nav>\")\n\t\t\t\t\t\t.addClass(\"sheet-tabs tabs\")\n\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t$(\"<a>\")\n\t\t\t\t\t\t\t\t.addClass(\"item active\")\n\t\t\t\t\t\t\t\t.attr(\"data-tab\", \"basic\")\n\t\t\t\t\t\t\t\t.html('<i class=\"fas fa-university\"></i> Basic')\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t$(\"<a>\")\n\t\t\t\t\t\t\t\t.addClass(\"item\")\n\t\t\t\t\t\t\t\t.attr(\"data-tab\", \"pincushion\")\n\t\t\t\t\t\t\t\t.html('<i class=\"fas fa-map-marker-plus\"></i> Pin Cushion (GM Only)')\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t$(\"<a>\")\n\t\t\t\t\t\t\t\t.addClass(\"item\")\n\t\t\t\t\t\t\t\t.attr(\"data-tab\", \"triggers\")\n\t\t\t\t\t\t\t\t.html('<i class=\"fas fa-running\"></i> Triggers')\n\t\t\t\t\t\t)\n\t\t\t\t);\n\t\t} else {\n\t\t*/\n    // ====================================\n    // END SUPPORT MATT\n    // ====================================\n\n    $(root)\n      .prepend($(\"<div>\").addClass(\"tab action-sheet\").attr(\"data-tab\", \"pincushion\").html(noteHtml))\n      .prepend(basictab)\n      .prepend(\n        $(\"<nav>\")\n          .addClass(\"sheet-tabs tabs\")\n          .append(\n            $(\"<a>\").addClass(\"item active\").attr(\"data-tab\", \"basic\").html('<i class=\"fas fa-university\"></i> Basic')\n          )\n          .append(\n            $(\"<a>\")\n              .addClass(\"item\")\n              .attr(\"data-tab\", \"pincushion\")\n              .html('<i class=\"fas fa-map-marker-plus\"></i> Pin Cushion (GM Only)')\n          )\n      );\n    // }\n  }\n\n  // START LISTENERS\n\n  // ====================================\n  // START SUPPORT MATT\n  // ====================================\n  /*\n\tif (game.modules.get(\"monks-active-tiles\")?.active && allowNote) {\n\t\t$('button[data-type=\"entity\"]', html).on(\"click\", ActionConfig.selectEntity.bind(app));\n\t\t$('button[data-type=\"tagger\"]', html).on(\"click\", ActionConfig.addTag.bind(app));\n\t}\n\t*/\n  // ====================================\n  // END SUPPORT MATT\n  // ====================================\n\n  // html.find(\"button.file-picker-showImageExplicitSource\").each(\n  // \t(i, button) => (button.onclick = app._activateFilePicker.bind(app))\n  // );\n\n  $('button[data-target=\"flags.pin-cushion.showImageExplicitSource\"]', html).on(\n    \"click\",\n    app._activateFilePicker.bind(app)\n  );\n\n  $('button[data-target=\"flags.pin-cushion.PlayerIconPath\"]', html).on(\"click\", app._activateFilePicker.bind(app));\n\n  const iconCustomSelectorExplicit = html.find(\n    `input[name='flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.SHOW_IMAGE_EXPLICIT_SOURCE}']`\n  );\n  if (iconCustomSelectorExplicit?.length > 0) {\n    iconCustomSelectorExplicit.on(\"change\", function () {\n      const p = iconCustomSelectorExplicit.parent().find(\".pin-cushion-explicit-icon\");\n      p[0].src = this.value;\n    });\n  }\n\n  const iconCustomPlayerIconPath = html.find(\n    `input[name='flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.PLAYER_ICON_PATH}']`\n  );\n  if (iconCustomPlayerIconPath?.length > 0) {\n    iconCustomPlayerIconPath.on(\"change\", function () {\n      const p = iconCustomPlayerIconPath.parent().find(\".pin-cushion-journal-icon\");\n      p[0].src = this.value;\n    });\n  }\n\n  const iconCustomPageIcon = html.find(`select[name='pageId']`);\n  if (iconCustomPageIcon?.length > 0) {\n    iconCustomPageIcon.on(\"change\", function () {\n      const p = iconCustomPageIcon.parent().find(\".pin-cushion-page-icon\");\n      const pageId = this.value;\n      if (html.find(`select[name='entryId']`).length > 0) {\n        const entryId = html.find(`select[name='entryId']`)[0].value;\n        const firstImageFromPage = retrieveFirstImageFromJournalId(entryId, pageId, true);\n        if (firstImageFromPage) {\n          p[0].src = firstImageFromPage;\n        }\n      }\n    });\n  }\n\n  // ENDS LISTENERS\n\n  app.options.tabs = [{ navSelector: \".tabs\", contentSelector: \"form\", initial: \"basic\" }];\n  app.options.height = \"auto\";\n  app._tabs = app._createTabHandlers();\n  const el = html[0];\n  app._tabs.forEach((t) => t.bind(el));\n\n  app.setPosition();\n  /*\n\t// Force a recalculation of the height\n\tif (!app._minimized) {\n\t\tlet pos = app.position;\n\t\tpos.height = \"auto\";\n\t\tapp.setPosition(pos);\n\t}\n\t*/\n});\n\n/**\n * Hook on render HUD\n */\nHooks.on(\"renderHeadsUpDisplay\", (app, html, data) => {\n  // VERSION 1 TOOLTIP\n\n  html.append(`<template id=\"pin-cushion-hud\"></template>`);\n  canvas.hud.pinCushion = new PinCushionHUD();\n\n  // VERSION 2 TOOLTIP\n\n  // html.append(`<template id=\"pin-cushion-hud-v2\"></template>`);\n  // canvas.hud.pinCushionV2 = new PinCushionHUDV2();\n});\n\n/**\n * Hook on Note hover\n */\nHooks.on(\"hoverNote\", (note, hovered) => {\n  // const showPreview = game.settings.get(CONSTANTS.MODULE_ID, 'showJournalPreview');\n  const previewDelay = game.settings.get(CONSTANTS.MODULE_ID, \"previewDelay\");\n  let doNotShowJournalPreviewS = String(\n    getProperty(note, `document.flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.DO_NOT_SHOW_JOURNAL_PREVIEW}`)\n  );\n  if (doNotShowJournalPreviewS !== \"true\" && doNotShowJournalPreviewS !== \"false\") {\n    doNotShowJournalPreviewS = \"true\";\n  }\n  const doNotShowJournalPreview = String(doNotShowJournalPreviewS) === \"true\" ? true : false;\n  if (doNotShowJournalPreview) {\n    return;\n  }\n\n  let tooltipForceRemoveS = String(\n    getProperty(note, `document.flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.TOOLTIP_FORCE_REMOVE}`)\n  );\n  if (tooltipForceRemoveS !== \"true\" && tooltipForceRemoveS !== \"false\") {\n    tooltipForceRemoveS = \"false\";\n  }\n  const tooltipForceRemove = String(tooltipForceRemoveS) === \"true\" ? true : false;\n\n  // VERSION 1 TOOLTIP\n\n  if (!hovered) {\n    clearTimeout(API.pinCushion.hoverTimer);\n    if (tooltipForceRemove) {\n      $(\"#powerTip\").remove();\n    }\n    return canvas.hud.pinCushion.clear();\n  }\n\n  // If the note is hovered by the mouse cursor (not via alt/option)\n  if (hovered) {\n    // TODO && note.mouseInteractionManager.state === 1\n    API.pinCushion.hoverTimer = setTimeout(function () {\n      canvas.hud.pinCushion.bind(note);\n    }, previewDelay);\n    return;\n  } else {\n    // THis code should be never reached\n    if (!hovered) {\n      clearTimeout(API.pinCushion.hoverTimer);\n      return canvas.hud.pinCushion.clear();\n    }\n  }\n\n  // VERSION 2 TOOLTIP\n  /*\n    // If the note is hovered by the mouse cursor (not via alt/option)\n    if (hovered ) { // TODO && note.mouseInteractionManager.state === 1\n\t\tcanvas.hud.pinCushionV2.bind(note)\n\t} else {\n\t\tcanvas.hud.pinCushionV2.clear()\n\t}\n\t*/\n});\n\n/**\n * Hook on render Journal Directory\n */\nHooks.on(\"renderJournalDirectory\", (app, html, data) => {\n  PinCushion._addJournalThumbnail(app, html, data);\n  PinCushion._addJournalDirectoryPages(app, html, data);\n});\n\nHooks.on(\"deleteJournalEntryPage\", () => {\n  PinCushion._deleteJournalDirectoryPagesEntry();\n});\n\nHooks.on(\"createJournalEntryPage\", () => {\n  PinCushion._createJournalDirectoryPagesEntry();\n});\n\nHooks.on(\"renderJournalSheet\", (app, html, data) => {\n  PinCushion._renderJournalThumbnail(app, html);\n});\n\nHooks.once(\"canvasInit\", () => {\n  // This module is only required for GMs (game.user accessible from 'ready' event but not 'init' event)\n  if (game.user.isGM && game.settings.get(CONSTANTS.MODULE_ID, \"noteGM\")) {\n    // eslint-disable-next-line no-undef\n    libWrapper.register(\n      CONSTANTS.MODULE_ID,\n      \"Note.prototype._drawTooltip\",\n      PinCushion._addDrawTooltipWithNoteGM,\n      \"WRAPPER\"\n    );\n  } else {\n    // eslint-disable-next-line no-undef\n    libWrapper.register(CONSTANTS.MODULE_ID, \"Note.prototype._drawTooltip\", PinCushion._addDrawTooltip2, \"MIXED\");\n  }\n\n  libWrapper.register(CONSTANTS.MODULE_ID, \"Note.prototype._applyRenderFlags\", PinCushion._applyRenderFlags, \"MIXED\");\n\n  // eslint-disable-next-line no-undef\n  libWrapper.register(CONSTANTS.MODULE_ID, \"Note.prototype.refresh\", PinCushion._noteRefresh, \"WRAPPER\");\n\n  libWrapper.register(CONSTANTS.MODULE_ID, \"Note.prototype._onUpdate\", PinCushion._noteUpdate, \"WRAPPER\");\n\n  // eslint-disable-next-line no-undef\n  libWrapper.register(CONSTANTS.MODULE_ID, \"Note.prototype.isVisible\", PinCushion._isVisible, \"MIXED\");\n\n  // eslint-disable-next-line no-undef\n  libWrapper.register(CONSTANTS.MODULE_ID, \"Note.prototype._drawControlIcon\", PinCushion._drawControlIcon, \"OVERRIDE\");\n\n  // eslint-disable-next-line no-undef\n  libWrapper.register(CONSTANTS.MODULE_ID, \"Note.prototype._canControl\", PinCushion._canControl, \"MIXED\");\n\n  // DEPRECATED ON V11\n  //   const enableOneClickNoteCreation = game.settings.get(CONSTANTS.MODULE_ID, \"oneClickNoteCreation\");\n  //   if (enableOneClickNoteCreation) {\n  //     // This module is only required for GMs (game.user accessible from 'ready' event but not 'init' event)\n  //     if (game.user.isGM) {\n  //       // eslint-disable-next-line no-undef\n  //       libWrapper.register(\n  //         CONSTANTS.MODULE_ID,\n  //         \"NotesLayer.prototype._onClickLeft\",\n  //         PinCushion._onSingleClick,\n  //         \"OVERRIDE\"\n  //       );\n  //     }\n  //   }\n});\n\nHooks.on(\"renderSettingsConfig\", (app, html, data) => {\n  // Add colour pickers to the Configure Game Settings: Module Settings menu\n  let name, colour;\n  name = `${CONSTANTS.MODULE_ID}.revealedNotesTintColorLink`;\n  colour = game.settings.get(CONSTANTS.MODULE_ID, \"revealedNotesTintColorLink\");\n  $(\"<input>\")\n    .attr(\"type\", \"color\")\n    .attr(\"data-edit\", name)\n    .val(colour)\n    .insertAfter($(`input[name=\"${name}\"]`, html).addClass(\"color\"));\n\n  name = `${CONSTANTS.MODULE_ID}.revealedNotesTintColorNotLink`;\n  colour = game.settings.get(CONSTANTS.MODULE_ID, \"revealedNotesTintColorNotLink\");\n  $(\"<input>\")\n    .attr(\"type\", \"color\")\n    .attr(\"data-edit\", name)\n    .val(colour)\n    .insertAfter($(`input[name=\"${name}\"]`, html).addClass(\"color\"));\n\n  name = `${CONSTANTS.MODULE_ID}.revealedNotesTintColorRevealed`;\n  colour = game.settings.get(CONSTANTS.MODULE_ID, \"revealedNotesTintColorRevealed\");\n  $(\"<input>\")\n    .attr(\"type\", \"color\")\n    .attr(\"data-edit\", name)\n    .val(colour)\n    .insertAfter($(`input[name=\"${name}\"]`, html).addClass(\"color\"));\n\n  name = `${CONSTANTS.MODULE_ID}.revealedNotesTintColorNotRevealed`;\n  colour = game.settings.get(CONSTANTS.MODULE_ID, \"revealedNotesTintColorNotRevealed\");\n  $(\"<input>\")\n    .attr(\"type\", \"color\")\n    .attr(\"data-edit\", name)\n    .val(colour)\n    .insertAfter($(`input[name=\"${name}\"]`, html).addClass(\"color\"));\n});\n\n// This runs only on canvas drop and after the renderNoteConfig hook above.\n// It ensures that we have fill the html of the NoteConfig window with the correct data on first drop.\nHooks.on(\"dropCanvasData\", (canvas, data) => {\n  const enableJournalAnchorLink = game.settings.get(CONSTANTS.MODULE_ID, \"enableJournalAnchorLink\");\n  if (enableJournalAnchorLink && !game.modules.get(\"jal\")?.active) {\n    if (!(data.type === \"JournalEntryPage\" && data.anchor)) {\n      return;\n    }\n    const { anchor } = data;\n\n    Hooks.once(\"renderNoteConfig\", (_, html, { label }) => {\n      html.find(\"input[name='text']\").val(`${label}: ${anchor.name}`);\n      html.find(`option[value=${anchor.slug}]`).attr(\"selected\", true);\n    });\n  }\n});\n\n// Why doesn't this just exist in core foundry?\nHooks.on(\"activateNote\", (note, options) => {\n  const enableJournalAnchorLink = game.settings.get(CONSTANTS.MODULE_ID, \"enableJournalAnchorLink\");\n  if (enableJournalAnchorLink && !game.modules.get(\"jal\")?.active) {\n    let anchorData = getProperty(note, `document.flags.${CONSTANTS.MODULE_ID}.${CONSTANTS.FLAGS.JAL_ANCHOR}`);\n    options.anchor = anchorData?.slug;\n    //options.anchor = note.document.flags.anchor?.slug;\n  }\n});\n\n// Hooks.on(\"canvasReady\", () => {\n// \t// VERSION 2 TOOLTIP\n// \t// PinCushionContainer.onReady();\n// });\n"],"names":["this","$","info","warn","error","journalEntry","canvas","valueIconSelector","valuepageSelector","pageiimage","result","API","window"],"mappings":"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"}